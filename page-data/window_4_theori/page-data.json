{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/window_4_theori/",
    "result": {"data":{"cur":{"id":"60cba5e7-39d0-5855-a5bc-bcc248468cd4","html":"<h1 id=\"teb-thread-environment-block\" style=\"position:relative;\"><a href=\"#teb-thread-environment-block\" aria-label=\"teb thread environment block permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TEB (Thread Environment Block)</h1>\n<ul>\n<li>프로세스에서 실행되는 스레드에 대한 정보를 담고 있는 구조체</li>\n<li>스레드별로 TEB 구조체가 하나씩 할당된다.</li>\n<li>OS 종류별로 해당 모양이 조금씩 달라진다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_TEB</span> <span class=\"token punctuation\">{</span>\n  PVOID Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PPEB  ProcessEnvironmentBlock<span class=\"token punctuation\">;</span>\n  PVOID Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">399</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  BYTE  Reserved3<span class=\"token punctuation\">[</span><span class=\"token number\">1952</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID TlsSlots<span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  BYTE  Reserved4<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID Reserved5<span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID ReservedForOle<span class=\"token punctuation\">;</span>\n  PVOID Reserved6<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID TlsExpansionSlots<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> TEB<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PTEB<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">001</span><span class=\"token operator\">></span> dt _TEB\nntdll<span class=\"token operator\">!</span>_TEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> NtTib            <span class=\"token operator\">:</span> _NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x01c</span> EnvironmentPointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x020</span> ClientId         <span class=\"token operator\">:</span> _CLIENT_ID\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> ActiveRpcHandle  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x02c</span> ThreadLocalStoragePointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessEnvironmentBlock <span class=\"token operator\">:</span> Ptr32 _PEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x034</span> LastErrorValue   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x038</span> CountOfOwnedCriticalSections <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x03c</span> CsrClientThread  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x040</span> Win32ThreadInfo  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x044</span> User32Reserved   <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0ac</span> UserReserved     <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c0</span> WOW32Reserved    <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c4</span> CurrentLocale    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c8</span> FpSoftwareStatusRegister <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0cc</span> ReservedForDebuggerInstrumentation <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x10c</span> SystemReserved1  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x174</span> PlaceholderCompatibilityMode <span class=\"token operator\">:</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x175</span> PlaceholderHydrationAlwaysExplicit <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x176</span> PlaceholderReserved <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x180</span> ProxiedProcessId <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x184</span> _ActivationStack <span class=\"token operator\">:</span> _ACTIVATION_CONTEXT_STACK\n   <span class=\"token operator\">+</span><span class=\"token number\">0x19c</span> WorkingOnBehalfTicket <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1a4</span> ExceptionCode    <span class=\"token operator\">:</span> Int4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1a8</span> ActivationContextStackPointer <span class=\"token operator\">:</span> Ptr32 _ACTIVATION_CONTEXT_STACK\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1ac</span> InstrumentationCallbackSp <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b0</span> InstrumentationCallbackPreviousPc <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b4</span> InstrumentationCallbackPreviousSp <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b8</span> InstrumentationCallbackDisabled <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b9</span> SpareBytes       <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1d0</span> TxFsContext      <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1d4</span> GdiTebBatch      <span class=\"token operator\">:</span> _GDI_TEB_BATCH\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6b4</span> RealClientId     <span class=\"token operator\">:</span> _CLIENT_ID\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6bc</span> GdiCachedProcessHandle <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6c0</span> GdiClientPID     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6c4</span> GdiClientTID     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6c8</span> GdiThreadLocalInfo <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6cc</span> Win32ClientInfo  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">62</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c4</span> glDispatchTable  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">233</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xb68</span> glReserved1      <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">29</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbdc</span> glReserved2      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbe0</span> glSectionInfo    <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbe4</span> glSection        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbe8</span> glTable          <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbec</span> glCurrentRC      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbf0</span> glContext        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbf4</span> LastStatusValue  <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbf8</span> StaticUnicodeString <span class=\"token operator\">:</span> _UNICODE_STRING\n   <span class=\"token operator\">+</span><span class=\"token number\">0xc00</span> StaticUnicodeBuffer <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">261</span><span class=\"token punctuation\">]</span> Wchar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xe0c</span> DeallocationStack <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xe10</span> TlsSlots         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf10</span> TlsLinks         <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf18</span> Vdm              <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf1c</span> ReservedForNtRpc <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf20</span> DbgSsReserved    <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf28</span> HardErrorMode    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf2c</span> Instrumentation  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf50</span> ActivityId       <span class=\"token operator\">:</span> _GUID\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf60</span> SubProcessTag    <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf64</span> PerflibData      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf68</span> EtwTraceData     <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf6c</span> WinSockData      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf70</span> GdiBatchCount    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf74</span> CurrentIdealProcessor <span class=\"token operator\">:</span> _PROCESSOR_NUMBER\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf74</span> IdealProcessorValue <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf74</span> ReservedPad0     <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf75</span> ReservedPad1     <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf76</span> ReservedPad2     <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf77</span> IdealProcessor   <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf78</span> GuaranteedStackBytes <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf7c</span> ReservedForPerf  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf80</span> ReservedForOle   <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf84</span> WaitingOnLoaderLock <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf88</span> SavedPriorityState <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf8c</span> ReservedForCodeCoverage <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf90</span> ThreadPoolData   <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf94</span> TlsExpansionSlots <span class=\"token operator\">:</span> Ptr32 Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf98</span> MuiGeneration    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf9c</span> IsImpersonating  <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfa0</span> NlsCache         <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfa4</span> pShimData        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfa8</span> HeapData         <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfac</span> CurrentTransactionHandle <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfb0</span> ActiveFrame      <span class=\"token operator\">:</span> Ptr32 _TEB_ACTIVE_FRAME\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfb4</span> FlsData          <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfb8</span> PreferredLanguages <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfbc</span> UserPrefLanguages <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc0</span> MergedPrefLanguages <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc4</span> MuiImpersonation <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc8</span> CrossTebFlags    <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc8</span> SpareCrossTebBits <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SameTebFlags     <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SafeThunkCall    <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> InDebugPrint     <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> HasFiberData     <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SkipThreadAttach <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> WerInShipAssertCode <span class=\"token operator\">:</span> Pos <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> RanProcessInit   <span class=\"token operator\">:</span> Pos <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> ClonedThread     <span class=\"token operator\">:</span> Pos <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SuppressDebugMsg <span class=\"token operator\">:</span> Pos <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> DisableUserStackWalk <span class=\"token operator\">:</span> Pos <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> RtlExceptionAttached <span class=\"token operator\">:</span> Pos <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> InitialThread    <span class=\"token operator\">:</span> Pos <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SessionAware     <span class=\"token operator\">:</span> Pos <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> LoadOwner        <span class=\"token operator\">:</span> Pos <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> LoaderWorker     <span class=\"token operator\">:</span> Pos <span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SkipLoaderInit   <span class=\"token operator\">:</span> Pos <span class=\"token number\">14</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SpareSameTebBits <span class=\"token operator\">:</span> Pos <span class=\"token number\">15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfcc</span> TxnScopeEnterCallback <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfd0</span> TxnScopeExitCallback <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfd4</span> TxnScopeContext  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfd8</span> LockCount        <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfdc</span> WowTebOffset     <span class=\"token operator\">:</span> Int4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfe0</span> ResourceRetValue <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfe4</span> ReservedForWdf   <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfe8</span> ReservedForCrt   <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xff0</span> EffectiveContainerId <span class=\"token operator\">:</span> _GUID</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">001</span><span class=\"token operator\">></span> dt _TEB\nntdll<span class=\"token operator\">!</span>_TEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> NtTib            <span class=\"token operator\">:</span> _NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x01c</span> EnvironmentPointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x020</span> ClientId         <span class=\"token operator\">:</span> _CLIENT_ID\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> ActiveRpcHandle  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x02c</span> ThreadLocalStoragePointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessEnvironmentBlock <span class=\"token operator\">:</span> Ptr32 _PEB\n\t <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"processenvironmentblock-member\" style=\"position:relative;\"><a href=\"#processenvironmentblock-member\" aria-label=\"processenvironmentblock member permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ProcessEnvironmentBlock member</h3>\n<ul>\n<li>0x30 offset 에 위치한 ProcessEnvironmentBlock member</li>\n<li>PEB(Process Environment Block) 구조체의 포인터이다.</li>\n<li>PEB는 프로세스 별로 하나만 생성된다.</li>\n</ul>\n<h3 id=\"nttib-member\" style=\"position:relative;\"><a href=\"#nttib-member\" aria-label=\"nttib member permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NtTib member</h3>\n<ul>\n<li>TEB 구조체의 첫 번째 멤버는 <code class=\"language-text\">_NT_TIB</code> 구조체이다.</li>\n<li>_NT_TIB (_NT_Thread information Block)</li>\n<li>현재 실행 중인 스레드에 대한 정보를 저장하고 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_NT_TIB</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_REGISTRATION_RECORD</span> <span class=\"token operator\">*</span>ExceptionList<span class=\"token punctuation\">;</span>\n    PVOID StackBase<span class=\"token punctuation\">;</span>\n    PVOID StackLimit<span class=\"token punctuation\">;</span>\n    PVOID SubSystemTib<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>_MSC_EXTENSIONS<span class=\"token punctuation\">)</span></span></span>\n    <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n        PVOID FiberData<span class=\"token punctuation\">;</span>\n        DWORD Version<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n    PVOID FiberData<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n    PVOID ArbitraryUserPointer<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_NT_TIB</span> <span class=\"token operator\">*</span>Self<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> NT_TIB<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">typedef</span> NT_TIB <span class=\"token operator\">*</span>PNT_TIB<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>ExceptionList member는 _EXCEPTION_REGISTRATION_RECORD 구조체 연결 리스트를 가리키고 있다. 이것은 SEH(Structured Exception Handler) 라고 하는 Window OS의 예외 처리 메커니즘에 사용된다.</li>\n<li>Self 멤버는 _NT_TIB 구조체의 셀프 포인터이며 곧 TEB 구조체 포인터이기도 한다. (TEB 구조체 첫 번째 멤버가 _NT_TIB 구조체이기 때문이다.)</li>\n</ul>\n<h2 id=\"유저-모드-teb-접근-방법\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EC%A0%80-%EB%AA%A8%EB%93%9C-teb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\" aria-label=\"유저 모드 teb 접근 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유저 모드 TEB 접근 방법</h2>\n<h3 id=\"ntdllntcurrentteb\" style=\"position:relative;\"><a href=\"#ntdllntcurrentteb\" aria-label=\"ntdllntcurrentteb permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ntdll.NtCurrentTeb()</h3>\n<ul>\n<li>Ntdll.NtCurrentTeb() API는 현재 스레드의 TEB 구조체 주소를 리턴하는 함수이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVQY0y3L4XJDMAAAYO//Ul23m2okKSEJcYoeIorS0uoWs+tud9/fz8C+54uEcEFFjBziHmDAaBCEruezMDomSZZmsqqklEVZ5sVLWUopK6WUgTGwgRVw6mDoYGCZW2zv7f2OEsQpCZknOGWMHqCNEHQhwMBk1BMBi6PQyGNO7I/qFKaC5DHFuy0yN87+vcrE86rmQfUq6+rie2y+bmc9NsvULvdOT62eWqPOY+6Cvj6lws+PDFlbaG4CYs9Xtepx1ePjdh4a+TP3+t4tj8v6HNa5f3kOBvh84wTWRXIMvTSiHrZctIuY01anoSmubdnItD/Ln8dFT91y7/7nn19hlAa2U/3ljAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/313b08180b86b127459eec3e7216e166/37523/0.png\"\n        srcset=\"/static/313b08180b86b127459eec3e7216e166/e9ff0/0.png 180w,\n/static/313b08180b86b127459eec3e7216e166/f21e7/0.png 360w,\n/static/313b08180b86b127459eec3e7216e166/37523/0.png 720w,\n/static/313b08180b86b127459eec3e7216e166/302a4/0.png 1080w,\n/static/313b08180b86b127459eec3e7216e166/b5cea/0.png 1140w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQY02XPW2+CMACGYf7/31l2sSsWzSYagR5oQWgplEpBxkHUTd0mC0vc4pY8F+93+RmXYzec+12tObTlykuZryWrtfR8GDFaZrIISZWLusiaUnVV/k03WvZKGCqJtOQiCsBijhwbI4AhoBhaEDjQ9SD07CVBgGAYBjQVcRLzEWcpC41qHW8UqxQvFWuL9NDk+3p9aPVw7C5v7egan6/NrdYYPvbD+2503g3nfjhtR8ft2D/zdJ23jMCnCNiUYOAsMQau7XjIJQR6rkUxJhitqEcQiHmUCP6H8Twxp+Z0tnhy3Lk5M+/uHyazRxfNA+KIkEQ+bEvZbVS3yf4zMLQiBaPMFQXkGqQviPKljS0R0zKPlQz7Wv9eu/UFCPh13YKrvi4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/0ddfab9384ee51c255ffd546801bd9a8/37523/1.png\"\n        srcset=\"/static/0ddfab9384ee51c255ffd546801bd9a8/e9ff0/1.png 180w,\n/static/0ddfab9384ee51c255ffd546801bd9a8/f21e7/1.png 360w,\n/static/0ddfab9384ee51c255ffd546801bd9a8/37523/1.png 720w,\n/static/0ddfab9384ee51c255ffd546801bd9a8/eafa0/1.png 939w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>NtCurrentTeb() 의 내부 코드는 아주 간단하게 구성되어 있다.</li>\n<li><code class=\"language-text\">FS:[18]</code> 주소의 값을 리턴 한다.</li>\n<li>FS:[18] 실제 주소 <code class=\"language-text\">00281018</code> 을 확인할 수 있는데 메모리 창에서 주소를 확인해보면 <code class=\"language-text\">00281000</code> 값이 들어 있다.</li>\n<li>NtCuurentTeb() API 는 이 값을 리턴하고 있다.</li>\n<li>따라서 이 값이 바로 현재 스레드의 TEB 주소 이다.</li>\n<li>TEB 주소(00281000) 주소는 FS 세그먼트 레지스터가 가리키는 세그먼트 메모리의 베이스 주소와 일치한다.</li>\n</ul>\n<h2 id=\"fs-segment-register\" style=\"position:relative;\"><a href=\"#fs-segment-register\" aria-label=\"fs segment register permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS Segment Register</h2>\n<ul>\n<li>FS 세그먼트 레지스터는 현재 스레드의 TEB를 지시하는데 사용한다.</li>\n<li><code class=\"language-text\">IA32</code> 시스템에서는 프로세스의 가상 메모리 크기가 4GB이므로 32비트 크기의 포인터를 이용해야 전체 메모리 공간에 접근이 가능하다.</li>\n<li>FS 레지스터의 크기는 16비트밖에 안된다.</li>\n<li>FS 레지스터는 직접 TEB 주소를 가리키는 것이 아니라, 실제 TEB 주소를 가지고 있는 <code class=\"language-text\">Segment Descriptor Table</code> 의 Index를 가지고 있는것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Segment Descriptor Table은 커널 메모리 영역에 존재하며\n특수 레지스터인 <span class=\"token function\">GDTR</span><span class=\"token punctuation\">(</span>Global Descriptor Table Register<span class=\"token punctuation\">)</span>에 그 주소가 저장되어 있다<span class=\"token punctuation\">.</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVQoz3WS3UsUURjG95/JdeecmTMzO64frLtq67q6bquuaWkZq5uaBUEJhWQpCHWRghRSBFb4hZn2BUFEhUUX4YUE1VXdSF1UhFFCCbK/2GmjoLp4eF7OOfx43vO+HiHNrBAKIZTrUrfwaQbB8koSDSmqY3Fi8R1E6xLU1icJFJeh5d8Jaf6WbrlnHqGbSNOflZaDK2Xj0xSOU8LyxU5ez2d4OZNhbbGbq8O78Ek/QiqkNDEME6UslGEhpXLBHqnb2eDhRzSdeZONjazhJAcQhV4su5jnY+18m0rzaXIfW7Od3Dyxk20+E123CIajJFN7iMabSTS2Eaqs+wW0qG3qp75lkPrWIUpDjQhh4DjFvLp8gK17x/ly6yjcP8ad0x14pY0Sisj4OPFnT2l/vEzi6ROi83MoswhPjmqaCqV0V4ah0ISJbRexej7N12t9vJ/u4ftiH4tDuynQLPQcsL+HugunSJ4bJD5xkujIkZ/A3F/4CgWFXg2fV3PT5YCWVcSLiQ42F7pYn+kku5Th9nCr27Jh2FQGq4mU11AVjLq+vbwmn1C3MMMJiiIpnEgzRqACTTNc4OpEBxvXM3yY7WTzxn6W8kDdsAiGIoSrYoQra1wPVUQxlINHkzbV/Sukxz/SevYzgYYhhK8A21/Cyuhe1q908e5Smo2pDAsDLRRouaGY7or8Sx4hc0UJUi9F6mVI3XEvbDvA2+k0POiFu92w3MfD0bb8lM2/9zAvj9RzhfGHFLrhx7aLGUsnmT7YxGRvI3OHUgy01lEocrD/J/wByl+GNmQQIYoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./SGT.png\"\n        title=\"./SGT.png\"\n        src=\"/static/072d5e551d215b08984b841e81b2b639/37523/SGT.png\"\n        srcset=\"/static/072d5e551d215b08984b841e81b2b639/e9ff0/SGT.png 180w,\n/static/072d5e551d215b08984b841e81b2b639/f21e7/SGT.png 360w,\n/static/072d5e551d215b08984b841e81b2b639/37523/SGT.png 720w,\n/static/072d5e551d215b08984b841e81b2b639/302a4/SGT.png 1080w,\n/static/072d5e551d215b08984b841e81b2b639/07a9c/SGT.png 1440w,\n/static/072d5e551d215b08984b841e81b2b639/74e37/SGT.png 1732w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>세그먼트 레지스터는 실제로 Segment Descriptor Table의 Index를 가지고 있기 때문에 Segment Selector 라는 별칭을 가지고 있다.</li>\n<li>FS 세그먼트 셀렉터가 가리키는 세그먼트 메모리의 시작주소 (base address) 에 TEB 구조체가 위치하는 것을 확인할 수 있다.</li>\n</ul>\n<h3 id=\"fs0x18--teb-base-address\" style=\"position:relative;\"><a href=\"#fs0x18--teb-base-address\" aria-label=\"fs0x18  teb base address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS:[0x18] = TEB base address</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>NtTib<span class=\"token punctuation\">.</span>Self <span class=\"token operator\">=</span> address of TIB <span class=\"token operator\">=</span> address of TEB <span class=\"token operator\">=</span> FS<span class=\"token operator\">:</span><span class=\"token number\">0</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x2810100</span>\n\nFS<span class=\"token operator\">:</span><span class=\"token number\">0</span> 의 의미는 FS 레지스터가 Indexing 하는 Segment Descriptor가 가리키는 Segment Memory의\n시작 주소이다<span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"fs0x30--peb-base-address\" style=\"position:relative;\"><a href=\"#fs0x30--peb-base-address\" aria-label=\"fs0x30  peb base address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS:[0x30] = PEB base address</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>ProcessEnvironmentBlock <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<h3 id=\"fs0x0--seh-base-address\" style=\"position:relative;\"><a href=\"#fs0x0--seh-base-address\" aria-label=\"fs0x0  seh base address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS:[0x0] = SEH base address</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>NtTib<span class=\"token punctuation\">.</span>ExceptionList <span class=\"token operator\">=</span> address of SEH</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<ul>\n<li><a href=\"#processenvironmentblock-member\">ProcessEnvironmentBlock member</a></li>\n<li><a href=\"#nttib-member\">NtTib member</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%9C%A0%EC%A0%80-%EB%AA%A8%EB%93%9C-teb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\">유저 모드 TEB 접근 방법</a></p>\n<ul>\n<li><a href=\"#ntdllntcurrentteb\">Ntdll.NtCurrentTeb()</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#fs-segment-register\">FS Segment Register</a></p>\n<ul>\n<li><a href=\"#fs0x18--teb-base-address\">FS:[0x18] = TEB base address</a></li>\n<li><a href=\"#fs0x30--peb-base-address\">FS:[0x30] = PEB base address</a></li>\n<li><a href=\"#fs0x0--seh-base-address\">FS:[0x0] = SEH base address</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"TEB (Thread Environment Block) 프로세스에서 실행되는 스레드에 대한 정보를 담고 있는 구조체 스레드별로 TEB 구조체가 하나씩 할당된다. OS 종류별로 해당 모양이 조금씩 달라진다. ProcessEnvironmentBlock member 0x30 offset 에 위치한 ProcessEnvironmentBlock member PEB(Process Environment Block) 구조체의 포인터이다. PEB는 프로세스 별로 하나만 생성된다. NtTib member TEB 구조체의 첫 번째 멤버는  구조체이다. _NT_TIB (_NT_Thread information Block) 현재 실행 중인 스레드에 대한 정보를 저장하고 있다. ExceptionList member는 _EXCEPTION_REGISTRATION_RECORD 구조체 연결 리스트를 가리키고 있다. 이것은 SEH(Structured Exception Handler) 라고 하는 Window OS의 예…","frontmatter":{"date":"January 03, 2021","title":"TEB (Thread Environment Block)","categories":"Windows","author":"Zer0Luck","emoji":"🍬"},"fields":{"slug":"/window_4_theori/"}},"next":{"id":"b1774849-da4b-5855-9b5c-547e7a977783","html":"<h1 id=\"fuzz\" style=\"position:relative;\"><a href=\"#fuzz\" aria-label=\"fuzz permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fuzz</h1>\n<p><strong>Fuzzing</strong> or <strong>fuzz testing</strong> is an automated <a href=\"https://en.wikipedia.org/wiki/Software_testing\">software testing</a> technique that involves providing invalid, unexpected, or <a href=\"https://en.wikipedia.org/wiki/Random_data\">random data</a> as inputs to a <a href=\"https://en.wikipedia.org/wiki/Computer_program\">computer program</a>. The program is then monitored for exceptions such as <a href=\"https://en.wikipedia.org/wiki/Crash_(computing)\">crashes</a>, failing built-in code <a href=\"https://en.wikipedia.org/wiki/Assertion_(software_development)\">assertions</a>, or potential <a href=\"https://en.wikipedia.org/wiki/Memory_leak\">memory leaks</a>. Typically, fuzzers are used to test programs that take structured inputs. This structure is specified, e.g., in a <a href=\"https://en.wikipedia.org/wiki/File_format\">file format</a> or <a href=\"https://en.wikipedia.org/wiki/Communications_protocol\">protocol</a> and distinguishes valid from invalid input. An effective fuzzer generates semi-valid inputs that are “valid enough” in that they are not directly rejected by the parser, but do create unexpected behaviors deeper in the program and are “invalid enough” to expose <a href=\"https://en.wikipedia.org/wiki/Corner_case\">corner cases</a> that have not been properly dealt with.</p>\n<p>For the purpose of security, input that crosses a <a href=\"https://en.wikipedia.org/wiki/Trust_boundary\">trust boundary</a> is often the most interesting. For example, it is more important to fuzz code that handles the upload of a file by any user than it is to fuzz the code that parses a configuration file that is accessible only to a privileged user.</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Fuzzing\"><em>https://en.wikipedia.org/wiki/Fuzzing</em></a></p>\n<h2 id=\"fuzzer-tool\" style=\"position:relative;\"><a href=\"#fuzzer-tool\" aria-label=\"fuzzer tool permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fuzzer tool</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token number\">1.</span> Window PE <span class=\"token builtin\">file</span> fuzzing operation\n<span class=\"token number\">2.</span> dumb fuzzer\n<span class=\"token number\">3.</span> Customizable TestCase\n<span class=\"token number\">4.</span> GUI Interface using PyQt\n<span class=\"token number\">5.</span> Message Box notification when Crash <span class=\"token keyword\">is</span> detected</code></pre></div>\n<h2 id=\"required-installation\" style=\"position:relative;\"><a href=\"#required-installation\" aria-label=\"required installation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Required installation</h2>\n<ul>\n<li><a href=\"https://vallhalla-edition.tistory.com/attachment/cfile23.uf@9959693E5C98A9A80FBC86.exe\">PaiMei-1.1.win32.exe</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">######################################################################</span>\n<span class=\"token comment\">#  This file should be kept compatible with Python 2.3, see PEP 291. #</span>\n<span class=\"token comment\">######################################################################</span>\n<span class=\"token triple-quoted-string string\">\"\"\"create and manipulate C data types in Python\"\"\"</span>\n\n<span class=\"token keyword\">import</span> os <span class=\"token keyword\">as</span> _os<span class=\"token punctuation\">,</span> sys <span class=\"token keyword\">as</span> _sys\n\n__version__ <span class=\"token operator\">=</span> <span class=\"token string\">\"1.1.0\"</span>\n\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> Union<span class=\"token punctuation\">,</span> Structure<span class=\"token punctuation\">,</span> Array\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> _Pointer\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> CFuncPtr <span class=\"token keyword\">as</span> _CFuncPtr\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> __version__ <span class=\"token keyword\">as</span> _ctypes_version\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> RTLD_LOCAL<span class=\"token punctuation\">,</span> RTLD_GLOBAL\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> ArgumentError\n\n<span class=\"token keyword\">from</span> _ctypes <span class=\"token keyword\">import</span> Structure <span class=\"token keyword\">as</span> _ctypesStructure       <span class=\"token comment\"># Add for Paimei</span>\n<span class=\"token keyword\">from</span> struct <span class=\"token keyword\">import</span> calcsize <span class=\"token keyword\">as</span> _calcsize\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Structure</span> <span class=\"token punctuation\">(</span>_ctypesStructure<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">pass</span>                <span class=\"token comment\"># Add for Paimei</span>\n\n<span class=\"token keyword\">if</span> __version__ <span class=\"token operator\">!=</span> _ctypes_version<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Version number mismatch\"</span><span class=\"token punctuation\">,</span> __version__<span class=\"token punctuation\">,</span> _ctypes_version<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>For compatibility with python 2.7.x version, modify the <strong>init</strong>.py file.</li>\n</ul>\n<p><code class=\"language-text\">PATH: C:\\Python27\\Lib\\ctypes\\**init**.py</code></p>\n<ul>\n<li>If you added the code in lines 17 and 19, download the rebuilt pydasm.pyd file for Python 2.7.x.</li>\n<li>After that, copy it to the C:\\Python27\\Lib\\site-packages\\pydbg folder.</li>\n</ul>\n<p>If there is an existing pydasm.pyd file, it will be overwritten.</p>\n<ul>\n<li><a href=\"https://vallhalla-edition.tistory.com/attachment/cfile27.uf@99B4814F5C98AB6A29F4DB.pyd\">pydasm.pyd</a></li>\n</ul>\n<p><strong>pydasm test</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pydbg\n<span class=\"token keyword\">print</span> <span class=\"token string\">\"Hello, pydbg!\"</span></code></pre></div>\n<ul>\n<li>success!</li>\n</ul>\n<h2 id=\"options-cli\" style=\"position:relative;\"><a href=\"#options-cli\" aria-label=\"options cli permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options (CLI)</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">-</span>t<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>target <span class=\"token punctuation\">:</span> Binary to fuzz\n<span class=\"token operator\">-</span>s<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>sample <span class=\"token punctuation\">:</span> Sample folder name <span class=\"token punctuation\">(</span>Test Case <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">-</span>h<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token builtin\">help</span> <span class=\"token punctuation\">:</span> <span class=\"token builtin\">help</span></code></pre></div>\n<h2 id=\"blueprint-gui\" style=\"position:relative;\"><a href=\"#blueprint-gui\" aria-label=\"blueprint gui permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BluePrint (GUI)</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoElEQVQoz2XM+0tTARjG8fOXRESJupbToW66s7a57ezsKBYzm23ulmULF5mlJWkX7YK0bmqNLrSuphSDoDQoiCiqfyCJLlQk9EsFRYVt53zDzaLLDx/e93leeAXX2e84TnzAdvwdSuor0TOgjIEyDvUTfxgvaJgo3LxX542BfBHkC1p+Cs7uDM74MO7RTzQOzODrm8bT9QwxPo15/VNM/5jrxI1PsXc8x9XzhNCu+yhnNJQ0eM9pCN6OFA3BrbiTM1TYAuiW6NDrzUh2O8EVTkIr/zbXSXYH5QaR0iU6FhtkrMdziCPgOqkhtPacJtG9AyU5Q7mjBV1JEfoKC32JJh6cDvDqepiZGxFeZyK8yUTg8TomklEMpjrMpmoOj6ZJ3ftK+nGO9jEN4faVNB/v9BMefY/e2oK+pJhiQw1H4n6+ndrAy2QbL5JtvD26jumhNri4kSs7YhgtEqbKKhLd+9g+/oX+TJbgWQ1haPgR14ZvsnroE2VWP3pdKcZqkVCzn55YhM7WAN2xCNuiYbpCQTYHA0Saw9S5Gig3lFFkVBAHs1j2gfOgimDbDaY+sO3MsszsY5lez3Kbm0bfGup9QRRfgIamVhpXh1F8QeqbAvhWrcXmUNDpllIhNiPvmcU7CPKAiuDbk+P85GfStz4wkrqER65n4aISKivNWGqqqDVXYl9uwemw5ndLTTW1NdUYjQZKihZQViUjbZ/F0wueXhVB6lRp258lOviD4cuvSZ2/y4FjGboGbmHxTyG2TCH6p7D4Jwv7b7extkxiCz1E6swhbdGY+yVE+jVc7RpiDNr3avSPqOw+CVsOgacD5AR4NxX8yn+a66S4hhRX81NoSmjIa1WkmIotqFLrL7CuyeGOZPOkaIFrPv8nquKOank/AVcrGqV8PVvaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./Bl-8.png\"\n        title=\"./Bl-8.png\"\n        src=\"/static/11b0973c52b4a1db5dee5094314f7265/37523/Bl-8.png\"\n        srcset=\"/static/11b0973c52b4a1db5dee5094314f7265/e9ff0/Bl-8.png 180w,\n/static/11b0973c52b4a1db5dee5094314f7265/f21e7/Bl-8.png 360w,\n/static/11b0973c52b4a1db5dee5094314f7265/37523/Bl-8.png 720w,\n/static/11b0973c52b4a1db5dee5094314f7265/302a4/Bl-8.png 1080w,\n/static/11b0973c52b4a1db5dee5094314f7265/07a9c/Bl-8.png 1440w,\n/static/11b0973c52b4a1db5dee5094314f7265/29114/Bl-8.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8ElEQVQoz3XMS09TQRjG8fPFlF7onJkWiYTKVS4FTEtFAkVMwMICatU2kZ6Woi2KFbysTEzcmLDxQ7jXGKPRaGShiGln/oSeA0kFF7887zt5n7FCD/fxFz8TKH3B73zCX/hI29p7VOk7sXKdjpomvP0vg9oBtWM8nLBU5i0dSy+R1V9EtiFcg8gTEDXwPYbAkVqr9hqoLYPa4hTr7sorni6WiJZ+IDYhXNGIKvRX/pCs7BG//5OE8424Z9L5yuj6HqoKqmpOsaZzH0hn33GxdIDcgEi5QbAKUwuv2RgeZ23kGoXoKM6lGE7vBOXuQdITd5q3qsl46bJ863CuDHYRVNGgCnXUAwglt+gMt9HZ1cXA8BA9A/2IsELYPgJ9c0jHu3eMmx5L5RqEcw1kXiPzBpmrI9dAzOwioinae9P0JYuMzG4S7LlJsHsOeeURkXt4Ha/nseSKQa5o3DymkRmQWZd9C4S3K8+FrCaS0ajV1r4lFw2ttJsLDeRC3UuX3dzr+K838M9D8AYE5lv7VnBaI2YN9pl0q5QmNKPJP9c8e/ObF7v73N4xHP0hUwY7ZbBiy4bIlEEkDPbkGRIGlTTIpDuLhGZsWZNcPeBq5i+jSxoR1yf3VnTKIMcNIvZ/csx1NNsxg++y4fwgTf4h9+349hDx2VedtFeB6QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./Bl-10.png\"\n        title=\"./Bl-10.png\"\n        src=\"/static/5f2de169ea7d484f5fa5123a55f7ff56/37523/Bl-10.png\"\n        srcset=\"/static/5f2de169ea7d484f5fa5123a55f7ff56/e9ff0/Bl-10.png 180w,\n/static/5f2de169ea7d484f5fa5123a55f7ff56/f21e7/Bl-10.png 360w,\n/static/5f2de169ea7d484f5fa5123a55f7ff56/37523/Bl-10.png 720w,\n/static/5f2de169ea7d484f5fa5123a55f7ff56/302a4/Bl-10.png 1080w,\n/static/5f2de169ea7d484f5fa5123a55f7ff56/07a9c/Bl-10.png 1440w,\n/static/5f2de169ea7d484f5fa5123a55f7ff56/29114/Bl-10.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACp0lEQVQoz0WOW28TVxRG5z9VQm1DZ+w5c86ZOeOxPa4bG8eJ4wQIhFzUpLSmVFwCCaSAUMtFUC4CqQakQoGqJFWkPvUJ8YhUqQFFlaB9QyoU0QZ7vFBMgIelb+29pU/bkhf+wz39hNS3j4nOrVI/D+EVMNfeEVwFfx19BcJrIJsw8xtcv79K895Tztx9Sfg9WGLnLbyRE6gzz8h8/YTiV7+T+WIZd3wZMbmMmPgDPbWCmX6MmXpE3PibQuMRwfSfbNr3gF3H7jBy+V8GfgBzsYMVTp4iU5tAn3xKT/Uo6Q9sHCeD81GAYxscW6HFAFvcW+xO3eS0vsFxcQKRinBFjpSIcWZXkOcgOJtgVcauMjU4Q+b4czbWjvJJIYcM8ghl8FSIkAEmyhMXy5goRuoMQhrSwsf1fOy0Rs4+JDwLwakEa772PwvxP5SOwIfVeXoLMSqIcb2wi9IRHxcrDAxuIZvvxTd5dJBbvxuEilAHVghOQvBNgrV5ssXw9jZmHnpKcxR9RU7n8GSIK0OkCskXStSHt3WL18relGo/i17zPSv4x8A/0saSswl6roU5BHbvPL6SyKCA62VwZURaGHKFMvXhUXrLNbL5Etm4TDZfRgf57qdB4yFmFoKZNpa/KyE91cZtwIZwBrvnPZRWSE8gpUC4KcLQp9pXJo6zRJHpYoyP5wk2vO/gjD4g/TmoRhtLfdrhu9ttLt15QfPHu0zv/wmnb4lo66/IgUW8/gXc6s+I/oWu+0NL6PovpCqLDO1c5HLzNhdu/kVzKaG0J8Ea2tthbC5h674XjB+CypcgtoHe8Q5/7DVrrkZfp9wOhc9g/DCM7F9lx8EW2YkOVnGsQ7q/g9MHdiXB7W+h6y3UYAu1nmuzfuvttzuv1sKutHGqYPd1kIMJrwBIUhS7ZfuiggAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./Bl-9.png\"\n        title=\"./Bl-9.png\"\n        src=\"/static/ddefedaf5616ff75bb74313a97d51243/37523/Bl-9.png\"\n        srcset=\"/static/ddefedaf5616ff75bb74313a97d51243/e9ff0/Bl-9.png 180w,\n/static/ddefedaf5616ff75bb74313a97d51243/f21e7/Bl-9.png 360w,\n/static/ddefedaf5616ff75bb74313a97d51243/37523/Bl-9.png 720w,\n/static/ddefedaf5616ff75bb74313a97d51243/302a4/Bl-9.png 1080w,\n/static/ddefedaf5616ff75bb74313a97d51243/07a9c/Bl-9.png 1440w,\n/static/ddefedaf5616ff75bb74313a97d51243/29114/Bl-9.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#fuzzer-tool\">Fuzzer tool</a></li>\n<li><a href=\"#required-installation\">Required installation</a></li>\n<li><a href=\"#options-cli\">Options (CLI)</a></li>\n<li><a href=\"#blueprint-gui\">BluePrint (GUI)</a></li>\n</ul>\n</div>","frontmatter":{"date":"December 20, 2020","title":"Development of window GUI binary fuzzing using the dump fuzzing theory.","categories":"projects","author":"Zer0Luck","emoji":"🔎"},"fields":{"slug":"/project_fuzz_/"}},"prev":{"id":"3c959693-35cd-5fa0-bdb5-e82315df4c6d","html":"<ul>\n<li>window NT 데이터 구조체 이며 프로세스 정보를 담고 있는 구조체</li>\n</ul>\n<h2 id=\"peb-접근-방법\" style=\"position:relative;\"><a href=\"#peb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\" aria-label=\"peb 접근 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB 접근 방법</h2>\n<ul>\n<li>TEB.ProcessEnvironmentBlock 멤버가 PEB 구조체의 주소</li>\n<li>TEB 구조체는 FS 세그먼트 셀렉터가 가리키는 세그먼트 메모리의 base address에 위치한다.</li>\n<li>그리고 ProcessEnvironmentBlock 멤버는 TEB 구조체 시작 부터 30 옵셋만큼 떨어져 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>ProcessEnvironmentBlock <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<h2 id=\"method-1\" style=\"position:relative;\"><a href=\"#method-1\" aria-label=\"method 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>method 1</h2>\n<ul>\n<li>바로 PEB 주소를 구하는 방법</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">MOV EAX<span class=\"token punctuation\">,</span> DWORD PTR FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span>      <span class=\"token punctuation\">;</span> FS<span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<h2 id=\"method-2\" style=\"position:relative;\"><a href=\"#method-2\" aria-label=\"method 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>method 2</h2>\n<ul>\n<li>TEB 주소를 구한후 ProcessEnvironmentBlock 멤버를 이용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">MOV EAX<span class=\"token punctuation\">,</span> DWORD PTR FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span>       <span class=\"token punctuation\">;</span> FS<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> address of TEB\nMOV EAX<span class=\"token punctuation\">,</span> DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>EAX<span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span>   <span class=\"token punctuation\">;</span> DS<span class=\"token punctuation\">[</span>EAX<span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQozz3RUW/TMBAH8Hz/j0EHLwjEHsZomQQMqahjaJ0G7douTVIncRyf47MTJ07axqgKVPo93Mtfuvuf51rsKp4n2zKPdgBB+mlfLZ2tnMWjEQfNnMVBbzEJNyzaSEaqItubwsvjUgsIlo+YBCz1k3hSwqqrZFeCxcxK2pUwaEsQaVBlYQnJwYDrlHcwyiBELwtkRFMf6NSqP3sj9kZ0JewrGOYBI9uCBrWkrc6dRc+1qimBxds8WqWMvkRfK/jYVSvXYt/IvpGuxUHf4m67kmzXW3UwxbGWnrOq0ZARP9k8reNgsf7CyEiJy6566ht9Cg8HN/JYSyULhagVKkSF0nOdqkugxIfd2qc7n9zZ4nOtvp0Kq+W/cIuu032rcs4ZB84BhCik9ICGGlKeRgpSCZnIGfJMAVVADfJGi0YLg7xgcVVky/mv+Wy6fv4d+mtKQm/24/tkfD25uZ5cXd2Oxw/3MxYHkJEzweKMBM8P93S7tDS0OTn3793eTF6NLi4+vBm9e/3+8u3dz+lpyfNvT4WpWuWL+ZwnoetN3yr331/SJuwAkbF/mwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/0e108b97323267fb25a1db164ed8e537/37523/0.png\"\n        srcset=\"/static/0e108b97323267fb25a1db164ed8e537/e9ff0/0.png 180w,\n/static/0e108b97323267fb25a1db164ed8e537/f21e7/0.png 360w,\n/static/0e108b97323267fb25a1db164ed8e537/37523/0.png 720w,\n/static/0e108b97323267fb25a1db164ed8e537/302a4/0.png 1080w,\n/static/0e108b97323267fb25a1db164ed8e537/07a9c/0.png 1440w,\n/static/0e108b97323267fb25a1db164ed8e537/3a5d5/0.png 1807w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FS:[0x30] 주소 값을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"peb-구조체-정의\" style=\"position:relative;\"><a href=\"#peb-%EA%B5%AC%EC%A1%B0%EC%B2%B4-%EC%A0%95%EC%9D%98\" aria-label=\"peb 구조체 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB 구조체 정의</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_PEB</span> <span class=\"token punctuation\">{</span>\n  BYTE                          Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  BYTE                          BeingDebugged<span class=\"token punctuation\">;</span>\n  BYTE                          Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID                         Reserved3<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PPEB_LDR_DATA                 Ldr<span class=\"token punctuation\">;</span>\n  PRTL_USER_PROCESS_PARAMETERS  ProcessParameters<span class=\"token punctuation\">;</span>\n  BYTE                          Reserved4<span class=\"token punctuation\">[</span><span class=\"token number\">104</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID                         Reserved5<span class=\"token punctuation\">[</span><span class=\"token number\">52</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine<span class=\"token punctuation\">;</span>\n  BYTE                          Reserved6<span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID                         Reserved7<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  ULONG                         SessionId<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> PEB<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PPEB<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">ntdll<span class=\"token operator\">!</span>_PEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> InheritedAddressSpace <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x001</span> ReadImageFileExecOptions <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x002</span> BeingDebugged    <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> BitField         <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> ImageUsesLargePages <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsProtectedProcess <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsImageDynamicallyRelocated <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> SkipPatchingUser32Forwarders <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsPackagedProcess <span class=\"token operator\">:</span> Pos <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsAppContainer   <span class=\"token operator\">:</span> Pos <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsProtectedProcessLight <span class=\"token operator\">:</span> Pos <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsLongPathAwareProcess <span class=\"token operator\">:</span> Pos <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Padding0         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x008</span> Mutant           <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> ImageBaseAddress <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x018</span> Ldr              <span class=\"token operator\">:</span> Ptr64 _PEB_LDR_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x020</span> ProcessParameters <span class=\"token operator\">:</span> Ptr64 _RTL_USER_PROCESS_PARAMETERS\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> SubSystemData    <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessHeap      <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x038</span> FastPebLock      <span class=\"token operator\">:</span> Ptr64 _RTL_CRITICAL_SECTION\n   <span class=\"token operator\">+</span><span class=\"token number\">0x040</span> AtlThunkSListPtr <span class=\"token operator\">:</span> Ptr64 _SLIST_HEADER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x048</span> IFEOKey          <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> CrossProcessFlags <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessInJob     <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessInitializing <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessUsingVEH  <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessUsingVCH  <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessUsingFTH  <span class=\"token operator\">:</span> Pos <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessPreviouslyThrottled <span class=\"token operator\">:</span> Pos <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessCurrentlyThrottled <span class=\"token operator\">:</span> Pos <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessImagesHotPatched <span class=\"token operator\">:</span> Pos <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ReservedBits0    <span class=\"token operator\">:</span> Pos <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0x054</span> Padding1         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x058</span> KernelCallbackTable <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x058</span> UserSharedInfoPtr <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x060</span> SystemReserved   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x064</span> AtlThunkSListPtr32 <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x068</span> ApiSetMap        <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x070</span> TlsExpansionCounter <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x074</span> Padding2         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x078</span> TlsBitmap        <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x080</span> TlsBitmapBits    <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x088</span> ReadOnlySharedMemoryBase <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x090</span> SharedData       <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x098</span> ReadOnlyStaticServerData <span class=\"token operator\">:</span> Ptr64 Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0a0</span> AnsiCodePageData <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0a8</span> OemCodePageData  <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0b0</span> UnicodeCaseTableData <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0b8</span> NumberOfProcessors <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0bc</span> NtGlobalFlag     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c0</span> CriticalSectionTimeout <span class=\"token operator\">:</span> _LARGE_INTEGER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c8</span> HeapSegmentReserve <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0d0</span> HeapSegmentCommit <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0d8</span> HeapDeCommitTotalFreeThreshold <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0e0</span> HeapDeCommitFreeBlockThreshold <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0e8</span> NumberOfHeaps    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0ec</span> MaximumNumberOfHeaps <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0f0</span> ProcessHeaps     <span class=\"token operator\">:</span> Ptr64 Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0f8</span> GdiSharedHandleTable <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x100</span> ProcessStarterHelper <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x108</span> GdiDCAttributeList <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x10c</span> Padding3         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x110</span> LoaderLock       <span class=\"token operator\">:</span> Ptr64 _RTL_CRITICAL_SECTION\n   <span class=\"token operator\">+</span><span class=\"token number\">0x118</span> OSMajorVersion   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x11c</span> OSMinorVersion   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x120</span> OSBuildNumber    <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x122</span> OSCSDVersion     <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x124</span> OSPlatformId     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x128</span> ImageSubsystem   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x12c</span> ImageSubsystemMajorVersion <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x130</span> ImageSubsystemMinorVersion <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x134</span> Padding4         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x138</span> ActiveProcessAffinityMask <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x140</span> GdiHandleBuffer  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">60</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x230</span> PostProcessInitRoutine <span class=\"token operator\">:</span> Ptr64     <span class=\"token keyword\">void</span> \n   <span class=\"token operator\">+</span><span class=\"token number\">0x238</span> TlsExpansionBitmap <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x240</span> TlsExpansionBitmapBits <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2c0</span> SessionId        <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2c4</span> Padding5         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2c8</span> AppCompatFlags   <span class=\"token operator\">:</span> _ULARGE_INTEGER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2d0</span> AppCompatFlagsUser <span class=\"token operator\">:</span> _ULARGE_INTEGER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2d8</span> pShimData        <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2e0</span> AppCompatInfo    <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2e8</span> CSDVersion       <span class=\"token operator\">:</span> _UNICODE_STRING\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2f8</span> ActivationContextData <span class=\"token operator\">:</span> Ptr64 _ACTIVATION_CONTEXT_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x300</span> ProcessAssemblyStorageMap <span class=\"token operator\">:</span> Ptr64 _ASSEMBLY_STORAGE_MAP\n   <span class=\"token operator\">+</span><span class=\"token number\">0x308</span> SystemDefaultActivationContextData <span class=\"token operator\">:</span> Ptr64 _ACTIVATION_CONTEXT_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x310</span> SystemAssemblyStorageMap <span class=\"token operator\">:</span> Ptr64 _ASSEMBLY_STORAGE_MAP\n   <span class=\"token operator\">+</span><span class=\"token number\">0x318</span> MinimumStackCommit <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x320</span> SparePointers    <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x340</span> SpareUlongs      <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x358</span> WerRegistrationData <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x360</span> WerShipAssertPtr <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x368</span> pUnused          <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x370</span> pImageHeaderHash <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> TracingFlags     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> HeapTracingEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> CritSecTracingEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> LibLoaderTracingEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> SpareTracingBits <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">29</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0x37c</span> Padding6         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x380</span> CsrServerReadOnlySharedMemoryBase <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x388</span> TppWorkerpListLock <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x390</span> TppWorkerpList   <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x3a0</span> WaitOnAddressHashTable <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7a0</span> TelemetryCoverageHeader <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7a8</span> CloudFileFlags   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7ac</span> CloudFileDiagFlags <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7b0</span> PlaceholderCompatibilityMode <span class=\"token operator\">:</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7b1</span> PlaceholderCompatibilityModeReserved <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7b8</span> LeapSecondData   <span class=\"token operator\">:</span> Ptr64 _LEAP_SECOND_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c0</span> LeapSecondFlags  <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c0</span> SixtySecondEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c0</span> Reserved         <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c4</span> NtGlobalFlag2    <span class=\"token operator\">:</span> Uint4B</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">tdll<span class=\"token operator\">!</span>_PEB \n   <span class=\"token operator\">+</span><span class=\"token number\">0x002</span> BeingDebugged    <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> ImageBaseAddress <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x018</span> Ldr              <span class=\"token operator\">:</span> Ptr64 _PEB_LDR_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessHeap      <span class=\"token operator\">:</span> Ptr64 Void</code></pre></div>\n<h2 id=\"pebbeingdebugged\" style=\"position:relative;\"><a href=\"#pebbeingdebugged\" aria-label=\"pebbeingdebugged permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.BeingDebugged</h2>\n<ul>\n<li>Kernel32!IsDebuggerPresent() API</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">BOOL WINAPI <span class=\"token function\">IsDebuggerPresent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>현재 프로세스가 디버깅을 당하는지를 판단해서 결과를 반환한다.</li>\n<li>API가 참조하는 정보가 바로 PEB.BeingDebugged 멤버이다. (디버깅 중이면1, 아니면 0을 반환)</li>\n</ul>\n<h2 id=\"pebimagebaseaddress\" style=\"position:relative;\"><a href=\"#pebimagebaseaddress\" aria-label=\"pebimagebaseaddress permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.ImageBaseAddress</h2>\n<ul>\n<li>PEB.ImageBaseAddress 멤버는 프로세스의 ImageBase 를 표시한다.</li>\n<li>GetModuleHandle() API는 ImageBase를 얻어내는 API이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">HMOUDLE WINAPI <span class=\"token function\">GetModuleHandle</span> <span class=\"token punctuation\">(</span>\n\t__in_opt  LPCTSTR lpModuleName\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>lpModuleName 파라미터에 NULL을 입력하고 GetModuleHandle()을 호출하면 프로세스가 로딩된 ImageBase를 리턴한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjklEQVQI11XL3QqCMBjGce//HqLzbqC76CgMmU5ci9yYr/vAvVvqFmYEwY/n6PkX6kl5W2nBGLmiFi8rCTlV9ZGXh4GeVzQ56K9oZidR1FG1CSEHXYBgrCmNvEveJA/eDhdKnYHF4mrH/fSzTEPykHHcbHHfdXVp1QN1n2cXnOTdLUedI2wb/iwe0ifbvQEgE6fbOMXfJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/9e888556dc76a2d9f49f2c740922e0b7/37523/1.png\"\n        srcset=\"/static/9e888556dc76a2d9f49f2c740922e0b7/e9ff0/1.png 180w,\n/static/9e888556dc76a2d9f49f2c740922e0b7/f21e7/1.png 360w,\n/static/9e888556dc76a2d9f49f2c740922e0b7/37523/1.png 720w,\n/static/9e888556dc76a2d9f49f2c740922e0b7/024d6/1.png 961w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>PEB.ImageBaseAddress 멤버를 EAX 레지스터 에 세팅하는 것을 확인할 수 있다.</p>\n</li>\n</ul>\n<h2 id=\"pebldr\" style=\"position:relative;\"><a href=\"#pebldr\" aria-label=\"pebldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.Ldr</h2>\n<ul>\n<li>_PEB_LDR_DATA 구조체의 포인터이다.</li>\n<li>_PEB_LDR_DAT 구조체</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_PEB_LDR_DATA</span> <span class=\"token punctuation\">{</span>\n  BYTE       Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID      Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  LIST_ENTRY InMemoryOrderModuleList<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> PEB_LDR_DATA<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PPEB_LDR_DATA<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">007</span><span class=\"token operator\">></span> dt _PEB_LDR_DATA\nntdll<span class=\"token operator\">!</span>_PEB_LDR_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Length           <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Initialized      <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x008</span> SsHandle         <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x00c</span> InLoadOrderModuleList <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x014</span> InMemoryOrderModuleList <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x01c</span> InInitializationOrderModuleList <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x024</span> EntryInProgress  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> ShutdownInProgress <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x02c</span> ShutdownThreadId <span class=\"token operator\">:</span> Ptr32 Void</code></pre></div>\n<ul>\n<li>프로세스에 로딩된 모듈(DLL)의 로딩 베이스 주소를 직접 구할 수 있는 방법을 제공하기 때문이다.</li>\n<li>_LIST_ENTRY 타입의 멤버가 세 개 있다.\n<ul>\n<li>InLoadOrderModuleList</li>\n<li>InMemoryOrderModuleList</li>\n<li>InInitializationOrderModuleList</li>\n</ul>\n</li>\n<li>_LIST_ENTRY 구조체 정의는</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LIST_ENTRY</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LIST_ENTRY</span> <span class=\"token operator\">*</span>Flink<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LIST_ENTRY</span> <span class=\"token operator\">*</span>Blink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> LIST_ENTRY<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PLIST_ENTRY<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>구조체 정의를 보면 _LIST_ENTRY는 양방향 연결 리스트 메커니즘을 제공하는 구조체이다.</li>\n<li>연결 리스트에는 _LDR_DATA_TABLE_ENTRY 구조체 정보가 담겨 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LDR_DATA_TABLE_ENTRY</span> <span class=\"token punctuation\">{</span>\n    PVOID Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    LIST_ENTRY InMemoryOrderLinks<span class=\"token punctuation\">;</span>\n    PVOID Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    PVOID DllBase<span class=\"token punctuation\">;</span>\n    PVOID EntryPoint<span class=\"token punctuation\">;</span>\n    PVOID Reserved3<span class=\"token punctuation\">;</span>\n    UNICODE_STRING FullDllName<span class=\"token punctuation\">;</span>\n    BYTE Reserved4<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    PVOID Reserved5<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n        ULONG CheckSum<span class=\"token punctuation\">;</span>\n        PVOID Reserved6<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    ULONG TimeDateStamp<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> LDR_DATA_TABLE_ENTRY<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PLDR_DATA_TABLE_ENTRY<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>프로세스에 로딩된 DLL 모듈 마다 _LDR_DATA_TABLE_ENTRY 구조체가 하나씩 생성되고 이 구조체 들은 _LIST_ENTRY 양방향 연결 리스트로 연결된다.</li>\n<li>_LDR_DATA_TABLE_ENTRY 구조체 들이 많이 있는 데 연결 방법을 세 가지를 제공한다.</li>\n</ul>\n<h2 id=\"pebprocessheap--pebntglobalflag\" style=\"position:relative;\"><a href=\"#pebprocessheap--pebntglobalflag\" aria-label=\"pebprocessheap  pebntglobalflag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.ProcessHeap &#x26; PEB.NtGlobalFlag</h2>\n<ul>\n<li>PEB.ProcessHeap 멤버, PEB.NtGlobalFlag 멤버는 (PEB.BeingDebugged 멤버와 마찬가지로) 안티 디버깅에 사용된다.</li>\n<li>프로세스가 디버깅 중이라면 ProcessHeap, NtGlobalFlag 멤버는 특정한 값을 갖는다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#peb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\">PEB 접근 방법</a></li>\n<li><a href=\"#method-1\">method 1</a></li>\n<li><a href=\"#method-2\">method 2</a></li>\n<li><a href=\"#peb-%EA%B5%AC%EC%A1%B0%EC%B2%B4-%EC%A0%95%EC%9D%98\">PEB 구조체 정의</a></li>\n<li><a href=\"#pebbeingdebugged\">PEB.BeingDebugged</a></li>\n<li><a href=\"#pebimagebaseaddress\">PEB.ImageBaseAddress</a></li>\n<li><a href=\"#pebldr\">PEB.Ldr</a></li>\n<li><a href=\"#pebprocessheap--pebntglobalflag\">PEB.ProcessHeap &#x26; PEB.NtGlobalFlag</a></li>\n</ul>\n</div>","frontmatter":{"date":"January 03, 2021","title":"PEB (Process Environment Block)","categories":"Windows","author":"Zer0Luck","emoji":"🧊"},"fields":{"slug":"/window_1_theori/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/window_4_theori/","nextSlug":"/project_fuzz_/","prevSlug":"/window_1_theori/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}