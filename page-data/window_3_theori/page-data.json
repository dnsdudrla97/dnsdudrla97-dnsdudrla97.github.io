{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/window_3_theori/",
    "result": {"data":{"cur":{"id":"6ddfd1b2-808b-5d18-b643-d305593f1a71","html":"<h1 id=\"seh-structured-exception-handler\" style=\"position:relative;\"><a href=\"#seh-structured-exception-handler\" aria-label=\"seh structured exception handler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH (Structured Exception Handler)</h1>\n<ul>\n<li>SEH Windows 운영체제에서 제공하는 예외처리 시스템이다.</li>\n<li><code class=\"language-text\">__try, __except, __finally</code> 키워드로 간단히 구현할 수 있다.</li>\n<li>하드웨어 오류와 같은 특정 예외 코드 상황을 정상적으로 처리하기 위해 C에 대한 Microsoft 확장이다.</li>\n<li>SEH를 사용하면 실행이 예기치 않게 종료 되는 경우 메모리 블록 및 파일과 같은 리소스가 올바르게 해제 되도록 할 수 있다.</li>\n</ul>\n<h3 id=\"seh-매커니즘\" style=\"position:relative;\"><a href=\"#seh-%EB%A7%A4%EC%BB%A4%EB%8B%88%EC%A6%98\" aria-label=\"seh 매커니즘 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH 매커니즘</h3>\n<ul>\n<li>예외 처리기 , <code class=\"language-text\">_except</code> 예외에 응답 하거나 해제할 수 있는 블록</li>\n<li>Termination Handlers <code class=\"language-text\">_finally</code> 예외가 종료를 발생 시키는 지 여부에 관계 없이 항상 호출되는 종료 처리기 또는 블록</li>\n</ul>\n<h3 id=\"일반-실행의-경우-예외-처리-방법\" style=\"position:relative;\"><a href=\"#%EC%9D%BC%EB%B0%98-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\" aria-label=\"일반 실행의 경우 예외 처리 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>일반 실행의 경우 예외 처리 방법</h3>\n<ul>\n<li>OS는 프로세스 실행 중에 예외가 발생하면 프로세스에게 처리를 맡긴다.</li>\n<li>프로세스 코드에 (SEH…) 예외처 리가 구현되어 있다면, 해당 예외를 잘 처리한 후 게속 실행될 것이다.</li>\n<li>구현되어 있지 않다면 기본 예외 처리기를 동작시켜 프로세스를 종료 시킨다.</li>\n</ul>\n<h3 id=\"디버깅-실행의-경우-예외-처리-방법\" style=\"position:relative;\"><a href=\"#%EB%94%94%EB%B2%84%EA%B9%85-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\" aria-label=\"디버깅 실행의 경우 예외 처리 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디버깅 실행의 경우 예외 처리 방법</h3>\n<ul>\n<li>디버깅 중에 디버기 프로세스에 에외가 발생하면 OS는 우선적으로 디버거에게 에외를 넘겨서 처리하도록 한다.</li>\n<li>디버거는 디버기에 대한 거의 모든 소유권을 가지고 있다.</li>\n<li>즉 디버기의 실행, 종료의 제어뿐만 아니라 디버기 프로세스 내부의 가상 메모리, 레지스터에 때한 읽기/쓰기 권한도 가지고 있다.</li>\n<li>이버기의 내부에서 발생하는 모든 에외(에러) 상황을 처리해야 한다.</li>\n<li>디버기의 SEH는 우선순위에서 디버거에게 밀린다.</li>\n</ul>\n<h3 id=\"디버거-실행-중지시-조치\" style=\"position:relative;\"><a href=\"#%EB%94%94%EB%B2%84%EA%B1%B0-%EC%8B%A4%ED%96%89-%EC%A4%91%EC%A7%80%EC%8B%9C-%EC%A1%B0%EC%B9%98\" aria-label=\"디버거 실행 중지시 조치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디버거 실행 중지시 조치</h3>\n<ol>\n<li>\n<p>예외 직접 수정 : 코드, 레지스터, 메모리</p>\n<ul>\n<li>디버거는 예외가 발생한 코드 주소에 멈춰 있기 때문에 문제가 발생한 코드, 메모리, 레지스터 등을 디버거를 통하여 직접 수정하면 예외는 해결된다.</li>\n</ul>\n</li>\n<li>\n<p>예외를 디버기에게 넘겨서 처리</p>\n<ul>\n<li>디버기 내부에 이미 SEH가 존재하여 예외를 처리할 수 있다.</li>\n<li>예외 (EXCEPTION) 통지를 그대로 디버기에게 되돌려 보내서 자체 해결하도록 만들 수 있다.</li>\n<li>‘일반 실행’ 의 예외 처리와 동일한 상황이 된다.</li>\n</ul>\n</li>\n<li>\n<p>기본 예외처리기</p>\n<ul>\n<li>현재 발생한 예외를 디버거와 디버기에서 처리할 수 없다면 (혹은 의도적으로 처리하지 않는다면), 마지막으로 OS의 기본 예외 처리기에서 처리한다.</li>\n<li>디버기 프로세스가 종료되면서 디버깅은 완전히 중지된다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"excpetion\" style=\"position:relative;\"><a href=\"#excpetion\" aria-label=\"excpetion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Excpetion</h2>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">UMDF_USING_NTSTATUS </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">WIN32_NO_STATUS </span></span>\n<span class=\"token comment\">/*lint -save -e767 */</span>  \n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_WAIT_0</span>                           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000000L</span><span class=\"token punctuation\">)</span> </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ABANDONED_WAIT_0</span>          <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000080L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_USER_APC</span>                  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x000000C0L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_TIMEOUT</span>                   <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000102L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_PENDING</span>                   <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00000103L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_EXCEPTION_HANDLED</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00010001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_CONTINUE</span>                     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x00010002L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SEGMENT_NOTIFICATION</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40000005L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FATAL_APP_EXIT</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40000015L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_REPLY_LATER</span>                  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_TERMINATE_THREAD</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010003L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_TERMINATE_PROCESS</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010004L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_CONTROL_C</span>                    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010005L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_PRINTEXCEPTION_C</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010006L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_RIPEXCEPTION</span>                 <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010007L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_CONTROL_BREAK</span>                <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010008L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_COMMAND_EXCEPTION</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x40010009L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_PRINTEXCEPTION_WIDE_C</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x4001000AL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_GUARD_PAGE_VIOLATION</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_DATATYPE_MISALIGNMENT</span>     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000002L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_BREAKPOINT</span>                <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000003L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SINGLE_STEP</span>               <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000004L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_LONGJUMP</span>                  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000026L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_UNWIND_CONSOLIDATE</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80000029L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DBG_EXCEPTION_NOT_HANDLED</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0x80010001L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ACCESS_VIOLATION</span>          <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000005L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_IN_PAGE_ERROR</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000006L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_HANDLE</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000008L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_PARAMETER</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000000DL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_NO_MEMORY</span>                 <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000017L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ILLEGAL_INSTRUCTION</span>       <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000001DL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_NONCONTINUABLE_EXCEPTION</span>  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000025L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_DISPOSITION</span>       <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000026L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ARRAY_BOUNDS_EXCEEDED</span>     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008CL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_DENORMAL_OPERAND</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008DL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_DIVIDE_BY_ZERO</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008EL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_INEXACT_RESULT</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000008FL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_INVALID_OPERATION</span>   <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000090L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_OVERFLOW</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000091L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_STACK_CHECK</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000092L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_UNDERFLOW</span>           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000093L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INTEGER_DIVIDE_BY_ZERO</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000094L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INTEGER_OVERFLOW</span>          <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000095L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_PRIVILEGED_INSTRUCTION</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000096L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_STACK_OVERFLOW</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00000FDL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_DLL_NOT_FOUND</span>             <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000135L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ORDINAL_NOT_FOUND</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000138L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ENTRYPOINT_NOT_FOUND</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000139L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_CONTROL_C_EXIT</span>            <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC000013AL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_DLL_INIT_FAILED</span>           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000142L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_MULTIPLE_FAULTS</span>     <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00002B4L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_FLOAT_MULTIPLE_TRAPS</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00002B5L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_REG_NAT_CONSUMPTION</span>       <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00002C9L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_HEAP_CORRUPTION</span>           <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000374L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_STACK_BUFFER_OVERRUN</span>      <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000409L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INVALID_CRUNTIME_PARAMETER</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000417L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ASSERTION_FAILURE</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000420L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ENCLAVE_VIOLATION</span>         <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC00004A2L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_INTERRUPTED</span>               <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000515L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_THREAD_NOT_RUNNING</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000516L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_ALREADY_REGISTERED</span>        <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0000718L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>STATUS_SUCCESS<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_WIN32_WINNT <span class=\"token operator\">></span> <span class=\"token number\">0x0500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>_WIN32_FUSION <span class=\"token operator\">>=</span> <span class=\"token number\">0x0100</span><span class=\"token punctuation\">)</span> </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SXS_EARLY_DEACTIVATION</span>    <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC015000FL</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STATUS_SXS_INVALID_DEACTIVATION</span>  <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>DWORD   <span class=\"token punctuation\">)</span><span class=\"token number\">0xC0150010L</span><span class=\"token punctuation\">)</span>    </span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<h3 id=\"status_access_violation--dword---0xc0000005l\" style=\"position:relative;\"><a href=\"#status_access_violation--dword---0xc0000005l\" aria-label=\"status_access_violation  dword   0xc0000005l permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_ACCESS_VIOLATION  (DWORD   )0xC0000005L</h3>\n<ul>\n<li>존재하지 않거나 접근 권하니 없는 메모리 영역에 대해서 접근을 시도할 때 발생하는 예외</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">MOV DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> 메모리 주소 <span class=\"token number\">0</span>은 할당된 영역이 아니다<span class=\"token punctuation\">.</span>\n\nADD DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x401000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">.</span>text 섹션의 시작 주소 <span class=\"token number\">0x401000</span>은 READ 속성만을 가지고 있다<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>WRITE 속성 없음<span class=\"token punctuation\">)</span>\n\nXOR DWORD PTR DS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">80000000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1234</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> 메모리 주소 <span class=\"token number\">0x80000000</span> 은 Kernel 영역이라 user 모드에선 접근 불가</code></pre></div>\n<h3 id=\"status_breakpoint-dword---0x80000003l\" style=\"position:relative;\"><a href=\"#status_breakpoint-dword---0x80000003l\" aria-label=\"status_breakpoint dword   0x80000003l permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_BREAKPOINT (DWORD   )0x80000003L</h3>\n<ul>\n<li>실행 코드에 BP가 설치되면 CPU가 그 주소를 실행하려 할 때 EXCEPTION_BREAKPOINT 예외가 발생한다.</li>\n<li>디버거는 바로 이 EXCEPTION_BREAKPOINT 예외를 이용하여 BP 기능을 제공하는 것이다.</li>\n</ul>\n<h2 id=\"breakpoint-구현-방법\" style=\"position:relative;\"><a href=\"#breakpoint-%EA%B5%AC%ED%98%84-%EB%B0%A9%EB%B2%95\" aria-label=\"breakpoint 구현 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>BreakPoint 구현 방법</h2>\n<h3 id=\"int-3\" style=\"position:relative;\"><a href=\"#int-3\" aria-label=\"int 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>INT 3</h3>\n<ul>\n<li>BP를 설치하는 명령어는 어셈블리 명령어로 <code class=\"language-text\">INT 3</code> 입니다.</li>\n<li>해당 명령어의 기계어 (IA32 Instruction) 형태는 <code class=\"language-text\">0xCC</code> 이다.</li>\n<li>CPU는 코드 실행 과정에서 어셈블리 명령어 INT3을 만나면 EXCPETION_BREAKPOINT 예외를 발생시킨다.</li>\n<li>디버거 상에서는 사용자 임시 BP (User Temporary Break Point)이기 때문에 화면 상에 표시하지 ㅇ낳는다.</li>\n<li>해당 Instuction이 0xcc로 변경된 것을 확인할려면 프로세스 덤프를 한후에 해당 주소에서 확인이 가능하다.</li>\n</ul>\n<h3 id=\"status_illegal_instruction-------dword---0xc000001dl\" style=\"position:relative;\"><a href=\"#status_illegal_instruction-------dword---0xc000001dl\" aria-label=\"status_illegal_instruction       dword   0xc000001dl permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_ILLEGAL_INSTRUCTION       ((DWORD   )0xC000001DL)</h3>\n<ul>\n<li>CPU가 해석할 수 없는 Instuction을 만날 때 발생하는 예외이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0FFF</span></code></pre></div>\n<ul>\n<li>해당 Insturction은 x86 CPU에 정의된 Instruction이 아니기 때문에 EXCEPTION_ILLEGAL_INSTRUCTION 예외를 발생시킨다.</li>\n</ul>\n<h3 id=\"status_integer_divide_by_zero----dword---0xc0000094l\" style=\"position:relative;\"><a href=\"#status_integer_divide_by_zero----dword---0xc0000094l\" aria-label=\"status_integer_divide_by_zero    dword   0xc0000094l permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STATUS_INTEGER_DIVIDE_BY_ZERO    (DWORD   )0xC0000094L</h3>\n<ul>\n<li>INTEGER (정수) 나눗셈 연산에서 분모가 0인 경우 (0으로나누는 경우) 발생하는 예외이다.</li>\n<li>프로그램 개발할 때 간혹 발생하는 예외</li>\n<li>분모가 변수로 잡혀 값이 0이 되었을 때 나누기 연산을 수행하면 EXCEPTION_INTEGER_DIVIDE_BY_ZERO 예외가 발생한다.</li>\n</ul>\n<h2 id=\"seh-chain\" style=\"position:relative;\"><a href=\"#seh-chain\" aria-label=\"seh chain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH Chain</h2>\n<ul>\n<li>체인 형태로 구성되어 있다.</li>\n<li>첫 번째 에외 처리기에서 해당 예외를 처리하지 못하면 (처리될 때 까지) 다음 예외 처리기로 예외를 넘겨주는 형식이다.</li>\n<li>기술적으로 SEH는 EXCEPTION_REGISTRATION_RECORD 구조체 연결 리스트의 형태로 구성된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_REGISTRATION_RECORD</span>\n<span class=\"token punctuation\">{</span>\n     PEXCEPTION_REGISTRATION_RECORD Next<span class=\"token punctuation\">;</span>\n     PEXCEPTION_DISPOSITION Handler<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> EXCEPTION_REGISTRATION_RECORD<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PEXCEPTION_REGISTRATION_RECORD<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Next 멤버는 다음 <em>EXCPETION</em>REGISTRATION_RECORD 구조체 포인터이며, Handler 멤버가 예외처리기 함수 (예외 처리기)이다.</li>\n<li>NEXT 멤버의 값이 <code class=\"language-text\">FFFFFFFF</code> 이면 연결리스트의 마지막을 나타낸다.</li>\n<li>프로세스의 SEH 체인 구조를 그림으로 표현하면</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWElEQVQoz12SW0+SARjH+R615QHl9HKQFxAFBEGQk5knQM1whivBqRvlpOnqI3RVeZjoctZWy9Q3oKWyVold+C26q1ldtbn1/hqUN1082/95fs//f/M8Cp1GL2uVKjRKlaxRqqhqQTDhD4QJ+EMEPD6CXj9+j5dubxcBfxB/dxijUeTvvpoLn1YtoLCF+nDOLMruzAId0zmcmQXMjk4ErR6rN4Rz+h7uWuVwzSxi8UcRNHpEeweOqXlc0zk8mRzO2SVaexMo3LNTcs9pgbGKJA9V9oh8eEVb7zW0DWraEjGin14zciKRON4j+nkf1+QEugYN1k4f4fIL4icS14/3iZ4W8C7dReG6PUXkoEi8KDFQkghJO9jCPajrmrAPxggXdhkqSQwVJcJvJdqT46jrmxDdPoK7L+kvScQL+0SOSrjvVANvjXP13QajhTzxYp7I3jK2cAh1vQr7QB890irDhTwjhTw9xXUcN4ZrTHR7iOw8JlbMM/omT+/BJp5sGoXOaKHJIKI0mFHqzTQbLQgGsXYYnUGs9UqDSKO+hWaDpTarMsFgRlVlenONVzO0RguK9IhfrqyPc7iSkssrExw9GiXc5eSKUqA/1EH5yRjl1RSHyxN8XEuSivmoU+px2O0UHiZ4v5biYPkmlfUkD9JRFPeTUc6fzchfn2b5vpXlbCPNYMDDpUYdyaiXH5sZzrayfNvK8mt7lvmRIJcbBTzt7XxZnuTndpaq9/z5HKtzgyjMJutve0srdpNVtpusVHX1x7SCCaPRwj/GBWsxWmpMbzDT+h8TTTb+AFSYdO5NBUyxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./SEH_CHAIN.png\"\n        title=\"./SEH_CHAIN.png\"\n        src=\"/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/37523/SEH_CHAIN.png\"\n        srcset=\"/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/e9ff0/SEH_CHAIN.png 180w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/f21e7/SEH_CHAIN.png 360w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/37523/SEH_CHAIN.png 720w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/302a4/SEH_CHAIN.png 1080w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/07a9c/SEH_CHAIN.png 1440w,\n/static/8f877b3c5b5fdbd859a60c8bb7f0ccf3/74e37/SEH_CHAIN.png 1732w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>총 3개의 SEH가 존재한다. 어떤 예외가 발생하면, 예외가 해결될 때까지 처리기 (A) → (B) → (C) 순서대로 예외 처리기가 호출된다.</li>\n</ul>\n<h2 id=\"seh-함수-정의\" style=\"position:relative;\"><a href=\"#seh-%ED%95%A8%EC%88%98-%EC%A0%95%EC%9D%98\" aria-label=\"seh 함수 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH 함수 정의</h2>\n<ul>\n<li>EXCEPTION_DISPOSITION</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">EXCPETION_DISPOSITION <span class=\"token function\">_except_handler</span> <span class=\"token punctuation\">(</span>\n\tEXCEPTION_RECORD               <span class=\"token operator\">*</span>pRecord<span class=\"token punctuation\">,</span>\n\tEXCEPTION_REGISTRATION_RECORD  <span class=\"token operator\">*</span>pFrame\n\tCONTEXT                        <span class=\"token operator\">*</span>pContext<span class=\"token punctuation\">,</span>\n\tPVOID                           pValue\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>예외 처리기는 4개의 파라미터를 입력 받으며, EXCEPTION_DISPOSITION 이라는 열거형을 반환한다.</li>\n<li>해당 예외 처리 함수는 시스템에 의해서 호출되는 콜백 함수이다.</li>\n<li>입력 파라미터들에 예외와 관련된 정보가 저장되어 있다.</li>\n</ul>\n<p><strong>EXCEPTION_RECORD 구조체 정의</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_RECORD</span> <span class=\"token punctuation\">{</span>\n  DWORD                    ExceptionCode<span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 예외 코드</span>\n  DWORD                    ExceptionFlags<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_RECORD</span> <span class=\"token operator\">*</span>ExceptionRecord<span class=\"token punctuation\">;</span>\n  PVOID                    ExceptionAddress<span class=\"token punctuation\">;</span>             <span class=\"token comment\">// 예외 발생 주소</span>\n  DWORD                    NumberParameters<span class=\"token punctuation\">;</span>\n  ULONG_PTR                ExceptionInformation<span class=\"token punctuation\">[</span>EXCEPTION_MAXIMUM_PARAMETERS<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> EXCEPTION_RECORD<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>ExceptionCode : 발생한 예외의 종류를 의미</li>\n<li>ExcpetionAddress : 예외가 발생한 코드 주소를 나타낸다.</li>\n</ul>\n<p><strong>CONTEXT 구조체 정의</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_CONTEXT</span> <span class=\"token punctuation\">{</span>\n  DWORD64 P1Home<span class=\"token punctuation\">;</span>\n  DWORD64 P2Home<span class=\"token punctuation\">;</span>\n  DWORD64 P3Home<span class=\"token punctuation\">;</span>\n  DWORD64 P4Home<span class=\"token punctuation\">;</span>\n  DWORD64 P5Home<span class=\"token punctuation\">;</span>\n  DWORD64 P6Home<span class=\"token punctuation\">;</span>\n  DWORD   ContextFlags<span class=\"token punctuation\">;</span>\n  DWORD   MxCsr<span class=\"token punctuation\">;</span>\n  WORD    SegCs<span class=\"token punctuation\">;</span>\n  WORD    SegDs<span class=\"token punctuation\">;</span>\n  WORD    SegEs<span class=\"token punctuation\">;</span>\n  WORD    SegFs<span class=\"token punctuation\">;</span>\n  WORD    SegGs<span class=\"token punctuation\">;</span>\n  WORD    SegSs<span class=\"token punctuation\">;</span>\n  DWORD   EFlags<span class=\"token punctuation\">;</span>\n  DWORD64 Dr0<span class=\"token punctuation\">;</span>\n  DWORD64 Dr1<span class=\"token punctuation\">;</span>\n  DWORD64 Dr2<span class=\"token punctuation\">;</span>\n  DWORD64 Dr3<span class=\"token punctuation\">;</span>\n  DWORD64 Dr6<span class=\"token punctuation\">;</span>\n  DWORD64 Dr7<span class=\"token punctuation\">;</span>\n  DWORD64 Rax<span class=\"token punctuation\">;</span>\n  DWORD64 Rcx<span class=\"token punctuation\">;</span>\n  DWORD64 Rdx<span class=\"token punctuation\">;</span>\n  DWORD64 Rbx<span class=\"token punctuation\">;</span>\n  DWORD64 Rsp<span class=\"token punctuation\">;</span>\n  DWORD64 Rbp<span class=\"token punctuation\">;</span>\n  DWORD64 Rsi<span class=\"token punctuation\">;</span>\n  DWORD64 Rdi<span class=\"token punctuation\">;</span>\n  DWORD64 R8<span class=\"token punctuation\">;</span>\n  DWORD64 R9<span class=\"token punctuation\">;</span>\n  DWORD64 R10<span class=\"token punctuation\">;</span>\n  DWORD64 R11<span class=\"token punctuation\">;</span>\n  DWORD64 R12<span class=\"token punctuation\">;</span>\n  DWORD64 R13<span class=\"token punctuation\">;</span>\n  DWORD64 R14<span class=\"token punctuation\">;</span>\n  DWORD64 R15<span class=\"token punctuation\">;</span>\n  DWORD64 Rip<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n    XMM_SAVE_AREA32 FltSave<span class=\"token punctuation\">;</span>\n    NEON128         Q<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    ULONGLONG       D<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n      M128A Header<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      M128A Legacy<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      M128A Xmm0<span class=\"token punctuation\">;</span>\n      M128A Xmm1<span class=\"token punctuation\">;</span>\n      M128A Xmm2<span class=\"token punctuation\">;</span>\n      M128A Xmm3<span class=\"token punctuation\">;</span>\n      M128A Xmm4<span class=\"token punctuation\">;</span>\n      M128A Xmm5<span class=\"token punctuation\">;</span>\n      M128A Xmm6<span class=\"token punctuation\">;</span>\n      M128A Xmm7<span class=\"token punctuation\">;</span>\n      M128A Xmm8<span class=\"token punctuation\">;</span>\n      M128A Xmm9<span class=\"token punctuation\">;</span>\n      M128A Xmm10<span class=\"token punctuation\">;</span>\n      M128A Xmm11<span class=\"token punctuation\">;</span>\n      M128A Xmm12<span class=\"token punctuation\">;</span>\n      M128A Xmm13<span class=\"token punctuation\">;</span>\n      M128A Xmm14<span class=\"token punctuation\">;</span>\n      M128A Xmm15<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> DUMMYSTRUCTNAME<span class=\"token punctuation\">;</span>\n    DWORD           S<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> DUMMYUNIONNAME<span class=\"token punctuation\">;</span>\n  M128A   VectorRegister<span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  DWORD64 VectorControl<span class=\"token punctuation\">;</span>\n  DWORD64 DebugControl<span class=\"token punctuation\">;</span>\n  DWORD64 LastBranchToRip<span class=\"token punctuation\">;</span>\n  DWORD64 LastBranchFromRip<span class=\"token punctuation\">;</span>\n  DWORD64 LastExceptionToRip<span class=\"token punctuation\">;</span>\n  DWORD64 LastExceptionFromRip<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> CONTEXT<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PCONTEXT<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>CONTEXT 구조체는 CPU 레지스터 값을 백업하는 용도로 사용된다.</li>\n<li>CPU 레지스터 값을 백업하는 이유는 멀티 스레드(Multi-Thread) 환경 때문이다.</li>\n<li>스레드는 내부적으로 CONTEXT 구조체를 하나씩 가지고 있다.</li>\n<li>CPU가 다른 스레드를 실행하러 잠시 이동할 때 CPU 레지스터들의 값을 현재 스레드의 CONTEXT 구조체에 백업한다.</li>\n<li>그후 CPU가 다시 에전 스레드를 실행하러 오면 CONTEXT 구조체에 백업된 레지스터 값들을 실제 CPU 레지스터에 덮어쓴다.</li>\n<li>아까 실행이 멈춰졌던 코드 위치부터 실행을 다시 시작한다.</li>\n<li>OS는 멀티 스레드 환경에서 안전하게 스레드 단위별로 실행이 가능하다.</li>\n</ul>\n<h3 id=\"multi-thread\" style=\"position:relative;\"><a href=\"#multi-thread\" aria-label=\"multi thread permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multi-Thread</h3>\n<ul>\n<li>\n<p>CPU의 시분할 (Time-Slicing) 방식</p>\n</li>\n<li>\n<p>CPU가 각 스레드를 차례대로 일정 시간 동안 실행해주는 것이다.</p>\n</li>\n<li>\n<p>그 시간 간격이 극히 짧기 때문에 동시에 여러 개의 스레드가 실행되는 것처럼 보이는 것이다.</p>\n</li>\n<li>\n<p>스레드의 우선순위에 따라서 CPU 제어권을 얻는 횟수에 차이가 발생한다.</p>\n</li>\n<li>\n<p>예외가 발생하면 그 코드를 실행한 스레드는 중지되고 SEH(예외 처리기)가 실행된다.</p>\n</li>\n<li>\n<p>OS는 예외 처리기의 파라미터에 해당 스레드의 CONTEXT 구조체 포인터를 넘겨준다.</p>\n</li>\n<li>\n<p>구조체 멤버 중 EIP 멤버가 있다.(offset: B8)</p>\n</li>\n<li>\n<p>예외 처리기에서 파라미터로 넘어온 CONTEXT.Eip 를 다른 주소로 설정한 후 예외 처리기 함수를 리턴시키면, 아까 중지된 스레드는 새로 설정된 EIP 주소의 코드를 실행한다.</p>\n</li>\n</ul>\n<h3 id=\"exception_disposition-enum\" style=\"position:relative;\"><a href=\"#exception_disposition-enum\" aria-label=\"exception_disposition enum permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXCEPTION_DISPOSITION enum</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">_EXCEPTION_DISPOSITION</span>\n<span class=\"token punctuation\">{</span>\n         ExceptionContinueExecution <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n         ExceptionContinueSearch <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n         ExceptionNestedException <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n         ExceptionCollidedUnwind <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">}</span> EXCEPTION_DISPOSITION<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>예외 처리기 (SEH)에서 예외를 처리했다면 <code class=\"language-text\">ExceptionContinueExecution(0)</code> 을 리턴할 경우 예외가 발생한 코드부터 재실행된다.</li>\n<li>만약 예외를 처리할 수 없다면 ExceptionContinueSearch(1)을 리턴하여 SEH chain에서 다음 예외 처리기에서 처리하도록 한다.</li>\n</ul>\n<h3 id=\"tebnttibexceptionlist\" style=\"position:relative;\"><a href=\"#tebnttibexceptionlist\" aria-label=\"tebnttibexceptionlist permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TEB.NtTib.ExceptionList</h3>\n<ul>\n<li>프로세스의 SEH chain.에 접근하는 방법은 간단하다.</li>\n<li>TEB(THREAD ENVIRONMENT BLOCK) 구조체의 NtTib 멤버를 따라가면 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> dt _NT_TIB\nntdll<span class=\"token operator\">!</span>_NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> ExceptionList    <span class=\"token operator\">:</span> Ptr32 _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> StackBase        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x008</span> StackLimit       <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x00c</span> SubSystemTib     <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> FiberData        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x010</span> Version          <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x014</span> ArbitraryUserPointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x018</span> Self             <span class=\"token operator\">:</span> Ptr32 _NT_TIB</code></pre></div>\n<ul>\n<li>TEB 구조체에서 가장 첫 멤버임을 확인할 수 있다.</li>\n<li>TEB는 FS 세그먼트 레지스터가 가리키는 세그먼트 메모리의 시작 주소 (base address)에 위치한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">TEB<span class=\"token punctuation\">.</span>NtTib<span class=\"token punctuation\">.</span>ExceptionList <span class=\"token operator\">=</span> FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<ul>\n<li><a href=\"#seh-%EB%A7%A4%EC%BB%A4%EB%8B%88%EC%A6%98\">SEH 매커니즘</a></li>\n<li><a href=\"#%EC%9D%BC%EB%B0%98-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\">일반 실행의 경우 예외 처리 방법</a></li>\n<li><a href=\"#%EB%94%94%EB%B2%84%EA%B9%85-%EC%8B%A4%ED%96%89%EC%9D%98-%EA%B2%BD%EC%9A%B0-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EB%B2%95\">디버깅 실행의 경우 예외 처리 방법</a></li>\n<li><a href=\"#%EB%94%94%EB%B2%84%EA%B1%B0-%EC%8B%A4%ED%96%89-%EC%A4%91%EC%A7%80%EC%8B%9C-%EC%A1%B0%EC%B9%98\">디버거 실행 중지시 조치</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#excpetion\">Excpetion</a></p>\n<ul>\n<li><a href=\"#status_access_violation--dword---0xc0000005l\">STATUS_ACCESS_VIOLATION  (DWORD   )0xC0000005L</a></li>\n<li><a href=\"#status_breakpoint-dword---0x80000003l\">STATUS_BREAKPOINT (DWORD   )0x80000003L</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#breakpoint-%EA%B5%AC%ED%98%84-%EB%B0%A9%EB%B2%95\">BreakPoint 구현 방법</a></p>\n<ul>\n<li><a href=\"#int-3\">INT 3</a></li>\n<li><a href=\"#status_illegal_instruction-------dword---0xc000001dl\">STATUS_ILLEGAL_INSTRUCTION       ((DWORD   )0xC000001DL)</a></li>\n<li><a href=\"#status_integer_divide_by_zero----dword---0xc0000094l\">STATUS_INTEGER_DIVIDE_BY_ZERO    (DWORD   )0xC0000094L</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#seh-chain\">SEH Chain</a></p>\n</li>\n<li>\n<p><a href=\"#seh-%ED%95%A8%EC%88%98-%EC%A0%95%EC%9D%98\">SEH 함수 정의</a></p>\n<ul>\n<li><a href=\"#multi-thread\">Multi-Thread</a></li>\n<li><a href=\"#exception_disposition-enum\">EXCEPTION_DISPOSITION enum</a></li>\n<li><a href=\"#tebnttibexceptionlist\">TEB.NtTib.ExceptionList</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"SEH (Structured Exception Handler) SEH Windows 운영체제에서 제공하는 예외처리 시스템이다.  키워드로 간단히 구현할 수 있다. 하드웨어 오류와 같은 특정 예외 코드 상황을 정상적으로 처리하기 위해 C에 대한 Microsoft 확장이다. SEH를 사용하면 실행이 예기치 않게 종료 되는 경우 메모리 블록 및 파일과 같은 리소스가 올바르게 해제 되도록 할 수 있다. SEH 매커니즘 예외 처리기 ,  예외에 응답 하거나 해제할 수 있는 블록 Termination Handlers  예외가 종료를 발생 시키는 지 여부에 관계 없이 항상 호출되는 종료 처리기 또는 블록 일반 실행의 경우 예외 처리 방법 OS는 프로세스 실행 중에 예외가 발생하면 프로세스에게 처리를 맡긴다. 프로세스 코드에 (SEH…) 예외처 리가 구현되어 있다면, 해당 예외를 잘 처리한 후 게속 실행될 것이다. 구현되어 있지 않다면 기본 예외 처리기를 동작시켜 프로세스를 종료 시킨다. 디버깅…","frontmatter":{"date":"January 03, 2021","title":"Windows SEH (Structured Exception Handler) 0","categories":"Windows","author":"Zer0Luck","emoji":"🍙"},"fields":{"slug":"/window_3_theori/"}},"next":{"id":"a2b2882f-79f1-5058-be0a-cc4ee51e785c","html":"<h2 id=\"seh\" style=\"position:relative;\"><a href=\"#seh\" aria-label=\"seh permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SEH</h2>\n<ul>\n<li><code class=\"language-text\">exception handlers</code> 는 각 Thread와 관련된 <code class=\"language-text\">Singly-linked list</code> 구성된다.</li>\n<li>원칙적으로 해당 목록의 노드는 stack에 할당된다.</li>\n<li>목록의 Head는 TEB(Thred Environment Block)의 시작 부분에 있는 포인터로 가리키므로 코드가 새 예외처리기를 추가하려는 경우 새 노드가 목록의 헤드와 포인터에 추가된다.</li>\n<li>TEB에서 새 노드를 가리키도록 변경된다.</li>\n<li>각 노드는 <code class=\"language-text\">_EXCEPTION_REGISTRATION_RECORD</code> 유형이며 핸들러의 주소와 목록의 다음 노드에 대한 포인터를 저장한다.</li>\n<li>이상하게도 목록의 마지막 노드의 “next pointer” 는 NULL이 아니지만 <code class=\"language-text\">0xFFFFFFFF</code> 와 같다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">000</span><span class=\"token operator\">></span> dt _EXCEPTION_REGISTRATION_RECORD\nntdll<span class=\"token operator\">!</span>_EXCEPTION_REGISTRATION_RECORD\n<span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next <span class=\"token operator\">:</span> Ptr32 _EXCEPTION_REGISTRATION_RECORD\n<span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler <span class=\"token operator\">:</span> Ptr32 _EXCEPTION_DISPOSITION\n\n<span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">005</span><span class=\"token operator\">></span> dt _EXCEPTION_REGISTRATION_RECORD\ncombase<span class=\"token operator\">!</span>_EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next             <span class=\"token operator\">:</span> Ptr32 _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler          <span class=\"token operator\">:</span> Ptr32     _EXCEPTION_DISPOSITION</code></pre></div>\n<ul>\n<li>TEB는 FS:[0] 부터 시작하는 <code class=\"language-text\">selector</code> FS를 통해서도 액세스 할 수 있으므로 다음과 같은 코드르 보는 것이 일반적이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">mov eax<span class=\"token punctuation\">,</span> dword ptr fs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">00000000</span>h<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">;</span> retrieve the head\npush eax <span class=\"token punctuation\">;</span> save the old head\nlea eax<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">-</span><span class=\"token number\">10</span>h<span class=\"token punctuation\">]</span>\nmov dword ptr fs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">00000000</span>h<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> eax <span class=\"token punctuation\">;</span> set the <span class=\"token keyword\">new</span> head\nmov ecx<span class=\"token punctuation\">,</span> dword ptr <span class=\"token punctuation\">[</span>ebp<span class=\"token operator\">-</span><span class=\"token number\">10</span>h<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">;</span> get the old <span class=\"token function\">head</span> <span class=\"token punctuation\">(</span>NEXT field of the current head<span class=\"token punctuation\">)</span>\nmov dword ptr fs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">00000000</span>h<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> ecx <span class=\"token punctuation\">;</span> restore the old head</code></pre></div>\n<ul>\n<li>\n<p>컴파일러는 일반적으로 프로그램의 어느 영역이 실행되고 있는지 (전역 변수에 의존) 알고 호출될 될 때 그에 따라 동작하는 단일 전역 처리기를 등록한다.</p>\n</li>\n<li>\n<p>각 스레드에는 다른 <code class=\"language-text\">TEB</code> 가 있으므로 운영 체제는 <code class=\"language-text\">FS</code> 에 의해 선택된 세그먼트가 항상 올바른 TEB(즉, 현재 스레드 중 하나)를 참조하는지 확인한다.</p>\n</li>\n<li>\n<p>TEB의 주소를 얻을려면 TEB의 Self 필드에 해당하는 <code class=\"language-text\">FS:[18h]</code>를 읽어야 한다.</p>\n</li>\n<li>\n<p>TEB를 확인해 보자</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> <span class=\"token operator\">!</span>teb\nTEB at <span class=\"token number\">00</span>b95000\n    ExceptionList<span class=\"token operator\">:</span>        <span class=\"token number\">032</span>af770\n    StackBase<span class=\"token operator\">:</span>            <span class=\"token number\">032</span>b0000\n    StackLimit<span class=\"token operator\">:</span>           <span class=\"token number\">032</span>ac000\n    SubSystemTib<span class=\"token operator\">:</span>         <span class=\"token number\">00000000</span>\n    FiberData<span class=\"token operator\">:</span>            <span class=\"token number\">00001e00</span>\n    ArbitraryUserPointer<span class=\"token operator\">:</span> <span class=\"token number\">00000000</span>\n    Self<span class=\"token operator\">:</span>                 <span class=\"token number\">00</span>b95000\n    EnvironmentPointer<span class=\"token operator\">:</span>   <span class=\"token number\">00000000</span>\n    ClientId<span class=\"token operator\">:</span>             <span class=\"token number\">0000351</span>c <span class=\"token punctuation\">.</span> <span class=\"token number\">00004360</span>\n    RpcHandle<span class=\"token operator\">:</span>            <span class=\"token number\">00000000</span>\n    Tls Storage<span class=\"token operator\">:</span>          <span class=\"token number\">00000000</span>\n    PEB Address<span class=\"token operator\">:</span>          <span class=\"token number\">00</span>b50000\n    LastErrorValue<span class=\"token operator\">:</span>       <span class=\"token number\">0</span>\n    LastStatusValue<span class=\"token operator\">:</span>      <span class=\"token number\">0</span>\n    Count Owned Locks<span class=\"token operator\">:</span>    <span class=\"token number\">0</span>\n    HardErrorMode<span class=\"token operator\">:</span>        <span class=\"token number\">0</span></code></pre></div>\n<p>FS 세그먼트가 TEB를 참조하는 지 확인해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> dg fs\n                                  P Si Gr Pr Lo\nSel    Base     Limit     Type    l ze an es ng Flags\n<span class=\"token operator\">--</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span> <span class=\"token operator\">-</span> <span class=\"token operator\">--</span> <span class=\"token operator\">--</span> <span class=\"token operator\">--</span> <span class=\"token operator\">--</span> <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span>\n<span class=\"token number\">0053</span> <span class=\"token number\">00</span>b95000 <span class=\"token number\">00000fff</span> Data RW Ac <span class=\"token number\">3</span> Bg By P  Nl <span class=\"token number\">000004f</span>3</code></pre></div>\n<ul>\n<li>FS:[18h] 에는 TEB의 주소가 포함되어 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> <span class=\"token operator\">?</span><span class=\"token function\">poi</span><span class=\"token punctuation\">(</span>fs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nEvaluate expression<span class=\"token operator\">:</span> <span class=\"token number\">12144640</span> <span class=\"token operator\">=</span> <span class=\"token number\">00</span>b95000</code></pre></div>\n<ul>\n<li>ExceptionList가 가리키는 Structure를 확인해보도록 하겠다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> dt nt<span class=\"token operator\">!</span>_NT_TIB ExceptionList\nntdll<span class=\"token operator\">!</span>_NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> ExceptionList <span class=\"token operator\">:</span> Ptr32 _EXCEPTION_REGISTRATION_RECORD</code></pre></div>\n<ul>\n<li>각 노드는 _EXCPETION_REGISTRATION_RECORD의 Instance이다. 전체 목록을 확인하고 싶으면 <code class=\"language-text\">!slist</code> 를 사용하자</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> <span class=\"token operator\">!</span>slist $teb _EXCEPTION_REGISTRATION_RECORD\nSLIST HEADER<span class=\"token operator\">:</span>\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Alignment          <span class=\"token operator\">:</span> <span class=\"token number\">32</span>b0000032af770\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next               <span class=\"token operator\">:</span> <span class=\"token number\">32</span>af770\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Depth              <span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Sequence           <span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n\nSLIST CONTENTS<span class=\"token operator\">:</span>\n<span class=\"token number\">032</span>af770\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next             <span class=\"token operator\">:</span> <span class=\"token number\">0x032af7dc</span> _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler          <span class=\"token operator\">:</span> <span class=\"token number\">0x77759990</span>     _EXCEPTION_DISPOSITION  ntdll<span class=\"token operator\">!</span>_except_handler4<span class=\"token operator\">+</span><span class=\"token number\">0</span>\n<span class=\"token number\">032</span>af7dc\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next             <span class=\"token operator\">:</span> <span class=\"token number\">0x032af7f4</span> _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler          <span class=\"token operator\">:</span> <span class=\"token number\">0x77759990</span>     _EXCEPTION_DISPOSITION  ntdll<span class=\"token operator\">!</span>_except_handler4<span class=\"token operator\">+</span><span class=\"token number\">0</span>\n<span class=\"token number\">032</span>af7f4\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next             <span class=\"token operator\">:</span> <span class=\"token number\">0xffffffff</span> _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler          <span class=\"token operator\">:</span> <span class=\"token number\">0x7776734b</span>     _EXCEPTION_DISPOSITION  ntdll<span class=\"token operator\">!</span>FinalExceptionHandlerPad27<span class=\"token operator\">+</span><span class=\"token number\">0</span>\nffffffff\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next             <span class=\"token operator\">:</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span><span class=\"token operator\">?</span><span class=\"token operator\">?</span> \n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler          <span class=\"token operator\">:</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span><span class=\"token operator\">?</span><span class=\"token operator\">?</span> \nCan<span class=\"token number\">'</span>t read memory at ffffffff<span class=\"token punctuation\">,</span> error <span class=\"token number\">0</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">$teb</code> 는 TEB의 주소이다.</p>\n</li>\n<li>\n<p>SEH chain을 표시하는 더 간단한 방법은 다음을 사용하는 것이다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> <span class=\"token operator\">!</span>exchain\n<span class=\"token number\">032</span>af770<span class=\"token operator\">:</span> ntdll<span class=\"token operator\">!</span>_except_handler4<span class=\"token operator\">+</span><span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">77759990</span><span class=\"token punctuation\">)</span>\n  CRT scope  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> filter<span class=\"token operator\">:</span> ntdll<span class=\"token operator\">!</span>DbgUiRemoteBreakin<span class=\"token operator\">+</span><span class=\"token number\">3</span>b <span class=\"token punctuation\">(</span><span class=\"token number\">7778</span>db7b<span class=\"token punctuation\">)</span>\n                func<span class=\"token operator\">:</span>   ntdll<span class=\"token operator\">!</span>DbgUiRemoteBreakin<span class=\"token operator\">+</span><span class=\"token number\">3f</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7778</span>db7f<span class=\"token punctuation\">)</span>\n<span class=\"token number\">032</span>af7dc<span class=\"token operator\">:</span> ntdll<span class=\"token operator\">!</span>_except_handler4<span class=\"token operator\">+</span><span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">77759990</span><span class=\"token punctuation\">)</span>\n  CRT scope  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> filter<span class=\"token operator\">:</span> ntdll<span class=\"token operator\">!</span>__RtlUserThreadStart<span class=\"token operator\">+</span><span class=\"token number\">3</span>d6c5 <span class=\"token punctuation\">(</span><span class=\"token number\">77784</span>c8a<span class=\"token punctuation\">)</span>\n                func<span class=\"token operator\">:</span>   ntdll<span class=\"token operator\">!</span>__RtlUserThreadStart<span class=\"token operator\">+</span><span class=\"token number\">3</span>d75e <span class=\"token punctuation\">(</span><span class=\"token number\">77784</span>d23<span class=\"token punctuation\">)</span>\n<span class=\"token number\">032</span>af7f4<span class=\"token operator\">:</span> ntdll<span class=\"token operator\">!</span>FinalExceptionHandlerPad27<span class=\"token operator\">+</span><span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7776734</span>b<span class=\"token punctuation\">)</span>\nInvalid exception stack at ffffffff</code></pre></div>\n<ul>\n<li>SEH chain을 수동으로 검사 할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">003</span><span class=\"token operator\">></span> dt <span class=\"token number\">032</span>af770 _EXCEPTION_REGISTRATION_RECORD\nntdll<span class=\"token operator\">!</span>_EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> Next             <span class=\"token operator\">:</span> <span class=\"token number\">0x032af7dc</span> _EXCEPTION_REGISTRATION_RECORD\n   <span class=\"token operator\">+</span><span class=\"token number\">0x004</span> Handler          <span class=\"token operator\">:</span> <span class=\"token number\">0x77759990</span>     _EXCEPTION_DISPOSITION  ntdll<span class=\"token operator\">!</span>_except_handler4<span class=\"token operator\">+</span><span class=\"token number\">0</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#seh\">SEH</a></li>\n</ul>\n</div>","frontmatter":{"date":"January 03, 2021","title":"Windows SEH (Structured Exception Handler) 1","categories":"Windows","author":"Zer0Luck","emoji":"🥖"},"fields":{"slug":"/window_2_theori/"}},"prev":{"id":"60cba5e7-39d0-5855-a5bc-bcc248468cd4","html":"<h1 id=\"teb-thread-environment-block\" style=\"position:relative;\"><a href=\"#teb-thread-environment-block\" aria-label=\"teb thread environment block permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TEB (Thread Environment Block)</h1>\n<ul>\n<li>프로세스에서 실행되는 스레드에 대한 정보를 담고 있는 구조체</li>\n<li>스레드별로 TEB 구조체가 하나씩 할당된다.</li>\n<li>OS 종류별로 해당 모양이 조금씩 달라진다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_TEB</span> <span class=\"token punctuation\">{</span>\n  PVOID Reserved1<span class=\"token punctuation\">[</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PPEB  ProcessEnvironmentBlock<span class=\"token punctuation\">;</span>\n  PVOID Reserved2<span class=\"token punctuation\">[</span><span class=\"token number\">399</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  BYTE  Reserved3<span class=\"token punctuation\">[</span><span class=\"token number\">1952</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID TlsSlots<span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  BYTE  Reserved4<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID Reserved5<span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID ReservedForOle<span class=\"token punctuation\">;</span>\n  PVOID Reserved6<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  PVOID TlsExpansionSlots<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> TEB<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>PTEB<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">001</span><span class=\"token operator\">></span> dt _TEB\nntdll<span class=\"token operator\">!</span>_TEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> NtTib            <span class=\"token operator\">:</span> _NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x01c</span> EnvironmentPointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x020</span> ClientId         <span class=\"token operator\">:</span> _CLIENT_ID\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> ActiveRpcHandle  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x02c</span> ThreadLocalStoragePointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessEnvironmentBlock <span class=\"token operator\">:</span> Ptr32 _PEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x034</span> LastErrorValue   <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x038</span> CountOfOwnedCriticalSections <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x03c</span> CsrClientThread  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x040</span> Win32ThreadInfo  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x044</span> User32Reserved   <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0ac</span> UserReserved     <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c0</span> WOW32Reserved    <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c4</span> CurrentLocale    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0c8</span> FpSoftwareStatusRegister <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x0cc</span> ReservedForDebuggerInstrumentation <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x10c</span> SystemReserved1  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x174</span> PlaceholderCompatibilityMode <span class=\"token operator\">:</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x175</span> PlaceholderHydrationAlwaysExplicit <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x176</span> PlaceholderReserved <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> Char\n   <span class=\"token operator\">+</span><span class=\"token number\">0x180</span> ProxiedProcessId <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x184</span> _ActivationStack <span class=\"token operator\">:</span> _ACTIVATION_CONTEXT_STACK\n   <span class=\"token operator\">+</span><span class=\"token number\">0x19c</span> WorkingOnBehalfTicket <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1a4</span> ExceptionCode    <span class=\"token operator\">:</span> Int4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1a8</span> ActivationContextStackPointer <span class=\"token operator\">:</span> Ptr32 _ACTIVATION_CONTEXT_STACK\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1ac</span> InstrumentationCallbackSp <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b0</span> InstrumentationCallbackPreviousPc <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b4</span> InstrumentationCallbackPreviousSp <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b8</span> InstrumentationCallbackDisabled <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1b9</span> SpareBytes       <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1d0</span> TxFsContext      <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x1d4</span> GdiTebBatch      <span class=\"token operator\">:</span> _GDI_TEB_BATCH\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6b4</span> RealClientId     <span class=\"token operator\">:</span> _CLIENT_ID\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6bc</span> GdiCachedProcessHandle <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6c0</span> GdiClientPID     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6c4</span> GdiClientTID     <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6c8</span> GdiThreadLocalInfo <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x6cc</span> Win32ClientInfo  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">62</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0x7c4</span> glDispatchTable  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">233</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xb68</span> glReserved1      <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">29</span><span class=\"token punctuation\">]</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbdc</span> glReserved2      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbe0</span> glSectionInfo    <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbe4</span> glSection        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbe8</span> glTable          <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbec</span> glCurrentRC      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbf0</span> glContext        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbf4</span> LastStatusValue  <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xbf8</span> StaticUnicodeString <span class=\"token operator\">:</span> _UNICODE_STRING\n   <span class=\"token operator\">+</span><span class=\"token number\">0xc00</span> StaticUnicodeBuffer <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">261</span><span class=\"token punctuation\">]</span> Wchar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xe0c</span> DeallocationStack <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xe10</span> TlsSlots         <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf10</span> TlsLinks         <span class=\"token operator\">:</span> _LIST_ENTRY\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf18</span> Vdm              <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf1c</span> ReservedForNtRpc <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf20</span> DbgSsReserved    <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf28</span> HardErrorMode    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf2c</span> Instrumentation  <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf50</span> ActivityId       <span class=\"token operator\">:</span> _GUID\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf60</span> SubProcessTag    <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf64</span> PerflibData      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf68</span> EtwTraceData     <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf6c</span> WinSockData      <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf70</span> GdiBatchCount    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf74</span> CurrentIdealProcessor <span class=\"token operator\">:</span> _PROCESSOR_NUMBER\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf74</span> IdealProcessorValue <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf74</span> ReservedPad0     <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf75</span> ReservedPad1     <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf76</span> ReservedPad2     <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf77</span> IdealProcessor   <span class=\"token operator\">:</span> UChar\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf78</span> GuaranteedStackBytes <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf7c</span> ReservedForPerf  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf80</span> ReservedForOle   <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf84</span> WaitingOnLoaderLock <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf88</span> SavedPriorityState <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf8c</span> ReservedForCodeCoverage <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf90</span> ThreadPoolData   <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf94</span> TlsExpansionSlots <span class=\"token operator\">:</span> Ptr32 Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf98</span> MuiGeneration    <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xf9c</span> IsImpersonating  <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfa0</span> NlsCache         <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfa4</span> pShimData        <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfa8</span> HeapData         <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfac</span> CurrentTransactionHandle <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfb0</span> ActiveFrame      <span class=\"token operator\">:</span> Ptr32 _TEB_ACTIVE_FRAME\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfb4</span> FlsData          <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfb8</span> PreferredLanguages <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfbc</span> UserPrefLanguages <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc0</span> MergedPrefLanguages <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc4</span> MuiImpersonation <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc8</span> CrossTebFlags    <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfc8</span> SpareCrossTebBits <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> Bits\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SameTebFlags     <span class=\"token operator\">:</span> Uint2B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SafeThunkCall    <span class=\"token operator\">:</span> Pos <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> InDebugPrint     <span class=\"token operator\">:</span> Pos <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> HasFiberData     <span class=\"token operator\">:</span> Pos <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SkipThreadAttach <span class=\"token operator\">:</span> Pos <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> WerInShipAssertCode <span class=\"token operator\">:</span> Pos <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> RanProcessInit   <span class=\"token operator\">:</span> Pos <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> ClonedThread     <span class=\"token operator\">:</span> Pos <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SuppressDebugMsg <span class=\"token operator\">:</span> Pos <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> DisableUserStackWalk <span class=\"token operator\">:</span> Pos <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> RtlExceptionAttached <span class=\"token operator\">:</span> Pos <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> InitialThread    <span class=\"token operator\">:</span> Pos <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SessionAware     <span class=\"token operator\">:</span> Pos <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> LoadOwner        <span class=\"token operator\">:</span> Pos <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> LoaderWorker     <span class=\"token operator\">:</span> Pos <span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SkipLoaderInit   <span class=\"token operator\">:</span> Pos <span class=\"token number\">14</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfca</span> SpareSameTebBits <span class=\"token operator\">:</span> Pos <span class=\"token number\">15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> Bit\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfcc</span> TxnScopeEnterCallback <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfd0</span> TxnScopeExitCallback <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfd4</span> TxnScopeContext  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfd8</span> LockCount        <span class=\"token operator\">:</span> Uint4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfdc</span> WowTebOffset     <span class=\"token operator\">:</span> Int4B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfe0</span> ResourceRetValue <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfe4</span> ReservedForWdf   <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0xfe8</span> ReservedForCrt   <span class=\"token operator\">:</span> Uint8B\n   <span class=\"token operator\">+</span><span class=\"token number\">0xff0</span> EffectiveContainerId <span class=\"token operator\">:</span> _GUID</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">001</span><span class=\"token operator\">></span> dt _TEB\nntdll<span class=\"token operator\">!</span>_TEB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x000</span> NtTib            <span class=\"token operator\">:</span> _NT_TIB\n   <span class=\"token operator\">+</span><span class=\"token number\">0x01c</span> EnvironmentPointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x020</span> ClientId         <span class=\"token operator\">:</span> _CLIENT_ID\n   <span class=\"token operator\">+</span><span class=\"token number\">0x028</span> ActiveRpcHandle  <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x02c</span> ThreadLocalStoragePointer <span class=\"token operator\">:</span> Ptr32 Void\n   <span class=\"token operator\">+</span><span class=\"token number\">0x030</span> ProcessEnvironmentBlock <span class=\"token operator\">:</span> Ptr32 _PEB\n\t <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"processenvironmentblock-member\" style=\"position:relative;\"><a href=\"#processenvironmentblock-member\" aria-label=\"processenvironmentblock member permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ProcessEnvironmentBlock member</h3>\n<ul>\n<li>0x30 offset 에 위치한 ProcessEnvironmentBlock member</li>\n<li>PEB(Process Environment Block) 구조체의 포인터이다.</li>\n<li>PEB는 프로세스 별로 하나만 생성된다.</li>\n</ul>\n<h3 id=\"nttib-member\" style=\"position:relative;\"><a href=\"#nttib-member\" aria-label=\"nttib member permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NtTib member</h3>\n<ul>\n<li>TEB 구조체의 첫 번째 멤버는 <code class=\"language-text\">_NT_TIB</code> 구조체이다.</li>\n<li>_NT_TIB (_NT_Thread information Block)</li>\n<li>현재 실행 중인 스레드에 대한 정보를 저장하고 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_NT_TIB</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_EXCEPTION_REGISTRATION_RECORD</span> <span class=\"token operator\">*</span>ExceptionList<span class=\"token punctuation\">;</span>\n    PVOID StackBase<span class=\"token punctuation\">;</span>\n    PVOID StackLimit<span class=\"token punctuation\">;</span>\n    PVOID SubSystemTib<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>_MSC_EXTENSIONS<span class=\"token punctuation\">)</span></span></span>\n    <span class=\"token keyword\">union</span> <span class=\"token punctuation\">{</span>\n        PVOID FiberData<span class=\"token punctuation\">;</span>\n        DWORD Version<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span>\n    PVOID FiberData<span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span>\n    PVOID ArbitraryUserPointer<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_NT_TIB</span> <span class=\"token operator\">*</span>Self<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> NT_TIB<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">typedef</span> NT_TIB <span class=\"token operator\">*</span>PNT_TIB<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>ExceptionList member는 _EXCEPTION_REGISTRATION_RECORD 구조체 연결 리스트를 가리키고 있다. 이것은 SEH(Structured Exception Handler) 라고 하는 Window OS의 예외 처리 메커니즘에 사용된다.</li>\n<li>Self 멤버는 _NT_TIB 구조체의 셀프 포인터이며 곧 TEB 구조체 포인터이기도 한다. (TEB 구조체 첫 번째 멤버가 _NT_TIB 구조체이기 때문이다.)</li>\n</ul>\n<h2 id=\"유저-모드-teb-접근-방법\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EC%A0%80-%EB%AA%A8%EB%93%9C-teb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\" aria-label=\"유저 모드 teb 접근 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유저 모드 TEB 접근 방법</h2>\n<h3 id=\"ntdllntcurrentteb\" style=\"position:relative;\"><a href=\"#ntdllntcurrentteb\" aria-label=\"ntdllntcurrentteb permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ntdll.NtCurrentTeb()</h3>\n<ul>\n<li>Ntdll.NtCurrentTeb() API는 현재 스레드의 TEB 구조체 주소를 리턴하는 함수이다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVQY0y3L4XJDMAAAYO//Ul23m2okKSEJcYoeIorS0uoWs+tud9/fz8C+54uEcEFFjBziHmDAaBCEruezMDomSZZmsqqklEVZ5sVLWUopK6WUgTGwgRVw6mDoYGCZW2zv7f2OEsQpCZknOGWMHqCNEHQhwMBk1BMBi6PQyGNO7I/qFKaC5DHFuy0yN87+vcrE86rmQfUq6+rie2y+bmc9NsvULvdOT62eWqPOY+6Cvj6lws+PDFlbaG4CYs9Xtepx1ePjdh4a+TP3+t4tj8v6HNa5f3kOBvh84wTWRXIMvTSiHrZctIuY01anoSmubdnItD/Ln8dFT91y7/7nn19hlAa2U/3ljAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./0.png\"\n        title=\"./0.png\"\n        src=\"/static/313b08180b86b127459eec3e7216e166/37523/0.png\"\n        srcset=\"/static/313b08180b86b127459eec3e7216e166/e9ff0/0.png 180w,\n/static/313b08180b86b127459eec3e7216e166/f21e7/0.png 360w,\n/static/313b08180b86b127459eec3e7216e166/37523/0.png 720w,\n/static/313b08180b86b127459eec3e7216e166/302a4/0.png 1080w,\n/static/313b08180b86b127459eec3e7216e166/b5cea/0.png 1140w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQY02XPW2+CMACGYf7/31l2sSsWzSYagR5oQWgplEpBxkHUTd0mC0vc4pY8F+93+RmXYzec+12tObTlykuZryWrtfR8GDFaZrIISZWLusiaUnVV/k03WvZKGCqJtOQiCsBijhwbI4AhoBhaEDjQ9SD07CVBgGAYBjQVcRLzEWcpC41qHW8UqxQvFWuL9NDk+3p9aPVw7C5v7egan6/NrdYYPvbD+2503g3nfjhtR8ft2D/zdJ23jMCnCNiUYOAsMQau7XjIJQR6rkUxJhitqEcQiHmUCP6H8Twxp+Z0tnhy3Lk5M+/uHyazRxfNA+KIkEQ+bEvZbVS3yf4zMLQiBaPMFQXkGqQviPKljS0R0zKPlQz7Wv9eu/UFCPh13YKrvi4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./1.png\"\n        title=\"./1.png\"\n        src=\"/static/0ddfab9384ee51c255ffd546801bd9a8/37523/1.png\"\n        srcset=\"/static/0ddfab9384ee51c255ffd546801bd9a8/e9ff0/1.png 180w,\n/static/0ddfab9384ee51c255ffd546801bd9a8/f21e7/1.png 360w,\n/static/0ddfab9384ee51c255ffd546801bd9a8/37523/1.png 720w,\n/static/0ddfab9384ee51c255ffd546801bd9a8/eafa0/1.png 939w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>NtCurrentTeb() 의 내부 코드는 아주 간단하게 구성되어 있다.</li>\n<li><code class=\"language-text\">FS:[18]</code> 주소의 값을 리턴 한다.</li>\n<li>FS:[18] 실제 주소 <code class=\"language-text\">00281018</code> 을 확인할 수 있는데 메모리 창에서 주소를 확인해보면 <code class=\"language-text\">00281000</code> 값이 들어 있다.</li>\n<li>NtCuurentTeb() API 는 이 값을 리턴하고 있다.</li>\n<li>따라서 이 값이 바로 현재 스레드의 TEB 주소 이다.</li>\n<li>TEB 주소(00281000) 주소는 FS 세그먼트 레지스터가 가리키는 세그먼트 메모리의 베이스 주소와 일치한다.</li>\n</ul>\n<h2 id=\"fs-segment-register\" style=\"position:relative;\"><a href=\"#fs-segment-register\" aria-label=\"fs segment register permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS Segment Register</h2>\n<ul>\n<li>FS 세그먼트 레지스터는 현재 스레드의 TEB를 지시하는데 사용한다.</li>\n<li><code class=\"language-text\">IA32</code> 시스템에서는 프로세스의 가상 메모리 크기가 4GB이므로 32비트 크기의 포인터를 이용해야 전체 메모리 공간에 접근이 가능하다.</li>\n<li>FS 레지스터의 크기는 16비트밖에 안된다.</li>\n<li>FS 레지스터는 직접 TEB 주소를 가리키는 것이 아니라, 실제 TEB 주소를 가지고 있는 <code class=\"language-text\">Segment Descriptor Table</code> 의 Index를 가지고 있는것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Segment Descriptor Table은 커널 메모리 영역에 존재하며\n특수 레지스터인 <span class=\"token function\">GDTR</span><span class=\"token punctuation\">(</span>Global Descriptor Table Register<span class=\"token punctuation\">)</span>에 그 주소가 저장되어 있다<span class=\"token punctuation\">.</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVQoz3WS3UsUURjG95/JdeecmTMzO64frLtq67q6bquuaWkZq5uaBUEJhWQpCHWRghRSBFb4hZn2BUFEhUUX4YUE1VXdSF1UhFFCCbK/2GmjoLp4eF7OOfx43vO+HiHNrBAKIZTrUrfwaQbB8koSDSmqY3Fi8R1E6xLU1icJFJeh5d8Jaf6WbrlnHqGbSNOflZaDK2Xj0xSOU8LyxU5ez2d4OZNhbbGbq8O78Ek/QiqkNDEME6UslGEhpXLBHqnb2eDhRzSdeZONjazhJAcQhV4su5jnY+18m0rzaXIfW7Od3Dyxk20+E123CIajJFN7iMabSTS2Eaqs+wW0qG3qp75lkPrWIUpDjQhh4DjFvLp8gK17x/ly6yjcP8ad0x14pY0Sisj4OPFnT2l/vEzi6ROi83MoswhPjmqaCqV0V4ah0ISJbRexej7N12t9vJ/u4ftiH4tDuynQLPQcsL+HugunSJ4bJD5xkujIkZ/A3F/4CgWFXg2fV3PT5YCWVcSLiQ42F7pYn+kku5Th9nCr27Jh2FQGq4mU11AVjLq+vbwmn1C3MMMJiiIpnEgzRqACTTNc4OpEBxvXM3yY7WTzxn6W8kDdsAiGIoSrYoQra1wPVUQxlINHkzbV/Sukxz/SevYzgYYhhK8A21/Cyuhe1q908e5Smo2pDAsDLRRouaGY7or8Sx4hc0UJUi9F6mVI3XEvbDvA2+k0POiFu92w3MfD0bb8lM2/9zAvj9RzhfGHFLrhx7aLGUsnmT7YxGRvI3OHUgy01lEocrD/J/wByl+GNmQQIYoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"./SGT.png\"\n        title=\"./SGT.png\"\n        src=\"/static/072d5e551d215b08984b841e81b2b639/37523/SGT.png\"\n        srcset=\"/static/072d5e551d215b08984b841e81b2b639/e9ff0/SGT.png 180w,\n/static/072d5e551d215b08984b841e81b2b639/f21e7/SGT.png 360w,\n/static/072d5e551d215b08984b841e81b2b639/37523/SGT.png 720w,\n/static/072d5e551d215b08984b841e81b2b639/302a4/SGT.png 1080w,\n/static/072d5e551d215b08984b841e81b2b639/07a9c/SGT.png 1440w,\n/static/072d5e551d215b08984b841e81b2b639/74e37/SGT.png 1732w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>세그먼트 레지스터는 실제로 Segment Descriptor Table의 Index를 가지고 있기 때문에 Segment Selector 라는 별칭을 가지고 있다.</li>\n<li>FS 세그먼트 셀렉터가 가리키는 세그먼트 메모리의 시작주소 (base address) 에 TEB 구조체가 위치하는 것을 확인할 수 있다.</li>\n</ul>\n<h3 id=\"fs0x18--teb-base-address\" style=\"position:relative;\"><a href=\"#fs0x18--teb-base-address\" aria-label=\"fs0x18  teb base address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS:[0x18] = TEB base address</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>NtTib<span class=\"token punctuation\">.</span>Self <span class=\"token operator\">=</span> address of TIB <span class=\"token operator\">=</span> address of TEB <span class=\"token operator\">=</span> FS<span class=\"token operator\">:</span><span class=\"token number\">0</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x2810100</span>\n\nFS<span class=\"token operator\">:</span><span class=\"token number\">0</span> 의 의미는 FS 레지스터가 Indexing 하는 Segment Descriptor가 가리키는 Segment Memory의\n시작 주소이다<span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"fs0x30--peb-base-address\" style=\"position:relative;\"><a href=\"#fs0x30--peb-base-address\" aria-label=\"fs0x30  peb base address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS:[0x30] = PEB base address</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>ProcessEnvironmentBlock <span class=\"token operator\">=</span> address of PEB</code></pre></div>\n<h3 id=\"fs0x0--seh-base-address\" style=\"position:relative;\"><a href=\"#fs0x0--seh-base-address\" aria-label=\"fs0x0  seh base address permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FS:[0x0] = SEH base address</h3>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">FS<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> TEB<span class=\"token punctuation\">.</span>NtTib<span class=\"token punctuation\">.</span>ExceptionList <span class=\"token operator\">=</span> address of SEH</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<ul>\n<li><a href=\"#processenvironmentblock-member\">ProcessEnvironmentBlock member</a></li>\n<li><a href=\"#nttib-member\">NtTib member</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%9C%A0%EC%A0%80-%EB%AA%A8%EB%93%9C-teb-%EC%A0%91%EA%B7%BC-%EB%B0%A9%EB%B2%95\">유저 모드 TEB 접근 방법</a></p>\n<ul>\n<li><a href=\"#ntdllntcurrentteb\">Ntdll.NtCurrentTeb()</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#fs-segment-register\">FS Segment Register</a></p>\n<ul>\n<li><a href=\"#fs0x18--teb-base-address\">FS:[0x18] = TEB base address</a></li>\n<li><a href=\"#fs0x30--peb-base-address\">FS:[0x30] = PEB base address</a></li>\n<li><a href=\"#fs0x0--seh-base-address\">FS:[0x0] = SEH base address</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"January 03, 2021","title":"TEB (Thread Environment Block)","categories":"Windows","author":"Zer0Luck","emoji":"🍬"},"fields":{"slug":"/window_4_theori/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/window_3_theori/","nextSlug":"/window_2_theori/","prevSlug":"/window_4_theori/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}